import{a as vn}from"./chunk-6HKCU7ME.js";import{$ as re,$a as zi,A as h,Aa as be,Ab as Zi,B as b,Ba as Ti,Bb as xt,C as w,Ca as Ii,Cb as _t,D,Da as Fi,Db as Ne,E as ct,Ea as Ai,Eb as _e,F as ti,Fa as Di,Fb as Ce,G as mt,Ga as ii,Gb as Xi,H as vi,Hb as en,I as xi,Ia as ve,Ib as Ke,J as _i,Ja as Ye,Jb as Ct,K as Ci,Ka as ni,Kb as ye,L as pe,La as Pi,Lb as ze,M as ge,Ma as P,Mb as tn,Na as Vi,Nb as nn,O as s,Oa as qe,P as yi,Pa as pt,Q as y,Qa as Oi,R as A,Ra as q,S as Si,Sa as qi,T as Ei,Ta as Ri,U as wi,Ua as ae,V as j,Va as ji,W as ki,Wa as Li,X as We,Xa as Re,Ya as je,Z as u,Za as Ni,_ as p,_a as U,a as at,ab as G,b as lt,ba as M,bb as W,c as K,ca as T,cb as z,d as ce,da as C,db as Hi,e as Qe,ea as r,eb as $i,f as st,fa as o,g as ci,ga as g,h as Z,ha as S,hb as gt,i as mi,ia as f,ib as xe,j as ui,ja as c,jb as Ui,k as Xt,ka as Mi,kb as te,l as ke,la as ut,lb as Gi,m as Me,ma as Pe,mb as Bi,n as De,na as Ve,nb as le,o as pi,oa as Oe,ob as Qi,p as gi,pa as Je,pb as O,q as fi,qa as oe,qb as se,r as dt,ra as F,rb as ft,s as N,sb as ht,t as me,ta as Q,tb as Wi,u as ei,ua as l,ub as Le,v as $,va as E,vb as bt,w as hi,wa as _,wb as Ji,x as bi,xa as ne,xb as Yi,y as J,ya as fe,yb as Ki,z as R,za as he,zb as vt}from"./chunk-GDOXGUHT.js";import{a as we,b as Ae,g as bn,h as B}from"./chunk-PHUH23IY.js";var yt=class n{lastActivity=Date.now();INACTIVITY_THRESHOLD=10*60*1e3;constructor(){this.initActivityListeners()}initActivityListeners(){["mousedown","keydown","scroll","touchstart"].forEach(t=>{document.addEventListener(t,()=>this.updateActivity(),{passive:!0})})}updateActivity(){this.lastActivity=Date.now()}isUserActive(){return Date.now()-this.lastActivity<this.INACTIVITY_THRESHOLD}getInactivityDuration(){return Math.floor((Date.now()-this.lastActivity)/1e3)}getLastActivityTimestamp(){return this.lastActivity}static \u0275fac=function(e){return new(e||n)};static \u0275prov=$({token:n,factory:n.\u0275fac,providedIn:"root"})};var rn=(n,t)=>{let e=R(W),i=R(U),a=R(z),d=R(yt),m=e.getToken();return m&&n.url.includes("/api/")&&(n=n.clone({setHeaders:{Authorization:`Bearer ${m}`}})),t(n).pipe(Me(v=>{if(v.status===401){if(n.url.includes("/auth/verify-token"))return a.error("Session expir\xE9e","Impossible de renouveler votre session. Veuillez vous reconnecter."),e.logout(),i.navigate(["/"]),st(()=>v);if(d.isUserActive())return e.refreshToken().pipe(dt(I=>{let x=n.clone({setHeaders:{Authorization:`Bearer ${I.token}`}});return t(x)}),Me(I=>(console.error("Erreur lors du renouvellement du token:",I),a.error("Session expir\xE9e","Impossible de renouveler votre session. Veuillez vous reconnecter."),e.logout(),i.navigate(["/"]),st(()=>I))));a.error("Session expir\xE9e","Votre session a expir\xE9 suite \xE0 une inactivit\xE9 prolong\xE9e."),e.logout(),i.navigate(["/"])}return st(()=>v)}))};var St=class n{constructor(t){this.http=t}apiUrl=`${G.apiUrl}/incidents`;getHistories(t){return this.http.get(`${this.apiUrl}/${t}/histories`).pipe(Z(e=>e.data))}getHistory(t,e){return this.http.get(`${this.apiUrl}/${t}/histories/${e}`).pipe(Z(i=>i.data))}static \u0275fac=function(e){return new(e||n)(J(ae))};static \u0275prov=$({token:n,factory:n.\u0275fac,providedIn:"root"})};var Cn=(n,t)=>t.id,yn=(n,t)=>t.field_key;function Sn(n,t){n&1&&(r(0,"div",3),l(1," Chargement de l'historique... "),o())}function En(n,t){if(n&1&&(r(0,"div",4),l(1),o()),n&2){let e=c();s(),_(" ",e.error," ")}}function wn(n,t){n&1&&(r(0,"div",5),l(1," Aucun historique disponible. "),o())}function kn(n,t){if(n&1&&(r(0,"div",21)(1,"strong",26),l(2,"Raison :"),o(),r(3,"span",27),l(4),o()()),n&2){let e=c(2).$implicit;s(4),E(e.reason)}}function Mn(n,t){if(n&1&&(r(0,"span",36),l(1),o()),n&2){let e=c().$implicit,i=c(5);s(),E(i.formatChangeValue(e.old_value))}}function Tn(n,t){n&1&&(r(0,"span",37),l(1,"Non renseign\xE9"),o())}function In(n,t){if(n&1&&(r(0,"span",39),l(1),o()),n&2){let e=c().$implicit,i=c(5);s(),E(i.formatChangeValue(e.new_value))}}function Fn(n,t){n&1&&(r(0,"span",37),l(1,"Non renseign\xE9"),o())}function An(n,t){if(n&1&&(r(0,"tr",33)(1,"td",34),l(2),o(),r(3,"td",35),u(4,Mn,2,1,"span",36)(5,Tn,2,0,"span",37),o(),r(6,"td",38),u(7,In,2,1,"span",39)(8,Fn,2,0,"span",37),o()()),n&2){let e=t.$implicit,i=c(5);s(2),_(" ",i.getFieldLabel(e.field)," "),s(2),p(i.isValueEmpty(e.old_value)?5:4),s(3),p(i.isValueEmpty(e.new_value)?8:7)}}function Dn(n,t){if(n&1&&(r(0,"div",22)(1,"strong",28),l(2,"Champs modifi\xE9s :"),o(),r(3,"div",29)(4,"table",30)(5,"thead",31)(6,"tr")(7,"th",32),l(8,"Champ"),o(),r(9,"th",32),l(10,"Avant"),o(),r(11,"th",32),l(12,"Apr\xE8s"),o()()(),r(13,"tbody"),M(14,An,9,3,"tr",33,yn),o()()()()),n&2){let e=c(2).$implicit;s(14),T(e.changes)}}function Pn(n,t){if(n&1&&(r(0,"div",16)(1,"div",17)(2,"div")(3,"span",18),l(4,"Utilisateur :"),o(),r(5,"span",19),l(6),o(),r(7,"span",20),l(8),o()(),r(9,"div")(10,"span",18),l(11,"Date :"),o(),r(12,"span",19),l(13),o()()(),u(14,kn,5,1,"div",21),u(15,Dn,16,0,"div",22),r(16,"details",23)(17,"summary",24),l(18," Voir l'\xE9tat complet (snapshot) "),o(),r(19,"pre",25),l(20),o()()()),n&2){let e=c().$implicit,i=c(2);s(6),E(e.user.name),s(2),_("(",e.user.email,")"),s(5),E(i.formatDate(e.created_at)),s(),p(e.reason?14:-1),s(),p(e.changes&&e.changes.length>0?15:-1),s(5),E(i.formatSnapshotForDisplay(e.snapshot))}}function Vn(n,t){if(n&1){let e=S();r(0,"div",7)(1,"button",8),f("click",function(){let a=h(e).$implicit,d=c(2);return b(d.toggleExpand(a.id))}),r(2,"span",9),l(3),o(),r(4,"div",10)(5,"div",11)(6,"strong",12),l(7),o(),r(8,"span",13),l(9),o(),r(10,"span",14),l(11),o()()(),r(12,"span",15),l(13),o()(),u(14,Pn,21,6,"div",16),o()}if(n&2){let e=t.$implicit,i=c(2);s(2),oe("color",i.getActionColor(e.action)),s(),_(" ",i.getActionIcon(e.action)," "),s(4),E(e.action_label),s(2),_("par ",e.user.name),s(2),E(e.created_at_human),s(2),_(" ",i.isExpanded(e.id)?"\u25BC":"\u25B6"," "),s(),p(i.isExpanded(e.id)?14:-1)}}function On(n,t){if(n&1&&(r(0,"div",6),M(1,Vn,15,8,"div",7,Cn),o()),n&2){let e=c();s(),T(e.histories)}}var wt=class n{constructor(t,e){this.historyService=t;this.incidentDisplayService=e}incidentId;histories=[];loading=!0;error=null;expandedIds=new Set;ngOnInit(){if(!this.incidentId){this.error="ID incident manquant",this.loading=!1;return}this.loadHistories()}loadHistories(){this.loading=!0,this.error=null,this.historyService.getHistories(this.incidentId).subscribe({next:t=>{this.histories=t,this.loading=!1},error:t=>{this.error="Erreur lors du chargement de l'historique",this.loading=!1,console.error("Erreur historique:",t)}})}isValueEmpty(t){return t==null||t===""||Array.isArray(t)&&t.length===0}formatChangeValue(t){return t==null||t===""?"":typeof t=="string"&&(/^\d{2}\/\d{2}\/\d{4}/.test(t)||/^\d{4}-\d{2}-\d{2}/.test(t))?this.incidentDisplayService.formatDateTime(t):typeof t=="boolean"?t?"Oui":"Non":Array.isArray(t)?t.join(", "):String(t)}formatDate(t){return t?this.incidentDisplayService.formatDateTime(t):""}formatSnapshotForDisplay(t){if(!t)return"{}";try{let e=JSON.parse(JSON.stringify(t)),i=["created_at","updated_at","dateOuverture","dateCloture","deleted_at","last_sync_at"],a=d=>{if(!(!d||typeof d!="object")){for(let m in d)if(d.hasOwnProperty(m)){let v=d[m];typeof v=="string"&&i.includes(m)&&!v.includes("/")?d[m]=this.formatDate(v):typeof v=="object"&&a(v)}}};return a(e),JSON.stringify(e,null,2)}catch{return JSON.stringify(t,null,2)}}fieldLabels={object:"Objet",domains:"Domaines",gravity:"Gravit\xE9",status:"Statut",dateOuverture:"Date d'ouverture",dateCloture:"Date de cl\xF4ture",isNational:"Impact National",ticketNumber:"N\xB0 Ticket",lienTicketHelpy:"Lien Helpy",lienTicketTandem:"Lien Tandem",meteo:"M\xE9t\xE9o",publicsImpactes:"Publics impact\xE9s",sitesImpactes:"Sites impact\xE9s",description:"Description",actionsMenees:"Actions men\xE9es",actionsAMener:"Actions \xE0 mener",tempsIndisponibilite:"Temps indisponibilit\xE9",mailAlerte:"Emails alerte",auto_notified_emails:"Emails auto-notifi\xE9s",template_excluded_emails:"Emails template exclus",created_by:"Cr\xE9ateur",assigned_to:"Assign\xE9 \xE0",validateur_id:"Validateur",validation_status:"Statut validation",validated_at:"Date validation",template_id:"ID Template",template_actions:"Actions Template",archived:"Archiv\xE9",archived_at:"Date archivage",archived_by:"Archiv\xE9 par",archiveReason:"Raison archivage",previousStatus:"Statut pr\xE9c\xE9dent",creator:"Cr\xE9ateur",assignee:"Assign\xE9 \xE0",validator:"Validateur",template:"Template",user:"Utilisateur",created_at:"Date de cr\xE9ation",updated_at:"Date de modification",deleted_at:"Date de suppression"};getFieldLabel(t){return this.fieldLabels[t]||t}toggleExpand(t){this.expandedIds.has(t)?this.expandedIds.delete(t):this.expandedIds.add(t)}isExpanded(t){return this.expandedIds.has(t)}getActionIcon(t){return{created:"\u2728",updated:"\u270F\uFE0F",closed:"\u2705",archived:"\u{1F4E6}",restored_archive:"\u{1F4E4}",trashed:"\u{1F5D1}\uFE0F",restored_trash:"\u267B\uFE0F",validated:"\u2714\uFE0F",downgraded:"\u2B07\uFE0F"}[t]||"\u{1F4DD}"}getActionColor(t){return{created:"#10b981",updated:"#3b82f6",closed:"#059669",archived:"#6b7280",restored_archive:"#8b5cf6",trashed:"#ef4444",restored_trash:"#10b981",validated:"#059669",downgraded:"#f59e0b"}[t]||"#6b7280"}static \u0275fac=function(e){return new(e||n)(y(St),y(gt))};static \u0275cmp=A({type:n,selectors:[["app-incident-history"]],inputs:{incidentId:"incidentId"},decls:9,vars:4,consts:[[1,"max-w-5xl","mx-auto","p-6"],[1,"text-2xl","font-bold","mb-6","flex","items-center","gap-2"],[1,"text-3xl"],[1,"bg-blue-50","border","border-blue-200","rounded-lg","p-4","text-blue-700"],[1,"bg-red-50","border","border-red-200","rounded-lg","p-4","text-red-700"],[1,"bg-gray-50","border","border-gray-200","rounded-lg","p-8","text-center","text-gray-500"],[1,"space-y-3"],[1,"bg-white","border","border-gray-200","rounded-lg","shadow-sm","hover:shadow-md","transition-shadow"],[1,"w-full","px-4","py-3","flex","items-center","gap-3","hover:bg-gray-50","transition-colors","text-left",3,"click"],[1,"text-2xl","flex-shrink-0"],[1,"flex-1","min-w-0"],[1,"flex","items-center","gap-2","flex-wrap"],[1,"font-semibold","text-gray-900"],[1,"text-sm","text-gray-600"],[1,"text-sm","text-gray-400"],[1,"text-gray-400","text-xl","flex-shrink-0"],[1,"px-4","pb-4","border-t","border-gray-100"],[1,"grid","grid-cols-2","gap-4","py-3","text-sm"],[1,"text-gray-500"],[1,"ml-2","font-medium"],[1,"text-gray-400","ml-1"],[1,"bg-blue-50","border-l-4","border-blue-400","p-3","mb-3","text-sm"],[1,"mt-3"],[1,"mt-4"],[1,"cursor-pointer","text-sm","text-gray-600","hover:text-gray-900","font-medium","py-2","px-3","bg-gray-50","rounded","hover:bg-gray-100","transition-colors"],[1,"mt-2","p-3","bg-gray-900","text-gray-100","rounded","text-xs","overflow-x-auto"],[1,"text-blue-900"],[1,"ml-2","text-blue-800"],[1,"text-gray-700","block","mb-2"],[1,"overflow-x-auto"],[1,"min-w-full","bg-white","border","border-gray-200","rounded","text-sm"],[1,"bg-gray-50"],[1,"px-4","py-2","text-left","font-semibold","text-gray-700","border-b"],[1,"border-b","last:border-b-0","hover:bg-gray-50"],[1,"px-4","py-3","font-medium","text-gray-700","align-top"],[1,"px-4","py-3","text-gray-600","align-top","max-w-xs"],[1,"text-red-600"],[1,"text-gray-400","italic"],[1,"px-4","py-3","text-gray-900","align-top","max-w-xs"],[1,"text-green-600","font-medium"]],template:function(e,i){e&1&&(r(0,"div",0)(1,"h2",1)(2,"span",2),l(3,"\u{1F4DC}"),o(),l(4," Journal des modifications "),o(),u(5,Sn,2,0,"div",3),u(6,En,2,1,"div",4),u(7,wn,2,0,"div",5),u(8,On,3,0,"div",6),o()),e&2&&(s(5),p(i.loading?5:-1),s(),p(i.error?6:-1),s(),p(!i.loading&&!i.error&&i.histories.length===0?7:-1),s(),p(!i.loading&&!i.error&&i.histories.length>0?8:-1))},dependencies:[q],encapsulation:2})};var kt=(n,t)=>t.email;function Rn(n,t){n&1&&(r(0,"div",1)(1,"div",2),g(2,"div",3),r(3,"p",4),l(4,"Chargement de l'incident..."),o()()())}function jn(n,t){if(n&1){let e=S();r(0,"div",1)(1,"div",2)(2,"div",5),l(3,"\u26A0\uFE0F"),o(),r(4,"h2",6),l(5,"Incident non trouv\xE9"),o(),r(6,"p",7),l(7),o(),r(8,"button",8),f("click",function(){h(e);let a=c();return b(a.goList())}),l(9," Retour \xE0 la liste "),o()()()}if(n&2){let e=c();s(7),_("L'incident avec l'ID ",e.incidentId," n'existe pas.")}}function Ln(n,t){if(n&1){let e=S();r(0,"button",22),f("click",function(){h(e);let a=c(2);return b(a.validateIncident())}),w(),r(1,"svg",14),g(2,"path",23),o(),l(3," Valider "),o()}}function Nn(n,t){if(n&1){let e=S();r(0,"button",24),f("click",function(){h(e);let a=c(2);return b(a.editIncident())}),w(),r(1,"svg",14),g(2,"path",25),o(),l(3," Modifier "),o()}}function zn(n,t){if(n&1){let e=S();r(0,"button",26),f("click",function(){h(e);let a=c(2);return b(a.exportToPDF())}),w(),r(1,"svg",14),g(2,"path",27),o(),l(3," Export PDF "),o()}}function Hn(n,t){if(n&1){let e=S();r(0,"div",19)(1,"div",28)(2,"nav",29)(3,"button",30),f("click",function(){h(e);let a=c(2);return b(a.setActiveTab("details"))}),w(),r(4,"svg",31),g(5,"path",32),o(),l(6," D\xE9tails de l'incident "),o(),D(),r(7,"button",30),f("click",function(){h(e);let a=c(2);return b(a.setActiveTab("history"))}),w(),r(8,"svg",31),g(9,"path",33),o(),l(10," Journal des modifications "),o()()()()}if(n&2){let e=c(2);s(3),Q(e.activeTab==="details"?"border-blue-600 text-blue-600 font-medium":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),s(4),Q(e.activeTab==="history"?"border-blue-600 text-blue-600 font-medium":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300")}}function $n(n,t){if(n&1&&(r(0,"a",45),w(),r(1,"svg",82),g(2,"path",83),o(),D(),r(3,"span",84),l(4),ve(5,"slice"),o()()),n&2){let e=c(3);C("href",e.incident.lienTicketHelpy,ge),s(4),ne("",ni(5,3,e.incident.lienTicketHelpy,8,45),"",e.incident.lienTicketHelpy.length>45?"...":"")}}function Un(n,t){n&1&&(r(0,"p",42),l(1,"Non renseign\xE9"),o())}function Gn(n,t){n&1&&(r(0,"span"),l(1,"Oui"),o())}function Bn(n,t){n&1&&(r(0,"p",42),l(1,"Non"),o())}function Qn(n,t){if(n&1&&(r(0,"a",45),w(),r(1,"svg",82),g(2,"path",83),o(),D(),r(3,"span",84),l(4),ve(5,"slice"),o()()),n&2){let e=c(3);C("href",e.incident.lienTicketTandem,ge),s(4),ne("",ni(5,3,e.incident.lienTicketTandem,8,45),"",e.incident.lienTicketTandem.length>45?"...":"")}}function Wn(n,t){n&1&&(r(0,"p",42),l(1,"Non renseign\xE9"),o())}function Jn(n,t){if(n&1&&(r(0,"div",60)(1,"h3",85),w(),r(2,"svg",31),g(3,"path",86),o(),l(4," Temps d'indisponibilit\xE9 du service "),o(),D(),r(5,"div",49),g(6,"div",87),o()()),n&2){let e=c(3);s(6),C("innerHTML",e.getTempsIndisponibiliteHtml(),pe)}}function Yn(n,t){if(n&1&&(r(0,"div",96),w(),r(1,"svg",102),g(2,"path",23),o(),D(),r(3,"span",103),l(4),o()()),n&2){let e=t.$implicit;s(4),E(e.email)}}function Kn(n,t){if(n&1&&(r(0,"div",101),w(),r(1,"svg",104),g(2,"path",23),o(),D(),r(3,"span",105),l(4),o()()),n&2){let e=t.$implicit;s(4),E(e.email)}}function Zn(n,t){if(n&1&&(r(0,"div",89)(1,"div",88)(2,"div",90)(3,"div",70),w(),r(4,"svg",91),g(5,"path",92),o(),D(),r(6,"h4",93),l(7,"Notifications automatiques"),o(),r(8,"span",94),l(9,"Via template"),o()(),r(10,"div",95),M(11,Yn,5,1,"div",96,kt),o()()(),g(13,"div",97),r(14,"div",88)(15,"div",90)(16,"div",70),w(),r(17,"svg",98),g(18,"path",99),o(),D(),r(19,"h4",93),l(20,"Notifications personnalis\xE9es"),o(),r(21,"span",100),l(22,"Ajout manuel"),o()(),r(23,"div",95),M(24,Kn,5,1,"div",101,kt),o()()()()),n&2){let e=c(4),i=e.getAutomaticEmails();s(11),T(i);let a=e.getManualEmails();s(13),T(a)}}function Xn(n,t){if(n&1&&(r(0,"div",96),w(),r(1,"svg",102),g(2,"path",23),o(),D(),r(3,"span",103),l(4),o()()),n&2){let e=t.$implicit;s(4),E(e.email)}}function er(n,t){if(n&1&&(r(0,"div")(1,"div",90)(2,"div",70),w(),r(3,"svg",91),g(4,"path",92),o(),D(),r(5,"h4",93),l(6,"Notifications automatiques"),o(),r(7,"span",94),l(8,"Via template"),o()(),r(9,"div",95),M(10,Xn,5,1,"div",96,kt),o()()()),n&2){let e=c(4).getAutomaticEmails();s(10),T(e)}}function tr(n,t){if(n&1&&(r(0,"div",101),w(),r(1,"svg",104),g(2,"path",23),o(),D(),r(3,"span",105),l(4),o()()),n&2){let e=t.$implicit;s(4),E(e.email)}}function ir(n,t){if(n&1&&(r(0,"div")(1,"div",90)(2,"div",70),w(),r(3,"svg",98),g(4,"path",99),o(),D(),r(5,"h4",93),l(6,"Notifications personnalis\xE9es"),o(),r(7,"span",100),l(8,"Ajout manuel"),o()(),r(9,"div",95),M(10,tr,5,1,"div",101,kt),o()()()),n&2){let e=c(4).getManualEmails();s(10),T(e)}}function nr(n,t){n&1&&(r(0,"div",78),w(),r(1,"svg",106),g(2,"path",67),o(),D(),r(3,"h4",107),l(4,"Aucune notification configur\xE9e"),o(),r(5,"p",108),l(6,"Aucun destinataire automatique ou manuel pour cet incident"),o()())}function rr(n,t){if(n&1&&(r(0,"div",77)(1,"div",88),u(2,Zn,26,0,"div",89)(3,er,12,0,"div")(4,ir,12,0,"div")(5,nr,7,0,"div",78),o()()),n&2){let e=c(3);s(2),p(e.getAutomaticEmails().length>0&&e.getManualEmails().length>0?2:e.getAutomaticEmails().length>0?3:e.getManualEmails().length>0?4:5)}}function or(n,t){n&1&&(r(0,"div",78),w(),r(1,"svg",106),g(2,"path",67),o(),D(),r(3,"h4",107),l(4,"Aucune notification configur\xE9e"),o(),r(5,"p",108),l(6,"Aucun destinataire automatique ou manuel pour cet incident"),o()())}function ar(n,t){if(n&1&&(r(0,"p",80),l(1),o()),n&2){let e=c(3);s(),_(" Date de cl\xF4ture : ",e.incidentDisplayService.formatDateTime(e.incident.dateCloture)," ")}}function lr(n,t){if(n&1&&(r(0,"p",80),l(1),o()),n&2){let e=c(3);s(),_(" Mis \xE0 jour le : ",e.incidentDisplayService.formatDateTime(e.incident.updated_at)," ")}}function sr(n,t){if(n&1){let e=S();r(0,"div",20)(1,"div",34)(2,"div",35)(3,"h3",36),l(4," Informations principales "),o(),r(5,"div",37)(6,"div")(7,"span",38),l(8,"Statut : "),o(),r(9,"span"),l(10),o()(),r(11,"div")(12,"span",38),l(13,"Gravit\xE9 : "),o(),r(14,"span"),l(15),o()(),r(16,"div")(17,"span",38),l(18,"M\xE9t\xE9o :"),o(),r(19,"span",39),l(20),o()()()(),r(21,"div",40)(22,"div")(23,"label",41),l(24,"Date d'ouverture"),o(),r(25,"p",42),l(26),o()(),r(27,"div")(28,"label",41),l(29,"Date de cl\xF4ture"),o(),r(30,"p",42),l(31),o()(),r(32,"div")(33,"label",41),l(34,"Domaines"),o(),r(35,"p",42),l(36),o()()(),r(37,"div",43)(38,"div")(39,"label",41),l(40,"Publics impact\xE9s"),o(),r(41,"p",42),l(42),o()(),r(43,"div")(44,"label",41),l(45,"Sites impact\xE9s"),o(),r(46,"p",42),l(47),o()(),r(48,"div")(49,"label",41),l(50,"National"),o(),r(51,"p",42),l(52),o()()(),r(53,"div",43)(54,"div")(55,"label",41),l(56,"N\xB0 Ticket"),o(),r(57,"p",44),l(58),o()(),r(59,"div")(60,"label",41),l(61,"Lien HELPY"),o(),u(62,$n,6,7,"a",45)(63,Un,2,0,"p",42),o(),r(64,"div")(65,"label",41),l(66,"R\xE9dacteur"),o(),r(67,"p",42),l(68),o()()(),r(69,"div",43)(70,"div")(71,"label",41),l(72,"\xC0 faire"),o(),u(73,Gn,2,0,"span")(74,Bn,2,0,"p",42),o(),r(75,"div")(76,"label",41),l(77,"Lien TANDEM"),o(),u(78,Qn,6,7,"a",45)(79,Wn,2,0,"p",42),o(),r(80,"div")(81,"label",41),l(82,"Intervenant"),o(),r(83,"p",42),l(84),o()()()(),r(85,"div",46)(86,"h3",47),l(87," Description de l'incident "),o(),r(88,"div",48)(89,"div",49),g(90,"div",50),o()()(),r(91,"div",51)(92,"div",52)(93,"h3",53),w(),r(94,"svg",31),g(95,"path",33),o(),l(96," Actions \xE0 Mener "),o(),D(),r(97,"div",48)(98,"div",49),g(99,"div",54),o()()(),r(100,"div",55)(101,"h3",56),w(),r(102,"svg",31),g(103,"path",57),o(),l(104," Actions Men\xE9es "),o(),D(),r(105,"div",48)(106,"div",49),g(107,"div",58),o()()()(),r(108,"div",59),u(109,Jn,7,1,"div",60),r(110,"div",61)(111,"div",62)(112,"div",63)(113,"div",64)(114,"div",65),w(),r(115,"svg",66),g(116,"path",67),o()(),D(),r(117,"div")(118,"h3",36),l(119,"Destinataires des Notifications"),o(),r(120,"p",68),l(121,"Emails automatiques et personnalis\xE9s pour cet incident"),o()()(),r(122,"div",69)(123,"div",70),g(124,"div",71),r(125,"span",72),l(126),o()(),r(127,"div",70),g(128,"div",73),r(129,"span",72),l(130),o()(),r(131,"div",74),l(132,"|"),o(),r(133,"span",75),l(134),o()()()(),r(135,"div",76),u(136,rr,6,1,"div",77)(137,or,7,0,"div",78),o()()(),r(138,"div",79)(139,"p",80),l(140),o(),u(141,ar,2,1,"p",80),u(142,lr,2,1,"p",80),r(143,"div",12)(144,"button",81),f("click",function(){h(e);let a=c(2);return b(a.goList())}),l(145," Retour \xE0 la liste "),o()()()()}if(n&2){let e=c(2);s(9),Q("px-3 py-1 rounded-full text-sm font-medium "+e.statusConfig[e.incident.status].colorClass),s(),_(" ",e.statusConfig[e.incident.status].label," "),s(4),Q("px-3 py-1 rounded-full text-sm font-medium "+(e.incident.gravity?e.gravityConfig[e.incident.gravity].colorClass:"")),s(),_(" ",e.gravityConfig[e.incident.gravity].label," "),s(5),E(e.getMeteoDisplay()),s(6),E(e.incidentDisplayService.formatDateTime(e.incident.dateOuverture)),s(5),E(e.incidentDisplayService.formatDateTime(e.incident.dateCloture)),s(5),E(e.getDomainsDisplay()),s(6),E(e.getPublicsDisplay()),s(5),E(e.getSitesDisplay()),s(5),E(e.getNationalDisplay()||"Non"),s(6),E(e.incident.ticketNumber||"Non assign\xE9"),s(4),p(e.incident.lienTicketHelpy?62:63),s(6),E(e.incident.creator==null?null:e.incident.creator.full_name),s(5),p(e.incident.has_pending_actions?73:74),s(5),p(e.incident.lienTicketTandem?78:79),s(6),E((e.incident.assignee==null?null:e.incident.assignee.full_name)||"-"),s(6),C("innerHTML",e.getDescriptionHtml(),pe),s(9),C("innerHTML",e.getActionsAMenerHtml(),pe),s(8),C("innerHTML",e.getActionsMeneesHtml(),pe),s(2),p(e.incident.tempsIndisponibilite?109:-1),s(17),_("",e.getAutomaticEmailsCount()," automatique(s)"),s(4),_("",e.getManualEmailsCount()," manuel(s)"),s(4),_("",e.getNotifiedEmails().length," total"),s(2),p(e.hasNotifiedEmails()?136:137),s(4),_(" Date d'ouverture : ",e.incidentDisplayService.formatDateTime(e.incident.dateOuverture)," "),s(),p(e.incident.dateCloture?141:-1),s(),p(e.incident.updated_at?142:-1)}}function dr(n,t){if(n&1&&(r(0,"div",21),g(1,"app-incident-history",109),o()),n&2){let e=c(2);s(),C("incidentId",e.incidentId)}}function cr(n,t){if(n&1){let e=S();r(0,"div",9)(1,"div")(2,"h1",10),l(3),o(),r(4,"h2",11),l(5),o()(),r(6,"div",12)(7,"button",13),f("click",function(){h(e);let a=c();return b(a.goList())}),w(),r(8,"svg",14),g(9,"path",15),o(),l(10," Retour "),o(),u(11,Ln,4,0,"button",16),u(12,Nn,4,0,"button",17),u(13,zn,4,0,"button",18),o()(),u(14,Hn,11,4,"div",19),u(15,sr,146,30,"div",20),u(16,dr,2,1,"div",21)}if(n&2){let e=c();s(3),_(" Incident #",e.incident.id," "),s(2),E(e.incident.object),s(6),p(e.permissionService.canValidateIncidents()&&e.needsValidation()?11:-1),s(),p(e.permissionService.canModifyIncident()?12:-1),s(),p(e.permissionService.canExportData()?13:-1),s(),p(e.permissionService.canViewHistory()?14:-1),s(),p(!e.permissionService.canViewHistory()||e.activeTab==="details"?15:-1),s(),p(e.permissionService.canViewHistory()&&e.activeTab==="history"?16:-1)}}var Mt=class n{constructor(t,e,i,a,d,m,v,k){this.route=t;this.router=e;this.incidentDataService=i;this.exportService=a;this.notificationService=d;this.sanitizer=m;this.permissionService=v;this.incidentDisplayService=k}destroy$=new K;incident;incidentId=0;isLoading=!0;activeTab="details";gravityConfig=Hi;statusConfig=$i;ngOnInit(){this.route.params.pipe(N(this.destroy$)).subscribe(t=>{this.incidentId=+t.id,this.loadIncident()})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}loadIncident(){this.isLoading=!0,this.incidentDataService.getIncidentById(this.incidentId).pipe(N(this.destroy$)).subscribe({next:t=>{this.incident=t,this.isLoading=!1},error:t=>{this.notificationService.error("Erreur de chargement",`Impossible de charger l'incident avec l'ID ${this.incidentId}.`),console.error("Erreur lors du chargement de l'incident",t),this.isLoading=!1,this.router.navigate(["/incidents"])}})}goList(){this.router.navigate(["/incidents"])}editIncident(){this.incident&&this.router.navigate(["/incident",this.incident.id,"update"])}exportToPDF(){this.incident&&this.exportService.exportIncidentToPDF(this.incident)}needsValidation(){return this.incident?["grave","tres_grave"].includes(this.incident.gravity)&&this.incident.status==="en_attente":!1}validateIncident(){if(!this.incident)return;let t=`Valider l'incident "${this.incident.object}" ?

Cela changera son statut vers "En cours".`;confirm(t)&&(this.isLoading=!0,this.incidentDataService.validateIncident(this.incident.id).subscribe({next:()=>{this.notificationService.success("Validation r\xE9ussie",`Incident #${this.incident?.id} valid\xE9. Statut chang\xE9 vers "En cours".`),this.loadIncident()},error:e=>{this.notificationService.error("Erreur de validation",`Impossible de valider l'incident: ${e.message||e}`),this.isLoading=!1}}))}getDomainsDisplay(){return this.incident?.domains?.join(", ")||"Aucun domaine"}getPublicsDisplay(){return this.incident?.publicsImpactes?.join(", ")||"Aucun public"}getSitesDisplay(){return this.incident?.sitesImpactes?.join(", ")||"Aucun site impact\xE9"}getNationalDisplay(){return this.incident?.isNational?"Oui":""}getMeteoDisplay(){return this.incident?.meteo===void 0?"Non renseign\xE9":this.incident.meteo?"Oui":"Non"}getTrustedHtml(t){return t?this.sanitizer.bypassSecurityTrustHtml(t):""}setActiveTab(t){this.activeTab=t}getDescriptionHtml(){return this.getTrustedHtml(this.incident?.description)}getActionsMeneesHtml(){let t=this.incident?.actionsMenees;if(!t||t.length===0)return"";let e=t.map(i=>`<li>${i}</li>`).join("");return this.getTrustedHtml(`<ul>${e}</ul>`)}getActionsAMenerHtml(){let t=this.incident?.actionsAMener;if(!t||t.length===0)return"";let e=t.map(i=>`<li>${i}</li>`).join("");return this.getTrustedHtml(`<ul>${e}</ul>`)}getTempsIndisponibiliteHtml(){return this.getTrustedHtml(this.incident?.tempsIndisponibilite)}getMailAlerteHtml(){let t=this.incident?.mailAlerte;return Array.isArray(t)?this.getTrustedHtml(t.join("; ")):this.getTrustedHtml(t||"")}getNotifiedEmails(){let t=[];return this.incident?.mailAlerte&&Array.isArray(this.incident.mailAlerte)&&this.incident.mailAlerte.forEach(e=>{e&&e.trim()&&t.push({email:e.trim(),source:"manuel"})}),this.incident?.auto_notified_emails&&Array.isArray(this.incident.auto_notified_emails)&&this.incident.auto_notified_emails.forEach(e=>{e&&e.trim()&&t.push({email:e.trim(),source:"automatique"})}),t}hasNotifiedEmails(){return this.getNotifiedEmails().length>0}getAutomaticEmailsCount(){return this.getNotifiedEmails().filter(t=>t.source==="automatique").length}getManualEmailsCount(){return this.getNotifiedEmails().filter(t=>t.source==="manuel").length}getAutomaticEmails(){return this.getNotifiedEmails().filter(t=>t.source==="automatique")}getManualEmails(){return this.getNotifiedEmails().filter(t=>t.source==="manuel")}static \u0275fac=function(e){return new(e||n)(y(je),y(U),y(xe),y(Ui),y(z),y(Re),y(te),y(gt))};static \u0275cmp=A({type:n,selectors:[["app-incident-detail"]],decls:4,vars:3,consts:[[1,"max-w-6xl","mx-auto","p-6","bg-white","min-h-screen"],[1,"text-center","py-16"],[1,"flex","flex-col","items-center","space-y-4"],[1,"animate-spin","rounded-full","h-12","w-12","border-b-2","border-blue-600"],[1,"text-lg","text-gray-600"],[1,"text-red-500","text-6xl"],[1,"text-xl","font-semibold","text-gray-900"],[1,"text-gray-600"],[1,"px-4","py-2","bg-blue-600","text-white","rounded-lg","hover:bg-blue-700","transition-colors",3,"click"],[1,"flex","justify-between","items-start","mb-6","border-b","border-gray-200","pb-4"],[1,"text-2xl","font-bold","text-gray-900","mb-2"],[1,"text-lg","text-gray-700"],[1,"flex","gap-3"],[1,"bg-gray-500","hover:bg-gray-600","text-white","px-4","py-2","rounded-lg","transition-colors","flex","items-center","gap-2",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M10 19l-7-7m0 0l7-7m-7 7h18"],[1,"bg-green-600","hover:bg-green-700","text-white","px-4","py-2","rounded-lg","transition-colors","flex","items-center","gap-2"],[1,"bg-blue-600","hover:bg-blue-700","text-white","px-4","py-2","rounded-lg","transition-colors","flex","items-center","gap-2"],[1,"bg-red-600","hover:bg-red-700","text-white","px-4","py-2","rounded-lg","transition-colors","flex","items-center","gap-2"],[1,"mb-6"],[1,"tab-content-details"],[1,"tab-content-history"],[1,"bg-green-600","hover:bg-green-700","text-white","px-4","py-2","rounded-lg","transition-colors","flex","items-center","gap-2",3,"click"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M5 13l4 4L19 7"],[1,"bg-blue-600","hover:bg-blue-700","text-white","px-4","py-2","rounded-lg","transition-colors","flex","items-center","gap-2",3,"click"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"],[1,"bg-red-600","hover:bg-red-700","text-white","px-4","py-2","rounded-lg","transition-colors","flex","items-center","gap-2",3,"click"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"],[1,"border-b","border-gray-200"],[1,"flex","space-x-8"],[1,"py-4","px-1","border-b-2","transition-colors","flex","items-center","gap-2",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"],[1,"bg-gray-50","rounded-lg","p-6","mb-6"],[1,"flex","items-center","justify-between","w-full","mb-4","border-b","border-gray-300","pb-4"],[1,"text-lg","font-semibold","text-gray-900"],[1,"flex","items-center","space-x-10"],[1,"text-sm","font-bold","text-gray-700"],[1,"text-gray-900","ml-1"],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-3","gap-4"],[1,"block","text-sm","font-medium","text-gray-700","mb-1"],[1,"text-gray-900"],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-3","gap-4","mt-4"],[1,"text-gray-900","font-mono"],["target","_blank","rel","noopener noreferrer",1,"inline-flex","items-center","text-sm","text-blue-600","hover:text-blue-800","transition-colors",3,"href"],[1,"bg-white","border","border-gray-200","rounded-lg","p-6","mb-6"],[1,"text-lg","font-semibold","text-gray-900","mb-4","border-b","border-gray-300","pb-2"],[1,"prose","max-w-none"],[1,"ql-container","ql-snow",2,"border","none"],[1,"ql-editor","text-gray-700","leading-relaxed",2,"padding","0",3,"innerHTML"],[1,"grid","grid-cols-1","lg:grid-cols-2","gap-6","mb-6"],[1,"bg-blue-50","border","border-blue-200","rounded-lg","p-6"],[1,"text-lg","font-semibold","text-blue-800","mb-4","flex","items-center","gap-2"],[1,"ql-editor","text-blue-700","leading-relaxed",2,"padding","0",3,"innerHTML"],[1,"bg-green-50","border","border-green-200","rounded-lg","p-6"],[1,"text-lg","font-semibold","text-green-800","mb-4","flex","items-center","gap-2"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"],[1,"ql-editor","text-green-700","leading-relaxed",2,"padding","0",3,"innerHTML"],[1,"space-y-6"],[1,"bg-orange-50","border","border-orange-200","rounded-lg","p-6"],[1,"bg-white","border","border-gray-200","rounded-lg","overflow-hidden"],[1,"px-6","py-4","border-b","border-gray-200"],[1,"flex","items-center","justify-between"],[1,"flex","items-center","space-x-3"],[1,"flex-shrink-0"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-6","h-6","text-blue-600"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M3 8l7.89 4.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"],[1,"text-sm","text-gray-600"],[1,"flex","items-center","space-x-4","text-sm"],[1,"flex","items-center","space-x-2"],[1,"w-3","h-3","bg-blue-500","rounded-full"],[1,"text-gray-700","font-medium"],[1,"w-3","h-3","bg-green-500","rounded-full"],[1,"text-gray-500"],[1,"font-bold","text-gray-900"],[1,"px-6","py-5"],[1,"flex","space-x-6"],[1,"text-center","py-8"],[1,"mt-8","pt-6","border-t","border-gray-200","flex","justify-between","items-center"],[1,"text-sm","text-gray-500","font-bold"],[1,"bg-gray-500","hover:bg-gray-600","text-white","px-6","py-2","rounded-lg","transition-colors",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-3","h-3","mr-1","flex-shrink-0"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"],[1,"truncate"],[1,"text-lg","font-semibold","text-orange-800","mb-4","flex","items-center","gap-2"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"],[1,"ql-editor","text-orange-700","leading-relaxed",2,"padding","0",3,"innerHTML"],[1,"flex-1","min-w-0"],[1,"flex","gap-6"],[1,"space-y-3"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","text-blue-600"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"],[1,"font-medium","text-gray-900"],[1,"px-2","py-1","text-xs","font-medium","text-blue-700","bg-blue-100","rounded-full"],[1,"grid","grid-cols-1","gap-3"],[1,"flex","items-center","space-x-3","p-3","bg-blue-50","border","border-blue-200","rounded-lg"],[1,"w-px","bg-gray-200"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","text-green-600"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.5L15.232 5.232z"],[1,"px-2","py-1","text-xs","font-medium","text-green-700","bg-green-100","rounded-full"],[1,"flex","items-center","space-x-3","p-3","bg-green-50","border","border-green-200","rounded-lg"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4","text-blue-600","flex-shrink-0"],[1,"text-sm","font-medium","text-blue-900","truncate"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4","text-green-600","flex-shrink-0"],[1,"text-sm","font-medium","text-green-900","truncate"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"mx-auto","w-12","h-12","text-gray-300","mb-4"],[1,"text-sm","font-medium","text-gray-900","mb-1"],[1,"text-xs","text-gray-500"],[3,"incidentId"]],template:function(e,i){e&1&&(r(0,"div",0),u(1,Rn,5,0,"div",1),u(2,jn,10,1,"div",1),u(3,cr,17,8),o()),e&2&&(s(),p(i.isLoading?1:-1),s(),p(!i.isLoading&&!i.incident?2:-1),s(),p(i.incident?3:-1))},dependencies:[q,Oi,wt],styles:[`@charset "UTF-8";.ql-container.ql-snow{background:none!important;border:none!important;box-shadow:none!important}.ql-container.ql-snow .ql-editor{padding:0!important;border:none!important;background:none!important;box-shadow:none!important}.ql-container.ql-snow .ql-editor p{margin:0 0 1rem!important;line-height:1.6!important;background:none!important}.ql-container.ql-snow .ql-editor strong,.ql-container.ql-snow .ql-editor b{font-weight:700!important}.ql-container.ql-snow .ql-editor em,.ql-container.ql-snow .ql-editor i{font-style:italic!important}.ql-container.ql-snow .ql-editor u{text-decoration:underline!important}.ql-container.ql-snow .ql-editor s{text-decoration:line-through!important}.ql-container.ql-snow .ql-editor h1{font-size:1.8rem!important;font-weight:700!important;margin:1.5rem 0 1rem!important;line-height:1.2!important}.ql-container.ql-snow .ql-editor h2{font-size:1.4rem!important;font-weight:600!important;margin:1.25rem 0 .75rem!important;line-height:1.3!important}.ql-container.ql-snow .ql-editor h3{font-size:1.2rem!important;font-weight:600!important;margin:1rem 0 .5rem!important;line-height:1.4!important}.ql-container.ql-snow .ql-editor ol{padding-left:1.5rem!important;margin:1rem 0!important;list-style-type:decimal!important;background:none!important}.ql-container.ql-snow .ql-editor ol li{margin:.25rem 0!important;line-height:1.6!important;list-style-type:decimal!important;display:list-item!important;background:none!important}.ql-container.ql-snow .ql-editor ul{padding-left:1.5rem!important;margin:1rem 0!important;list-style-type:disc!important;background:none!important}.ql-container.ql-snow .ql-editor ul li{margin:.25rem 0!important;line-height:1.6!important;list-style-type:disc!important;display:list-item!important;background:none!important}.ql-container.ql-snow .ql-editor ul li[data-list=checked],.ql-container.ql-snow .ql-editor ul li[data-list=unchecked],.ql-container.ql-snow .ql-editor li[data-list=checked],.ql-container.ql-snow .ql-editor li[data-list=unchecked]{list-style:none!important;position:relative!important;padding-left:2rem!important;margin:.5rem 0!important;display:block!important;background:none!important;transition:all .2s ease-in-out!important}.ql-container.ql-snow .ql-editor ul li[data-list=checked]:before,.ql-container.ql-snow .ql-editor ul li[data-list=unchecked]:before,.ql-container.ql-snow .ql-editor li[data-list=checked]:before,.ql-container.ql-snow .ql-editor li[data-list=unchecked]:before{content:""!important;position:absolute!important;left:0!important;top:.1rem!important;width:1.2rem!important;height:1.2rem!important;border:2px solid #6b7280!important;border-radius:4px!important;background:#fff!important;display:block!important;transition:all .2s ease-in-out!important}.ql-container.ql-snow .ql-editor ul li[data-list=checked]:before,.ql-container.ql-snow .ql-editor li[data-list=checked]:before{background:#10b981!important;border-color:#10b981!important;background-image:url("data:image/svg+xml,%3csvg viewBox='0 0 16 16' fill='white' xmlns='http://www.w3.org/2000/svg'%3e%3cpath d='m13.854 3.646-7.5 7.5a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6 10.293l7.146-7.147a.5.5 0 0 1 .708.708z'/%3e%3c/svg%3e")!important;background-size:1rem!important;background-position:center!important;background-repeat:no-repeat!important;transform:scale(1.1)!important}.ql-container.ql-snow .ql-editor li[data-list=checked]{text-decoration:line-through!important;opacity:.65!important;color:#6b7280!important;transition:all .3s ease-in-out!important}.ql-container.ql-snow .ql-editor li[data-list=unchecked]{opacity:1!important}.ql-container.ql-snow .ql-editor blockquote{border-left:4px solid #e5e7eb!important;padding-left:1rem!important;margin:1rem 0!important;font-style:italic!important;color:#6b7280!important;background:#f3f4f64d!important;border-radius:0 6px 6px 0!important}.ql-container.ql-snow .ql-editor code{background:#f3f4f6!important;padding:.125rem .25rem!important;border-radius:4px!important;font-family:Courier New,monospace!important;font-size:.875rem!important;border:1px solid #e5e7eb!important}.ql-container.ql-snow .ql-editor pre{background:#f8fafc!important;padding:1rem!important;border-radius:8px!important;overflow-x:auto!important;margin:1rem 0!important;border:1px solid #e2e8f0!important;box-shadow:0 1px 3px #0000001a!important}.ql-container.ql-snow .ql-editor pre code{background:none!important;padding:0!important;border:none!important}.ql-container.ql-snow .ql-editor a{color:#3b82f6!important;text-decoration:underline!important;transition:color .2s ease-in-out!important}.ql-container.ql-snow .ql-editor a:hover{color:#1d4ed8!important;text-decoration:none!important}.ql-container.ql-snow .ql-editor .ql-align-center{text-align:center!important}.ql-container.ql-snow .ql-editor .ql-align-right{text-align:right!important}.ql-container.ql-snow .ql-editor .ql-align-justify{text-align:justify!important}.ql-container.ql-snow .ql-editor .ql-indent-1{padding-left:3rem!important;border-left:2px solid #e5e7eb!important}.ql-container.ql-snow .ql-editor .ql-indent-2{padding-left:4.5rem!important;border-left:2px solid #d1d5db!important}.ql-container.ql-snow .ql-editor .ql-indent-3{padding-left:6rem!important;border-left:2px solid #9ca3af!important}.ql-container.ql-snow .ql-editor .ql-color-red{color:#ef4444!important}.ql-container.ql-snow .ql-editor .ql-color-blue{color:#3b82f6!important}.ql-container.ql-snow .ql-editor .ql-color-green{color:#10b981!important}.ql-container.ql-snow .ql-editor .ql-color-yellow{color:#f59e0b!important}.ql-container.ql-snow .ql-editor .ql-color-purple{color:#8b5cf6!important}.ql-container.ql-snow .ql-editor .ql-bg-yellow{background-color:#fef3c7!important;padding:.125rem .25rem!important;border-radius:3px!important}.ql-container.ql-snow .ql-editor .ql-bg-green{background-color:#d1fae5!important;padding:.125rem .25rem!important;border-radius:3px!important}.ql-container.ql-snow .ql-editor .ql-bg-blue{background-color:#dbeafe!important;padding:.125rem .25rem!important;border-radius:3px!important}@media (max-width: 640px){.ql-container.ql-snow .ql-editor h1{font-size:1.5rem!important}.ql-container.ql-snow .ql-editor h2{font-size:1.25rem!important}.ql-container.ql-snow .ql-editor h3{font-size:1.125rem!important}.ql-container.ql-snow .ql-editor ol,.ql-container.ql-snow .ql-editor ul{padding-left:1rem!important}.ql-container.ql-snow .ql-editor li[data-list=checked],.ql-container.ql-snow .ql-editor li[data-list=unchecked]{padding-left:1.5rem!important}.ql-container.ql-snow .ql-editor li[data-list=checked]:before,.ql-container.ql-snow .ql-editor li[data-list=unchecked]:before{width:1rem!important;height:1rem!important;background-size:.75rem!important}.ql-container.ql-snow .ql-editor blockquote{margin:.5rem 0!important;padding-left:.75rem!important}.ql-container.ql-snow .ql-editor pre{padding:.75rem!important;margin:.75rem 0!important}}@media print{.ql-container.ql-snow .ql-editor{color:#000!important;background:#fff!important}.ql-container.ql-snow .ql-editor a{color:#000!important;text-decoration:underline!important}.ql-container.ql-snow .ql-editor blockquote{border-left-color:#000!important;background:none!important}.ql-container.ql-snow .ql-editor code,.ql-container.ql-snow .ql-editor pre{background:#f5f5f5!important;border:1px solid #ccc!important}}
`],encapsulation:2})};var It={toolbar:[["bold","italic","underline","strike"],["blockquote","code-block"],[{header:1},{header:2}],[{list:"ordered"},{list:"bullet"}],[{script:"sub"},{script:"super"}],[{indent:"-1"},{indent:"+1"}],[{direction:"rtl"}],[{size:["small",!1,"large","huge"]}],[{header:[1,2,3,4,5,6,!1]}],[{color:[]},{background:[]}],[{font:[]}],[{align:[]}],["clean"],["link","image","video"],["table"]]},oi=new bi("config",{providedIn:"root",factory:()=>({modules:It})});function et(n){n||(n=R(ct));let t=new lt(e=>{if(n.destroyed){e.next();return}return n.onDestroy(e.next.bind(e))});return e=>e.pipe(N(t))}var mr=[[["","above-quill-editor-toolbar",""]],[["","quill-editor-toolbar",""]],[["","below-quill-editor-toolbar",""]]],ur=["[above-quill-editor-toolbar]","[quill-editor-toolbar]","[below-quill-editor-toolbar]"];function pr(n,t){n&1&&g(0,"div",0)}function gr(n,t){n&1&&g(0,"div",0)}var Ft=(n,t)=>n||t||"html",fr=()=>new lt(n=>{let t=requestAnimationFrame(()=>{n.next(),n.complete()});return()=>cancelAnimationFrame(t)}),hr=(()=>{let t=class t{constructor(){this.config=R(oi)||{modules:It},this.quill$=ui(()=>B(this,null,function*(){if(!this.Quill){let i=document.addEventListener;document.addEventListener=document.__zone_symbol__addEventListener||document.addEventListener;let{Quill:a}=yield import("./chunk-63BE5YTP.js");document.addEventListener=i,this.Quill=a}return this.config.customOptions?.forEach(i=>{let a=this.Quill.import(i.import);a.whitelist=i.whitelist,this.Quill.register(a,!0,this.config.suppressGlobalRegisterWarning)}),new Promise(i=>{this.registerCustomModules(this.Quill,this.config.customModules,this.config.suppressGlobalRegisterWarning).subscribe(i)})})).pipe(fi({bufferSize:1,refCount:!1})),this.registeredModules=new Set}getQuill(){return this.quill$}beforeRender(i,a,d=this.config.beforeRender){let m=[this.registerCustomModules(i,a)];return d&&m.push(d()),Xt(m).pipe(Z(()=>i))}registerCustomModules(i,a,d){if(!Array.isArray(a))return Qe(i);let m=[];for(let v of a){let{path:k,implementation:I}=v;this.registeredModules.has(k)||(this.registeredModules.add(k),ci(I)?m.push(I.pipe(me(x=>{i.register(k,x,d)}))):i.register(k,I,d))}return m.length>0?Xt(m).pipe(Z(()=>i)):Qe(i)}};t.\u0275fac=function(a){return new(a||t)},t.\u0275prov=$({token:t,factory:t.\u0275fac,providedIn:"root"});let n=t;return n})(),br=(()=>{let t=class t{constructor(){this.format=P(void 0),this.theme=P(void 0),this.modules=P(void 0),this.debug=P(!1),this.readOnly=P(!1),this.placeholder=P(void 0),this.maxLength=P(void 0),this.minLength=P(void 0),this.required=P(!1),this.formats=P(void 0),this.customToolbarPosition=P("top"),this.sanitize=P(void 0),this.beforeRender=P(void 0),this.styles=P(null),this.registry=P(void 0),this.bounds=P(void 0),this.customOptions=P([]),this.customModules=P([]),this.trackChanges=P(void 0),this.classes=P(void 0),this.trimOnValidation=P(!1),this.linkPlaceholder=P(void 0),this.compareValues=P(!1),this.filterNull=P(!1),this.debounceTime=P(void 0),this.defaultEmptyValue=P(null),this.onEditorCreated=new j,this.onEditorChanged=new j,this.onContentChanged=new j,this.onSelectionChanged=new j,this.onFocus=new j,this.onBlur=new j,this.onNativeFocus=new j,this.onNativeBlur=new j,this.disabled=!1,this.toolbarPosition=ti("top"),this.eventsSubscription=null,this.quillSubscription=null,this.elementRef=R(xi),this.cd=R(Vi),this.domSanitizer=R(Re),this.platformId=R(_i),this.renderer=R(yi),this.zone=R(ki),this.service=R(hr),this.destroyRef=R(ct),this.valueGetter=P(i=>{let a=i.getSemanticHTML();this.isEmptyValue(a)&&(a=this.defaultEmptyValue());let d=a,m=Ft(this.format(),this.service.config.format);if(m==="text")d=i.getText();else if(m==="object")d=i.getContents();else if(m==="json")try{d=JSON.stringify(i.getContents())}catch{d=i.getText()}return d}),this.valueSetter=P((i,a)=>{let d=Ft(this.format(),this.service.config.format);if(d==="html")return([!0,!1].includes(this.sanitize())?this.sanitize():this.service.config.sanitize||!1)&&(a=this.domSanitizer.sanitize(Ci.HTML,a)),i.clipboard.convert({html:a});if(d==="json")try{return JSON.parse(a)}catch{return[{insert:a}]}return a}),this.selectionChangeHandler=(i,a,d)=>{let m=this.trackChanges()||this.service.config.trackChanges,v=!i&&!!this.onModelTouched&&(d==="user"||m&&m==="all");!this.onBlur.observed&&!this.onFocus.observed&&!this.onSelectionChanged.observed&&!v||this.zone.run(()=>{i===null?this.onBlur.emit({editor:this.quillEditor,source:d}):a===null&&this.onFocus.emit({editor:this.quillEditor,source:d}),this.onSelectionChanged.emit({editor:this.quillEditor,oldRange:a,range:i,source:d}),v&&this.onModelTouched(),this.cd.markForCheck()})},this.textChangeHandler=(i,a,d)=>{let m=this.quillEditor.getText(),v=this.quillEditor.getContents(),k=this.quillEditor.getSemanticHTML();this.isEmptyValue(k)&&(k=this.defaultEmptyValue());let I=this.trackChanges()||this.service.config.trackChanges,x=(d==="user"||I&&I==="all")&&!!this.onModelChange;!this.onContentChanged.observed&&!x||this.zone.run(()=>{if(x){let V=this.valueGetter();this.onModelChange(V(this.quillEditor))}this.onContentChanged.emit({content:v,delta:i,editor:this.quillEditor,html:k,oldDelta:a,source:d,text:m}),this.cd.markForCheck()})},this.editorChangeHandler=(i,a,d,m)=>{if(this.onEditorChanged.observed)if(i==="text-change"){let v=this.quillEditor.getText(),k=this.quillEditor.getContents(),I=this.quillEditor.getSemanticHTML();this.isEmptyValue(I)&&(I=this.defaultEmptyValue()),this.zone.run(()=>{this.onEditorChanged.emit({content:k,delta:a,editor:this.quillEditor,event:i,html:I,oldDelta:d,source:m,text:v}),this.cd.markForCheck()})}else this.zone.run(()=>{this.onEditorChanged.emit({editor:this.quillEditor,event:i,oldRange:d,range:a,source:m}),this.cd.markForCheck()})},this.destroyRef.onDestroy(()=>{this.dispose(),this.quillSubscription?.unsubscribe(),this.quillSubscription=null})}static normalizeClassNames(i){return i.trim().split(" ").reduce((d,m)=>{let v=m.trim();return v&&d.push(v),d},[])}ngOnInit(){this.toolbarPosition.set(this.customToolbarPosition())}ngAfterViewInit(){qi(this.platformId)||(this.quillSubscription=this.service.getQuill().pipe(mi(i=>this.service.beforeRender(i,this.customModules(),this.beforeRender()))).subscribe(i=>{this.editorElem=this.elementRef.nativeElement.querySelector("[quill-editor-element]");let a=this.elementRef.nativeElement.querySelector("[quill-editor-toolbar]"),d=Object.assign({},this.modules()||this.service.config.modules);a?d.toolbar=a:d.toolbar===void 0&&(d.toolbar=It.toolbar);let m=this.placeholder()!==void 0?this.placeholder():this.service.config.placeholder;m===void 0&&(m="Insert text here ...");let v=this.styles();v&&Object.keys(v).forEach(ee=>{this.renderer.setStyle(this.editorElem,ee,v[ee])}),this.classes()&&this.addClasses(this.classes()),this.customOptions().forEach(ee=>{let ie=i.import(ee.import);ie.whitelist=ee.whitelist,i.register(ie,!0)});let k=this.bounds()&&this.bounds()==="self"?this.editorElem:this.bounds();k||(k=this.service.config.bounds?this.service.config.bounds:document.body);let I=this.debug();!I&&I!==!1&&this.service.config.debug&&(I=this.service.config.debug);let x=this.readOnly();!x&&this.readOnly()!==!1&&(x=this.service.config.readOnly!==void 0?this.service.config.readOnly:!1);let V=this.formats();if(!V&&V===void 0&&(V=this.service.config.formats?[...this.service.config.formats]:this.service.config.formats===null?null:void 0),this.zone.runOutsideAngular(()=>{if(this.quillEditor=new i(this.editorElem,{bounds:k,debug:I,formats:V,modules:d,placeholder:m,readOnly:x,registry:this.registry(),theme:this.theme()||(this.service.config.theme?this.service.config.theme:"snow")}),this.onNativeBlur.observed){ke(this.quillEditor.scroll.domNode,"blur").pipe(et(this.destroyRef)).subscribe(()=>this.onNativeBlur.next({editor:this.quillEditor,source:"dom"}));let ee=this.quillEditor.getModule("toolbar");ee.container&&ke(ee.container,"mousedown").pipe(et(this.destroyRef)).subscribe(ie=>ie.preventDefault())}if(this.onNativeFocus.observed&&ke(this.quillEditor.scroll.domNode,"focus").pipe(et(this.destroyRef)).subscribe(()=>this.onNativeFocus.next({editor:this.quillEditor,source:"dom"})),this.linkPlaceholder()){let ie=this.quillEditor?.theme?.tooltip?.root?.querySelector("input[data-link]");ie?.dataset&&(ie.dataset.link=this.linkPlaceholder())}}),this.content){if(Ft(this.format(),this.service.config.format)==="text")this.quillEditor.setText(this.content,"silent");else{let Ie=this.valueSetter()(this.quillEditor,this.content);this.quillEditor.setContents(Ie,"silent")}this.quillEditor.getModule("history").clear()}this.setDisabledState(),this.addQuillEventListeners(),!(!this.onEditorCreated.observed&&!this.onValidatorChanged)&&fr().pipe(et(this.destroyRef)).subscribe(()=>{this.onValidatorChanged&&this.onValidatorChanged(),this.onEditorCreated.emit(this.quillEditor)})}))}ngOnChanges(i){if(this.quillEditor){if(i.readOnly&&this.quillEditor.enable(!i.readOnly.currentValue),i.placeholder&&(this.quillEditor.root.dataset.placeholder=i.placeholder.currentValue),i.styles){let a=i.styles.currentValue,d=i.styles.previousValue;d&&Object.keys(d).forEach(m=>{this.renderer.removeStyle(this.editorElem,m)}),a&&Object.keys(a).forEach(m=>{this.renderer.setStyle(this.editorElem,m,this.styles()[m])})}if(i.classes){let a=i.classes.currentValue,d=i.classes.previousValue;d&&this.removeClasses(d),a&&this.addClasses(a)}i.debounceTime&&this.addQuillEventListeners()}}addClasses(i){t.normalizeClassNames(i).forEach(a=>{this.renderer.addClass(this.editorElem,a)})}removeClasses(i){t.normalizeClassNames(i).forEach(a=>{this.renderer.removeClass(this.editorElem,a)})}writeValue(i){if(this.filterNull()&&i===null||(this.content=i,!this.quillEditor))return;let a=Ft(this.format(),this.service.config.format),m=this.valueSetter()(this.quillEditor,i);if(this.compareValues()){let v=this.quillEditor.getContents();if(JSON.stringify(v)===JSON.stringify(m))return}if(i){a==="text"?this.quillEditor.setText(i):this.quillEditor.setContents(m);return}this.quillEditor.setText("")}setDisabledState(i=this.disabled){this.disabled=i,this.quillEditor&&(i?(this.quillEditor.disable(),this.renderer.setAttribute(this.elementRef.nativeElement,"disabled","disabled")):(this.readOnly()||this.quillEditor.enable(),this.renderer.removeAttribute(this.elementRef.nativeElement,"disabled")))}registerOnChange(i){this.onModelChange=i}registerOnTouched(i){this.onModelTouched=i}registerOnValidatorChange(i){this.onValidatorChanged=i}validate(){if(!this.quillEditor)return null;let i={},a=!0,d=this.quillEditor.getText(),m=this.trimOnValidation()?d.trim().length:d.length===1&&d.trim().length===0?0:d.length-1,v=this.quillEditor.getContents().ops,k=!!v&&v.length===1&&[`
`,""].includes(v[0].insert?.toString());return this.minLength()&&m&&m<this.minLength()&&(i.minLengthError={given:m,minLength:this.minLength()},a=!1),this.maxLength()&&m>this.maxLength()&&(i.maxLengthError={given:m,maxLength:this.maxLength()},a=!1),this.required()&&!m&&k&&(i.requiredError={empty:!0},a=!1),a?null:i}addQuillEventListeners(){this.dispose(),this.zone.runOutsideAngular(()=>{this.eventsSubscription=new at,this.eventsSubscription.add(ke(this.quillEditor,"selection-change").subscribe(([d,m,v])=>{this.selectionChangeHandler(d,m,v)}));let i=ke(this.quillEditor,"text-change"),a=ke(this.quillEditor,"editor-change");typeof this.debounceTime()=="number"&&(i=i.pipe(De(this.debounceTime())),a=a.pipe(De(this.debounceTime()))),this.eventsSubscription.add(i.subscribe(([d,m,v])=>{this.textChangeHandler(d,m,v)})),this.eventsSubscription.add(a.subscribe(([d,m,v,k])=>{this.editorChangeHandler(d,m,v,k)}))})}dispose(){this.eventsSubscription?.unsubscribe(),this.eventsSubscription=null}isEmptyValue(i){return i==="<p></p>"||i==="<div></div>"||i==="<p><br></p>"||i==="<div><br></div>"}};t.\u0275fac=function(a){return new(a||t)},t.\u0275dir=Ei({type:t,inputs:{format:[1,"format"],theme:[1,"theme"],modules:[1,"modules"],debug:[1,"debug"],readOnly:[1,"readOnly"],placeholder:[1,"placeholder"],maxLength:[1,"maxLength"],minLength:[1,"minLength"],required:[1,"required"],formats:[1,"formats"],customToolbarPosition:[1,"customToolbarPosition"],sanitize:[1,"sanitize"],beforeRender:[1,"beforeRender"],styles:[1,"styles"],registry:[1,"registry"],bounds:[1,"bounds"],customOptions:[1,"customOptions"],customModules:[1,"customModules"],trackChanges:[1,"trackChanges"],classes:[1,"classes"],trimOnValidation:[1,"trimOnValidation"],linkPlaceholder:[1,"linkPlaceholder"],compareValues:[1,"compareValues"],filterNull:[1,"filterNull"],debounceTime:[1,"debounceTime"],defaultEmptyValue:[1,"defaultEmptyValue"],valueGetter:[1,"valueGetter"],valueSetter:[1,"valueSetter"]},outputs:{onEditorCreated:"onEditorCreated",onEditorChanged:"onEditorChanged",onContentChanged:"onContentChanged",onSelectionChanged:"onSelectionChanged",onFocus:"onFocus",onBlur:"onBlur",onNativeFocus:"onNativeFocus",onNativeBlur:"onNativeBlur"},features:[mt]});let n=t;return n})(),on=(()=>{let t=class t extends br{};t.\u0275fac=(()=>{let i;return function(d){return(i||(i=vi(t)))(d||t)}})(),t.\u0275cmp=A({type:t,selectors:[["quill-editor"]],features:[Di([{multi:!0,provide:Gi,useExisting:ei(()=>t)},{multi:!0,provide:Qi,useExisting:ei(()=>t)}]),wi],ngContentSelectors:ur,decls:5,vars:2,consts:[["quill-editor-element",""]],template:function(a,d){a&1&&(Mi(mr),u(0,pr,1,0,"div",0),ut(1),ut(2,1),ut(3,2),u(4,gr,1,0,"div",0)),a&2&&(p(d.toolbarPosition()!=="top"?0:-1),s(4),p(d.toolbarPosition()==="top"?4:-1))},styles:["[_nghost-%COMP%]{display:inline-block}"]});let n=t;return n})();var At=(()=>{let t=class t{static forRoot(i){return{ngModule:t,providers:[{provide:oi,useValue:i}]}}};t.\u0275fac=function(a){return new(a||t)},t.\u0275mod=Si({type:t}),t.\u0275inj=hi({});let n=t;return n})();var He=class n{constructor(t){this.http=t}apiUrl=`${G.apiUrl}/incident-templates`;templatesSubject=new ce([]);templates$=this.templatesSubject.asObservable();getActiveTemplates(){return this.http.get(this.apiUrl).pipe(me(t=>{t.success&&this.templatesSubject.next(t.data)}),Me(t=>{throw console.error("Erreur r\xE9cup\xE9ration templates:",t),t}))}getTemplate(t){return this.http.get(`${this.apiUrl}/${t}`)}createTemplate(t){return this.http.post(this.apiUrl,t).pipe(me(e=>{e.success&&this.refreshTemplates()}))}updateTemplate(t,e){return this.http.put(`${this.apiUrl}/${t}`,e).pipe(me(i=>{i.success&&this.refreshTemplates()}))}deleteTemplate(t){return this.http.delete(`${this.apiUrl}/${t}`).pipe(me(e=>{e.success&&this.refreshTemplates()}))}refreshTemplates(){this.getActiveTemplates().subscribe()}getCurrentTemplates(){return this.templatesSubject.value}clearCache(){this.templatesSubject.next([])}static \u0275fac=function(e){return new(e||n)(J(ae))};static \u0275prov=$({token:n,factory:n.\u0275fac,providedIn:"root"})};function tt(){return n=>{let t=n.value;return t?t.toLowerCase().endsWith("@urssaf.fr")?null:{urssafEmail:!0}:null}}var Dt=class n{constructor(t,e,i){this.fb=t;this.appConfigService=e;this.templateService=i}createFormState(t){let e=this.createIncidentForm(),i=!!(t&&t.id),a={form:e,validation:{isValid:!1,errors:[],progress:0,canSubmit:!1},isEditMode:i,isSubmitting:!1,selectedTemplate:null,templateEmails:[],excludedTemplateEmails:[],hasUnsavedChanges:!1};return i?this.initializeForEdition(a,t):this.initializeForCreation(a),this.setupFormSubscriptions(a),a}createIncidentForm(){return this.fb.group({template_id:[null],object:["",[O.required,O.minLength(5),O.maxLength(200)]],domains:[[],[O.required,O.minLength(1)]],gravity:["moyen",O.required],status:["en_cours",O.required],meteo:[!1,O.required],dateOuverture:[new Date],dateCloture:[null],ticketNumber:["",[O.pattern(/^[A-Z0-9-]+$/)]],lienTicketHelpy:["",[O.pattern(/^https?:\/\/.*(helpy|\/ticket\/).*$/i)]],lienTicketTandem:["",[O.pattern(/^https?:\/\/.*(tandem|\/ticket\/).*$/i)]],isNational:[!1],publicsImpactes:[[]],sitesImpactes:[[]],description:["",O.required],actionsMenees:this.fb.array([]),actionsAMener:this.fb.array([]),indisponibiliteJours:[null,[O.min(0)]],indisponibiliteHeures:[null,[O.min(0),O.max(23)]],indisponibiliteMinutes:[null,[O.min(0),O.max(59)]],indisponibiliteContexte:[""],mailAlerte:this.fb.array([])},{validators:[n.dateClotureValidator(),n.actionsRequiredValidator()]})}setupFormSubscriptions(t){let e=new K;t.form.valueChanges.pipe(De(1e3),N(e)).subscribe(i=>{t.validation=this.validateForm(t.form),t.hasUnsavedChanges=t.form.dirty,t.isEditMode||localStorage.setItem("incompleteIncident",JSON.stringify(i))}),t.form.get("status")?.valueChanges.pipe(De(100),N(e)).subscribe(i=>{this.handleStatusChange(t,i)}),t.form.get("gravity")?.valueChanges.pipe(N(e)).subscribe(i=>{this.handleGravityChange(t,i)})}handleStatusChange(t,e){let i=t.form.get("dateCloture");if(e==="cloture"||e==="archive"){if(!i?.value){let a=new Date,d=a.getFullYear(),m=(a.getMonth()+1).toString().padStart(2,"0"),v=a.getDate().toString().padStart(2,"0"),k=a.getHours().toString().padStart(2,"0"),I=a.getMinutes().toString().padStart(2,"0"),x=`${d}-${m}-${v}T${k}:${I}`;i?.setValue(x)}}else i?.setValue(null)}handleGravityChange(t,e){if(!t.isEditMode)return;let i=t.form.get("status");i&&(e==="moyen"||e==="faible"?i.value==="en_attente"&&(i.setValue("en_cours"),i.disable()):(e==="grave"||e==="tres_grave")&&i.value==="en_cours"&&(i.setValue("en_attente"),i.enable()))}loadAvailableTemplates(){return B(this,null,function*(){return new Promise(t=>{this.templateService.getActiveTemplates().subscribe({next:e=>{t(e.success?e.data:[])},error:()=>t([])})})})}applyTemplate(t,e){return B(this,null,function*(){return new Promise((i,a)=>{this.templateService.getTemplate(e).subscribe({next:d=>{if(d.success&&d.data){t.selectedTemplate=d.data;let m=d.data.diffusion_list_emails||[];t.templateEmails=m.filter(v=>!t.excludedTemplateEmails.includes(v)),this.populateFormWithTemplate(t,d.data),i()}else a(new Error("Template non trouv\xE9"))},error:d=>a(d)})})})}populateFormWithTemplate(t,e){let i=t.form.get("object");i?.value?.trim()||i?.setValue(this.sanitizeString(e.nom_objet)),e.description&&t.form.get("description")?.setValue(this.sanitizeString(e.description)),e.actions&&this.applyTemplateActions(t,e.actions),this.sanitizeTemplateData(t.form)}applyTemplateActions(t,e){let i=t.form.get("actionsAMener");for(;i.length!==0;)i.removeAt(0);e.forEach(a=>{let d=this.createActionControl(a.action);i.push(d)})}removeTemplateEmail(t,e){if(t.templateEmails.length>e){let i=t.templateEmails[e];t.excludedTemplateEmails.includes(i)||t.excludedTemplateEmails.push(i),t.templateEmails.splice(e,1),t.form.markAsDirty()}}restoreTemplateEmail(t,e){let i=t.excludedTemplateEmails.indexOf(e);i>-1&&t.excludedTemplateEmails.splice(i,1),t.templateEmails.includes(e)||t.templateEmails.push(e),t.form.markAsDirty()}initializeForCreation(t){let e=new Date,i=e.getFullYear(),a=(e.getMonth()+1).toString().padStart(2,"0"),d=e.getDate().toString().padStart(2,"0"),m=e.getHours().toString().padStart(2,"0"),v=e.getMinutes().toString().padStart(2,"0"),k=`${i}-${a}-${d}T${m}:${v}`;t.form.patchValue({dateOuverture:k,status:"en_cours",gravity:"moyen",meteo:!1,isNational:!1,domains:[],publicsImpactes:[],sitesImpactes:[],_originalStatus:null}),t.form.get("mailAlerte").clear(),t.form.get("template_id")?.enable()}initializeForEdition(t,e){this.populateForm(t.form,e),this.populateMailAlerte(t.form,e.mailAlerte||[]),e.template_id?(t.form.get("template_id")?.setValue(e.template_id,{emitEvent:!1}),this.templateService.getTemplate(e.template_id).subscribe({next:i=>{if(i.success&&i.data){t.selectedTemplate=i.data;let a=i.data.diffusion_list_emails||[],d=e.template_excluded_emails||[];t.excludedTemplateEmails=[...d],t.templateEmails=a.filter(m=>!d.includes(m))}},error:i=>{console.error("Erreur chargement template en \xE9dition:",i),t.templateEmails=[],t.excludedTemplateEmails=[]}})):(t.templateEmails=[],t.excludedTemplateEmails=[]),t.validation=this.validateForm(t.form),this.setOriginalStatus(t.form,e.status||"en_cours"),t.form.get("template_id")?.disable()}addEmailToFormArray(t,e){if(e&&/^[\w-\.]+@([\w-]+\.)+[\w-]{2,4}$/.test(e)){t.form.get("mailAlerte").push(this.fb.control(e,[O.email,tt()]));let a=t.excludedTemplateEmails.indexOf(e);return a>-1&&t.excludedTemplateEmails.splice(a,1),!0}return!1}removeEmailFromFormArray(t,e){t.form.get("mailAlerte").removeAt(e)}addActionToFormArray(t,e,i){return e.trim()?(t.form.get(i).push(this.createActionControl(e)),!0):!1}removeActionFromFormArray(t,e,i){t.form.get(i).removeAt(e)}transferAction(t,e,i){let a=t.form.get(i),d=t.form.get(i==="actionsAMener"?"actionsMenees":"actionsAMener"),m=a.at(e);m&&(d.push(this.createActionControl(m.value)),a.removeAt(e))}createActionControl(t){let e=this.sanitizeString(t);return this.fb.control(e,[O.required,O.minLength(3)])}toggleSelection(t,e,i){let a=t.form.get(e)?.value||[],d=a.indexOf(i);d>-1?a.splice(d,1):a.push(i),t.form.patchValue({[e]:a})}isSelected(t,e,i){return(t.form.get(e)?.value||[]).includes(i)}selectAll(t,e){let i=[];switch(e){case"domains":i=this.domainOptions.map(a=>a.value);break;case"publicsImpactes":i=this.publicOptions.map(a=>a.value);break;case"sitesImpactes":i=this.siteOptions.map(a=>a.value);break}t.form.patchValue({[e]:i})}clearAll(t,e){let i={[e]:[]};e==="sitesImpactes"&&(i.isNational=!1),t.form.patchValue(i)}validateForm(t){let e=[];this.isObjectValid(t)||e.push("\u2022 Objet de l'incident (minimum 5 caract\xE8res)"),this.areDomainsValid(t)||e.push("\u2022 Au moins un domaine doit \xEAtre s\xE9lectionn\xE9"),this.isDescriptionValid(t)||e.push("\u2022 Description de l'incident"),this.areActionsValid(t)||t.get("status")?.value==="en_cours"&&e.push("\u2022 Au moins une action \xE0 mener (incident en cours)");let i=t.get("mailAlerte");i&&i.invalid&&e.push("\u2022 Au moins un email manuel est invalide (doit se terminer par @urssaf.fr)");let a=this.calculateFormProgress(t);return{isValid:e.length===0&&t.valid,errors:e,progress:a,canSubmit:e.length===0&&t.valid}}getMissingFields(t){let e=[];this.isObjectValid(t)||e.push("Objet"),this.areDomainsValid(t)||e.push("Domaines"),this.isDescriptionValid(t)||e.push("Description");let i=t.get("status")?.value;i==="en_cours"&&!this.areActionsValid(t)&&e.push("Actions \xE0 mener"),i==="cloture"&&!t.get("dateCloture")?.value&&e.push("Date de cl\xF4ture"),[{field:"lienTicketHelpy",label:"Format Lien HELPY"},{field:"lienTicketTandem",label:"Format Lien TANDEM"},{field:"ticketNumber",label:"Format N\xB0 Ticket"}].forEach(({field:m,label:v})=>{let k=t.get(m);k?.value&&k.hasError("pattern")&&e.push(v)}),t.get("dateCloture")?.hasError("dateClotureBeforeOuverture")&&e.push("Date de cl\xF4ture invalide");let d=t.get("mailAlerte");return d&&d.invalid&&e.push("Emails manuels invalides"),e}isFieldInvalid(t,e){let i=t.get(e);return!!(i?.invalid&&(i?.dirty||i?.touched))}getFieldError(t,e){let i=t.get(e);if(i?.errors&&(i.dirty||i.touched)){if(i.errors.required)return"Ce champ est obligatoire";if(i.errors.minlength)return`Minimum ${i.errors.minlength.requiredLength} caract\xE8res`;if(i.errors.maxlength)return`Maximum ${i.errors.maxlength.requiredLength} caract\xE8res`;if(i.errors.min)return`La valeur minimale est ${i.errors.min.min}.`;if(i.errors.max)return`La valeur maximale est ${i.errors.max.max}.`;if(i.errors.pattern)return"Format invalide";if(i.errors.dateClotureBeforeOuverture)return"La date de cl\xF4ture ne peut pas \xEAtre ant\xE9rieure \xE0 la date d'ouverture."}return null}markFormGroupTouched(t){Object.values(t.controls).forEach(e=>{e instanceof ht||e instanceof Ke?this.markFormGroupTouched(e):e.markAsTouched()})}getFormData(t){let e=t.form.getRawValue(),i=this.sanitizeObjectField(e.object),a=e.dateOuverture?new Date(e.dateOuverture):void 0,d=e.dateCloture?new Date(e.dateCloture):void 0,m=this.combineTempsIndisponibilite(Number(e.indisponibiliteJours)||0,Number(e.indisponibiliteHeures)||0,Number(e.indisponibiliteMinutes)||0,this.sanitizeString(e.indisponibiliteContexte)),v=(e.actionsAMener||[]).map(V=>this.sanitizeString(V)).filter(V=>V.length>0),k=(e.actionsMenees||[]).map(V=>this.sanitizeString(V)).filter(V=>V.length>0),I=(e.mailAlerte||[]).map(V=>this.sanitizeString(V)).filter(V=>V.length>0&&V.includes("@")),x=[];return t.templateEmails&&t.templateEmails.length>0&&(x=t.templateEmails.filter(V=>!I.includes(V))),{object:i,domains:e.domains||[],gravity:e.gravity,status:e.status,dateOuverture:a,dateCloture:d,isNational:e.isNational,ticketNumber:this.sanitizeString(e.ticketNumber),lienTicketHelpy:this.sanitizeString(e.lienTicketHelpy),lienTicketTandem:this.sanitizeString(e.lienTicketTandem),meteo:e.meteo,publicsImpactes:e.publicsImpactes||[],sitesImpactes:e.sitesImpactes||[],description:this.sanitizeQuillContent(e.description),actionsMenees:k,actionsAMener:v,tempsIndisponibilite:m,mailAlerte:I,auto_notified_emails:x,template_id:t.selectedTemplate?.id,template_excluded_emails:t.excludedTemplateEmails}}sanitizeString(t){return typeof t!="string"?String(t||""):t.trim().replace(/[\u0000-\u001F\u007F-\u009F]/g,"").replace(/[\u200B-\u200D\uFEFF]/g,"").replace(/\s+/g," ").substring(0,500)}sanitizeObjectField(t){let e=this.sanitizeString(t);if(e=e.replace(/&[a-zA-Z0-9#]+;/g,"").replace(/<[^>]*>/g,"").replace(/\\/g,"").replace(/[""'']/g,'"').replace(//g,"...").replace(/[]/g,"-").trim(),e.length<5)throw new Error("L'objet doit contenir au minimum 5 caract\xE8res");return e}sanitizeQuillContent(t){if(!t)return"";let e=String(t);return e=e.replace(/ql-editor/g,"").replace(/contenteditable="[^"]*"/g,"").replace(/spellcheck="[^"]*"/g,"").replace(/data-gramm="[^"]*"/g,"").replace(/class="[^"]*ql-[^"]*"/g,"").trim(),e}sanitizeTemplateData(t){let e=t.get("object");if(e?.value)try{let d=this.sanitizeObjectField(e.value);e.setValue(d,{emitEvent:!1})}catch{e.setValue("",{emitEvent:!1})}let i=t.get("description");if(i?.value){let d=this.sanitizeQuillContent(i.value);i.setValue(d,{emitEvent:!1})}let a=t.get("actionsAMener");if(a.length>0)for(let d=0;d<a.length;d++){let m=a.at(d);if(m.value){let v=this.sanitizeString(m.value);m.setValue(v,{emitEvent:!1})}}}populateForm(t,e){let i=d=>{if(!d)return null;let m=typeof d=="string"?new Date(d):d;if(isNaN(m.getTime()))return null;let v=m.getFullYear(),k=(m.getMonth()+1).toString().padStart(2,"0"),I=m.getDate().toString().padStart(2,"0"),x=m.getHours().toString().padStart(2,"0"),V=m.getMinutes().toString().padStart(2,"0");return`${v}-${k}-${I}T${x}:${V}`},a=Ae(we({},e),{object:this.sanitizeString(e.object||""),description:this.sanitizeQuillContent(e.description||"")});if(t.patchValue({template_id:a.template_id||null,object:a.object,domains:a.domains||[],gravity:a.gravity||"moyen",status:a.status||"en_cours",meteo:a.meteo??!1,dateOuverture:i(a.dateOuverture),dateCloture:i(a.dateCloture),ticketNumber:this.sanitizeString(a.ticketNumber||""),lienTicketHelpy:this.sanitizeString(a.lienTicketHelpy||""),lienTicketTandem:this.sanitizeString(a.lienTicketTandem||""),isNational:a.isNational??!1,publicsImpactes:a.publicsImpactes||[],sitesImpactes:a.sitesImpactes||[],description:a.description,_originalStatus:a.status}),this.populateFormArray(t,"actionsAMener",a.actionsAMener||[]),this.populateFormArray(t,"actionsMenees",a.actionsMenees||[]),this.populateMailAlerte(t,e.mailAlerte),a.tempsIndisponibilite){let{jours:d,heures:m,minutes:v,contexte:k}=this.parseTempsIndisponibilite(a.tempsIndisponibilite);t.patchValue({indisponibiliteJours:d,indisponibiliteHeures:m,indisponibiliteMinutes:v,indisponibiliteContexte:this.sanitizeString(k)})}}populateFormArray(t,e,i){let a=t.get(e);a.clear(),i.forEach(d=>{let m=this.sanitizeString(d);a.push(this.fb.control(m))})}populateMailAlerte(t,e){let i=t.get("mailAlerte");if(i.clear(),e)if(typeof e=="string"){let a=e.match(/[\w.-]+@[\w.-]+\.\w+/g);a&&a.forEach(d=>{i.push(this.fb.control(d.trim(),[O.email,tt()]))})}else Array.isArray(e)&&e.forEach(a=>{a&&typeof a=="string"&&a.includes("@")&&i.push(this.fb.control(a.trim(),[O.email,tt()]))})}isObjectValid(t){let e=t.get("object")?.value?.trim();return!!(e&&e.length>=5)}areDomainsValid(t){let e=t.get("domains")?.value;return Array.isArray(e)&&e.length>0}isDescriptionValid(t){let e=t.get("description")?.value?.trim();return!!(e&&e.length>0)}areActionsValid(t){let e=t.get("status")?.value;if(e==="cloture"||e==="archive")return!0;if(e==="en_cours"){let i=t.get("actionsAMener");return i.length>0&&i.controls.some(a=>a.value?.trim()?.length>=3)}return!0}calculateFormProgress(t){let e=["object","domains","gravity","status","meteo","description","actionsAMener"],i=0;return e.forEach(a=>{this.isFieldCompletedForProgress(t,a)&&i++}),Math.round(i/e.length*100)}isFieldCompletedForProgress(t,e){let i=t.get(e);if(!i)return!1;switch(e){case"object":return this.isObjectValid(t);case"domains":return this.areDomainsValid(t);case"gravity":case"status":return i.value&&i.value!=="";case"meteo":return i.value!==null&&i.value!==void 0;case"description":return this.isDescriptionValid(t);case"actionsAMener":return this.areActionsValid(t);default:return i.valid}}setOriginalStatus(t,e){t.contains("_originalStatus")?t.get("_originalStatus")?.setValue(e):t.addControl("_originalStatus",this.fb.control(e))}combineTempsIndisponibilite(t,e,i,a){let d="";if(t>0&&(d+=`${t} jour(s)`),e>0&&(d&&(d+=" "),d+=`${e} heure(s)`),i>0&&(d&&(d+=" "),d+=`${i} minute(s)`),a&&a.trim()){let m=this.sanitizeString(a);d?d+=` (Contexte: ${m})`:d=m}return d}parseTempsIndisponibilite(t){if(!t)return{jours:null,heures:null,minutes:null,contexte:""};let e=this.sanitizeString(t),i=e.match(/\(Contexte:\s*(.*)\)/),a=i?i[1].trim():"",d=e.replace(/\s*\(Contexte:.*\)/,"").trim(),m=d.match(/(\d+)\s*jour(s)?/i),v=d.match(/(\d+)\s*heure(s)?/i),k=d.match(/(\d+)\s*minute(s)?/i),I=m?parseInt(m[1],10):null,x=v?parseInt(v[1],10):null,V=k?parseInt(k[1],10):null;return{jours:I,heures:x,minutes:V,contexte:a}}static dateClotureValidator(){return t=>{let e=t,i=e.get("dateOuverture"),a=e.get("dateCloture");if(!i||!a)return null;let d=i.value?new Date(i.value):null,m=a.value?new Date(a.value):null;if(!m||!d){if(a.hasError("dateClotureBeforeOuverture")){let v=a.errors;v&&(delete v.dateClotureBeforeOuverture,Object.keys(v).length===0?a.setErrors(null):a.setErrors(v))}return null}if(m.getTime()<d.getTime())return a.setErrors(Ae(we({},a.errors),{dateClotureBeforeOuverture:!0})),{dateMismatch:!0};if(a.hasError("dateClotureBeforeOuverture")){let v=a.errors;v&&(delete v.dateClotureBeforeOuverture,Object.keys(v).length===0?a.setErrors(null):a.setErrors(v))}return null}}static actionsRequiredValidator(){return t=>{let e=t,i=e.get("status"),a=e.get("actionsAMener");if(!i||!a)return null;let d=!["cloture","archive"].includes(i.value),m=a.length===0;if(d&&m)return a.setErrors({required:!0}),{actionsRequired:!0};{let v=a.errors;v&&v.required&&(delete v.required,Object.keys(v).length===0?a.setErrors(null):a.setErrors(v))}return null}}get domainOptions(){return this.appConfigService.getDomains()}get gravityOptions(){return this.appConfigService.getGravityLevels()}get statusOptions(){return this.appConfigService.getStatusTypes()}get publicOptions(){return this.appConfigService.getPublics()}get siteOptions(){return this.appConfigService.getSites()}get groupedSiteOptions(){return this.appConfigService.getGroupedSiteOptions()}static \u0275fac=function(e){return new(e||n)(J(Ct),J(tn),J(He))};static \u0275prov=$({token:n,factory:n.\u0275fac,providedIn:"root"})};var ln=(n,t)=>t.id;function _r(n,t){if(n&1){let e=S();r(0,"button",11),f("click",function(){h(e);let a=c(2);return b(a.startCreate())}),l(1," + Nouveau mod\xE8le "),o()}}function Cr(n,t){if(n&1){let e=S();r(0,"button",12),f("click",function(){h(e);let a=c(2);return b(a.addAction())}),l(1," + Ajouter une action "),o()}}function yr(n,t){if(n&1){let e=S();r(0,"div",15)(1,"div",16)(2,"div",17),l(3),o(),r(4,"div",18),l(5),o()(),r(6,"div",19)(7,"button",20),f("click",function(){let a=h(e).$implicit,d=c(4);return b(d.startEdit(a))}),l(8," Modifier "),o(),r(9,"button",21),f("click",function(){let a=h(e).$implicit,d=c(4);return b(d.deleteTemplate(a.id))}),l(10," Supprimer "),o()()()}if(n&2){let e=t.$implicit;s(3),E(e.nom_objet),s(2),_("",e.actions_count," actions pr\xE9d\xE9finies")}}function Sr(n,t){if(n&1&&(r(0,"div",13),M(1,yr,11,2,"div",15,ln),o()),n&2){let e=c(3);s(),T(e.existingTemplates)}}function Er(n,t){n&1&&(r(0,"div",14)(1,"div",22),l(2,"\u{1F4CB}"),o(),r(3,"p"),l(4,"Aucun mod\xE8le d'incident cr\xE9\xE9"),o(),r(5,"p",23),l(6,'Cliquez sur "Nouveau mod\xE8le" pour commencer'),o()())}function wr(n,t){if(n&1&&(r(0,"div",9),u(1,Sr,3,0,"div",13)(2,Er,7,0,"div",14),o()),n&2){let e=c(2);s(),p(e.existingTemplates.length>0?1:2)}}function kr(n,t){n&1&&(r(0,"div",31),l(1," Le nom de l'objet est obligatoire "),o())}function Mr(n,t){n&1&&(r(0,"div",31),l(1," Ce nom de mod\xE8le existe d\xE9j\xE0. "),o())}function Tr(n,t){if(n&1&&(r(0,"option",42),l(1),o()),n&2){let e=t.$implicit;C("value",e.id),s(),E(e.name)}}function Ir(n,t){if(n&1&&(r(0,"select",33)(1,"option",41),l(2,"Aucune"),o(),M(3,Tr,2,2,"option",42,ln),o()),n&2){let e=c(3);s(),C("ngValue",null),s(2),T(e.personalLists)}}function Fr(n,t){n&1&&(r(0,"div",34),l(1," Aucune liste personnalis\xE9e. Vous pouvez en cr\xE9er depuis le menu 'Liste diffusion' "),o())}function Ar(n,t){if(n&1){let e=S();r(0,"div",36)(1,"div",43)(2,"span",44),l(3),o(),r(4,"button",45),f("click",function(){let a=h(e).$index,d=c(3);return b(d.removeAction(a))}),l(5," \xD7 "),o()(),r(6,"div",4)(7,"label",46),l(8," Description de l'action "),r(9,"span",29),l(10,"*"),o()(),r(11,"input",47),f("keydown.enter",function(a){h(e);let d=c(3);return b(d.onActionInputEnter(a))}),o()()()}if(n&2){let e=t.$index,i=c(3);C("formGroupName",e),s(3),_("Action ",e+1),s(),C("disabled",i.getActionsFormArray().length===1)}}function Dr(n,t){n&1&&(r(0,"div",37),l(1," Au moins une action est requise. "),o())}function Pr(n,t){if(n&1){let e=S();r(0,"div",10)(1,"form",24),f("ngSubmit",function(){h(e);let a=c(2);return b(a.onSubmit())}),r(2,"div",25)(3,"h4",26),l(4,"Informations g\xE9n\xE9rales"),o(),r(5,"div",27)(6,"label",28),l(7," Nom de l'objet "),r(8,"span",29),l(9,"*"),o()(),r(10,"div",16),g(11,"input",30),u(12,kr,2,0,"div",31),u(13,Mr,2,0,"div",31),o()(),r(14,"div",4)(15,"label",32),l(16," Notifier la liste personnalis\xE9e "),o(),r(17,"div",16),u(18,Ir,5,1,"select",33)(19,Fr,2,0,"div",34),o()()(),r(20,"div",25)(21,"h4",26),l(22,"Actions \xE0 mener"),o(),r(23,"div",35),M(24,Ar,12,3,"div",36,re),o(),u(26,Dr,2,0,"div",37),o(),r(27,"div",38)(28,"button",39),f("click",function(){h(e);let a=c(2);return b(a.cancelForm())}),l(29," Annuler "),o(),r(30,"button",40),l(31),o()()()()}if(n&2){let e,i,a,d,m=c(2);s(),C("formGroup",m.templateForm),s(10),F("border-red-500",((e=m.templateForm.get("nom_objet"))==null?null:e.errors)&&((e=m.templateForm.get("nom_objet"))==null?null:e.touched)),s(),p(!((i=m.templateForm.get("nom_objet"))==null||i.errors==null)&&i.errors.required&&((i=m.templateForm.get("nom_objet"))!=null&&i.touched)?12:-1),s(),p(!((a=m.templateForm.get("nom_objet"))==null||a.errors==null)&&a.errors.nonUnique?13:-1),s(5),p(m.personalLists.length>0?18:19),s(6),T(m.getActionsFormArray().controls),s(2),p((d=m.templateForm.get("actions"))!=null&&d.hasError("atLeastOneActionRequired")&&((d=m.templateForm.get("actions"))!=null&&d.touched)?26:-1),s(4),C("disabled",!m.templateForm.valid||m.isSubmitting),s(),_(" ",m.isSubmitting?"Enregistrement...":m.isEditing?"Modifier":"Cr\xE9er"," ")}}function Vr(n,t){if(n&1){let e=S();r(0,"div",0)(1,"div",1),f("click",function(a){return h(e),b(a.stopPropagation())}),r(2,"div",2)(3,"h3",3),l(4," Mod\xE8les d'incident "),o(),r(5,"div",4),u(6,_r,2,0,"button",5),u(7,Cr,2,0,"button",6),r(8,"button",7),f("click",function(){h(e);let a=c();return b(a.closeModal())}),l(9,"\xD7"),o()()(),r(10,"div",8),u(11,wr,3,1,"div",9),u(12,Pr,32,9,"div",10),o()()()}if(n&2){let e=c();s(6),p(e.showForm?-1:6),s(),p(e.showForm?7:-1),s(4),p(e.showForm?-1:11),s(),p(e.showForm?12:-1)}}var Pt=class n{constructor(t,e,i,a){this.fb=t;this.templateService=e;this.notificationService=i;this.diffusionListService=a;this.templateForm=this.createForm()}templateSelected=new j;modalClosed=new j;isVisible=!1;showForm=!1;isEditing=!1;isSubmitting=!1;existingTemplates=[];personalLists=[];currentEditingId;templateForm;ngOnInit(){this.loadTemplates(),this.loadPersonalLists()}uniqueTemplateNameValidator(t){let e=(t.value||"").trim().toLowerCase();return e&&this.existingTemplates.some(a=>a.nom_objet.toLowerCase()===e&&a.id!==this.currentEditingId)?{nonUnique:!0}:null}minOneActionRequired(t){return t instanceof Ke?t.controls.filter(i=>{let a=i.get("action")?.value;return a&&a.trim()!==""}).length>0?null:{atLeastOneActionRequired:!0}:null}createForm(){return this.fb.group({nom_objet:["",[O.required,O.minLength(3),this.uniqueTemplateNameValidator.bind(this)]],diffusion_list_id:[null],actions:this.fb.array([this.createActionGroup()],[this.minOneActionRequired.bind(this)])})}createActionGroup(){return this.fb.group({action:[""]})}getActionsFormArray(){return this.templateForm.get("actions")}loadTemplates(){this.templateService.getActiveTemplates().subscribe({next:t=>{t.success&&(this.existingTemplates=t.data)},error:t=>{this.notificationService.error("Erreur lors du chargement des mod\xE8les"),console.error(t)}})}loadPersonalLists(){this.diffusionListService.getLists("personnelle").subscribe({next:t=>{t.success&&(this.personalLists=t.data)},error:t=>{this.notificationService.error("Erreur lors du chargement des listes personnalis\xE9es"),console.error(t)}})}openModal(){this.isVisible=!0,this.showForm=!1,this.loadTemplates()}closeModal(){this.isVisible=!1,this.showForm=!1,this.resetForm(),this.modalClosed.emit()}onOverlayClick(t){t.target===t.currentTarget&&this.closeModal()}startCreate(){this.isEditing=!1,this.currentEditingId=void 0,this.resetForm(),this.showForm=!0}startEdit(t){this.templateService.getTemplate(t.id).subscribe({next:e=>{e.success&&(this.isEditing=!0,this.currentEditingId=t.id,this.populateForm(e.data),this.showForm=!0)},error:e=>{this.notificationService.error("Erreur lors du chargement du mod\xE8le"),console.error(e)}})}populateForm(t){let e=this.getActionsFormArray();e.clear(),t.actions&&t.actions.length>0?t.actions.forEach(i=>{e.push(this.fb.group({action:[i.action]}))}):e.push(this.createActionGroup()),this.templateForm.patchValue({nom_objet:t.nom_objet,description:t.description||"",diffusion_list_id:t.diffusion_list_id||null})}resetForm(){this.templateForm.reset();let t=this.getActionsFormArray();t.clear(),t.push(this.createActionGroup()),this.templateForm.patchValue({nom_objet:"",description:"",diffusion_list_id:null})}addAction(){this.getActionsFormArray().push(this.createActionGroup())}removeAction(t){let e=this.getActionsFormArray();e.length>1&&e.removeAt(t)}onActionInputEnter(t){t.preventDefault()}cancelForm(){this.showForm=!1,this.resetForm()}onSubmit(){if(!this.templateForm.valid){this.markFormGroupTouched();return}this.isSubmitting=!0;let t=this.templateForm.value,e={nom_objet:t.nom_objet,description:t.description,actions:t.actions.filter(a=>a.action.trim()),diffusion_list_id:t.diffusion_list_id};(this.isEditing?this.templateService.updateTemplate(this.currentEditingId,e):this.templateService.createTemplate(e)).subscribe({next:a=>{a.success&&(this.notificationService.success(this.isEditing?"Mod\xE8le modifi\xE9 avec succ\xE8s":"Mod\xE8le cr\xE9\xE9 avec succ\xE8s"),this.showForm=!1,this.loadTemplates(),this.resetForm()),this.isSubmitting=!1},error:a=>{a.status===422&&a.error?.errors?.nom_objet?this.notificationService.error("Nom de mod\xE8le d\xE9j\xE0 utilis\xE9","Ce nom de mod\xE8le existe d\xE9j\xE0. Veuillez en choisir un autre."):this.notificationService.error(this.isEditing?"Erreur lors de la modification":"Erreur lors de la cr\xE9ation"),console.error(a),this.isSubmitting=!1}})}deleteTemplate(t){confirm("\xCAtes-vous s\xFBr de vouloir supprimer ce mod\xE8le ?")&&this.templateService.deleteTemplate(t).subscribe({next:e=>{e.success&&(this.notificationService.success("Mod\xE8le supprim\xE9 avec succ\xE8s"),this.loadTemplates())},error:e=>{this.notificationService.error("Erreur lors de la suppression"),console.error(e)}})}markFormGroupTouched(){Object.keys(this.templateForm.controls).forEach(t=>{let e=this.templateForm.get(t);e?.markAsTouched(),e instanceof Ke&&e.controls.forEach(i=>{i instanceof ht&&Object.keys(i.controls).forEach(a=>{i.get(a)?.markAsTouched()})})})}selectTemplate(t){this.templateService.getTemplate(t.id).subscribe({next:e=>{e.success&&(this.templateSelected.emit({id:e.data.id,nom_objet:e.data.nom_objet,actions:e.data.actions||[]}),this.closeModal())},error:e=>{this.notificationService.error("Erreur lors de la s\xE9lection du mod\xE8le"),console.error(e)}})}static \u0275fac=function(e){return new(e||n)(y(Ct),y(He),y(z),y(nn))};static \u0275cmp=A({type:n,selectors:[["app-incident-template-modal"]],outputs:{templateSelected:"templateSelected",modalClosed:"modalClosed"},decls:1,vars:1,consts:[[1,"fixed","inset-0","bg-black","bg-opacity-60","flex","items-center","justify-center","z-50"],[1,"bg-white","rounded-lg","w-11/12","max-w-4xl","max-h-[90vh]","overflow-hidden","shadow-2xl",3,"click"],[1,"flex","justify-between","items-center","px-6","py-5","border-b","border-gray-200","bg-gray-50"],[1,"text-xl","font-semibold","text-gray-900"],[1,"flex","items-center","gap-3"],["type","button",1,"px-4","py-2","bg-blue-600","text-white","rounded-lg","hover:bg-blue-700","transition-colors","font-medium","text-sm"],["type","button",1,"px-4","py-2","bg-green-600","text-white","rounded-lg","hover:bg-green-700","transition-colors","font-medium","text-sm"],["type","button",1,"w-8","h-8","flex","items-center","justify-center","text-2xl","text-gray-400","hover:text-gray-600","hover:bg-gray-200","rounded-full","transition-colors",3,"click"],[1,"px-6","py-6","max-h-[calc(90vh-140px)]","overflow-y-auto"],[1,"templates-list"],[1,"template-form"],["type","button",1,"px-4","py-2","bg-blue-600","text-white","rounded-lg","hover:bg-blue-700","transition-colors","font-medium","text-sm",3,"click"],["type","button",1,"px-4","py-2","bg-green-600","text-white","rounded-lg","hover:bg-green-700","transition-colors","font-medium","text-sm",3,"click"],[1,"space-y-3"],[1,"text-center","py-12","text-gray-500"],[1,"flex","justify-between","items-center","p-4","border","border-gray-200","rounded-lg","hover:bg-gray-50","transition-colors"],[1,"flex-1"],[1,"font-medium","text-gray-900"],[1,"text-sm","text-gray-600"],[1,"flex","gap-2"],["type","button",1,"px-3","py-1","bg-orange-500","text-white","text-sm","rounded","hover:bg-orange-600","transition-colors",3,"click"],["type","button",1,"px-3","py-1","bg-red-500","text-white","text-sm","rounded","hover:bg-red-600","transition-colors",3,"click"],[1,"text-4xl","mb-4"],[1,"text-sm","mt-2"],[3,"ngSubmit","formGroup"],[1,"mb-6"],[1,"text-lg","font-semibold","text-gray-900","mb-4"],[1,"flex","items-center","gap-3","mb-4"],["for","nom_objet",1,"text-sm","font-medium","text-gray-700","whitespace-nowrap"],[1,"text-red-500"],["type","text","id","nom_objet","formControlName","nom_objet","placeholder","Ex: Coupure \xE9lectrique, Panne r\xE9seau...",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","focus:ring-2","focus:ring-blue-500","focus:border-blue-500","transition-colors","text-sm"],[1,"mt-1","text-sm","text-red-600"],["for","diffusion_list_id",1,"text-sm","font-medium","text-gray-700","whitespace-nowrap"],["id","diffusion_list_id","formControlName","diffusion_list_id",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","focus:ring-2","focus:ring-blue-500","focus:border-blue-500","transition-colors","text-sm"],[1,"text-sm","text-gray-500","italic","bg-gray-100","p-2","rounded-md"],["formArrayName","actions",1,"space-y-4"],[1,"border","border-gray-200","rounded-lg","p-4","bg-gray-50",3,"formGroupName"],[1,"text-sm","text-red-600","mt-2"],[1,"flex","justify-end","gap-3","pt-4","border-t","border-gray-200","bg-white","sticky","bottom-0"],["type","button",1,"px-6","py-2","border","border-gray-300","text-gray-700","rounded-lg","hover:bg-gray-50","transition-colors","font-medium",3,"click"],["type","submit",1,"px-6","py-2","bg-blue-600","text-white","rounded-lg","hover:bg-blue-700","disabled:opacity-50","disabled:cursor-not-allowed","transition-colors","font-medium",3,"disabled"],[3,"ngValue"],[3,"value"],[1,"flex","justify-between","items-center","mb-3"],[1,"font-semibold","text-gray-800","text-sm"],["type","button",1,"w-6","h-6","flex","items-center","justify-center","text-red-500","hover:text-red-700","hover:bg-red-100","rounded-full","transition-colors","text-sm",3,"click","disabled"],[1,"text-sm","font-medium","text-gray-700","whitespace-nowrap"],["type","text","formControlName","action","placeholder","Ex: V\xE9rifier l'alimentation \xE9lectrique",1,"flex-1","px-3","py-2","border","border-gray-300","rounded-md","focus:ring-2","focus:ring-blue-500","focus:border-blue-500","transition-colors","text-sm",3,"keydown.enter"]],template:function(e,i){e&1&&u(0,Vr,13,4,"div",0),e&2&&p(i.isVisible?0:-1)},dependencies:[q,ye,bt,_e,Ce,le,Ne,se,ft,ze,vt,_t,Zi,xt],encapsulation:2})};var Vt=class n{configs={full:{toolbar:[["bold","italic","underline","strike"],["blockquote","code-block"],[{header:1},{header:2}],[{list:"ordered"},{list:"bullet"},{list:"check"}],[{script:"sub"},{script:"super"}],[{indent:"-1"},{indent:"+1"}],[{color:[]},{background:[]}],[{align:[]}],["clean"],["link"]]},compact:{toolbar:[["bold","italic","underline","strike"],[{list:"ordered"},{list:"bullet"},{list:"check"}],["clean"]]},basic:{toolbar:[["bold","italic","strike"],[{list:"bullet"},{list:"check"}],["clean"]]},email:{toolbar:[["bold","italic","underline","strike"],[{header:2}],[{list:"ordered"},{list:"bullet"}],["link"],["clean"]]}};styles={full:{height:"200px",border:"1px solid #d1d5db",borderRadius:"8px"},compact:{height:"150px",border:"1px solid #d1d5db",borderRadius:"8px"},basic:{height:"120px",border:"1px solid #d1d5db",borderRadius:"8px"},email:{height:"180px",border:"1px solid #d1d5db",borderRadius:"8px",fontFamily:"monospace"}};getConfig(t){return this.configs[t]||this.configs.full}getStyles(t){return this.styles[t]||this.styles.full}get fullConfig(){return this.getConfig("full")}get compactConfig(){return this.getConfig("compact")}get basicConfig(){return this.getConfig("basic")}get emailConfig(){return this.getConfig("email")}get descriptionStyles(){return this.getStyles("full")}get compactStyles(){return this.getStyles("compact")}get basicStyles(){return this.getStyles("basic")}get emailStyles(){return this.getStyles("email")}isQuillContentEmpty(t){return!t?.replace(/<[^>]*>/g,"").trim()}getPlainTextFromQuill(t){return t?.replace(/<[^>]*>/g,"").trim()||""}getWordCount(t){if(!t)return 0;let e=document.createElement("div");e.innerHTML=t;let i=e.textContent||e.innerText||"";return i.trim()?i.trim().split(/\s+/).length:0}suggestions={"actions-menees":["Red\xE9marrage du serveur principal","V\xE9rification des logs syst\xE8me","Contact \xE9quipe support niveau 2","Mise en place solution de contournement","Escalade vers l'\xE9quipe infrastructure","Test de la solution temporaire"],"actions-a-mener":["Analyse approfondie des causes racines","Mise \xE0 jour de la documentation","Formation \xE9quipe sur nouvelle proc\xE9dure","Test de non-r\xE9gression","Planification maintenance pr\xE9ventive","R\xE9vision des alertes monitoring"]};getFieldSuggestions(t){return this.suggestions[t]||[]}getDefaultEmailTemplate(){return`<p>Un incident concernant <strong>{object}</strong> vient d'\xEAtre ajout\xE9 \xE0 la base des incidents.</p>
  <p>Vous pouvez aller le consulter en cliquant ici : <a href="${G.frontUrl}/incident/{id}" target="_blank" rel="noopener noreferrer"><strong><u>Consulter l'incident</u></strong></a></p>`}processEmailTemplate(t,e){return t.replace(/{object}/g,e.object).replace(/{id}/g,e.id.toString())}static \u0275fac=function(e){return new(e||n)};static \u0275prov=$({token:n,factory:n.\u0275fac,providedIn:"root"})};var qr=["templateModal"],Rr=(n,t)=>({"bg-blue-100 text-blue-800":n,"bg-red-100 text-red-800":t}),jr=(n,t)=>({"text-blue-600 hover:text-blue-800":n,"text-red-600 hover:text-red-800":t}),Lr=(n,t)=>t.id,nt=(n,t)=>t.value;function Nr(n,t){n&1&&l(0," Template utilis\xE9 pour la cr\xE9ation de cet incident ")}function zr(n,t){n&1&&l(0," S\xE9lectionnez un mod\xE8le pour pr\xE9-remplir automatiquement les actions \xE0 mener ")}function Hr(n,t){n&1&&l(0," Objet pr\xE9d\xE9fini ")}function $r(n,t){n&1&&l(0," Attention le template ne peut pas \xEAtre modifi\xE9 apr\xE8s la cr\xE9ation de l'incident ")}function Ur(n,t){if(n&1&&l(0),n&2){let e=c().$implicit;_(" (",e.actions_count," actions) ")}}function Gr(n,t){if(n&1&&(r(0,"option",21),l(1),u(2,Ur,1,1),o()),n&2){let e=t.$implicit;C("value",e.id),s(),_(" ",e.nom_objet," "),s(),p(e.actions_count?2:-1)}}function Br(n,t){n&1&&(r(0,"div",22)(1,"div",121)(2,"span",122),l(3,"\u2713"),o(),r(4,"span",123),l(5,"Mod\xE8le appliqu\xE9"),o(),r(6,"span",124),l(7,"- Actions pr\xE9-remplies"),o()()())}function Qr(n,t){if(n&1){let e=S();r(0,"span",130)(1,"span"),l(2),o(),r(3,"button",131),f("click",function(){let a=h(e).$index,d=c(3);return b(d.removeTemplateEmail(a))}),l(4," \xD7 "),o()()}if(n&2){let e=t.$implicit;s(2),E(e)}}function Wr(n,t){if(n&1&&(r(0,"div",23)(1,"div",125)(2,"span",126),l(3,"\u{1F4E7}"),o(),r(4,"p",127),l(5," Destinataires du template "),o(),r(6,"span",128),l(7,"(cliquez sur \u2715 pour retirer)"),o()(),r(8,"div",129),M(9,Qr,5,1,"span",130,re),o()()),n&2){let e=c(2);s(9),T(e.templateDiffusionListEmails)}}function Jr(n,t){n&1&&(r(0,"div",24)(1,"div",132)(2,"span",133),l(3,"\u26A0\uFE0F"),o(),r(4,"span",134),l(5,"Aucune liste de diffusion, ce template n'a pas de liste personnalis\xE9e ou vous avez tout retir\xE9. "),o()(),r(6,"div",135)(7,"span",136),l(8,"\u2192"),o(),l(9,' Ajoutez des emails dans "Personnes suppl\xE9mentaires \xE0 notifier" '),o()())}function Yr(n,t){n&1&&(r(0,"div",25)(1,"div",137)(2,"span"),l(3,"\u{1F4A1}"),o(),r(4,"div")(5,"span",138),l(6,"Astuce :"),o(),r(7,"span",139),l(8," Les mod\xE8les permettent de gagner du temps en pr\xE9-remplissant automatiquement les actions courantes pour des types d'incidents r\xE9currents. "),o()()()())}function Kr(n,t){if(n&1&&(r(0,"div",37),l(1),o()),n&2){let e=c(2);s(),_(" ",e.getFieldError("object")," ")}}function Zr(n,t){if(n&1&&(r(0,"option",21),l(1),o()),n&2){let e=t.$implicit;C("value",e.value),s(),_(" ",e.label," ")}}function Xr(n,t){if(n&1&&(r(0,"option",21),l(1),o()),n&2){let e=t.$implicit;C("value",e.value),s(),_(" ",e.label," ")}}function eo(n,t){if(n&1&&(r(0,"div",37),l(1),o()),n&2){let e=c(2);s(),_(" ",e.getFieldError("ticketNumber")," ")}}function to(n,t){if(n&1&&(r(0,"div",37),l(1),o()),n&2){let e=c(3);s(),_(" ",e.getFieldError("dateCloture")," ")}}function io(n,t){if(n&1&&(r(0,"div")(1,"label",140),l(2," Date de cl\xF4ture "),o(),g(3,"input",141),u(4,to,2,1,"div",37),o()),n&2){let e=c(2);s(3),F("border-red-500",e.isFieldInvalid("dateCloture")),s(),p(e.isFieldInvalid("dateCloture")?4:-1)}}function no(n,t){n&1&&(r(0,"div"),l(1," Le lien doit \xEAtre une URL valide (contenant 'helpy' ou '/ticket/') "),o())}function ro(n,t){n&1&&(r(0,"div"),l(1," Veuillez saisir une URL valide "),o())}function oo(n,t){if(n&1&&(r(0,"div",37),u(1,no,2,0,"div"),u(2,ro,2,0,"div"),o()),n&2){let e,i,a=c(2);s(),p(!((e=a.incidentForm.get("lienTicketHelpy"))==null||e.errors==null)&&e.errors.pattern?1:-1),s(),p(!((i=a.incidentForm.get("lienTicketHelpy"))==null||i.errors==null)&&i.errors.url?2:-1)}}function ao(n,t){if(n&1&&(r(0,"div",59)(1,"div",142),w(),r(2,"svg",143),g(3,"path",144),o(),D(),r(4,"a",145),l(5," Ouvrir le ticket HELPY "),w(),r(6,"svg",146),g(7,"path",147),o()()()()),n&2){let e,i=c(2);s(4),C("href",(e=i.incidentForm.get("lienTicketHelpy"))==null?null:e.value,ge)}}function lo(n,t){n&1&&(r(0,"div"),l(1," Le lien doit \xEAtre une URL valide (contenant 'tandem' ou '/ticket/') "),o())}function so(n,t){n&1&&(r(0,"div"),l(1," Veuillez saisir une URL valide "),o())}function co(n,t){if(n&1&&(r(0,"div",37),u(1,lo,2,0,"div"),u(2,so,2,0,"div"),o()),n&2){let e,i,a=c(2);s(),p(!((e=a.incidentForm.get("lienTicketTandem"))==null||e.errors==null)&&e.errors.pattern?1:-1),s(),p(!((i=a.incidentForm.get("lienTicketTandem"))==null||i.errors==null)&&i.errors.url?2:-1)}}function mo(n,t){if(n&1&&(r(0,"div",59)(1,"div",142),w(),r(2,"svg",143),g(3,"path",144),o(),D(),r(4,"a",145),l(5," Ouvrir le ticket TANDEM "),w(),r(6,"svg",146),g(7,"path",147),o()()()()),n&2){let e,i=c(2);s(4),C("href",(e=i.incidentForm.get("lienTicketTandem"))==null?null:e.value,ge)}}function uo(n,t){if(n&1){let e=S();r(0,"div",148),f("click",function(){let a=h(e).$implicit,d=c(2);return b(d.toggleDomainSelection(a.value))}),g(1,"input",149),r(2,"span",150),l(3),o()()}if(n&2){let e=t.$implicit,i=c(2);F("border-blue-500",i.isDomainSelected(e.value))("bg-blue-50",i.isDomainSelected(e.value))("border-gray-200",!i.isDomainSelected(e.value)),s(),C("checked",i.isDomainSelected(e.value)),s(2),E(e.label)}}function po(n,t){if(n&1&&(r(0,"div",67),l(1),o()),n&2){let e=c(2);s(),_(" ",e.getFieldError("domains")," ")}}function go(n,t){if(n&1){let e=S();r(0,"div",148),f("click",function(){let a=h(e).$implicit,d=c(2);return b(d.togglePublicSelection(a.value))}),g(1,"input",149),r(2,"span",150),l(3),o()()}if(n&2){let e=t.$implicit,i=c(2);F("border-blue-500",i.isPublicSelected(e.value))("bg-blue-50",i.isPublicSelected(e.value))("border-gray-200",!i.isPublicSelected(e.value)),s(),C("checked",i.isPublicSelected(e.value)),s(2),E(e.label)}}function fo(n,t){if(n&1){let e=S();r(0,"div",148),f("click",function(){let a=h(e).$implicit,d=c(2);return b(d.toggleSiteSelection(a.value))}),g(1,"input",149),r(2,"span",150),l(3),o()()}if(n&2){let e=t.$implicit,i=c(2);F("border-blue-500",i.isSiteSelected(e.value))("bg-blue-50",i.isSiteSelected(e.value))("border-gray-200",!i.isSiteSelected(e.value)),s(),C("checked",i.isSiteSelected(e.value)),s(2),E(e.label)}}function ho(n,t){if(n&1&&(r(0,"div",37),l(1),o()),n&2){let e=c(2);s(),_(" ",e.getFieldError("description")," ")}}function bo(n,t){n&1&&(r(0,"span",83),l(1,"*"),o())}function vo(n,t){if(n&1){let e=S();r(0,"div",85)(1,"button",151),f("click",function(){let a=h(e).$index,d=c(2);return b(d.removeAction("actionsAMener",a))}),w(),r(2,"svg",152),g(3,"path",153),o()(),D(),g(4,"input",154),r(5,"button",155),f("click",function(){let a=h(e).$index,d=c(2);return b(d.transferAction(a))}),w(),r(6,"svg",156),g(7,"path",157),o()()()}if(n&2){let e=t.$index;s(4),C("formControlName",e)}}function xo(n,t){n&1&&(r(0,"div",87),l(1," \u26A0\uFE0F "),r(2,"strong"),l(3,"Incident en cours :"),o(),l(4," Au moins une action \xE0 mener est requise. "),o())}function _o(n,t){n&1&&(r(0,"div",88),l(1," \u2705 "),r(2,"strong"),l(3,"Incident clotur\xE9 :"),o(),l(4," Les actions restantes peuvent \xEAtre conserv\xE9es pour traitement ult\xE9rieur. "),o())}function Co(n,t){n&1&&(r(0,"div",67),l(1," Au moins une action est requise lorsque l'incident est en cours. "),o())}function yo(n,t){if(n&1){let e=S();r(0,"li",158)(1,"button",159),f("click",function(){let a=h(e).$index,d=c(3);return b(d.untransferAction(a))}),w(),r(2,"svg",156),g(3,"path",160),o()(),D(),r(4,"span",161),l(5,"\u2713"),o(),r(6,"span",162),l(7),o(),r(8,"button",163),f("click",function(){let a=h(e).$index,d=c(3);return b(d.removeAction("actionsMenees",a))}),w(),r(9,"svg",152),g(10,"path",153),o()()()}if(n&2){let e=t.$implicit;s(7),E(e.value)}}function So(n,t){if(n&1&&(r(0,"ul",91),M(1,yo,11,1,"li",158,re),o()),n&2){let e=c(2);s(),T(e.actionsMenees.controls)}}function Eo(n,t){n&1&&(r(0,"p",92),l(1,"Aucune action men\xE9e pour le moment."),o())}function wo(n,t){n&1&&l(0," L'email doit se terminer par @urssaf.fr ")}function ko(n,t){n&1&&l(0," Format d'email invalide. ")}function Mo(n,t){if(n&1&&(r(0,"div",167),u(1,wo,1,0)(2,ko,1,0),o()),n&2){let e=c().$implicit;s(),p(e.hasError("urssafEmail")?1:e.hasError("email")?2:-1)}}function To(n,t){if(n&1){let e=S();r(0,"div",164)(1,"div",165)(2,"span"),l(3),o(),r(4,"button",166),f("click",function(){let a=h(e).$index,d=c(3);return b(d.removeEmail(a))}),l(5," \xD7 "),o()(),u(6,Mo,3,1,"div",167),o()}if(n&2){let e=t.$implicit;s(),C("ngClass",ii(4,Rr,e.valid,e.invalid)),s(2),E(e.value),s(),C("ngClass",ii(7,jr,e.valid,e.invalid)),s(2),p(e.invalid&&(e.dirty||e.touched)?6:-1)}}function Io(n,t){if(n&1&&(r(0,"div",105),M(1,To,7,10,"div",164,re),o()),n&2){let e=c(2);s(),T(e.mailAlerte.controls)}}function Fo(n,t){n&1&&l(0," Format d'email invalide. ")}function Ao(n,t){n&1&&l(0," L'email doit se terminer par @urssaf.fr ")}function Do(n,t){if(n&1&&(r(0,"div",37),u(1,Fo,1,0)(2,Ao,1,0),o()),n&2){let e=c(2);s(),p(e.newEmailControl.hasError("email")?1:e.newEmailControl.hasError("urssafEmail")?2:-1)}}function Po(n,t){if(n&1&&(r(0,"span",170),l(1),o()),n&2){c();let e=Fi(0);s(),_("(",e.join(", "),")")}}function Vo(n,t){if(n&1&&(Ti(0),r(1,"div",115),w(),r(2,"svg",168),g(3,"path",169),o(),l(4," Champs obligatoires manquants "),u(5,Po,2,1,"span",170),o()),n&2){let e=Ii(c(2).getMissingFields());s(5),p(e.length>0?5:-1)}}function Oo(n,t){n&1&&(r(0,"div",116),w(),r(1,"svg",168),g(2,"path",171),o(),l(3," Formulaire pr\xEAt pour soumission "),o())}function qo(n,t){if(n&1&&(r(0,"span",118),l(1),o()),n&2){let e=c(2);s(),_(" \u{1F4BE} ",e.isEditMode?"Enregistrer les modifications":"Cr\xE9er l'incident"," ")}}function Ro(n,t){if(n&1&&(r(0,"span",118),w(),r(1,"svg",172),g(2,"circle",173)(3,"path",174),o(),l(4),o()),n&2){let e=c(2);s(4),_(" ",e.isEditMode?"Mise \xE0 jour en cours...":"Cr\xE9ation en cours..."," ")}}function jo(n,t){if(n&1){let e=S();r(0,"form",2),f("ngSubmit",function(){h(e);let a=c();return b(a.onSubmit())}),r(1,"div",3)(2,"div",4)(3,"h2",5),l(4," \u{1F4CB} Fiche d'incident "),o(),r(5,"div",6)(6,"span",7),l(7,"R\xE9dacteur :"),o(),r(8,"span",8),l(9),o()()(),r(10,"div",3)(11,"div",9)(12,"div",10)(13,"div",11)(14,"div",12),l(15," \u{1F4CB} "),o(),r(16,"div")(17,"h3",5),l(18,"Mod\xE8le pr\xE9d\xE9fini"),o(),r(19,"p",13),u(20,Nr,1,0)(21,zr,1,0),o()()(),r(22,"button",14),f("click",function(){h(e);let a=c();return b(a.openTemplateManagement())}),r(23,"span"),l(24,"\u2699"),o(),r(25,"span"),l(26,"G\xE9rer les mod\xE8les"),o()()()(),r(27,"div",15)(28,"div",16)(29,"div",17)(30,"div")(31,"label",18),u(32,Hr,1,0),u(33,$r,1,0),o(),r(34,"select",19),f("change",function(a){h(e);let d=c();return b(d.onTemplateSelected(a))}),r(35,"option",20),l(36,"Aucun mod\xE8le - Saisie manuelle"),o(),M(37,Gr,3,3,"option",21,Lr),o()(),u(39,Br,8,0,"div",22),o(),u(40,Wr,11,0,"div",23),u(41,Jr,10,0,"div",24),u(42,Yr,9,0,"div",25),o()()(),r(43,"div",26)(44,"div",27),g(45,"div",28),o(),r(46,"div",29)(47,"span",30),l(48," Informations de base "),o()()(),r(49,"div",31)(50,"div",32)(51,"div",33)(52,"label",34),l(53," Objet "),r(54,"span",35),l(55,"*"),o()(),g(56,"input",36),u(57,Kr,2,1,"div",37),o(),r(58,"div",38)(59,"label",39),l(60," D\xE9clencher un signalement dans la m\xE9t\xE9o : "),o(),r(61,"div",40)(62,"label",41),g(63,"input",42),r(64,"span",43),l(65,"OUI"),o()(),r(66,"label",41),g(67,"input",42),r(68,"span",43),l(69,"NON"),o()()()()(),r(70,"div")(71,"h4",44),l(72," \u{1F527} Caract\xE9ristiques de l'incident "),o(),r(73,"div",45)(74,"div")(75,"label",46),l(76," Gravit\xE9 "),r(77,"span",35),l(78,"*"),o()(),r(79,"select",47)(80,"option",48),l(81,"S\xE9lectionner une gravit\xE9"),o(),M(82,Zr,2,2,"option",21,nt),o()(),r(84,"div")(85,"label",49),l(86," Statut "),r(87,"span",35),l(88,"*"),o()(),r(89,"select",50)(90,"option",48),l(91,"S\xE9lectionner un statut"),o(),M(92,Xr,2,2,"option",21,nt),o()(),r(94,"div")(95,"label",51),l(96," N\xB0 Ticket "),o(),g(97,"input",52),u(98,eo,2,1,"div",37),o()()(),r(99,"div")(100,"h4",44),l(101," \u{1F4C5} Dates et suivi "),o(),r(102,"div")(103,"div")(104,"label",53),l(105," Date de d\xE9but "),o(),g(106,"input",54),o(),u(107,io,5,3,"div"),o()(),r(108,"div")(109,"h4",44),l(110," \u{1F517} Liens vers les outils de suivi "),o(),r(111,"div",55)(112,"div")(113,"label",56),l(114," Lien Ticket HELPY "),r(115,"span",57),l(116,"(optionnel)"),o()(),g(117,"input",58),u(118,oo,3,2,"div",37),u(119,ao,8,1,"div",59),o(),r(120,"div")(121,"label",60),l(122," Lien Ticket TANDEM "),r(123,"span",57),l(124,"(optionnel)"),o()(),g(125,"input",61),u(126,co,3,2,"div",37),u(127,mo,8,1,"div",59),o()()()()(),r(128,"div",3)(129,"div",9)(130,"div",10)(131,"h3",5),l(132," \u{1F3AF} Domaine(s) "),r(133,"span",35),l(134,"*"),o()(),r(135,"div",62)(136,"button",63),f("click",function(){h(e);let a=c();return b(a.selectAllDomains())}),l(137," Tous les domaines "),o(),r(138,"button",64),f("click",function(){h(e);let a=c();return b(a.clearAllDomains())}),l(139," Aucun "),o()()()(),r(140,"div",15)(141,"div",65),M(142,uo,4,8,"div",66,nt),o(),u(144,po,2,1,"div",67),o()(),r(145,"div",3)(146,"div",9)(147,"div",10)(148,"h3",5),l(149," \u{1F465} Public(s) impact\xE9(s) "),o(),r(150,"div",62)(151,"button",63),f("click",function(){h(e);let a=c();return b(a.selectAllPublics())}),l(152," Tous publics "),o(),r(153,"button",64),f("click",function(){h(e);let a=c();return b(a.clearAllPublics())}),l(154," Aucun "),o()()()(),r(155,"div",15)(156,"div",65),M(157,go,4,8,"div",66,nt),o()()(),r(159,"div",3)(160,"div",9)(161,"div",10)(162,"h3",5),l(163," \u{1F3E2} Site(s) impact\xE9(s) "),o(),r(164,"div",68)(165,"div",11)(166,"label",69),g(167,"input",70),r(168,"span",71),l(169,"\u{1F4CD} Impact National"),o()(),r(170,"p",72),l(171," Cocher si l'incident a un impact au niveau national "),o()(),g(172,"div",73),r(173,"div",74)(174,"button",63),f("click",function(){h(e);let a=c();return b(a.selectAllSites())}),l(175," Toute la r\xE9gion "),o(),r(176,"button",64),f("click",function(){h(e);let a=c();return b(a.clearAllSites())}),l(177," Aucun "),o()()()()(),r(178,"div",15)(179,"div",75),M(180,fo,4,8,"div",66,nt),o()()(),r(182,"div",3)(183,"div",9)(184,"h3",5),l(185," \u{1F4DD} Description et Actions "),o()(),r(186,"div",31)(187,"div",76)(188,"label",77),l(189," Description de l'incident "),r(190,"span",35),l(191,"*"),o(),r(192,"span",78),l(193),o()(),g(194,"quill-editor",79),u(195,ho,2,1,"div",37),o(),r(196,"div",80)(197,"div",81)(198,"h3",82),l(199," Actions \xE0 Mener "),u(200,bo,2,0,"span",83),o(),r(201,"div",84),M(202,vo,8,1,"div",85,re),o(),r(204,"input",86,0),f("keydown.enter",function(a){h(e);let d=Je(205),m=c();return b(m.addAction(d,a))}),o(),u(206,xo,5,0,"div",87)(207,_o,5,0,"div",88),u(208,Co,2,0,"div",67),o(),r(209,"div",89)(210,"h3",90),l(211,"Actions Men\xE9es"),o(),u(212,So,3,0,"ul",91)(213,Eo,2,0,"p",92),o()()()(),r(214,"div",3)(215,"div",9)(216,"h3",5),l(217," \u23F1\uFE0F Temps d'indisponibilit\xE9 du service "),o()(),r(218,"div",93)(219,"p",94),l(220," Si le service a \xE9t\xE9 indisponible, pr\xE9cisez la dur\xE9e. Cela permet de g\xE9n\xE9rer des statistiques fiables. "),o(),r(221,"div",16)(222,"div",95)(223,"div")(224,"label",96),l(225," Jours "),o(),r(226,"input",97),f("keydown",function(a){h(e);let d=c();return b(d.onKeyDown(a))}),o()(),r(227,"div")(228,"label",98),l(229," Heures "),o(),r(230,"input",99),f("input",function(a){h(e);let d=c();return b(d.onTimeInput(a,"indisponibiliteHeures",23))})("keydown",function(a){h(e);let d=c();return b(d.onKeyDown(a))}),o()(),r(231,"div")(232,"label",100),l(233," Minutes "),o(),r(234,"input",101),f("input",function(a){h(e);let d=c();return b(d.onTimeInput(a,"indisponibiliteMinutes",59))})("keydown",function(a){h(e);let d=c();return b(d.onKeyDown(a))}),o()()(),r(235,"div")(236,"label",102),l(237," Contexte (optionnel) "),o(),g(238,"textarea",103),o()()()(),r(239,"div",3)(240,"div",9)(241,"h3",5),l(242," \u{1F4E7} Personnes suppl\xE9mentaires \xE0 notifier "),r(243,"span",13),l(244,"(Utilisez des adresses @urssaf.fr uniquement)"),o()()(),r(245,"div",93)(246,"p",104),l(247," Ajoutez ici les adresses email des personnes qui doivent \xEAtre tenues inform\xE9es de cet incident, en plus des listes de diffusion standards. "),o(),u(248,Io,3,0,"div",105),r(249,"div")(250,"label",106),l(251,"Ajouter un email"),o(),r(252,"input",107),f("keydown.enter",function(a){h(e);let d=c();return b(d.addEmail(a))}),o(),u(253,Do,3,1,"div",37),o()()(),r(254,"div",3)(255,"div",93)(256,"div",108)(257,"div",109)(258,"span",110),l(259,"Progression du formulaire"),o(),r(260,"span",111),l(261),o()(),r(262,"div",112),g(263,"div",113),o(),r(264,"div",114),u(265,Vo,6,2,"div",115)(266,Oo,4,0,"div",116),o()(),r(267,"div",10)(268,"div")(269,"button",117),u(270,qo,2,1,"span",118)(271,Ro,5,1,"span",118),o()(),r(272,"div")(273,"button",119),f("click",function(){h(e);let a=c();return b(a.onCancel())}),l(274," \u274C Annuler "),o()()()()()(),r(275,"app-incident-template-modal",120,1),f("modalClosed",function(){h(e);let a=c();return b(a.onTemplateModalClosed())}),o()}if(n&2){let e,i,a,d,m,v,k,I,x=c();C("formGroup",x.incidentForm),s(9),E(x.connectedUser),s(11),p(x.isEditMode?20:21),s(12),p(x.isEditMode?-1:32),s(),p(x.isEditMode?33:-1),s(),F("bg-gray-100",x.isEditMode)("cursor-not-allowed",x.isEditMode),s(),C("ngValue",null),s(2),T(x.availableTemplates),s(2),p(x.selectedTemplateId?39:-1),s(),p(x.selectedTemplateId&&x.templateDiffusionListEmails.length>0?40:-1),s(),p(x.selectedTemplateId&&x.templateDiffusionListEmails.length==0?41:-1),s(),p(x.isEditMode?-1:42),s(14),F("border-red-500",x.isFieldInvalid("object")),s(),p(x.isFieldInvalid("object")?57:-1),s(6),C("value",!0),s(4),C("value",!1),s(15),T(x.gravityOptions),s(10),T(x.statusOptions),s(5),F("border-red-500",x.isFieldInvalid("ticketNumber")),s(),p(x.isFieldInvalid("ticketNumber")?98:-1),s(4),Q(((e=x.incidentForm.get("status"))==null?null:e.value)==="cloture"?"grid grid-cols-1 md:grid-cols-2 gap-6":"grid grid-cols-1 gap-6"),s(5),p(((i=x.incidentForm.get("status"))==null?null:i.value)==="cloture"?107:-1),s(11),p((a=x.incidentForm.get("lienTicketHelpy"))!=null&&a.invalid&&((a=x.incidentForm.get("lienTicketHelpy"))!=null&&a.touched)?118:-1),s(),p((d=x.incidentForm.get("lienTicketHelpy"))!=null&&d.value&&((d=x.incidentForm.get("lienTicketHelpy"))!=null&&d.valid)?119:-1),s(7),p((m=x.incidentForm.get("lienTicketTandem"))!=null&&m.invalid&&((m=x.incidentForm.get("lienTicketTandem"))!=null&&m.touched)?126:-1),s(),p((v=x.incidentForm.get("lienTicketTandem"))!=null&&v.value&&((v=x.incidentForm.get("lienTicketTandem"))!=null&&v.valid)?127:-1),s(15),T(x.domainOptions),s(2),p(x.isFieldInvalid("domains")?144:-1),s(13),T(x.publicOptions),s(23),T(x.siteOptions),s(13),_("(",x.getWordCount("description")," mots)"),s(),F("border-red-500",x.isFieldInvalid("description")),C("modules",x.quillConfig)("styles",x.quillStylesDescription),s(),p(x.isFieldInvalid("description")?195:-1),s(5),p(((k=x.incidentForm.get("status"))==null?null:k.value)==="en_cours"?200:-1),s(2),T(x.actionsAMener.controls),s(2),F("border-red-500",x.isFieldInvalid("actionsAMener")),s(2),p(((I=x.incidentForm.get("status"))==null?null:I.value)==="en_cours"?206:((I=x.incidentForm.get("status"))==null?null:I.value)==="cloture"?207:-1),s(2),p(x.isFieldInvalid("actionsAMener")?208:-1),s(4),p(x.actionsMenees.controls.length>0?212:213),s(36),p(x.mailAlerte.controls.length>0?248:-1),s(4),F("border-red-500",x.newEmailControl.invalid&&x.newEmailControl.touched),C("formControl",x.newEmailControl),s(),p(x.newEmailControl.invalid&&x.newEmailControl.touched?253:-1),s(8),_("",x.formProgress,"%"),s(2),oe("width",x.formProgress,"%"),s(2),p(x.isFormValid?266:265),s(4),Q(x.canSubmit?"bg-blue-600 text-white hover:bg-blue-700":"bg-gray-300 text-gray-500 cursor-not-allowed"),F("animate-pulse",x.isSubmitting),C("disabled",!x.canSubmit),s(),p(x.isSubmitting?271:270),s(3),C("disabled",x.isSubmitting)}}var $e=class n{constructor(t,e,i,a,d){this.notificationService=t;this.quillConfigService=e;this.formService=i;this.authService=a;this.permissionService=d}destroy$=new K;initialIncident;initialized=new j;save=new j;cancel=new j;progressChanged=new j;templateModal;formState;availableTemplates=[];newEmailControl=new Wi("",[O.email,tt()]);connectedUser="";isLoading=!0;ngOnInit(){return B(this,null,function*(){let t=this.authService.getCurrentUser();this.connectedUser=t?.full_name||"Utilisateur inconnu",yield this.loadAvailableTemplates(),this.initializeForm()})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}ngOnChanges(t){t.initialIncident&&!t.initialIncident.firstChange&&this.formState&&this.initializeForm()}loadAvailableTemplates(){return B(this,null,function*(){try{this.availableTemplates=yield this.formService.loadAvailableTemplates()}catch(t){console.error("Erreur chargement templates:",t)}})}initializeForm(){this.formState=this.formService.createFormState(this.initialIncident),this.setupProgressTracking(),this.setupGravityListener(),this.isLoading=!1,this.initialized.emit()}setupProgressTracking(){this.formState.form.valueChanges.pipe(N(this.destroy$)).subscribe(()=>{this.progressChanged.emit(this.formState.validation.progress)})}setupGravityListener(){this.formState.form.get("gravity")?.valueChanges.pipe(N(this.destroy$)).subscribe(t=>{["grave","tres_grave"].includes(t)?this.formState.form.get("status")?.value!=="en_attente"&&this.formState.form.get("status")?.setValue("en_attente"):this.isEditMode||this.formState.form.get("status")?.setValue("en_cours")})}onTemplateSelected(t){return B(this,null,function*(){let e=t.target,i=e.value?Number(e.value):null;if(i)try{yield this.formService.applyTemplate(this.formState,i),this.notificationService.success("Mod\xE8le appliqu\xE9","Les donn\xE9es ont \xE9t\xE9 pr\xE9-remplies automatiquement")}catch(a){console.error("Erreur application template:",a),this.notificationService.error("Erreur lors de l'application du mod\xE8le")}else this.resetToDefault()})}resetToDefault(){this.formState.selectedTemplate=null,this.formState.templateEmails=[],this.formState.excludedTemplateEmails=[],this.formState.isEditMode||(this.formState=this.formService.createFormState())}openTemplateManagement(){this.templateModal.openModal()}onTemplateModalClosed(){return B(this,null,function*(){yield this.loadAvailableTemplates()})}removeTemplateEmail(t){this.formService.removeTemplateEmail(this.formState,t),this.notificationService.info("Destinataire du template retir\xE9 pour cet incident")}get incidentForm(){return this.formState?.form}get isEditMode(){return this.formState?.isEditMode||!1}get isSubmitting(){return this.formState?.isSubmitting||!1}get selectedTemplateId(){return this.formState?.selectedTemplate?.id||null}get templateDiffusionListEmails(){return this.formState?.templateEmails||[]}get formProgress(){return this.formState?.validation?.progress||0}get isFormValid(){return this.formState?.validation?.isValid||!1}get formErrors(){return this.formState?.validation?.errors||[]}get canSubmit(){return this.formState?.validation?.canSubmit&&!this.formState?.isSubmitting||!1}get hasUnsavedChanges(){return this.formState?.hasUnsavedChanges||!1}get domainOptions(){return this.formService.domainOptions}get gravityOptions(){return this.formService.gravityOptions}get statusOptions(){let t=this.formService.statusOptions;this.permissionService.canArchiveIncidents()||(t=t.filter(v=>v.value!=="archive"));let e=this.incidentForm.get("gravity")?.value,i=["grave","tres_grave"].includes(e),a=this.initialIncident?.status,d=this.initialIncident?.gravity,m=["grave","tres_grave"].includes(d);return i?this.isEditMode&&m&&a==="en_cours"?t.filter(v=>["en_cours","cloture"].includes(v.value)):t.filter(v=>v.value==="en_attente"):t.filter(v=>v.value!=="en_attente")}get publicOptions(){return this.formService.publicOptions}get siteOptions(){return this.formService.siteOptions}get quillConfig(){return this.quillConfigService.fullConfig}get quillStylesDescription(){return this.quillConfigService.descriptionStyles}get actionsAMener(){return this.formState?.form.get("actionsAMener")}get actionsMenees(){return this.formState?.form.get("actionsMenees")}get mailAlerte(){return this.formState?.form.get("mailAlerte")}addEmail(t){if(t.preventDefault(),this.newEmailControl.markAsTouched(),this.newEmailControl.valid&&this.newEmailControl.value){let e=this.newEmailControl.value.trim();this.formState&&this.formService.addEmailToFormArray(this.formState,e)&&this.newEmailControl.reset("")}}removeEmail(t){this.formState&&this.formService.removeEmailFromFormArray(this.formState,t)}addAction(t,e){e.preventDefault();let i=t.value.trim();this.formState&&this.formService.addActionToFormArray(this.formState,i,"actionsAMener")&&(t.value="")}removeAction(t,e){this.formState&&this.formService.removeActionFromFormArray(this.formState,e,t)}transferAction(t){this.formState&&this.formService.transferAction(this.formState,t,"actionsAMener")}untransferAction(t){this.formState&&this.formService.transferAction(this.formState,t,"actionsMenees")}toggleDomainSelection(t){this.formState&&this.formService.toggleSelection(this.formState,"domains",t)}isDomainSelected(t){return this.formState?this.formService.isSelected(this.formState,"domains",t):!1}togglePublicSelection(t){this.formState&&this.formService.toggleSelection(this.formState,"publicsImpactes",t)}isPublicSelected(t){return this.formState?this.formService.isSelected(this.formState,"publicsImpactes",t):!1}toggleSiteSelection(t){this.formState&&this.formService.toggleSelection(this.formState,"sitesImpactes",t)}isSiteSelected(t){return this.formState?this.formService.isSelected(this.formState,"sitesImpactes",t):!1}selectAllDomains(){this.formState&&this.formService.selectAll(this.formState,"domains")}clearAllDomains(){this.formState&&this.formService.clearAll(this.formState,"domains")}selectAllPublics(){this.formState&&this.formService.selectAll(this.formState,"publicsImpactes")}clearAllPublics(){this.formState&&this.formService.clearAll(this.formState,"publicsImpactes")}selectAllSites(){this.formState&&this.formService.selectAll(this.formState,"sitesImpactes")}clearAllSites(){this.formState&&this.formService.clearAll(this.formState,"sitesImpactes")}isFieldInvalid(t){return this.formState?this.formService.isFieldInvalid(this.formState.form,t):!1}getFieldError(t){return this.formState?this.formService.getFieldError(this.formState.form,t):null}markAllFieldsAsTouched(){this.formState&&this.formService.markFormGroupTouched(this.formState.form)}restoreFormArraysFromData(t){!this.formState||!t||(t.actionsAMener&&Array.isArray(t.actionsAMener)&&(this.formState.form.get("actionsAMener").clear(),t.actionsAMener.forEach(i=>{this.formService.addActionToFormArray(this.formState,i,"actionsAMener")})),t.actionsMenees&&Array.isArray(t.actionsMenees)&&(this.formState.form.get("actionsMenees").clear(),t.actionsMenees.forEach(i=>{this.formService.addActionToFormArray(this.formState,i,"actionsMenees")})),t.mailAlerte&&Array.isArray(t.mailAlerte)&&(this.formState.form.get("mailAlerte").clear(),t.mailAlerte.forEach(i=>{this.formService.addEmailToFormArray(this.formState,i)})))}onSubmit(){if(!this.formState)return;if(this.markAllFieldsAsTouched(),!this.canSubmit){this.notificationService.error("Formulaire incomplet",`Veuillez remplir les champs obligatoires :
${this.formErrors.join(`
`)}`);return}this.formState.isSubmitting=!0;let t=this.formService.getFormData(this.formState);this.save.emit(t)}onCancel(){this.cancel.emit()}resetSubmittingState(){this.formState&&(this.formState.isSubmitting=!1)}getMissingFields(){return this.formState?this.formService.getMissingFields(this.formState.form):[]}getWordCount(t){let e=this.incidentForm?.get(t)?.value||"";return this.quillConfigService.getWordCount(e)}onTimeInput(t,e,i){if(!this.incidentForm)return;let a=t.target,d=a.value.trim();if(d===""){this.incidentForm.get(e)?.setValue(null,{emitEvent:!1});return}d.length>2&&(d=d.slice(0,2));let m=parseInt(d,10);if(isNaN(m)){a.value="",this.incidentForm.get(e)?.setValue(null,{emitEvent:!1});return}m>i&&(m=i,d=i.toString()),m<0&&(m=0,d="0"),a.value=d,this.incidentForm.get(e)?.setValue(m,{emitEvent:!1})}onKeyDown(t){["Backspace","Tab","End","Home","ArrowLeft","ArrowRight","Delete"].includes(t.key)||t.key>="0"&&t.key<="9"||t.preventDefault()}static \u0275fac=function(e){return new(e||n)(y(z),y(Vt),y(Dt),y(W),y(te))};static \u0275cmp=A({type:n,selectors:[["app-incident-form"]],viewQuery:function(e,i){if(e&1&&Pe(qr,5),e&2){let a;Ve(a=Oe())&&(i.templateModal=a.first)}},inputs:{initialIncident:"initialIncident"},outputs:{initialized:"initialized",save:"save",cancel:"cancel",progressChanged:"progressChanged"},features:[mt],decls:1,vars:1,consts:[["newActionInput",""],["templateModal",""],[1,"space-y-6",3,"ngSubmit","formGroup"],[1,"bg-white","shadow-sm","rounded-lg"],[1,"px-6","py-4","border-b","border-gray-200","flex","justify-between","items-center"],[1,"text-lg","font-semibold","text-gray-900"],[1,"flex","items-center","space-x-4"],[1,"text-sm","font-bold","text-gray-700"],[1,"text-sm","text-gray-900","font-medium"],[1,"px-6","py-4","border-b","border-gray-200"],[1,"flex","items-center","justify-between"],[1,"flex","items-center","space-x-3"],[1,"w-8","h-8","bg-gray-600","text-white","rounded-full","flex","items-center","justify-center","text-lg"],[1,"text-sm","text-gray-600"],["type","button","title","G\xE9rer les mod\xE8les",1,"px-4","py-2","bg-gray-600","text-white","text-sm","rounded-lg","hover:bg-gray-700","transition-colors","font-medium","flex","items-center","space-x-2",3,"click"],[1,"px-6","py-4"],[1,"space-y-4"],[1,"grid","grid-cols-1","lg:grid-cols-2","gap-6","items-end"],["for","template-select",1,"block","text-sm","font-medium","text-gray-700","mb-2"],["id","template-select","formControlName","template_id",1,"w-full","px-4","py-2","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-blue-500","focus:border-blue-500","bg-white","h-11",3,"change"],[3,"ngValue"],[3,"value"],[1,"bg-green-50","border","border-green-200","rounded-lg","px-4","py-2","h-11","flex","items-center"],[1,"bg-blue-50","border","border-blue-200","rounded-lg","p-3"],[1,"bg-orange-50","border-l-4","border-orange-400","py-2","px-3","rounded-r","text-xs"],[1,"p-3","bg-gray-50","border","border-gray-200","rounded-lg"],[1,"relative","py-4"],[1,"absolute","inset-0","flex","items-center","px-6"],[1,"w-full","border-t","border-gray-200"],[1,"relative","flex","justify-center"],[1,"bg-white","px-3","text-xs","text-gray-500","uppercase","tracking-wider"],[1,"px-6","py-6","space-y-6"],[1,"grid","grid-cols-1","lg:grid-cols-3","gap-6"],[1,"lg:col-span-2"],["for","object",1,"block","text-sm","font-medium","text-gray-700","mb-2"],[1,"text-red-500"],["type","text","id","object","formControlName","object","placeholder","D\xE9crivez bri\xE8vement l'incident...",1,"w-full","px-4","py-2","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-blue-500","focus:border-blue-500","h-11"],[1,"mt-1","text-sm","text-red-600"],[1,"lg:col-span-1","flex","flex-col"],[1,"block","text-sm","font-medium","text-gray-700","text-center","mb-2","mt-7"],[1,"flex","items-center","justify-center","space-x-6","mt-auto","mb-1"],[1,"flex","items-center","cursor-pointer"],["type","radio","name","meteo","formControlName","meteo",1,"h-4","w-4","text-blue-600","border-gray-300","focus:ring-blue-500",3,"value"],[1,"ml-2","text-sm","text-gray-700"],[1,"text-sm","font-semibold","text-gray-800","mb-4","border-b","border-gray-200","pb-2"],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-3","gap-6"],["for","gravity",1,"block","text-sm","font-medium","text-gray-700","mb-2"],["id","gravity","formControlName","gravity",1,"w-full","px-4","py-2","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-blue-500","focus:border-blue-500","h-11"],["value",""],["for","status",1,"block","text-sm","font-medium","text-gray-700","mb-2"],["id","status","formControlName","status",1,"w-full","px-4","py-2","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-blue-500","focus:border-blue-500","h-11"],["for","ticketNumber",1,"block","text-sm","font-medium","text-gray-700","mb-2"],["type","text","id","ticketNumber","formControlName","ticketNumber","placeholder","UR837-I0323383",1,"w-full","px-4","py-2","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-blue-500","focus:border-blue-500","h-11"],["for","dateOuverture",1,"block","text-sm","font-medium","text-gray-700","mb-2"],["type","datetime-local","id","dateOuverture","formControlName","dateOuverture",1,"w-full","px-4","py-2","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-blue-500","focus:border-blue-500","h-11"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-6"],["for","lienTicketHelpy",1,"block","text-sm","font-medium","text-gray-700","mb-2"],[1,"text-xs","text-gray-500"],["type","url","id","lienTicketHelpy","formControlName","lienTicketHelpy","placeholder","https://helpy.urssaf.recouv/ticket/12345",1,"w-full","px-4","py-2","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-blue-500","focus:border-blue-500","h-11"],[1,"mt-2","p-2","bg-blue-50","rounded-md"],["for","lienTicketTandem",1,"block","text-sm","font-medium","text-gray-700","mb-2"],["type","url","id","lienTicketTandem","formControlName","lienTicketTandem","placeholder","https://tandem.urssaf.recouv/ticket/12345",1,"w-full","px-4","py-2","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-blue-500","focus:border-blue-500","h-11"],[1,"space-x-2"],["type","button",1,"px-3","py-1","text-xs","bg-blue-100","text-blue-700","rounded-md","hover:bg-blue-200","transition-colors",3,"click"],["type","button",1,"px-3","py-1","text-xs","bg-gray-100","text-gray-700","rounded-md","hover:bg-gray-200","transition-colors",3,"click"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-4"],[1,"flex","items-center","p-3","border-2","rounded-lg","cursor-pointer","transition-all","hover:bg-gray-50",3,"border-blue-500","bg-blue-50","border-gray-200"],[1,"mt-2","text-sm","text-red-600"],[1,"flex","items-center","space-x-6"],[1,"flex","items-center","cursor-pointer","hover:bg-gray-50","p-2","rounded-lg","transition-colors"],["type","checkbox","formControlName","isNational",1,"h-4","w-4","text-blue-600","border-gray-300","rounded","focus:ring-blue-500"],[1,"ml-2","text-sm","text-gray-700","font-medium"],[1,"text-xs","text-gray-600","whitespace-nowrap"],[1,"border-l","border-gray-300","h-8"],[1,"flex","space-x-2"],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-3","gap-4","mb-4"],[1,"description-editor"],["for","description",1,"block","text-sm","font-medium","text-gray-700","mb-2"],[1,"ml-2","text-xs","text-gray-500"],["formControlName","description","placeholder","D\xE9crivez en d\xE9tail l'incident, les sympt\xF4mes observ\xE9s, l'impact...",3,"modules","styles"],[1,"grid","grid-cols-1","lg:grid-cols-2","gap-6"],[1,"bg-blue-50","border","border-blue-200","rounded-lg","p-6","dark:bg-gray-800","dark:border-gray-700"],[1,"text-lg","font-semibold","text-blue-800","mb-4","dark:text-gray-200"],[1,"text-red-500","text-sm"],["formArrayName","actionsAMener",1,"space-y-2"],[1,"flex","items-center","gap-2","bg-white","p-2","rounded-md","border"],["type","text","placeholder","Ajouter une nouvelle action et appuyer sur Entr\xE9e...",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","mt-4",3,"keydown.enter"],[1,"mt-2","p-2","bg-orange-50","border","border-orange-200","rounded","text-xs","text-orange-700"],[1,"mt-2","p-2","bg-green-50","border","border-green-200","rounded","text-xs","text-green-700"],[1,"bg-green-50","border","border-green-200","rounded-lg","p-6","dark:bg-gray-800","dark:border-gray-700"],[1,"text-lg","font-semibold","text-green-800","mb-4","dark:text-gray-200"],[1,"space-y-2"],[1,"text-base","text-gray-500","italic","text-center","py-8"],[1,"px-6","py-6"],[1,"text-xs","text-gray-500","mb-4"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-6"],["for","indisponibiliteJours",1,"block","text-sm","font-medium","text-gray-700","mb-2"],["type","number","id","indisponibiliteJours","formControlName","indisponibiliteJours","placeholder","Ex: 1 jour (nombre uniquement)","min","0",1,"w-full","px-4","py-2","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-blue-500","focus:border-blue-500",3,"keydown"],["for","indisponibiliteHeures",1,"block","text-sm","font-medium","text-gray-700","mb-2"],["type","number","id","indisponibiliteHeures","formControlName","indisponibiliteHeures","placeholder","Ex: 1 heure (nombre uniquement)","min","0","max","23",1,"w-full","px-4","py-2","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-blue-500","focus:border-blue-500",3,"input","keydown"],["for","indisponibiliteMinutes",1,"block","text-sm","font-medium","text-gray-700","mb-2"],["type","number","id","indisponibiliteMinutes","formControlName","indisponibiliteMinutes","placeholder","Ex: 5 minutes (nombre uniquement)","min","0","max","59",1,"w-full","px-4","py-2","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-blue-500","focus:border-blue-500",3,"input","keydown"],["for","indisponibiliteContexte",1,"block","text-sm","font-medium","text-gray-700","mb-2"],["id","indisponibiliteContexte","formControlName","indisponibiliteContexte","rows","2","placeholder","Ex: Coupure courant survenue Lundi de 14h30 \xE0 16h15",1,"w-full","px-4","py-2","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-blue-500","focus:border-blue-500","resize-none"],[1,"text-sm","text-gray-600","mb-4"],[1,"flex","flex-wrap","gap-4","mb-3"],["for","new-email-input",1,"sr-only"],["type","email","id","new-email-input","placeholder","email@urssaf.fr (appuyez sur Entr\xE9e pour ajouter)",1,"w-full","px-4","py-2","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-blue-500","focus:border-blue-500",3,"keydown.enter","formControl"],[1,"mb-6","p-4","bg-gray-50","rounded-lg"],[1,"flex","items-center","justify-between","mb-2"],[1,"text-sm","font-medium","text-gray-700"],[1,"text-sm","font-semibold","text-gray-900"],[1,"w-full","bg-gray-200","rounded-full","h-3"],[1,"bg-blue-600","h-3","rounded-full","transition-all","duration-300"],[1,"mt-3","text-xs"],[1,"text-orange-600","flex","items-center"],[1,"text-green-600","flex","items-center"],["type","submit",1,"px-6","py-3","font-medium","rounded-lg","focus:ring-2","focus:ring-blue-500","focus:ring-offset-2","disabled:opacity-50","disabled:cursor-not-allowed","transition-all",3,"disabled"],[1,"flex","items-center"],["type","button",1,"px-6","py-3","border","border-gray-300","text-gray-700","font-medium","rounded-lg","hover:bg-gray-50","focus:ring-2","focus:ring-gray-500","focus:ring-offset-2","disabled:opacity-50","transition-all",3,"click","disabled"],[3,"modalClosed"],[1,"flex","items-center","space-x-2"],[1,"text-green-600","font-bold","text-sm"],[1,"font-medium","text-green-800","text-sm"],[1,"text-green-700","text-xs"],[1,"flex","items-center","space-x-2","mb-2"],[1,"text-blue-600"],[1,"text-sm","font-medium","text-blue-800"],[1,"text-xs","text-blue-600"],[1,"flex","flex-wrap","gap-2"],[1,"flex","items-center","bg-blue-100","text-blue-800","text-xs","font-medium","px-3","py-1","rounded-full"],["type","button",1,"ml-2","text-blue-600","hover:text-blue-800",3,"click"],[1,"flex","items-center","space-x-1","mb-1"],[1,"text-orange-600"],[1,"font-medium","text-orange-800"],[1,"text-blue-700"],[1,"font-medium"],[1,"text-xs","text-gray-600","flex","items-start","space-x-2"],[1,"font-semibold"],[1,"ml-1"],["for","dateCloture",1,"block","text-sm","font-medium","text-gray-700","mb-2"],["type","datetime-local","id","dateCloture","formControlName","dateCloture",1,"w-full","px-4","py-2","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-blue-500","focus:border-blue-500","h-11"],[1,"flex","items-center","space-x-2","text-sm"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4","text-blue-600"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"],["target","_blank","rel","noopener noreferrer",1,"text-blue-600","hover:text-blue-800",3,"href"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"inline","w-3","h-3","ml-1"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"],[1,"flex","items-center","p-3","border-2","rounded-lg","cursor-pointer","transition-all","hover:bg-gray-50",3,"click"],["type","checkbox","readonly","",1,"h-5","w-5","text-blue-600","border-gray-300","rounded","focus:ring-blue-500",3,"checked"],[1,"ml-3","text-sm","font-medium","text-gray-700"],["type","button","title","Supprimer l'action",1,"p-1","text-gray-400","hover:text-red-600","hover:bg-red-100","rounded-full",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12"],["type","text","placeholder","D\xE9crivez l'action \xE0 r\xE9aliser...",1,"flex-grow","w-full","border-0","focus:ring-0","bg-transparent",3,"formControlName"],["type","button","title","Marquer comme men\xE9e",1,"p-2","text-red-600","hover:bg-red-100","rounded-full",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 5l7 7-7 7"],[1,"flex","items-center","gap-2","text-sm","text-gray-700","bg-white","p-2","rounded-md","border"],["type","button","title","Marquer comme non men\xE9e",1,"p-2","text-orange-600","hover:bg-orange-100","rounded-full",3,"click"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M15 19l-7-7 7-7"],[1,"text-green-600"],[1,"flex-grow"],["type","button","title","Supprimer l'action men\xE9e",1,"p-1","text-gray-400","hover:text-red-600","hover:bg-red-100","rounded-full",3,"click"],[1,"flex","flex-col"],[1,"flex","items-center","text-sm","font-medium","px-3","py-1","rounded-full",3,"ngClass"],["type","button",1,"ml-2",3,"click","ngClass"],[1,"mt-1","text-xs","text-red-600"],["fill","currentColor","viewBox","0 0 20 20",1,"w-4","h-4","mr-1"],["fill-rule","evenodd","d","M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z","clip-rule","evenodd"],[1,"font-medium","ml-1"],["fill-rule","evenodd","d","M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z","clip-rule","evenodd"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24",1,"animate-spin","-ml-1","mr-3","h-5","w-5","text-white"],["cx","12","cy","12","r","10","stroke","currentColor","stroke-width","4",1,"opacity-25"],["fill","currentColor","d","M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z",1,"opacity-75"]],template:function(e,i){e&1&&u(0,jo,277,58),e&2&&p(i.isLoading?-1:0)},dependencies:[q,qe,ze,bt,_e,Ce,le,Ji,Bi,Ne,Yi,se,ft,en,Xi,Ki,vt,_t,xt,At,on,Pt],styles:['@charset "UTF-8";.suggestions-zone[_ngcontent-%COMP%]{border-radius:6px;padding:8px 12px;margin-bottom:8px;border:1px solid}.suggestions-zone.actions-menees[_ngcontent-%COMP%]{background-color:#dcfce7;border-color:#bbf7d0}.suggestions-zone.actions-menees[_ngcontent-%COMP%]   .suggestions-title[_ngcontent-%COMP%], .suggestions-zone.actions-menees[_ngcontent-%COMP%]   .suggestion-item[_ngcontent-%COMP%]{color:#166534}.suggestions-zone.actions-menees[_ngcontent-%COMP%]   .suggestion-item[_ngcontent-%COMP%]:hover{background-color:#1665341a}.suggestions-zone.actions-a-mener[_ngcontent-%COMP%]{background-color:#dbeafe;border-color:#bfdbfe}.suggestions-zone.actions-a-mener[_ngcontent-%COMP%]   .suggestions-title[_ngcontent-%COMP%], .suggestions-zone.actions-a-mener[_ngcontent-%COMP%]   .suggestion-item[_ngcontent-%COMP%]{color:#1e40af}.suggestions-zone.actions-a-mener[_ngcontent-%COMP%]   .suggestion-item[_ngcontent-%COMP%]:hover{background-color:#1e40af1a}.suggestions-zone[_ngcontent-%COMP%]   .suggestions-title[_ngcontent-%COMP%]{font-weight:500;font-size:.9rem;margin-bottom:6px;display:block}.suggestions-zone[_ngcontent-%COMP%]   .suggestions-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:2px}.suggestions-zone[_ngcontent-%COMP%]   .suggestion-item[_ngcontent-%COMP%]{font-size:.8rem;cursor:pointer;border-radius:3px;transition:all .2s ease-in-out;display:block}.suggestions-zone[_ngcontent-%COMP%]   .suggestion-item[_ngcontent-%COMP%]:active{background-color:#0000001a}  quill-editor,   .ql-container,   .ql-toolbar,   .ql-editor{display:block!important;width:100%!important;min-width:100%!important;box-sizing:border-box!important}  .ql-editor li[data-list=checked]{text-decoration:line-through!important;color:#6b7280!important;opacity:.7!important;transition:all .2s ease-in-out!important}  .ql-editor input[type=checkbox]{width:16px!important;height:16px!important;margin-right:8px!important;cursor:pointer!important;appearance:none!important;border:2px solid #d1d5db!important;border-radius:3px!important;background:#fff!important;position:relative!important}  .ql-editor input[type=checkbox]:checked{background:#3b82f6!important;border-color:#3b82f6!important}  .ql-editor input[type=checkbox]:checked:after{content:"\\2713"!important;color:#fff!important;font-size:12px!important;font-weight:700!important;position:absolute!important;top:-2px!important;left:2px!important}  .ql-editor div[style*="display: flex"]{-webkit-user-select:none!important;user-select:none!important}  .ql-editor div[style*="display: flex"]:hover{background-color:#f9fafb!important;border-radius:4px!important;padding:2px 4px!important}.description-editor[_ngcontent-%COMP%]     .ql-editor{min-height:180px!important}.compact-editor[_ngcontent-%COMP%]     .ql-editor{min-height:150px!important}.basic-editor[_ngcontent-%COMP%]     .ql-editor{min-height:120px!important}.email-editor[_ngcontent-%COMP%]     .ql-editor{min-height:160px!important}.selection-item[_ngcontent-%COMP%]{transition:all .2s ease-in-out}.selection-item[_ngcontent-%COMP%]:hover{transform:translateY(-1px)}.selection-item[_ngcontent-%COMP%]:focus-visible{outline:2px solid #2563eb;outline-offset:2px}.submit-button[_ngcontent-%COMP%]{transition:all .2s ease-in-out}.submit-button[_ngcontent-%COMP%]:hover:not(:disabled){transform:translateY(-1px);box-shadow:0 4px 12px #2563eb4d}.submit-button[_ngcontent-%COMP%]:active{transform:translateY(0)}button[title="Vider le contenu"][_ngcontent-%COMP%]{transition:all .2s ease-in-out!important}button[title="Vider le contenu"][_ngcontent-%COMP%]:hover{transform:scale(1.05)!important;box-shadow:0 2px 4px #ef444433!important}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.spinner[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_spin 1s linear infinite}.progress-bar[_ngcontent-%COMP%]{transition:width .3s ease-in-out}.grid.grid-cols-1.lg\\:grid-cols-2>div[_ngcontent-%COMP%]{width:100%!important;min-width:0!important}@media (max-width: 1024px){.description-editor[_ngcontent-%COMP%]     .ql-editor{min-height:140px!important}.compact-editor[_ngcontent-%COMP%]     .ql-editor{min-height:120px!important}.basic-editor[_ngcontent-%COMP%]     .ql-editor{min-height:100px!important}.grid.grid-cols-1.lg\\:grid-cols-2[_ngcontent-%COMP%]{grid-template-columns:1fr!important}}@media (max-width: 768px){.responsive-actions[_ngcontent-%COMP%]{flex-direction:column;gap:.5rem}.responsive-actions[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{width:100%}.suggestions-zone[_ngcontent-%COMP%]   .suggestion-item[_ngcontent-%COMP%]{font-size:.65rem}.suggestions-zone[_ngcontent-%COMP%]   .suggestions-title[_ngcontent-%COMP%]{font-size:.7rem}}div[formArrayName=actionsAMener][_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{background-color:transparent!important}']})};var Lo=["incidentFormRef"];function No(n,t){if(n&1&&(r(0,"div",13)(1,"div",15),l(2),o(),r(3,"div",16),g(4,"div",17),o()()),n&2){c();let e=Je(17);s(2),_(" Progression : ",e.formProgress,"% "),s(2),oe("width",e.formProgress,"%")}}var Ot=class n{constructor(t,e,i){this.router=t;this.incidentDataService=e;this.notificationService=i}destroy$=new K;incidentFormRef;onIncidentFormInitialized(){this.checkForIncompleteIncident()}checkForIncompleteIncident(){let t=localStorage.getItem("incompleteIncident");if(t)if(confirm("Une saisie non sauvegard\xE9e a \xE9t\xE9 trouv\xE9e. Voulez-vous la restaurer ?")){let e=JSON.parse(t);this.incidentFormRef.incidentForm.patchValue(e),this.incidentFormRef.restoreFormArraysFromData(e)}else localStorage.removeItem("incompleteIncident")}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}get hasUnsavedChanges(){return this.incidentFormRef?.hasUnsavedChanges??!1}onSave(t){this.createIncident(t)}onCancel(){this.quickReturn()}createIncident(t){this.incidentDataService.createIncident(t).pipe(N(this.destroy$)).subscribe({next:e=>this.handleCreateSuccess(e),error:e=>this.handleCreateError(e)})}handleCreateSuccess(t){if(!t){console.error("Incident object is null or undefined in handleCreateSuccess."),this.notificationService.error("Erreur de cr\xE9ation","L'incident n'a pas pu \xEAtre cr\xE9\xE9 car les donn\xE9es retourn\xE9es sont invalides.");return}this.incidentFormRef?.resetSubmittingState(),localStorage.removeItem("incompleteIncident"),this.notificationService.success("Incident cr\xE9\xE9 avec succ\xE8s",`L'incident #${t.id} "${t.object}" a \xE9t\xE9 cr\xE9\xE9`),this.router.navigate(["/incidents"])}handleCreateError(t){this.incidentFormRef?.resetSubmittingState(),this.notificationService.error("Erreur de cr\xE9ation",`Impossible de cr\xE9er l'incident. Veuillez r\xE9essayer. D\xE9tails: ${t.message||t}`)}quickReturn(){return B(this,null,function*(){this.hasUnsavedChanges&&!confirm("Quitter sans sauvegarder ?")||(yield this.router.navigate(["/incidents"]))})}static \u0275fac=function(e){return new(e||n)(y(U),y(xe),y(z))};static \u0275cmp=A({type:n,selectors:[["app-incident-create"]],viewQuery:function(e,i){if(e&1&&Pe(Lo,5),e&2){let a;Ve(a=Oe())&&(i.incidentFormRef=a.first)}},decls:18,vars:2,consts:[["incidentFormRef",""],[1,"min-h-screen","bg-gray-50","py-8"],[1,"max-w-6xl","mx-auto","px-4","sm:px-6","lg:px-8"],[1,"bg-white","shadow-sm","rounded-lg","mb-6"],[1,"px-6","py-4","border-b","border-gray-200"],[1,"flex","items-center","justify-between"],[1,"flex","items-center","space-x-4"],["type","button",1,"inline-flex","items-center","px-4","py-2","border","border-gray-300","text-sm","font-medium","rounded-lg","text-gray-700","bg-white","hover:bg-gray-50","focus:ring-2","focus:ring-blue-500","focus:ring-offset-2","transition-all",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4","mr-2"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M10 19l-7-7m0 0l7-7m-7 7h18"],[1,"border-l","border-gray-300","pl-4"],[1,"text-2xl","font-bold","text-gray-900"],[1,"mt-1","text-sm","text-gray-600"],[1,"text-right"],[3,"save","cancel","initialized","initialIncident"],[1,"text-sm","text-gray-600","mb-1"],[1,"w-32","bg-gray-200","rounded-full","h-2"],[1,"bg-blue-600","h-2","rounded-full","transition-all","duration-300"]],template:function(e,i){if(e&1){let a=S();r(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4)(4,"div",5)(5,"div",6)(6,"button",7),f("click",function(){return h(a),b(i.quickReturn())}),w(),r(7,"svg",8),g(8,"path",9),o(),l(9," Retour \xE0 la liste "),o(),D(),r(10,"div",10)(11,"h1",11),l(12," \u{1F4DD} RAPPORT D'INCIDENT "),o(),r(13,"p",12),l(14," Cr\xE9er un nouveau rapport d'incident de s\xE9curit\xE9 "),o()()(),u(15,No,5,3,"div",13),o()()(),r(16,"app-incident-form",14,0),f("save",function(m){return h(a),b(i.onSave(m))})("cancel",function(){return h(a),b(i.onCancel())})("initialized",function(){return h(a),b(i.onIncidentFormInitialized())}),o()()()}if(e&2){let a=Je(17);s(15),p(a?15:-1),s(),C("initialIncident",void 0)}},dependencies:[q,$e],encapsulation:2})};var zo=["incidentFormRef"];function Ho(n,t){if(n&1&&(r(0,"div",13)(1,"div",16),l(2),o(),r(3,"div",17),g(4,"div",18),o()()),n&2){let e=c();s(2),_(" Progression : ",e.currentFormProgress,"% "),s(2),oe("width",e.currentFormProgress,"%")}}function $o(n,t){n&1&&(r(0,"div",14)(1,"div",19),g(2,"div",20),r(3,"p",21),l(4,"Chargement de l'incident..."),o()()())}function Uo(n,t){if(n&1){let e=S();r(0,"div",14)(1,"div",19)(2,"div",22),l(3,"\u26A0\uFE0F"),o(),r(4,"h2",23),l(5,"Incident non trouv\xE9"),o(),r(6,"p",24),l(7,"L'incident que vous essayez de modifier n'existe pas."),o(),r(8,"button",25),f("click",function(){h(e);let a=c();return b(a.quickReturn())}),l(9," Retour \xE0 la liste "),o()()()}}function Go(n,t){if(n&1){let e=S();r(0,"app-incident-form",26,0),f("save",function(a){h(e);let d=c();return b(d.onSave(a))})("cancel",function(){h(e);let a=c();return b(a.onCancel())})("progressChanged",function(a){h(e);let d=c();return b(d.onProgressChanged(a))}),o()}if(n&2){let e=c();C("initialIncident",e.incident)}}var qt=class n{constructor(t,e,i,a){this.route=t;this.router=e;this.incidentDataService=i;this.notificationService=a}destroy$=new K;incident;isLoading=!0;incidentFormRef;ngOnInit(){this.loadIncident()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}currentFormProgress=0;onProgressChanged(t){this.currentFormProgress=t}loadIncident(){this.route.paramMap.pipe(N(this.destroy$),dt(t=>{let e=Number(t.get("id"));return isNaN(e)?(this.handleIncidentNotFound(),[]):(this.isLoading=!0,this.incidentDataService.getIncidentById(e))})).subscribe({next:t=>{t?(this.incident=t,this.isLoading=!1):this.handleIncidentNotFound()},error:t=>{console.error("\u274C incident-update - Erreur chargement:",t),this.handleIncidentNotFound(),this.notificationService.error("Erreur de chargement",`Impossible de charger l'incident. D\xE9tails: ${t.message||t}`)}})}handleIncidentNotFound(){this.isLoading=!1,this.incident=void 0,this.notificationService.error("Incident non trouv\xE9","L'incident que vous essayez de modifier n'existe pas.")}get hasUnsavedChanges(){return this.incidentFormRef?.hasUnsavedChanges??!1}onSave(t){if(!this.incident){this.notificationService.error("Erreur","Aucun incident \xE0 modifier.");return}this.incidentDataService.updateIncident(this.incident.id,t).pipe(N(this.destroy$)).subscribe({next:e=>this.handleUpdateSuccess(e),error:e=>this.handleUpdateError(e)})}onCancel(){this.quickReturn()}handleUpdateSuccess(t){this.incidentFormRef?.resetSubmittingState(),this.notificationService.success("Incident mis \xE0 jour",`L'incident #${t.id} a \xE9t\xE9 modifi\xE9 avec succ\xE8s.`),this.router.navigate(["/incidents"])}handleUpdateError(t){this.incidentFormRef?.resetSubmittingState(),this.notificationService.error("Erreur de mise \xE0 jour",`Impossible de modifier l'incident. Veuillez r\xE9essayer. D\xE9tails: ${t.message||t}`)}quickReturn(){return B(this,null,function*(){this.hasUnsavedChanges&&!confirm("Quitter sans sauvegarder les modifications ?")||(yield this.router.navigate(["/incidents"]))})}static \u0275fac=function(e){return new(e||n)(y(je),y(U),y(xe),y(z))};static \u0275cmp=A({type:n,selectors:[["app-incident-update"]],viewQuery:function(e,i){if(e&1&&Pe(zo,5),e&2){let a;Ve(a=Oe())&&(i.incidentFormRef=a.first)}},decls:19,vars:5,consts:[["incidentFormRef",""],[1,"min-h-screen","bg-gray-50","py-8"],[1,"max-w-6xl","mx-auto","px-4","sm:px-6","lg:px-8"],[1,"bg-white","shadow-sm","rounded-lg","mb-6"],[1,"px-6","py-4","border-b","border-gray-200"],[1,"flex","items-center","justify-between"],[1,"flex","items-center","space-x-4"],["type","button",1,"inline-flex","items-center","px-4","py-2","border","border-gray-300","text-sm","font-medium","rounded-lg","text-gray-700","bg-white","hover:bg-gray-50","focus:ring-2","focus:ring-blue-500","focus:ring-offset-2","transition-all",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4","mr-2"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M10 19l-7-7m0 0l7-7m-7 7h18"],[1,"border-l","border-gray-300","pl-4"],[1,"text-2xl","font-bold","text-gray-900"],[1,"mt-1","text-sm","text-gray-600"],[1,"text-right"],[1,"text-center","py-16"],[3,"initialIncident"],[1,"text-sm","text-gray-600","mb-1"],[1,"w-32","bg-gray-200","rounded-full","h-2"],[1,"bg-blue-600","h-2","rounded-full","transition-all","duration-300"],[1,"flex","flex-col","items-center","space-y-4"],[1,"animate-spin","rounded-full","h-12","w-12","border-b-2","border-blue-600"],[1,"text-lg","text-gray-600"],[1,"text-red-500","text-6xl"],[1,"text-xl","font-semibold","text-gray-900"],[1,"text-gray-600"],[1,"px-4","py-2","bg-blue-600","text-white","rounded-lg","hover:bg-blue-700","transition-colors",3,"click"],[3,"save","cancel","progressChanged","initialIncident"]],template:function(e,i){e&1&&(r(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4)(4,"div",5)(5,"div",6)(6,"button",7),f("click",function(){return i.quickReturn()}),w(),r(7,"svg",8),g(8,"path",9),o(),l(9," Retour \xE0 la liste "),o(),D(),r(10,"div",10)(11,"h1",11),l(12),o(),r(13,"p",12),l(14," Mettre \xE0 jour les informations du rapport d'incident de s\xE9curit\xE9 "),o()()(),u(15,Ho,5,3,"div",13),o()()(),u(16,$o,5,0,"div",14),u(17,Uo,10,0,"div",14),u(18,Go,2,1,"app-incident-form",15),o()()),e&2&&(s(12),_(" \u{1F4DD} MODIFIER L'INCIDENT #",i.incident==null?null:i.incident.id," "),s(3),p(!i.isLoading&&i.incident?15:-1),s(),p(i.isLoading?16:-1),s(),p(!i.isLoading&&!i.incident?17:-1),s(),p(!i.isLoading&&i.incident?18:-1))},dependencies:[q,ze,At,$e],encapsulation:2})};var Bo=(n,t)=>t.name,Qo=(n,t)=>t.key;function Wo(n,t){if(n&1&&(r(0,"span",30),l(1,"\u{1F512}"),o()),n&2){let e=c().$implicit;C("title",e.lockReason)}}function Jo(n,t){if(n&1&&(r(0,"div",32),l(1),o()),n&2){let e=c().$implicit;s(),_(" \u26A0\uFE0F ",e.lockReason," ")}}function Yo(n,t){if(n&1){let e=S();r(0,"div",26)(1,"div",27)(2,"div",28)(3,"label",29),l(4),o(),u(5,Wo,2,1,"span",30),o(),r(6,"p",31),l(7),o(),u(8,Jo,2,1,"div",32),o(),r(9,"div",33)(10,"button",34),f("click",function(){let a=h(e).$implicit,d=c(2);return b(!a.isLocked&&d.togglePermission(a))}),g(11,"span",35),o()()()}if(n&2){let e=t.$implicit;F("border",e.isLocked)("border-gray-400",e.isLocked)("dark:border-gray-500",e.isLocked),s(4),_(" ",e.label," "),s(),p(e.isLocked?5:-1),s(2),_(" ",e.description," "),s(),p(e.isLocked?8:-1),s(),F("cursor-not-allowed",e.isLocked)("opacity-60",e.isLocked),s(),F("bg-blue-600",e.value&&!e.isLocked)("bg-gray-200",!e.value&&!e.isLocked)("dark:bg-gray-600",!e.value&&!e.isLocked)("bg-gray-400",e.isLocked),C("disabled",e.isLocked??!1),We("aria-checked",e.value),s(),F("translate-x-5",e.value)("translate-x-1",!e.value)}}function Ko(n,t){if(n&1&&(r(0,"div",8)(1,"div",21)(2,"h3",22)(3,"span"),l(4,"\u{1F4CC}"),o(),l(5),o(),r(6,"span",23),l(7),o()(),r(8,"div",24),M(9,Yo,12,28,"div",25,Qo),o()()),n&2){let e=t.$implicit,i=c();s(5),_(" ",e.name," "),s(2),ne(" ",i.getCategoryActiveCount(e)," / ",e.permissions.length," actifs "),s(2),T(e.permissions)}}function Zo(n,t){n&1&&(r(0,"span"),l(1,"Enregistrement..."),o())}function Xo(n,t){n&1&&(r(0,"span"),l(1,"Enregistrer les modifications"),o())}var Rt=class n{constructor(t){this.permissionService=t}role;close=new j;save=new j;saving=!1;permissionCategories=[];criticalPermissions={admin:["can_view_dashboard","can_modify","can_view_all"],responsable:["can_view_all"],technicien:["can_view_all"],animateur:["can_view_all"],consultant:["can_view_all"]};ngOnInit(){this.initializePermissions()}initializePermissions(){let t=this.permissionService.getAppUserSync(),i=(t?t.role_code:void 0)===this.role.code,a=this.criticalPermissions[this.role.code]||[];this.permissionCategories=[{name:"Gestion des incidents",permissions:[{key:"can_create",label:"Cr\xE9er un incident",description:"Permet de cr\xE9er un nouvel incident dans le syst\xE8me",value:this.role.permissions.can_create},{key:"can_modify",label:"Modifier un incident",description:"Permet de modifier les d\xE9tails d'un incident existant",value:this.role.permissions.can_modify,isLocked:i&&a.includes("can_modify"),lockReason:"Permission critique pour votre r\xF4le"},{key:"can_view_all",label:"Consulter tous les incidents",description:"Permet de consulter tous les incidents du syst\xE8me",value:this.role.permissions.can_view_all,isLocked:i&&a.includes("can_view_all"),lockReason:i&&a.includes("can_view_all")?"\u26A0\uFE0F ATTENTION : D\xE9sactiver cette permission vous emp\xEAchera de voir le tableau de bord !":void 0},{key:"can_validate",label:"Valider un incident",description:"Permet de valider et approuver un incident",value:this.role.permissions.can_validate}]},{name:"Archives et corbeille",permissions:[{key:"can_view_archives",label:"Consulter les archives",description:"Permet de consulter les incidents archiv\xE9s",value:this.role.permissions.can_view_archives},{key:"can_archive",label:"Archiver un incident",description:"Permet d'archiver un incident termin\xE9",value:this.role.permissions.can_archive},{key:"can_unarchive",label:"D\xE9sarchiver un incident",description:"Permet de d\xE9sarchiver un incident",value:this.role.permissions.can_unarchive},{key:"can_view_trash",label:"Consulter la corbeille",description:"Permet de consulter les incidents supprim\xE9s",value:this.role.permissions.can_view_trash},{key:"can_restore_from_trash",label:"Restaurer de la corbeille",description:"Permet de restaurer un incident supprim\xE9",value:this.role.permissions.can_restore_from_trash}]},{name:"Suppression",permissions:[{key:"can_soft_delete",label:"Supprimer (corbeille)",description:"Permet de supprimer un incident (envoi en corbeille)",value:this.role.permissions.can_soft_delete},{key:"can_force_delete",label:"Supprimer d\xE9finitivement",description:"Permet de supprimer d\xE9finitivement un incident (irreversible)",value:this.role.permissions.can_force_delete}]},{name:"Autres fonctionnalit\xE9s",permissions:[{key:"can_view_dashboard",label:"Acc\xE9der au tableau de bord",description:"Permet d'acc\xE9der au tableau de bord administrateur",value:this.role.permissions.can_view_dashboard,isLocked:i&&a.includes("can_view_dashboard"),lockReason:"Vous perdriez l'acc\xE8s \xE0 cette interface !"},{key:"can_manage_emails",label:"G\xE9rer les notifications emails",description:"Permet de g\xE9rer les listes de diffusion email",value:this.role.permissions.can_manage_emails},{key:"can_export",label:"Exporter les donn\xE9es",description:"Permet d'exporter les incidents en CSV/Excel",value:this.role.permissions.can_export},{key:"can_view_history",label:"Consulter le journal",description:"Permet de consulter le journal des modifications d'un incident",value:this.role.permissions.can_view_history}]}]}get activeCount(){return this.permissionCategories.flatMap(t=>t.permissions).filter(t=>t.value).length}get inactiveCount(){return this.permissionCategories.flatMap(t=>t.permissions).filter(t=>!t.value).length}getCategoryActiveCount(t){return t.permissions.filter(e=>e.value).length}onPermissionChange(){this.permissionCategories.forEach(t=>{t.permissions.forEach(e=>{this.role.permissions[e.key]=e.value})})}closeModal(){this.close.emit()}togglePermission(t){t.isLocked||(t.value=!t.value,this.onPermissionChange())}saveChanges(){let t=this.permissionService.getAppUserSync();if((t?t.role_code:void 0)===this.role.code){let d=(this.criticalPermissions[this.role.code]||[]).filter(m=>!this.role.permissions[m]);if(d.length>0){alert(`\u26A0\uFE0F ATTENTION : Vous ne pouvez pas d\xE9sactiver ces permissions critiques pour votre propre r\xF4le :

- ${d.join(`
- `)}

Vous risquez de perdre l'acc\xE8s au syst\xE8me.`);return}}this.saving=!0,this.save.emit(this.role)}static \u0275fac=function(e){return new(e||n)(y(te))};static \u0275cmp=A({type:n,selectors:[["app-role-modal"]],inputs:{role:"role"},outputs:{close:"close",save:"save"},decls:35,vars:7,consts:[[1,"fixed","inset-0","bg-black","bg-opacity-50","flex","items-center","justify-center","z-50"],[1,"bg-white","dark:bg-gray-800","rounded-lg","shadow-xl","w-full","max-w-4xl","max-h-[90vh]","overflow-hidden"],[1,"bg-gradient-to-r","from-blue-600","to-blue-700","text-white","px-6","py-4","flex","items-center","justify-between"],[1,"flex","items-center","gap-3"],[1,"text-2xl"],[1,"text-xl","font-semibold"],[1,"text-white","hover:text-gray-200","transition-colors",3,"click"],[1,"p-6","overflow-y-auto","max-h-[calc(90vh-180px)]"],[1,"mb-6"],[1,"block","text-sm","font-medium","text-gray-700","dark:text-gray-300","mb-2"],["type","text",1,"w-full","px-4","py-2","border","border-gray-300","dark:border-gray-600","dark:bg-gray-700","dark:text-white","rounded-lg","focus:ring-2","focus:ring-blue-500","focus:border-transparent",3,"ngModelChange","ngModel"],[1,"block","text-sm","font-medium","text-gray-700","dark:text-gray-300","mt-4","mb-2"],["rows","2",1,"w-full","px-4","py-2","border","border-gray-300","dark:border-gray-600","dark:bg-gray-700","dark:text-white","rounded-lg","focus:ring-2","focus:ring-blue-500","focus:border-transparent",3,"ngModelChange","ngModel"],[1,"flex","gap-4","mb-6"],[1,"flex-1","bg-green-50","dark:bg-green-900/20","border","border-green-200","dark:border-green-700","rounded-lg","p-4"],[1,"text-green-600","dark:text-green-400","font-semibold"],[1,"flex-1","bg-red-50","dark:bg-red-900/20","border","border-red-200","dark:border-red-700","rounded-lg","p-4"],[1,"text-red-600","dark:text-red-400","font-semibold"],[1,"bg-gray-50","dark:bg-gray-700","px-6","py-4","flex","items-center","justify-between","border-t","dark:border-gray-600"],[1,"px-6","py-2","border","border-gray-300","dark:border-gray-600","rounded-lg","hover:bg-gray-100","dark:hover:bg-gray-600","transition-colors","dark:text-white",3,"click"],[1,"px-6","py-2","bg-blue-600","text-white","rounded-lg","hover:bg-blue-700","transition-colors","disabled:bg-gray-400",3,"click","disabled"],[1,"flex","items-center","justify-between","mb-3","pb-2","border-b","dark:border-gray-700"],[1,"text-lg","font-semibold","text-gray-800","dark:text-gray-200","flex","items-center","gap-2"],[1,"text-sm","text-gray-500","dark:text-gray-400"],[1,"space-y-3"],[1,"flex","items-start","gap-4","p-3","rounded-lg","hover:bg-gray-100","dark:hover:bg-gray-700","transition-colors",3,"border","border-gray-400","dark:border-gray-500"],[1,"flex","items-start","gap-4","p-3","rounded-lg","hover:bg-gray-100","dark:hover:bg-gray-700","transition-colors"],[1,"flex-1"],[1,"flex","items-center","gap-2"],[1,"font-medium","text-gray-900","dark:text-gray-100"],[1,"text-lg",3,"title"],[1,"text-sm","text-gray-600","dark:text-gray-400","mt-1"],[1,"mt-2","text-xs","px-2","py-1","rounded","bg-gray-100","dark:bg-gray-700","text-gray-700","dark:text-gray-300"],[1,"flex","items-center"],["type","button","role","switch",1,"relative","inline-flex","h-6","w-11","items-center","rounded-full","transition-colors","focus:outline-none","focus:ring-2","focus:ring-blue-500","focus:ring-offset-2",3,"click","disabled"],[1,"inline-block","h-5","w-5","transform","rounded-full","bg-white","transition-transform"]],template:function(e,i){e&1&&(r(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"span",4),l(5,"\u{1F512}"),o(),r(6,"h2",5),l(7),o()(),r(8,"button",6),f("click",function(){return i.closeModal()}),r(9,"span",4),l(10,"\xD7"),o()()(),r(11,"div",7)(12,"div",8)(13,"label",9),l(14,"Nom du r\xF4le"),o(),r(15,"input",10),be("ngModelChange",function(d){return he(i.role.label,d)||(i.role.label=d),d}),o(),r(16,"label",11),l(17,"Description"),o(),r(18,"textarea",12),be("ngModelChange",function(d){return he(i.role.description,d)||(i.role.description=d),d}),l(19,"        "),o()(),r(20,"div",13)(21,"div",14)(22,"div",15),l(23),o()(),r(24,"div",16)(25,"div",17),l(26),o()()(),M(27,Ko,11,3,"div",8,Bo),o(),r(29,"div",18)(30,"button",19),f("click",function(){return i.closeModal()}),l(31," Annuler "),o(),r(32,"button",20),f("click",function(){return i.saveChanges()}),u(33,Zo,2,0,"span")(34,Xo,2,0,"span"),o()()()()),e&2&&(s(7),_("Gestion des droits : ",i.role.label),s(8),fe("ngModel",i.role.label),s(3),fe("ngModel",i.role.description),s(5),_("\u2713 ",i.activeCount," droits activ\xE9s"),s(3),_("\u2717 ",i.inactiveCount," droits d\xE9sactiv\xE9s"),s(),T(i.permissionCategories),s(5),C("disabled",i.saving),s(),p(i.saving?33:34))},dependencies:[q,ye,le,se,Le],styles:['.modal-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#00000080;display:flex;align-items:center;justify-content:center;z-index:1000;animation:_ngcontent-%COMP%_fadeIn .2s}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0}to{opacity:1}}.modal-content[_ngcontent-%COMP%]{background:#fff;border-radius:12px;width:90%;max-width:800px;max-height:90vh;display:flex;flex-direction:column;box-shadow:0 10px 40px #0003;animation:_ngcontent-%COMP%_slideUp .3s}@keyframes _ngcontent-%COMP%_slideUp{0%{transform:translateY(20px);opacity:0}to{transform:translateY(0);opacity:1}}.modal-header[_ngcontent-%COMP%]{padding:24px;border-bottom:1px solid #e5e7eb;display:flex;justify-content:space-between;align-items:center;background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;border-radius:12px 12px 0 0}.modal-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-size:24px;font-weight:600}.close-btn[_ngcontent-%COMP%]{background:none;border:none;font-size:32px;cursor:pointer;color:#fff;padding:0;width:40px;height:40px;display:flex;align-items:center;justify-content:center;border-radius:50%;transition:background .2s}.close-btn[_ngcontent-%COMP%]:hover{background:#fff3}.modal-body[_ngcontent-%COMP%]{padding:24px;overflow-y:auto;flex:1}.role-info[_ngcontent-%COMP%]{background:#f9fafb;padding:20px;border-radius:8px;margin-bottom:20px}.form-group[_ngcontent-%COMP%]{margin-bottom:16px}.form-group[_ngcontent-%COMP%]:last-child{margin-bottom:0}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;font-weight:600;margin-bottom:8px;color:#374151}.input-field[_ngcontent-%COMP%]{width:100%;padding:10px 12px;border:1px solid #d1d5db;border-radius:6px;font-size:14px;font-family:inherit}.input-field[_ngcontent-%COMP%]:focus{outline:none;border-color:#667eea;box-shadow:0 0 0 3px #667eea1a}.stats[_ngcontent-%COMP%]{display:flex;gap:12px;margin-bottom:24px}.stat-badge[_ngcontent-%COMP%]{padding:8px 16px;border-radius:20px;font-size:14px;font-weight:500}.stat-badge.success[_ngcontent-%COMP%]{background:#d1fae5;color:#065f46}.stat-badge.neutral[_ngcontent-%COMP%]{background:#fee2e2;color:#991b1b}.permission-category[_ngcontent-%COMP%]{margin-bottom:24px;background:#fff;border:1px solid #e5e7eb;border-radius:8px;overflow:hidden}.permission-category[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;padding:16px 20px;background:#f9fafb;font-size:16px;font-weight:600;color:#111827;border-bottom:1px solid #e5e7eb;display:flex;justify-content:space-between;align-items:center}.category-count[_ngcontent-%COMP%]{font-size:14px;color:#6b7280;font-weight:500}.permission-item[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:16px 20px;border-bottom:1px solid #f3f4f6;transition:background .2s}.permission-item[_ngcontent-%COMP%]:last-child{border-bottom:none}.permission-item[_ngcontent-%COMP%]:hover{background:#f9fafb}.permission-info[_ngcontent-%COMP%]{flex:1}.permission-info[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{display:block;color:#111827;margin-bottom:4px;font-size:15px}.permission-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;color:#6b7280;font-size:13px}.toggle-switch[_ngcontent-%COMP%]{position:relative;display:inline-block;width:52px;height:28px;cursor:pointer}.toggle-switch[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{opacity:0;width:0;height:0}.toggle-slider[_ngcontent-%COMP%]{position:absolute;inset:0;background-color:#d1d5db;border-radius:28px;transition:.3s}.toggle-slider[_ngcontent-%COMP%]:before{content:"";position:absolute;height:20px;width:20px;left:4px;bottom:4px;background-color:#fff;border-radius:50%;transition:.3s}input[_ngcontent-%COMP%]:checked + .toggle-slider[_ngcontent-%COMP%]{background-color:#667eea}input[_ngcontent-%COMP%]:checked + .toggle-slider[_ngcontent-%COMP%]:before{transform:translate(24px)}.modal-footer[_ngcontent-%COMP%]{padding:20px 24px;border-top:1px solid #e5e7eb;display:flex;justify-content:flex-end;gap:12px;background:#f9fafb;border-radius:0 0 12px 12px}.btn-cancel[_ngcontent-%COMP%], .btn-save[_ngcontent-%COMP%]{padding:10px 20px;border-radius:6px;font-size:14px;font-weight:500;cursor:pointer;transition:all .2s;border:none}.btn-cancel[_ngcontent-%COMP%]{background:#fff;color:#374151;border:1px solid #d1d5db}.btn-cancel[_ngcontent-%COMP%]:hover{background:#f9fafb}.btn-save[_ngcontent-%COMP%]{background:linear-gradient(135deg,#667eea,#764ba2);color:#fff}.btn-save[_ngcontent-%COMP%]:hover:not(:disabled){transform:translateY(-1px);box-shadow:0 4px 12px #667eea66}.btn-save[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}']})};var jt=class n{constructor(t){this.http=t}apiUrl=`${G.apiUrl}`;getMetiersWithRoles(){return this.http.get(`${this.apiUrl}/metiers-with-roles`)}associateRoles(t,e){return this.http.post(`${this.apiUrl}/metiers/associate-role`,{role_id:t,metier_nums:e})}removeAssociation(t){return this.http.delete(`${this.apiUrl}/metiers/${t}/role`)}static \u0275fac=function(e){return new(e||n)(J(ae))};static \u0275prov=$({token:n,factory:n.\u0275fac,providedIn:"root"})};var ta=(n,t)=>t.id,ia=(n,t)=>t.num_metier;function na(n,t){n&1&&(r(0,"div",8)(1,"div",12),g(2,"div",13),r(3,"p",14),l(4,"Chargement des m\xE9tiers..."),o()()())}function ra(n,t){if(n&1&&(r(0,"option",20),l(1),o()),n&2){let e=t.$implicit,i=c(2);C("value",e.id)("ngClass",i.getRoleBadgeClass(e.code)),s(),E(e.label)}}function oa(n,t){n&1&&(r(0,"div",27),l(1," Aucun m\xE9tier trouv\xE9 "),o())}function aa(n,t){if(n&1){let e=S();r(0,"input",36),f("change",function(){h(e);let a=c().$implicit,d=c(3);return b(d.toggleMetier(a.num_metier))}),o()}if(n&2){let e=c().$implicit,i=c(3);C("checked",i.selectedMetiers.has(e.num_metier))}}function la(n,t){n&1&&g(0,"div",30)}function sa(n,t){n&1&&(r(0,"span",33),l(1," Votre m\xE9tier - Non modifiable "),o())}function da(n,t){n&1&&(r(0,"span",34),l(1," Admin syst\xE8me "),o())}function ca(n,t){n&1&&(r(0,"span",38),l(1," (sera modifi\xE9) "),o())}function ma(n,t){if(n&1&&(r(0,"div",35),l(1," R\xF4le actuel : "),r(2,"span",37),l(3),o(),u(4,ca,2,0,"span",38),o()),n&2){let e=c().$implicit,i=c(3);s(2),Q("text-"+i.getRoleColor(e.role.code)+" dark:text-"+i.getRoleColor(e.role.code)+"-400"),s(),_(" ",e.role.label," "),s(),p(e.role.code!=="consultant"&&e.role.label!=="Administrateur"?4:-1)}}function ua(n,t){n&1&&(r(0,"div",35),l(1," R\xF4le actuel : "),r(2,"span",39),l(3,"Aucun"),o()())}function pa(n,t){if(n&1&&(r(0,"label",28),u(1,aa,1,1,"input",29)(2,la,1,0,"div",30),r(3,"div",31)(4,"div",32),l(5),u(6,sa,2,0,"span",33),u(7,da,2,0,"span",34),o(),u(8,ma,5,4,"div",35)(9,ua,4,0,"div",35),o()()),n&2){let e=t.$implicit,i=c(3);s(),p(e.num_metier!==i.currentUserMetierNum?1:2),s(4),_(" ",e.nom_metier," "),s(),p(e.num_metier===i.currentUserMetierNum?6:-1),s(),p(i.protectedMetiers.includes(e.num_metier)?7:-1),s(),p(e.role?8:9)}}function ga(n,t){if(n&1&&M(0,pa,10,5,"label",28,ia),n&2){let e=c(2);T(e.filteredMetiersList)}}function fa(n,t){if(n&1){let e=S();r(0,"div",15)(1,"label",16),l(2," R\xF4le \xE0 associer "),o(),r(3,"select",17),be("ngModelChange",function(a){h(e);let d=c();return he(d.selectedRole,a)||(d.selectedRole=a),b(a)}),r(4,"option",18),l(5,"S\xE9lectionnez un r\xF4le"),o(),r(6,"option",19),l(7,"-- Aucun droit --"),o(),M(8,ra,2,3,"option",20,ta),o()(),r(10,"div",21)(11,"input",22),be("ngModelChange",function(a){h(e);let d=c();return he(d.searchTerm,a)||(d.searchTerm=a),b(a)}),f("ngModelChange",function(){h(e);let a=c();return b(a.filterMetiers())}),o()(),r(12,"div",23)(13,"button",24),f("click",function(){h(e);let a=c();return b(a.selectAll())}),l(14," Tout s\xE9lectionner "),o(),r(15,"button",24),f("click",function(){h(e);let a=c();return b(a.deselectAll())}),l(16," Tout d\xE9s\xE9lectionner "),o(),r(17,"span",25),l(18),o()(),r(19,"div",26),u(20,oa,2,0,"div",27)(21,ga,2,0),o()}if(n&2){let e=c();s(3),fe("ngModel",e.selectedRole),s(5),T(e.roles),s(3),fe("ngModel",e.searchTerm),s(7),ne(" ",e.selectedMetiers.size," m\xE9tier(s) s\xE9lectionn\xE9(s) sur ",e.filteredMetiersList.length,". "),s(2),p(e.filteredMetiersList.length===0?20:21)}}function ha(n,t){n&1&&(g(0,"div",40),r(1,"span"),l(2,"Enregistrement..."),o())}function ba(n,t){n&1&&(r(0,"span"),l(1,"\u2713"),o(),r(2,"span"),l(3,"Associer le r\xF4le"),o())}var Lt=class n{constructor(t,e,i){this.metierRoleService=t;this.authService=e;this.notificationService=i}close=new j;saved=new j;roles=[];metiers=[];filteredMetiersList=[];selectedRole="";selectedMetiers=new Set;searchTerm="";loading=!1;saving=!1;currentUserMetierNum=null;protectedMetiers=[];ngOnInit(){this.loadData();let t=this.authService.getCurrentUser();t?.metier?.num_metier&&(this.currentUserMetierNum=t.metier.num_metier),this.protectedMetiers=[321]}loadData(){this.loading=!0,this.metierRoleService.getMetiersWithRoles().subscribe({next:t=>{let e=t.data.metiers;this.roles=t.data.roles;let i=e.find(d=>d.num_metier===this.currentUserMetierNum),a=e.filter(d=>d.num_metier!==this.currentUserMetierNum);a.sort((d,m)=>d.nom_metier.localeCompare(m.nom_metier)),this.metiers=i?[i,...a]:a,this.filteredMetiersList=[...this.metiers],this.loading=!1},error:t=>{console.error("Erreur lors du chargement",t),this.loading=!1}})}filterMetiers(){let t=this.searchTerm.toLowerCase();this.filteredMetiersList=this.metiers.filter(e=>e.nom_metier.toLowerCase().includes(t)||e.code_region.toLowerCase().includes(t))}toggleMetier(t){if(t===this.currentUserMetierNum){alert("\u26A0\uFE0F Vous ne pouvez pas modifier votre propre r\xF4le !");return}if(this.protectedMetiers.includes(t)){let e=this.metiers.find(i=>i.num_metier===t);if(!confirm(`\u26A0\uFE0F ATTENTION : Vous allez modifier le r\xF4le d'un administrateur syst\xE8me :

${e?.nom_metier}

\xCAtes-vous s\xFBr ?`))return}this.selectedMetiers.has(t)?this.selectedMetiers.delete(t):this.selectedMetiers.add(t)}selectAll(){this.filteredMetiersList.forEach(t=>{t.num_metier!==this.currentUserMetierNum&&this.selectedMetiers.add(t.num_metier)})}deselectAll(){this.selectedMetiers.clear()}getRoleColor(t){return{admin:"red-600",responsable:"orange-600",technicien:"blue-600",consultant:"gray-600",animateur:"green-600"}[t]||"gray-600"}getRoleBadgeClass(t){return{admin:"bg-red-100 text-red-800",responsable:"bg-orange-100 text-orange-800",technicien:"bg-blue-100 text-blue-800",animateur:"bg-green-100 text-green-800",consultant:"bg-gray-100 text-gray-700"}[t]||"bg-gray-100 text-gray-700"}save(){if(!this.selectedRole||this.selectedMetiers.size===0){this.notificationService.warning("S\xE9lection incompl\xE8te","Veuillez s\xE9lectionner un r\xF4le et au moins un m\xE9tier.");return}this.saving=!0;let t=Array.from(this.selectedMetiers),e=this.selectedRole==="null"?null:+this.selectedRole;this.metierRoleService.associateRoles(e,t).subscribe({next:()=>{this.notificationService.success("Association r\xE9ussie","Le r\xF4le a \xE9t\xE9 associ\xE9 au(x) m\xE9tier(s) s\xE9lectionn\xE9(s)."),this.saved.emit(),this.closeModal()},error:i=>{console.error("Erreur lors de l'association",i),this.notificationService.error("Erreur d'association",`Impossible d'associer le r\xF4le. D\xE9tails: ${i.message||i}`)},complete:()=>{this.saving=!1}})}closeModal(){this.close.emit()}static \u0275fac=function(e){return new(e||n)(y(jt),y(W),y(z))};static \u0275cmp=A({type:n,selectors:[["app-metier-role-modal"]],outputs:{close:"close",saved:"saved"},decls:19,vars:3,consts:[[1,"fixed","inset-0","bg-black","bg-opacity-50","flex","items-center","justify-center","z-50"],[1,"bg-white","dark:bg-gray-800","rounded-lg","shadow-xl","w-full","max-w-3xl","max-h-[90vh]","overflow-hidden"],[1,"bg-blue-600","text-white","px-6","py-4","flex","items-center","justify-between"],[1,"flex","items-center","gap-2"],[1,"text-xl"],[1,"text-xl","font-semibold"],[1,"text-white","hover:text-gray-200","transition-colors","text-2xl",3,"click"],[1,"p-6"],[1,"flex","items-center","justify-center","py-12"],[1,"bg-gray-50","dark:bg-gray-700","px-6","py-4","flex","items-center","justify-between","border-t","dark:border-gray-600"],[1,"px-6","py-2","border","border-gray-300","dark:border-gray-600","rounded-lg","hover:bg-gray-100","dark:hover:bg-gray-600","dark:text-white","transition-colors",3,"click"],[1,"px-6","py-2","bg-blue-600","text-white","rounded-lg","hover:bg-blue-700","transition-colors","disabled:bg-gray-400","flex","items-center","gap-2",3,"click","disabled"],[1,"text-center"],[1,"animate-spin","rounded-full","h-12","w-12","border-b-2","border-blue-600","mx-auto","mb-4"],[1,"text-gray-600","dark:text-gray-400"],[1,"mb-6"],[1,"block","text-sm","font-medium","text-gray-700","dark:text-gray-300","mb-2"],[1,"w-full","px-4","py-2","border","border-gray-300","dark:border-gray-600","dark:bg-gray-700","dark:text-white","rounded-lg","focus:ring-2","focus:ring-blue-500","focus:border-transparent",3,"ngModelChange","ngModel"],["value",""],["value","null",1,"bg-gray-100","text-gray-700"],[3,"value","ngClass"],[1,"mb-4"],["type","text","placeholder","Rechercher un m\xE9tier...",1,"w-full","px-4","py-2","border","border-gray-300","dark:border-gray-600","dark:bg-gray-700","dark:text-white","dark:placeholder-gray-400","rounded-lg","focus:ring-2","focus:ring-blue-500",3,"ngModelChange","ngModel"],[1,"mb-4","flex","gap-4","text-sm"],[1,"text-blue-600","dark:text-blue-400","hover:underline",3,"click"],[1,"text-gray-600","dark:text-gray-400","ml-auto"],[1,"border","dark:border-gray-600","rounded-lg","overflow-hidden","max-h-96","overflow-y-auto"],[1,"p-8","text-center","text-gray-500","dark:text-gray-400"],[1,"flex","items-center","gap-3","px-4","py-3","hover:bg-gray-50","dark:hover:bg-gray-700","border-b","dark:border-gray-700","last:border-b-0","cursor-pointer"],["type","checkbox",1,"h-4","w-4","text-blue-600","rounded","focus:ring-blue-500","dark:bg-gray-700","dark:border-gray-600",3,"checked"],[1,"h-4","w-4"],[1,"flex-1"],[1,"font-medium","text-gray-900","dark:text-gray-100","flex","items-center","gap-2"],[1,"text-xs","bg-red-100","dark:bg-red-900/30","text-red-700","dark:text-red-400","px-2","py-1","rounded"],[1,"text-xs","bg-yellow-100","dark:bg-yellow-900/30","text-yellow-700","dark:text-yellow-400","px-2","py-1","rounded"],[1,"text-sm","text-gray-500","dark:text-gray-400"],["type","checkbox",1,"h-4","w-4","text-blue-600","rounded","focus:ring-blue-500","dark:bg-gray-700","dark:border-gray-600",3,"change","checked"],[1,"font-medium"],[1,"text-xs","text-orange-600","dark:text-orange-400","ml-2"],[1,"font-medium","text-gray-600"],[1,"animate-spin","rounded-full","h-4","w-4","border-b-2","border-white"]],template:function(e,i){e&1&&(r(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"span",4),l(5,"\u{1F4CB}"),o(),r(6,"h2",5),l(7,"Association de r\xF4le aux m\xE9tiers"),o()(),r(8,"button",6),f("click",function(){return i.closeModal()}),l(9," \xD7 "),o()(),r(10,"div",7),u(11,na,5,0,"div",8)(12,fa,22,5),o(),r(13,"div",9)(14,"button",10),f("click",function(){return i.closeModal()}),l(15," Annuler "),o(),r(16,"button",11),f("click",function(){return i.save()}),u(17,ha,3,0)(18,ba,4,0),o()()()()),e&2&&(s(11),p(i.loading?11:12),s(5),C("disabled",!i.selectedRole||i.selectedMetiers.size===0||i.saving),s(),p(i.saving?17:18))},dependencies:[q,qe,ye,_e,Ce,le,Ne,se,Le],encapsulation:2})};var dn=bn(vn());var ai=[{name:"Gestion des incidents",permissions:[{key:"can_create",label:"Cr\xE9er un incident",description:"Permet de cr\xE9er un nouvel incident dans le syst\xE8me"},{key:"can_modify",label:"Modifier un incident",description:"Permet de modifier les d\xE9tails d'un incident existant"},{key:"can_view_all",label:"Consulter tous les incidents",description:"Permet de consulter tous les incidents du syst\xE8me"},{key:"can_validate",label:"Valider un incident",description:"Permet de valider et approuver un incident"}]},{name:"Archives et corbeille",permissions:[{key:"can_view_archives",label:"Consulter les archives",description:"Permet de consulter les incidents archiv\xE9s"},{key:"can_archive",label:"Archiver un incident",description:"Permet d'archiver un incident termin\xE9"},{key:"can_unarchive",label:"D\xE9sarchiver un incident",description:"Permet de d\xE9sarchiver un incident"},{key:"can_view_trash",label:"Consulter la corbeille",description:"Permet de consulter les incidents supprim\xE9s"},{key:"can_restore_from_trash",label:"Restaurer de la corbeille",description:"Permet de restaurer un incident supprim\xE9"}]},{name:"Suppression",permissions:[{key:"can_soft_delete",label:"Supprimer (corbeille)",description:"Permet de supprimer un incident (envoi en corbeille)"},{key:"can_force_delete",label:"Supprimer d\xE9finitivement",description:"Permet de supprimer d\xE9finitivement un incident (irreversible)"}]},{name:"Autres fonctionnalit\xE9s",permissions:[{key:"can_view_dashboard",label:"Acc\xE9der au tableau de bord",description:"Permet d'acc\xE9der au tableau de bord administrateur"},{key:"can_manage_emails",label:"G\xE9rer les notifications emails",description:"Permet de g\xE9rer les listes de diffusion email"},{key:"can_export",label:"Exporter les donn\xE9es",description:"Permet d'exporter les incidents en CSV/Excel"},{key:"can_view_history",label:"Consulter le journal",description:"Permet de consulter le journal des modifications d'un incident"}]}],Nt=ai.flatMap(n=>n.permissions);var Ue=class n{constructor(t){this.http=t}apiUrl=G.apiUrl;metiersSubject=new ce(null);metiers$=this.metiersSubject.asObservable();getMetiers(t=!1){let e=this.metiersSubject.value;return!t&&e&&e.length>0?this.metiers$:this.http.get(`${this.apiUrl}/metiers-with-roles`,{withCredentials:!0}).pipe(Z(i=>i?.data?.metiers&&Array.isArray(i.data.metiers)?i.data.metiers:Array.isArray(i)?i:i.metiers&&Array.isArray(i.metiers)?i.metiers:i.data&&Array.isArray(i.data)?i.data:(console.error("\u274C Format inconnu:",i),[])),me(i=>{this.metiersSubject.next(i)}),Me(i=>(console.error("\u274C Erreur chargement m\xE9tiers:",i),Qe([]))))}getMetierLabel(t){return t?.nom_metier||"Pas de m\xE9tier"}searchMetiersByName(t){let e=this.metiersSubject.value;if(!e)return[];let i=t.toLowerCase();return e.filter(a=>a.nom_metier.toLowerCase().includes(i))}clearCache(){this.metiersSubject.next(null)}static \u0275fac=function(e){return new(e||n)(J(ae))};static \u0275prov=$({token:n,factory:n.\u0275fac,providedIn:"root"})};var zt=class n{constructor(t,e){this.http=t;this.incidentDataService=e;this.incidentDataService.incidents.pipe(Z(i=>this.extractUniqueUsers(i)),gi((i,a)=>JSON.stringify(i)===JSON.stringify(a)),N(this.destroy$)).subscribe(i=>{this.usersSubject.next(i)})}apiUrl=G.apiUrl;destroy$=new K;usersSubject=new ce([]);users$=this.usersSubject.asObservable();getAllUsersFromApi(){return this.http.get(`${this.apiUrl}/users`).pipe(Z(t=>t.data))}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete(),this.usersSubject.complete()}extractUniqueUsers(t){let e=new Map;return t.forEach(i=>{i.creator&&!e.has(i.creator.id)&&e.set(i.creator.id,i.creator),i.assignee&&!e.has(i.assignee.id)&&e.set(i.assignee.id,i.assignee)}),Array.from(e.values())}getAllUsers(){return this.users$}static \u0275fac=function(e){return new(e||n)(J(ae),J(xe))};static \u0275prov=$({token:n,factory:n.\u0275fac,providedIn:"root"})};var $t=(n,t)=>t.id,xa=(n,t)=>t.num_metier,_a=(n,t)=>t.login;function Ca(n,t){if(n&1){let e=S();r(0,"button",18),f("click",function(){h(e);let a=c();return b(a.openMetierRoleModal())}),r(1,"span"),l(2,"\u{1F4CB}"),o(),r(3,"span"),l(4,"Associer m\xE9tiers aux r\xF4les"),o()()}}function ya(n,t){if(n&1){let e=S();r(0,"button",19),f("click",function(){h(e);let a=c();return b(a.exportToExcel())}),r(1,"span"),l(2,"\u{1F4E4}"),o(),r(3,"span"),l(4,"Exporter les droits"),o()()}}function Sa(n,t){if(n&1){let e=S();r(0,"button",20),f("click",function(){let a=h(e).$implicit,d=c();return b(d.activeTab=a.id)}),l(1),o()}if(n&2){let e=t.$implicit,i=c();F("border-b-2",i.activeTab===e.id)("border-blue-600",i.activeTab===e.id)("text-blue-600",i.activeTab===e.id)("text-gray-600",i.activeTab!==e.id),s(),_(" ",e.label," ")}}function Ea(n,t){if(n&1){let e=S();r(0,"div",21)(1,"div",22)(2,"h3",23),l(3),o(),r(4,"p",24),l(5),o()(),r(6,"div",25)(7,"div",26)(8,"div",27)(9,"span",28),l(10),o(),r(11,"span",29),l(12),o()(),r(13,"div",30),g(14,"div",31),o()()(),r(15,"div",32)(16,"button",33),f("click",function(){let a=h(e).$implicit,d=c(2);return b(d.openRoleModal(a))}),r(17,"span"),l(18,"\u270F\uFE0F"),o(),r(19,"span"),l(20,"Modifier"),o()()()()}if(n&2){let e=t.$implicit,i=c(2);s(3),E(e.label),s(2),E(e.description),s(5),ne(" ",i.getActivePermissionsCount(e)," / ",i.getTotalPermissionsCount()," droits activ\xE9s "),s(),Q(i.getPercentageColor(i.getPermissionPercentage(e))),s(),_(" ",i.getPermissionPercentage(e),"% "),s(2),Q(i.getProgressBarColor(i.getPermissionPercentage(e))),oe("width",i.getPermissionPercentage(e),"%")}}function wa(n,t){if(n&1&&(r(0,"div",15),M(1,Ea,21,11,"div",21,$t),o()),n&2){let e=c();s(),T(e.filteredRoles)}}function ka(n,t){n&1&&(r(0,"div",34),g(1,"div",36),r(2,"p",37),l(3,"Chargement des m\xE9tiers..."),o()())}function Ma(n,t){if(n&1){let e=S();r(0,"div",35)(1,"p"),l(2),o(),r(3,"button",38),f("click",function(){h(e);let a=c(2);return b(a.loadMetiers(!0))}),l(4," R\xE9essayer "),o()()}if(n&2){let e=c(2);s(2),E(e.metiersError)}}function Ta(n,t){if(n&1){let e=S();r(0,"button",41),f("click",function(){let a=h(e).$implicit,d=c(3);return d.metierFilter=a.code,b(d.filterData())}),r(1,"span",42),l(2),o(),r(3,"span",43),l(4),o()()}if(n&2){let e=t.$implicit,i=c(3);F("bg-blue-600",i.metierFilter===e.code)("text-white",i.metierFilter===e.code)("bg-gray-100",i.metierFilter!==e.code),s(2),E(e.label),s(2),_("(",i.countMetiersByRole(e.code),")")}}function Ia(n,t){if(n&1&&(r(0,"span"),l(1),o()),n&2){let e=c().$implicit,i=c(3);Q(Ai("inline-flex px-3 py-1 rounded-full text-sm font-medium ",i.getRoleBadgeClass(e.role.code))),s(),_(" ",e.role.label," ")}}function Fa(n,t){n&1&&(r(0,"span",58),l(1," Aucun "),o())}function Aa(n,t){if(n&1&&(r(0,"tr",51)(1,"td",53),l(2),o(),r(3,"td",54),l(4),o(),r(5,"td",55),l(6),o(),r(7,"td",56),u(8,Ia,2,4,"span",57)(9,Fa,2,0,"span",58),o()()),n&2){let e=t.$implicit;s(2),E(e.num_metier),s(2),E(e==null?null:e.nom_metier),s(2),E(e.code_region),s(2),p(e.role?8:9)}}function Da(n,t){n&1&&(r(0,"tr")(1,"td",59),l(2," Aucun m\xE9tier trouv\xE9 "),o()())}function Pa(n,t){if(n&1){let e=S();r(0,"button",72),f("click",function(){let a=h(e).$implicit,d=c(4);return b(a>0?d.goToMetierPage(a):null)}),l(1),o()}if(n&2){let e=t.$implicit,i=c(4);F("bg-blue-600",e===i.metiersPagination.currentPage)("text-white",e===i.metiersPagination.currentPage)("border-blue-600",e===i.metiersPagination.currentPage)("bg-white",e!==i.metiersPagination.currentPage&&e>0)("text-gray-700",e!==i.metiersPagination.currentPage&&e>0)("border-gray-300",e!==i.metiersPagination.currentPage&&e>0)("hover:bg-gray-50",e!==i.metiersPagination.currentPage&&e>0)("text-gray-400",e===-1)("cursor-default",e===-1),C("disabled",e===-1),s(),_(" ",e===-1?"...":e," ")}}function Va(n,t){if(n&1){let e=S();r(0,"div",52)(1,"div",60)(2,"div",61),l(3),o(),r(4,"div",62)(5,"select",63),f("change",function(a){h(e);let d=c(3);return b(d.changeMetierPageSize(a))}),r(6,"option",64),l(7,"10"),o(),r(8,"option",65),l(9,"25"),o(),r(10,"option",66),l(11,"50"),o(),r(12,"option",67),l(13,"100"),o()(),r(14,"span",68),l(15,"par page"),o()()(),r(16,"div",69)(17,"button",70),f("click",function(){h(e);let a=c(3);return b(a.goToMetierPage(a.metiersPagination.currentPage-1))}),l(18," \u2190 Pr\xE9c\xE9dent "),o(),M(19,Pa,2,20,"button",71,re),r(21,"button",70),f("click",function(){h(e);let a=c(3);return b(a.goToMetierPage(a.metiersPagination.currentPage+1))}),l(22," Suivant \u2192 "),o()()()}if(n&2){let e=c(3);s(3),_(" ",e.getMetiersPaginationInfo()," "),s(2),C("value",e.metiersPagination.pageSize),s(12),C("disabled",e.metiersPagination.currentPage===1),s(2),T(e.getVisibleMetierPages()),s(2),C("disabled",e.metiersPagination.currentPage>=e.metiersPagination.totalPages)}}function Oa(n,t){if(n&1){let e=S();r(0,"div",39)(1,"div",40)(2,"button",41),f("click",function(){h(e);let a=c(2);return a.metierFilter="all",b(a.filterData())}),r(3,"span",42),l(4,"Tous les m\xE9tiers"),o(),r(5,"span",43),l(6),o()(),M(7,Ta,5,8,"button",44,$t),r(9,"button",41),f("click",function(){h(e);let a=c(2);return a.metierFilter="none",b(a.filterData())}),r(10,"span",42),l(11,"Aucun droit"),o(),r(12,"span",43),l(13),o()()(),r(14,"button",45),f("click",function(){h(e);let a=c(2);return b(a.loadMetiers(!0))}),l(15," \u{1F504} Actualiser "),o()(),r(16,"div",46)(17,"table",47)(18,"thead",48)(19,"tr")(20,"th",49),l(21," #"),o(),r(22,"th",49),l(23," M\xE9tier "),o(),r(24,"th",49),l(25," Code R\xE9gion"),o(),r(26,"th",49),l(27," Droit Associ\xE9"),o()()(),r(28,"tbody",50),M(29,Aa,10,4,"tr",51,xa,!1,Da,3,0,"tr"),o()()(),u(32,Va,23,4,"div",52)}if(n&2){let e=c(2);s(2),F("bg-blue-600",e.metierFilter==="all")("text-white",e.metierFilter==="all")("bg-gray-100",e.metierFilter!=="all"),s(4),_("(",e.metiers.length,")"),s(),T(e.displayRoles),s(2),F("bg-blue-600",e.metierFilter==="none")("text-white",e.metierFilter==="none")("bg-gray-100",e.metierFilter!=="none"),s(4),_("(",e.countMetiersByRole("none"),")"),s(16),T(e.paginatedMetiers),s(3),p(e.metiersPagination.totalPages>1?32:-1)}}function qa(n,t){if(n&1&&(r(0,"div",16),u(1,ka,4,0,"div",34),u(2,Ma,5,1,"div",35),u(3,Oa,33,16),o()),n&2){let e=c();s(),p(e.isLoadingMetiers?1:-1),s(),p(e.metiersError?2:-1),s(),p(!e.isLoadingMetiers&&!e.metiersError?3:-1)}}function Ra(n,t){if(n&1){let e=S();r(0,"button",41),f("click",function(){let a=h(e).$implicit,d=c(2);return d.userRoleFilter=a.code,b(d.filterData())}),r(1,"span",42),l(2),o(),r(3,"span",43),l(4),o()()}if(n&2){let e=t.$implicit,i=c(2);F("bg-blue-600",i.userRoleFilter===e.code)("text-white",i.userRoleFilter===e.code)("bg-gray-100",i.userRoleFilter!==e.code),s(2),E(e.label),s(2),_("(",i.countUsersByRole(e.code),")")}}function ja(n,t){if(n&1&&(r(0,"span",78),l(1),o()),n&2){let e=c().$implicit,i=c(2);Q(i.getRoleBadgeClass(e.role_code)),s(),_(" ",e.role_label," ")}}function La(n,t){n&1&&(r(0,"span",58),l(1," Aucun r\xF4le "),o())}function Na(n,t){if(n&1&&(r(0,"tr",51)(1,"td",74),l(2),o(),r(3,"td",75),l(4),o(),r(5,"td",76),l(6),o(),r(7,"td",56),u(8,ja,2,3,"span",77)(9,La,2,0,"span",58),o()()),n&2){let e=t.$implicit;s(2),_(" ",e.full_name," "),s(2),_(" ",e.login," "),s(2),_(" ",(e.metier==null?null:e.metier.nom_metier)||"Non trouv\xE9"," "),s(2),p(e.role_code?8:9)}}function za(n,t){if(n&1){let e=S();r(0,"button",72),f("click",function(){let a=h(e).$implicit,d=c(3);return b(a>0?d.goToUserPage(a):null)}),l(1),o()}if(n&2){let e=t.$implicit,i=c(3);F("bg-blue-600",e===i.usersPagination.currentPage)("text-white",e===i.usersPagination.currentPage)("border-blue-600",e===i.usersPagination.currentPage)("bg-white",e!==i.usersPagination.currentPage&&e>0)("text-gray-700",e!==i.usersPagination.currentPage&&e>0)("border-gray-300",e!==i.usersPagination.currentPage&&e>0)("hover:bg-gray-50",e!==i.usersPagination.currentPage&&e>0)("text-gray-400",e===-1)("cursor-default",e===-1),C("disabled",e===-1),s(),_(" ",e===-1?"...":e," ")}}function Ha(n,t){if(n&1){let e=S();r(0,"div",52)(1,"div",60)(2,"div",61),l(3),o(),r(4,"div",62)(5,"select",63),f("change",function(a){h(e);let d=c(2);return b(d.changeUserPageSize(a))}),r(6,"option",64),l(7,"10"),o(),r(8,"option",65),l(9,"25"),o(),r(10,"option",66),l(11,"50"),o(),r(12,"option",67),l(13,"100"),o()(),r(14,"span",68),l(15,"par page"),o()()(),r(16,"div",69)(17,"button",70),f("click",function(){h(e);let a=c(2);return b(a.goToUserPage(a.usersPagination.currentPage-1))}),l(18," \u2190 Pr\xE9c\xE9dent "),o(),M(19,za,2,20,"button",71,re),r(21,"button",70),f("click",function(){h(e);let a=c(2);return b(a.goToUserPage(a.usersPagination.currentPage+1))}),l(22," Suivant \u2192 "),o()()()}if(n&2){let e=c(2);s(3),_(" ",e.getUsersPaginationInfo()," "),s(2),C("value",e.usersPagination.pageSize),s(12),C("disabled",e.usersPagination.currentPage===1),s(2),T(e.getVisibleUserPages()),s(2),C("disabled",e.usersPagination.currentPage>=e.usersPagination.totalPages)}}function $a(n,t){if(n&1){let e=S();r(0,"div",16)(1,"div",39)(2,"div",40)(3,"button",41),f("click",function(){h(e);let a=c();return a.userRoleFilter="all",b(a.filterData())}),r(4,"span",42),l(5,"Tous les utilisateurs"),o(),r(6,"span",43),l(7),o()(),M(8,Ra,5,8,"button",44,$t),r(10,"button",41),f("click",function(){h(e);let a=c();return a.userRoleFilter="none",b(a.filterData())}),r(11,"span",42),l(12,"Aucun r\xF4le"),o(),r(13,"span",43),l(14),o()()(),r(15,"button",73),f("click",function(){h(e);let a=c();return b(a.loadUsers())}),l(16," \u{1F504} Actualiser "),o()(),r(17,"div",46)(18,"table",47)(19,"thead",48)(20,"tr")(21,"th",49),l(22," Nom"),o(),r(23,"th",49),l(24," Identifiant"),o(),r(25,"th",49),l(26," M\xE9tier"),o(),r(27,"th",49),l(28," R\xF4le"),o()()(),r(29,"tbody",50),M(30,Na,10,4,"tr",51,_a),o()()(),u(32,Ha,23,4,"div",52),o()}if(n&2){let e=c();s(3),F("bg-blue-600",e.userRoleFilter==="all")("text-white",e.userRoleFilter==="all")("bg-gray-100",e.userRoleFilter!=="all"),s(4),_("(",e.users.length,")"),s(),T(e.displayRoles),s(2),F("bg-blue-600",e.userRoleFilter==="none")("text-white",e.userRoleFilter==="none")("bg-gray-100",e.userRoleFilter!=="none"),s(4),_("(",e.usersWithoutRoleCount,")"),s(16),T(e.paginatedUsers),s(2),p(e.usersPagination.totalPages>1?32:-1)}}function Ua(n,t){if(n&1){let e=S();r(0,"app-role-modal",79),f("close",function(){h(e);let a=c();return b(a.closeRoleModal())})("save",function(a){h(e);let d=c();return b(d.saveRole(a))}),o()}if(n&2){let e=c();C("role",e.selectedRole)}}function Ga(n,t){if(n&1){let e=S();r(0,"app-metier-role-modal",80),f("close",function(){h(e);let a=c();return b(a.closeMetierRoleModal())})("saved",function(){h(e);let a=c();return b(a.onMetierRoleModalSaved())}),o()}}var Ht=class n{constructor(t,e,i,a,d,m){this.router=t;this.metierService=e;this.permissionService=i;this.authService=a;this.userService=d;this.notificationService=m}activeTab="droits";tabs=[{id:"droits",label:"Droits"},{id:"metiers",label:"M\xE9tiers"},{id:"utilisateurs",label:"Utilisateurs"}];searchTerm="";metierFilter="all";userRoleFilter="all";isLoadingMetiers=!1;metiersError=null;isLoadingUsers=!1;usersError=null;selectedRole=null;showRoleModal=!1;showMetierRoleModal=!1;refreshMetiersTab=!0;roles=[];displayRoles=[];metiers=[];users=[];filteredRoles=[];filteredMetiers=[];filteredUsers=[];paginatedMetiers=[];paginatedUsers=[];metiersPagination={currentPage:1,pageSize:10,totalItems:0,totalPages:0};usersPagination={currentPage:1,pageSize:10,totalItems:0,totalPages:0};ngOnInit(){this.loadRoles(),this.loadMetiers(),this.loadUsers(),this.filterData()}loadRoles(){this.permissionService.roles$.subscribe({next:t=>{this.roles=t;let e=[...t].sort((d,m)=>d.label.localeCompare(m.label)),i=e.find(d=>d.code==="consultant"),a=e.filter(d=>d.code!=="consultant");this.displayRoles=[...a],i&&this.displayRoles.push(i),this.filterData()},error:t=>{console.error("\u274C Erreur chargement r\xF4les:",t)}})}loadMetiers(t=!1){this.isLoadingMetiers=!0,this.metiersError=null,this.metierService.getMetiers(t).subscribe({next:e=>{if(!Array.isArray(e)){console.error("\u274C Format de donn\xE9es invalide:",e),this.metiersError="Format de donn\xE9es invalide",this.isLoadingMetiers=!1;return}this.metiers=e,this.isLoadingMetiers=!1,this.filterData()},error:e=>{console.error("\u274C Erreur chargement m\xE9tiers:",e),this.metiersError="Impossible de charger les m\xE9tiers. V\xE9rifiez la connexion \xE0 l'API.",this.isLoadingMetiers=!1}})}loadUsers(){this.isLoadingUsers=!0,this.usersError=null,this.userService.getAllUsersFromApi().subscribe({next:t=>{t&&Array.isArray(t)?this.users=t:Array.isArray(t)?this.users=t:(console.error("\u274C Format de donn\xE9es utilisateurs invalide:",t),this.usersError="Format de donn\xE9es invalide",this.users=[]),this.isLoadingUsers=!1,this.filterData()},error:t=>{this.usersError="Impossible de charger les utilisateurs.",this.isLoadingUsers=!1,console.error("\u274C Erreur chargement utilisateurs:",t)}})}filterData(){let t=this.searchTerm.toLowerCase();this.filteredRoles=this.roles.filter(a=>a.label.toLowerCase().includes(t)||a.description.toLowerCase().includes(t));let e=this.metiers;this.metierFilter!=="all"&&(this.metierFilter==="none"?e=this.metiers.filter(a=>!a.role):e=this.metiers.filter(a=>a.role?.code===this.metierFilter)),this.filteredMetiers=e.filter(a=>a.nom_metier.toLowerCase().includes(t)||a.role&&a.role.label.toLowerCase().includes(t));let i=this.users;this.userRoleFilter!=="all"&&(this.userRoleFilter==="none"?i=this.users.filter(a=>!a.role_code):i=this.users.filter(a=>a.role_code===this.userRoleFilter)),this.filteredUsers=i.filter(a=>a.full_name.toLowerCase().includes(t)||a.login.toLowerCase().includes(t)||a.metier&&a.metier.nom_metier.toLowerCase().includes(t)||a.role_label&&a.role_label.toLowerCase().includes(t)),this.updateMetiersPagination(),this.updateUsersPagination()}updateMetiersPagination(){this.metiersPagination.totalItems=this.filteredMetiers.length,this.metiersPagination.totalPages=Math.ceil(this.metiersPagination.totalItems/this.metiersPagination.pageSize),this.metiersPagination.currentPage>this.metiersPagination.totalPages&&(this.metiersPagination.currentPage=this.metiersPagination.totalPages||1);let t=(this.metiersPagination.currentPage-1)*this.metiersPagination.pageSize;this.paginatedMetiers=this.filteredMetiers.slice(t,t+this.metiersPagination.pageSize)}goToMetierPage(t){t>=1&&t<=this.metiersPagination.totalPages&&(this.metiersPagination.currentPage=t,this.updateMetiersPagination())}changeMetierPageSize(t){let e=+t.target.value;this.metiersPagination.pageSize=e,this.metiersPagination.currentPage=1,this.updateMetiersPagination()}updateUsersPagination(){this.usersPagination.totalItems=this.filteredUsers.length,this.usersPagination.totalPages=Math.ceil(this.usersPagination.totalItems/this.usersPagination.pageSize),this.usersPagination.currentPage>this.usersPagination.totalPages&&(this.usersPagination.currentPage=this.usersPagination.totalPages||1);let t=(this.usersPagination.currentPage-1)*this.usersPagination.pageSize;this.paginatedUsers=this.filteredUsers.slice(t,t+this.usersPagination.pageSize)}goToUserPage(t){t>=1&&t<=this.usersPagination.totalPages&&(this.usersPagination.currentPage=t,this.updateUsersPagination())}changeUserPageSize(t){let e=+t.target.value;this.usersPagination.pageSize=e,this.usersPagination.currentPage=1,this.updateUsersPagination()}getVisibleMetierPages(){return this.calculateVisiblePages(this.metiersPagination.currentPage,this.metiersPagination.totalPages)}getVisibleUserPages(){return this.calculateVisiblePages(this.usersPagination.currentPage,this.usersPagination.totalPages)}calculateVisiblePages(t,e){return e<=7?Array.from({length:e},(i,a)=>a+1):t<=4?[1,2,3,4,5,-1,e]:t>=e-3?[1,-1,e-4,e-3,e-2,e-1,e]:[1,-1,t-1,t,t+1,-1,e]}getMetiersPaginationInfo(){let t=this.metiersPagination;if(t.totalItems===0)return"Aucun \xE9l\xE9ment";let e=(t.currentPage-1)*t.pageSize+1,i=Math.min(t.currentPage*t.pageSize,t.totalItems);return`Affichage de ${e}-${i} sur ${t.totalItems} \xE9l\xE9ment(s)`}getUsersPaginationInfo(){let t=this.usersPagination;if(t.totalItems===0)return"Aucun \xE9l\xE9ment";let e=(t.currentPage-1)*t.pageSize+1,i=Math.min(t.currentPage*t.pageSize,t.totalItems);return`Affichage de ${e}-${i} sur ${t.totalItems} \xE9l\xE9ment(s)`}canAccessMetierRoles(){let t=this.authService.getCurrentUser();return t?t.role_code==="admin":!1}countMetiersByRole(t){return this.metiers?t==="none"?this.metiers.filter(e=>!e.role).length:this.metiers.filter(e=>e.role?.code===t).length:0}countUsersByRole(t){return this.users?t==="none"?this.users.filter(e=>!e.role_code).length:this.users.filter(e=>e.role_code===t).length:0}get metiersWithRoleCount(){return this.metiers.filter(t=>t.role&&t.role.code!=="consultant").length}get usersWithoutRoleCount(){return this.users.filter(t=>!t.role_code).length}getActivePermissionsCount(t){return Object.values(t.permissions).filter(e=>e===!0).length}getTotalPermissionsCount(){return!this.roles||this.roles.length===0||!this.roles[0].permissions?0:Object.keys(this.roles[0].permissions).length}getPermissionPercentage(t){let e=this.getActivePermissionsCount(t),i=this.getTotalPermissionsCount();return Math.round(e/i*100)}getProgressBarColor(t){return t>=80?"bg-green-500":t>=50?"bg-orange-500":"bg-red-500"}getPercentageColor(t){return t>=80?"text-green-600":t>=50?"text-orange-600":"text-red-600"}getRoleBadgeClass(t){return{admin:"bg-red-100 text-red-800",responsable:"bg-orange-100 text-orange-800",technicien:"bg-blue-100 text-blue-800",animateur:"bg-green-100 text-green-800",consultant:"bg-gray-100 text-gray-700"}[t]||"bg-gray-100 text-gray-700"}openRoleModal(t){this.selectedRole=Ae(we({},t),{permissions:we({},t.permissions)}),this.showRoleModal=!0}openMetierRoleModal(){this.showMetierRoleModal=!0}closeRoleModal(){this.showRoleModal=!1,this.selectedRole=null}closeMetierRoleModal(){this.showMetierRoleModal=!1}onMetierRoleModalSaved(){this.showMetierRoleModal=!1,this.loadMetiers(!0),this.loadUsers(),this.refreshMetiersTab=!1,setTimeout(()=>{this.refreshMetiersTab=!0},0)}saveRole(t){if(!this.permissionService){console.error("\u274C PermissionService non inject\xE9 !"),alert("Erreur : Service de permissions non disponible");return}this.permissionService.updateRole(t.id,t).subscribe({next:e=>{this.notificationService.success("R\xF4le mis \xE0 jour",`Les permissions du r\xF4le ${e.label} ont \xE9t\xE9 mises \xE0 jour.`),this.authService.validateSession().subscribe({error:i=>console.error("\u274C Erreur rafra\xEEchissement session:",i)}),this.closeRoleModal()},error:e=>{console.error("\u274C Erreur sauvegarde r\xF4le:",e),console.error("\u{1F4CB} D\xE9tails erreur:",{status:e.status,statusText:e.statusText,message:e.message,error:e.error}),this.notificationService.error("Erreur de sauvegarde",`Impossible de sauvegarder le r\xF4le : ${e.error?.message||e.message}`)}})}goBack(){this.router.navigate(["/incidents"])}canExportRights(){return this.permissionService.canExportData()}exportToExcel(){return B(this,null,function*(){let t=new dn.Workbook,e=t.addWorksheet("Matrice Permissions"),i={font:{bold:!0,size:11,color:{argb:"FFFFFFFF"}},fill:{type:"pattern",pattern:"solid",fgColor:{argb:"FF1F4E78"}},alignment:{horizontal:"center",vertical:"middle"},border:{top:{style:"thin",color:{argb:"FF000000"}},left:{style:"thin",color:{argb:"FF000000"}},bottom:{style:"thin",color:{argb:"FF000000"}},right:{style:"thin",color:{argb:"FF000000"}}}},a={font:{bold:!0,size:11,color:{argb:"FF1F4E78"}},fill:{type:"pattern",pattern:"solid",fgColor:{argb:"FFB4C7E7"}},alignment:{horizontal:"left",vertical:"middle"},border:{top:{style:"thin",color:{argb:"FF000000"}},left:{style:"thin",color:{argb:"FF000000"}},bottom:{style:"thin",color:{argb:"FF000000"}},right:{style:"thin",color:{argb:"FF000000"}}}},d={font:{bold:!0,size:14,color:{argb:"FF006100"}},fill:{type:"pattern",pattern:"solid",fgColor:{argb:"FFC6EFCE"}},alignment:{horizontal:"center",vertical:"middle"},border:{top:{style:"thin",color:{argb:"FF000000"}},left:{style:"thin",color:{argb:"FF000000"}},bottom:{style:"thin",color:{argb:"FF000000"}},right:{style:"thin",color:{argb:"FF000000"}}}},m={font:{bold:!0,size:14,color:{argb:"FF9C0006"}},fill:{type:"pattern",pattern:"solid",fgColor:{argb:"FFFFC7CE"}},alignment:{horizontal:"center",vertical:"middle"},border:{top:{style:"thin",color:{argb:"FF000000"}},left:{style:"thin",color:{argb:"FF000000"}},bottom:{style:"thin",color:{argb:"FF000000"}},right:{style:"thin",color:{argb:"FF000000"}}}},v={fill:{type:"pattern",pattern:"solid",fgColor:{argb:"FFFFFFFF"}},border:{top:{style:"thin",color:{argb:"FF000000"}},left:{style:"thin",color:{argb:"FF000000"}},bottom:{style:"thin",color:{argb:"FF000000"}},right:{style:"thin",color:{argb:"FF000000"}}},alignment:{vertical:"middle",wrapText:!0}},k={font:{bold:!0,size:10},fill:{type:"pattern",pattern:"solid",fgColor:{argb:"FFFFF2CC"}},alignment:{horizontal:"center",vertical:"middle"},border:{top:{style:"thin",color:{argb:"FF000000"}},left:{style:"thin",color:{argb:"FF000000"}},bottom:{style:"thin",color:{argb:"FF000000"}},right:{style:"thin",color:{argb:"FF000000"}}}};e.columns=[{key:"code",width:28},{key:"permission",width:32},{key:"description",width:55},{key:"admin",width:16},{key:"responsable",width:16},{key:"technicien",width:16},{key:"animateur",width:16},{key:"consultant",width:16}];let I=e.addRow(["Code action unitaire","Permission","Description","Administrateur","Responsable","Technicien","Animateur","Consultant"]);I.height=25,I.eachCell(H=>{H.font=i.font,H.fill=i.fill,H.alignment=i.alignment,H.border=i.border});let V=["admin","responsable","technicien","animateur","consultant"].map(H=>this.roles.find(de=>de.code===H)).filter(H=>H!==void 0),ee=ai.reduce((H,de)=>(H[de.name]=de.permissions.map(Be=>Be.key),H),{}),ie=1;Object.entries(ee).forEach(([H,de],Be)=>{Be>0&&e.addRow([]);let Fe=e.addRow([`\u{1F4CC} ${H}`]);Fe.height=22,e.mergeCells(`A${Fe.number}:H${Fe.number}`);for(let Se=1;Se<=8;Se++){let ue=Fe.getCell(Se);ue.font=a.font,ue.fill=a.fill,ue.alignment=a.alignment,ue.border=a.border}de.forEach(Se=>{let ue=Nt.find(Zt=>Zt.key===Se);if(!ue)return;let gn=`SB_${String(ie).padStart(3,"0")}_${Se}`,Y=e.addRow([gn,ue.label,ue.description]);Y.height=25,Y.getCell(1).font={size:9,color:{argb:"FF1F4E78"}},Y.getCell(1).alignment={horizontal:"left",vertical:"middle"},Y.getCell(1).fill=v.fill,Y.getCell(1).border=v.border,Y.getCell(2).font={size:10,bold:!0},Y.getCell(2).alignment={horizontal:"left",vertical:"middle"},Y.getCell(2).fill=v.fill,Y.getCell(2).border=v.border,Y.getCell(3).font={size:9},Y.getCell(3).alignment={horizontal:"left",vertical:"middle",wrapText:!0},Y.getCell(3).fill=v.fill,Y.getCell(3).border=v.border,V.forEach((Zt,fn)=>{let hn=Se,di=!!Zt.permissions[hn],Ee=Y.getCell(4+fn);Ee.value=di?"\u2713":"\u2717",di?(Ee.font=d.font,Ee.fill=d.fill):(Ee.font=m.font,Ee.fill=m.fill),Ee.alignment=d.alignment,Ee.border=d.border}),ie++})}),e.addRow([]);let ot=e.addRow([]),Ie=Nt.length,li=["TOTAL",`${Ie} permissions`,""];V.forEach(H=>{let de=Nt.filter(Fe=>H.permissions[Fe.key]).length,Be=Ie>0?Math.round(de/Ie*100):0;li.push(`${de}/${Ie} (${Be}%)`)}),ot.values=li,ot.height=25,ot.eachCell(H=>{H.font=k.font,H.fill=k.fill,H.border=k.border,H.alignment={horizontal:"center",vertical:"middle"}});let un=yield t.xlsx.writeBuffer(),pn=new Blob([un],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),si=window.URL.createObjectURL(pn),Kt=document.createElement("a");Kt.href=si,Kt.download=`Matrice_Permissions_SecurityBase_${new Date().toISOString().slice(0,10)}.xlsx`,Kt.click(),window.URL.revokeObjectURL(si),this.notificationService.success("\u2713 Export Excel r\xE9ussi","success")})}static \u0275fac=function(e){return new(e||n)(y(U),y(Ue),y(te),y(W),y(zt),y(z))};static \u0275cmp=A({type:n,selectors:[["app-dashboard"]],decls:23,vars:8,consts:[[1,"p-8"],[1,"max-w-7xl","mx-auto"],[1,"flex","items-center","justify-between","mb-8"],[1,"flex","items-center","gap-4"],[1,"flex","items-center","justify-center","w-10","h-10","bg-white","rounded-lg","shadow","hover:shadow-md","transition-shadow",3,"click"],[1,"text-xl"],[1,"text-2xl","font-semibold","text-gray-800"],[1,"flex","gap-3"],[1,"flex","items-center","gap-2","px-4","py-2","bg-green-600","text-white","rounded-lg","hover:bg-green-700","transition-colors"],[1,"flex","items-center","gap-2","px-4","py-2","bg-blue-600","text-white","rounded-lg","hover:bg-blue-700","transition-colors"],[1,"mb-6"],["type","text","placeholder","Rechercher...",1,"w-full","px-4","py-3","bg-white","rounded-lg","shadow-sm","border","border-gray-200","focus:outline-none","focus:ring-2","focus:ring-blue-500",3,"ngModelChange","input","ngModel"],[1,"bg-white","rounded-lg","shadow-sm","mb-6"],[1,"flex","border-b"],[1,"px-6","py-4","font-medium","hover:text-blue-600","transition-colors",3,"border-b-2","border-blue-600","text-blue-600","text-gray-600"],[1,"space-y-3"],[1,"bg-white","rounded-lg","shadow-md","overflow-hidden"],[3,"role"],[1,"flex","items-center","gap-2","px-4","py-2","bg-green-600","text-white","rounded-lg","hover:bg-green-700","transition-colors",3,"click"],[1,"flex","items-center","gap-2","px-4","py-2","bg-blue-600","text-white","rounded-lg","hover:bg-blue-700","transition-colors",3,"click"],[1,"px-6","py-4","font-medium","hover:text-blue-600","transition-colors",3,"click"],[1,"flex","items-center","bg-white","rounded-lg","border","shadow-sm","px-6","py-4","hover:shadow","transition-shadow"],[1,"w-64","flex-shrink-0"],[1,"text-blue-700","font-semibold","text-base","mb-1"],[1,"text-xs","text-gray-500","leading-tight"],[1,"flex-1","flex","items-center","gap-4","mx-6"],[1,"flex-1"],[1,"flex","items-center","justify-between","mb-1"],[1,"text-sm","text-gray-700","font-medium"],[1,"text-sm","font-bold"],[1,"w-full","bg-gray-200","rounded-full","h-2"],[1,"h-2","rounded-full","transition-all","duration-300"],[1,"w-32","flex-shrink-0","flex","justify-end"],[1,"px-4","py-2","text-blue-700","bg-blue-50","rounded-lg","hover:bg-blue-100","border","border-blue-200","transition-colors","text-sm","font-medium","flex","items-center","gap-2",3,"click"],[1,"p-8","text-center","text-gray-500"],[1,"p-4","bg-red-50","border-l-4","border-red-500","text-red-700"],[1,"inline-block","animate-spin","rounded-full","h-8","w-8","border-4","border-blue-500","border-t-transparent"],[1,"mt-2"],[1,"mt-2","px-3","py-1","bg-red-100","hover:bg-red-200","rounded","text-sm",3,"click"],[1,"p-4","border-b","flex","justify-between","items-center"],[1,"flex","gap-2","flex-wrap"],[1,"px-4","py-2","rounded-lg","hover:bg-blue-500","hover:text-white","transition-colors","text-sm","flex","flex-col","items-center",3,"click"],[1,"font-semibold"],[1,"text-xs"],[1,"px-4","py-2","rounded-lg","hover:bg-blue-500","hover:text-white","transition-colors","text-sm","flex","flex-col","items-center",3,"bg-blue-600","text-white","bg-gray-100"],["title","Recharger les m\xE9tiers",1,"px-3","py-1","text-sm","bg-gray-100","hover:bg-gray-200","rounded","transition-colors",3,"click"],[1,"overflow-x-auto"],[1,"w-full"],[1,"bg-gray-50","border-b"],[1,"px-6","py-3","text-left","text-xs","font-medium","text-gray-500","uppercase","tracking-wider"],[1,"bg-white","divide-y","divide-gray-200"],[1,"hover:bg-gray-50"],[1,"p-4","border-t","flex","flex-col","lg:flex-row","lg:items-center","lg:justify-between","space-y-4","lg:space-y-0"],[1,"px-6","py-4","whitespace-nowrap","text-sm","text-gray-500"],[1,"px-6","py-4","text-sm","text-gray-900"],[1,"px-6","py-4","whitespace-nowrap","text-sm","text-gray-600"],[1,"px-6","py-4","whitespace-nowrap"],[3,"class"],[1,"inline-flex","px-3","py-1","rounded-full","text-sm","font-medium","bg-gray-100","text-gray-600"],["colspan","4",1,"px-6","py-8","text-center","text-gray-500"],[1,"flex","flex-col","sm:flex-row","sm:items-center","space-y-2","sm:space-y-0","sm:space-x-4"],[1,"text-sm","text-gray-700"],[1,"flex","items-center","space-x-2"],[1,"text-sm","border","border-gray-300","rounded","px-2","py-1","focus:ring-2","focus:ring-blue-500","bg-white","text-gray-900",3,"change","value"],["value","10"],["value","25"],["value","50"],["value","100"],[1,"text-sm","text-gray-600"],[1,"pagination","flex","items-center","space-x-1"],[1,"px-3","py-2","text-sm","border","rounded-md","transition-colors","bg-white","text-gray-700","border-gray-300","hover:bg-gray-50","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"],[1,"px-3","py-2","text-sm","border","rounded-md","transition-colors","min-w-[40px]","text-center",3,"disabled","bg-blue-600","text-white","border-blue-600","bg-white","text-gray-700","border-gray-300","hover:bg-gray-50","text-gray-400","cursor-default"],[1,"px-3","py-2","text-sm","border","rounded-md","transition-colors","min-w-[40px]","text-center",3,"click","disabled"],["title","Recharger les utilisateurs",1,"px-3","py-1","text-sm","bg-gray-100","hover:bg-gray-200","rounded","transition-colors",3,"click"],[1,"px-6","py-4","whitespace-nowrap","text-sm","text-gray-900","font-medium"],[1,"px-6","py-4","whitespace-nowrap","text-sm","text-gray-900"],[1,"px-6","py-4","whitespace-nowrap","text-sm","text-gray-700"],[1,"inline-flex","px-3","py-1","rounded-full","text-sm","font-medium",3,"class"],[1,"inline-flex","px-3","py-1","rounded-full","text-sm","font-medium"],[3,"close","save","role"],[3,"close","saved"]],template:function(e,i){e&1&&(r(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"button",4),f("click",function(){return i.goBack()}),r(5,"span",5),l(6,"\u2190"),o()(),r(7,"h1",6),l(8,"Administration"),o()(),r(9,"div",7),u(10,Ca,5,0,"button",8),u(11,ya,5,0,"button",9),o()(),r(12,"div",10)(13,"input",11),be("ngModelChange",function(d){return he(i.searchTerm,d)||(i.searchTerm=d),d}),f("input",function(){return i.filterData()}),o()(),r(14,"div",12)(15,"div",13),M(16,Sa,2,9,"button",14,$t),o()(),u(18,wa,3,0,"div",15),u(19,qa,4,3,"div",16),u(20,$a,33,15,"div",16),o()(),u(21,Ua,1,1,"app-role-modal",17),u(22,Ga,1,0,"app-metier-role-modal")),e&2&&(s(10),p(i.canAccessMetierRoles()?10:-1),s(),p(i.canExportRights()?11:-1),s(2),fe("ngModel",i.searchTerm),s(3),T(i.tabs),s(2),p(i.activeTab==="droits"?18:-1),s(),p(i.activeTab==="metiers"?19:-1),s(),p(i.activeTab==="utilisateurs"?20:-1),s(),p(i.showRoleModal&&i.selectedRole?21:-1),s(),p(i.showMetierRoleModal?22:-1))},dependencies:[q,ye,_e,Ce,le,se,Le,Rt,Lt],encapsulation:2})};var Ut=n=>()=>{let t=R(te),e=R(U),i=R(z);return n(t)?!0:(i.error("Acc\xE8s refus\xE9","Vous n'avez pas les permissions n\xE9cessaires pour acc\xE9der \xE0 cette page."),e.navigate(["/incidents"]),!1)};var Ge=()=>{let n=R(W),t=R(z),e=R(U);return n.isAuthenticated$.pipe(pi(1),Z(i=>i?!0:(t.warning("Session expir\xE9e","Votre session a expir\xE9. Veuillez vous reconnecter."),localStorage.setItem("intendedUrl",e.url),window.location.href=`${G.apiUrl}/auth/sso-login`,!1)))};function Ba(n,t){n&1&&(r(0,"div",9),w(),r(1,"svg",14),g(2,"path",15),o()())}function Qa(n,t){n&1&&g(0,"div",10)}function Wa(n,t){n&1&&g(0,"div",11)}function Ja(n,t){n&1&&(r(0,"div",9),w(),r(1,"svg",14),g(2,"path",15),o()())}function Ya(n,t){n&1&&g(0,"div",10)}function Ka(n,t){n&1&&g(0,"div",11)}function Za(n,t){n&1&&(r(0,"div",9),w(),r(1,"svg",14),g(2,"path",15),o()())}function Xa(n,t){n&1&&g(0,"div",10)}function el(n,t){n&1&&g(0,"div",11)}function tl(n,t){if(n&1&&(r(0,"div",13)(1,"p",16),l(2),o()()),n&2){let e=c();s(2),_(" ",e.errorMessage," ")}}var Gt=class n{constructor(t,e){this.authService=t;this.router=e}currentStep=1;hasError=!1;errorMessage="";ngOnInit(){this.validateSession()}validateSession(){this.currentStep=1,setTimeout(()=>{this.currentStep=2,setTimeout(()=>{this.currentStep=3,this.authService.validateSession().subscribe({next:t=>{if(t.authenticated&&t.user){if(!sessionStorage.getItem("jwt_token")){console.error("Erreur critique : Token non stock\xE9 apr\xE8s authentification"),this.showError("Erreur d'authentification. Token manquant.");return}setTimeout(()=>{this.router.navigate(["/incidents"])},500)}else this.showError("Session invalide. Veuillez vous reconnecter.")},error:t=>{console.error("Erreur lors de la validation de session:",t),this.showError("Erreur de connexion. Veuillez r\xE9essayer.")}})},800)},800)}showError(t){this.hasError=!0,this.errorMessage=t,setTimeout(()=>{this.router.navigate(["/"])},3e3)}static \u0275fac=function(e){return new(e||n)(y(W),y(U))};static \u0275cmp=A({type:n,selectors:[["app-validating"]],decls:31,vars:10,consts:[[1,"bg-gray-50","dark:bg-gray-900","flex","items-start","justify-center","py-20"],[1,"max-w-md","w-full","bg-white","dark:bg-gray-800","rounded-lg","shadow-lg","p-8"],[1,"flex","justify-center","mb-6"],[1,"animate-spin","rounded-full","h-16","w-16","border-b-4","border-blue-600"],[1,"text-2xl","font-semibold","text-center","text-gray-800","dark:text-gray-100","mb-2"],[1,"text-center","text-gray-600","dark:text-gray-400","mb-8"],[1,"space-y-4"],[1,"flex","items-center","space-x-3"],[1,"flex-shrink-0"],[1,"w-6","h-6","bg-green-500","rounded-full","flex","items-center","justify-center"],[1,"w-6","h-6","border-2","border-blue-500","border-t-transparent","rounded-full","animate-spin"],[1,"w-6","h-6","border-2","border-gray-300","dark:border-gray-600","rounded-full"],[1,"text-sm","text-gray-700","dark:text-gray-300"],[1,"mt-6","p-4","bg-red-50","dark:bg-red-900/20","border","border-red-200","dark:border-red-800","rounded-lg"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4","text-white"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M5 13l4 4L19 7"],[1,"text-sm","text-red-800","dark:text-red-200","text-center"]],template:function(e,i){e&1&&(r(0,"div",0)(1,"div",1)(2,"div",2),g(3,"div",3),o(),r(4,"h2",4),l(5," Authentification en cours... "),o(),r(6,"p",5),l(7," Finalisation de votre connexion... "),o(),r(8,"div",6)(9,"div",7)(10,"div",8),u(11,Ba,3,0,"div",9)(12,Qa,1,0,"div",10)(13,Wa,1,0,"div",11),o(),r(14,"span",12),l(15,"Validation du token"),o()(),r(16,"div",7)(17,"div",8),u(18,Ja,3,0,"div",9)(19,Ya,1,0,"div",10)(20,Ka,1,0,"div",11),o(),r(21,"span",12),l(22,"R\xE9cup\xE9ration des permissions"),o()(),r(23,"div",7)(24,"div",8),u(25,Za,3,0,"div",9)(26,Xa,1,0,"div",10)(27,el,1,0,"div",11),o(),r(28,"span",12),l(29,"Finalisation de la connexion"),o()()(),u(30,tl,3,1,"div",13),o()()),e&2&&(s(9),F("opacity-50",i.currentStep<1),s(2),p(i.currentStep>1?11:i.currentStep===1?12:13),s(5),F("opacity-50",i.currentStep<2),s(2),p(i.currentStep>2?18:i.currentStep===2?19:20),s(5),F("opacity-50",i.currentStep<3),s(2),p(i.currentStep>3?25:i.currentStep===3?26:27),s(5),p(i.hasError?30:-1))},dependencies:[q],encapsulation:2})};var cn=[{path:"",redirectTo:"/incidents",pathMatch:"full"},{path:"auth/validating",component:Gt},{path:"incidents",loadComponent:()=>import("./chunk-6ANECSV7.js").then(n=>n.Incidents),canActivate:[Ge]},{path:"incident/create",component:Ot,canActivate:[Ge,Ut(n=>n.canCreateIncident())]},{path:"incident/:id",component:Mt,canActivate:[Ge]},{path:"incident/:id/update",component:qt,canActivate:[Ge,Ut(n=>n.canModifyIncident())]},{path:"dashboard",component:Ht,canActivate:[Ge,Ut(n=>n.canViewDashboard())]},{path:"**",redirectTo:"/incidents"}];var mn={providers:[Pi({eventCoalescing:!0}),zi(cn),ji(Li([rn]))]};var Bt=class n{STORAGE_KEY="security-base-theme";themeSubject=new ce("light");theme$=this.themeSubject.asObservable();isDarkModeSubject=new ce(!1);isDarkMode$=this.isDarkModeSubject.asObservable();constructor(){this.initializeTheme(),this.setupSystemThemeListener()}initializeTheme(){let e=localStorage.getItem(this.STORAGE_KEY)||"auto";this.setTheme(e)}setupSystemThemeListener(){typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",()=>{this.currentTheme==="auto"&&this.updateDarkMode()})}setTheme(t){this.themeSubject.next(t),localStorage.setItem(this.STORAGE_KEY,t),this.updateDarkMode(),this.applyThemeToDocument()}updateDarkMode(){let t=this.currentTheme,e=!1;switch(t){case"dark":e=!0;break;case"light":e=!1;break;case"auto":e=this.getSystemPreference();break}this.isDarkModeSubject.next(e)}getSystemPreference(){return typeof window<"u"&&window.matchMedia?window.matchMedia("(prefers-color-scheme: dark)").matches:!1}applyThemeToDocument(){typeof document<"u"&&(this.isDarkModeSubject.value?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark"))}toggleTheme(){switch(this.currentTheme){case"light":this.setTheme("dark");break;case"dark":this.setTheme("auto");break;case"auto":this.setTheme("light");break}}toggleSimple(){let t=this.isDarkModeSubject.value;this.setTheme(t?"light":"dark")}get currentTheme(){return this.themeSubject.value}get isDarkMode(){return this.isDarkModeSubject.value}getThemeIcon(){switch(this.currentTheme){case"light":return"\u2600\uFE0F";case"dark":return"\u{1F319}";case"auto":return"\u{1F504}";default:return"\u2600\uFE0F"}}getThemeLabel(){switch(this.currentTheme){case"light":return"Clair";case"dark":return"Sombre";case"auto":return"Auto";default:return"Clair"}}static \u0275fac=function(e){return new(e||n)};static \u0275prov=$({token:n,factory:n.\u0275fac,providedIn:"root"})};function nl(n,t){if(n&1){let e=S();r(0,"div",35)(1,"div",36),l(2),o()(),r(3,"button",37),f("click",function(){h(e);let a=c();return b(a.logout())}),w(),r(4,"svg",38),g(5,"path",39),o()()}if(n&2){let e=t;s(2),ne(" Connect\xE9 en tant que : ",e.full_name," - ",e.role_label," ")}}var Qt=class n{constructor(t,e,i,a){this.themeService=t;this.metierService=e;this.permissionService=i;this.authService=a}destroy$=new K;isDarkMode=!1;currentTheme="light";themeIcon="\u2600\uFE0F";themeLabel="Clair";isMobileMenuOpen=!1;frontUrl=G.frontUrl;ngOnInit(){this.themeService.isDarkMode$.pipe(N(this.destroy$)).subscribe(t=>{this.isDarkMode=t}),this.themeService.theme$.pipe(N(this.destroy$)).subscribe(t=>{this.currentTheme=t,this.themeIcon=this.themeService.getThemeIcon(),this.themeLabel=this.themeService.getThemeLabel()})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}logout(){confirm("Voulez-vous vraiment vous d\xE9connecter ?")&&this.authService.logout(),setTimeout(()=>{window.location.href=G.frontUrl},300)}toggleMobileMenu(){this.isMobileMenuOpen=!this.isMobileMenuOpen}closeMobileMenu(){this.isMobileMenuOpen=!1}toggleTheme(){this.themeService.toggleTheme()}get userDisplayName(){return this.authService.getUserDisplayName()}static \u0275fac=function(e){return new(e||n)(y(Bt),y(Ue),y(te),y(W))};static \u0275cmp=A({type:n,selectors:[["app-header"]],decls:56,vars:14,consts:[[1,"bg-gradient-to-r","from-blue-600","to-blue-700","dark:from-gray-800","dark:to-gray-800","text-white","shadow-lg","transition-colors","duration-300"],[1,"container","mx-auto","px-4"],[1,"flex","items-center","justify-between","py-3"],[1,"flex","items-center","space-x-3"],[1,"flex","items-center","space-x-3","hover:opacity-90","transition-opacity",3,"href"],["src","assets/images/urssaf-logo.png","alt","Urssaf",1,"h-20","w-auto"],[1,"hidden","lg:flex","items-center","space-x-8","ml-auto","mr-8"],["href","http://ur837-intranet/prod/home/HOM_Homepage.php",1,"hover:text-blue-200","dark:hover:text-gray-300","transition-colors","duration-200","font-medium","px-2"],["href","http://ur837-intranet/prod/gabarits/GAB_Gabarit-erh.php",1,"hover:text-blue-200","dark:hover:text-gray-300","transition-colors","duration-200","font-medium","px-2"],["href","http://ur837-intranet/prod/gabarits/GAB_Gabarit-article-liste.php",1,"hover:text-blue-200","dark:hover:text-gray-300","transition-colors","duration-200","font-medium","px-2"],["href","http://ur837-intranet/prod/gabarits/GAB_Gabarit-page-irp.php",1,"hover:text-blue-200","dark:hover:text-gray-300","transition-colors","duration-200","font-medium","px-2"],["href","http://ur837-intranet/prod/gabarits/GAB_Gabarit-page-applications.php",1,"hover:text-blue-200","dark:hover:text-gray-300","transition-colors","duration-200","font-medium","px-2"],["href","http://ur837-intranet/prod/gabarits/GAB_Gabarit-page-annuaire.php",1,"hover:text-blue-200","dark:hover:text-gray-300","transition-colors","duration-200","font-medium","px-2"],["href","https://helpy.urssaf.recouv/helpy/libraries/views/connexion.php",1,"hover:text-blue-200","dark:hover:text-gray-300","transition-colors","duration-200","font-medium","px-2"],[1,"p-2","rounded-md","hover:bg-blue-500","dark:hover:bg-gray-700","transition-colors","duration-200","border","border-blue-400","dark:border-gray-600",3,"click","title"],[1,"text-lg"],["aria-label","Menu de navigation",1,"lg:hidden","p-2","rounded-md","hover:bg-blue-500","dark:hover:bg-gray-700","transition-colors",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-6","h-6"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2"],[1,"lg:hidden","border-t","border-blue-500","dark:border-gray-600","transition-all","duration-300","ease-in-out"],[1,"py-4","space-y-2"],["href","http://ur837-intranet/prod/home/HOM_Homepage.php",1,"block","px-3","py-2","rounded-md","hover:bg-blue-500","dark:hover:bg-gray-700","transition-colors","duration-200","text-sm","font-medium",3,"click"],["href","http://ur837-intranet/prod/gabarits/GAB_Gabarit-erh.php",1,"block","px-3","py-2","rounded-md","hover:bg-blue-500","dark:hover:bg-gray-700","transition-colors","duration-200","text-sm","font-medium",3,"click"],["href","http://ur837-intranet/prod/gabarits/GAB_Gabarit-article-liste.php",1,"block","px-3","py-2","rounded-md","hover:bg-blue-500","dark:hover:bg-gray-700","transition-colors","duration-200","text-sm","font-medium",3,"click"],["href","http://ur837-intranet/prod/gabarits/GAB_Gabarit-page-irp.php",1,"block","px-3","py-2","rounded-md","hover:bg-blue-500","dark:hover:bg-gray-700","transition-colors","duration-200","text-sm","font-medium",3,"click"],["href","http://ur837-intranet/prod/gabarits/GAB_Gabarit-page-applications.php",1,"block","px-3","py-2","rounded-md","hover:bg-blue-500","dark:hover:bg-gray-700","transition-colors","duration-200","text-sm","font-medium",3,"click"],["href","http://ur837-intranet/prod/gabarits/GAB_Gabarit-page-annuaire.php",1,"block","px-3","py-2","rounded-md","hover:bg-blue-500","dark:hover:bg-gray-700","transition-colors","duration-200","text-sm","font-medium",3,"click"],["href","https://helpy.urssaf.recouv/helpy/libraries/views/connexion.php",1,"block","px-3","py-2","rounded-md","hover:bg-blue-500","dark:hover:bg-gray-700","transition-colors","duration-200","text-sm","font-medium",3,"click"],[1,"border-t","border-blue-500","dark:border-gray-600","py-3"],[1,"flex","items-center","justify-between"],[1,"flex","items-center"],[1,"hidden","md:flex","items-center","space-x-6"],["href","http://ur837-intranet/prod/gabarits/GAB_Gabarit-page-gouvernance.php",1,"hover:text-blue-200","dark:hover:text-gray-300","transition-colors"],["href","mailto:security-base@urssaf.fr",1,"hover:text-blue-200","dark:hover:text-gray-300","transition-colors"],["href","http://ur837-intranet/prod/gabarits/GAB_Gabarit-page-archives.php",1,"hover:text-blue-200","dark:hover:text-gray-300","transition-colors"],[1,"text-right"],[1,"font-semibold"],["title","D\xE9connexion",1,"ml-2","h-6","w-6","flex","items-center","justify-center","bg-red-500/80","hover:bg-red-500","rounded-full","transition-colors",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-3","h-3"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"]],template:function(e,i){if(e&1&&(r(0,"header",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"a",4),g(5,"img",5),o()(),r(6,"nav",6)(7,"a",7),l(8," Accueil "),o(),r(9,"a",8),l(10," Ressources humaines "),o(),r(11,"a",9),l(12," Articles "),o(),r(13,"a",10),l(14," Instances repr\xE9sentatives "),o(),r(15,"a",11),l(16," Applications "),o(),r(17,"a",12),l(18," Annuaire "),o(),r(19,"a",13),l(20," Helpy "),o()(),r(21,"div",3)(22,"button",14),f("click",function(){return i.themeService.toggleTheme()}),r(23,"span",15),l(24),o()(),r(25,"button",16),f("click",function(){return i.toggleMobileMenu()}),w(),r(26,"svg",17),g(27,"path",18),o()()()(),D(),r(28,"div",19)(29,"nav",20)(30,"a",21),f("click",function(){return i.closeMobileMenu()}),l(31," Accueil "),o(),r(32,"a",22),f("click",function(){return i.closeMobileMenu()}),l(33," Ressources humaines "),o(),r(34,"a",23),f("click",function(){return i.closeMobileMenu()}),l(35," Articles "),o(),r(36,"a",24),f("click",function(){return i.closeMobileMenu()}),l(37," Instances repr\xE9sentatives "),o(),r(38,"a",25),f("click",function(){return i.closeMobileMenu()}),l(39," Applications "),o(),r(40,"a",26),f("click",function(){return i.closeMobileMenu()}),l(41," Annuaire "),o(),r(42,"a",27),f("click",function(){return i.closeMobileMenu()}),l(43," Helpy "),o()()(),r(44,"div",28)(45,"div",29)(46,"div",30),u(47,nl,6,2),ve(48,"async"),o(),r(49,"div",31)(50,"a",32),l(51," La gouvernance "),o(),r(52,"a",33),l(53," Assistance informatique "),o(),r(54,"a",34),l(55," Archives "),o()()()()()()),e&2){let a;s(4),C("href",i.frontUrl,ge),s(18),C("title","Th\xE8me actuel: "+i.themeService.getThemeLabel()+" - Cliquez pour changer"),s(2),E(i.themeService.getThemeIcon()),s(),We("aria-expanded",i.isMobileMenuOpen),s(2),We("d",i.isMobileMenuOpen?"M6 18L18 6M6 6l12 12":"M4 6h16M4 12h16M4 18h16"),s(),F("max-h-0",!i.isMobileMenuOpen)("max-h-96",i.isMobileMenuOpen)("overflow-hidden",!0),s(19),p((a=Ye(48,12,i.authService.user$))?47:-1,a)}},dependencies:[q,pt],encapsulation:2})};var Wt=class n{currentYear=new Date().getFullYear();static \u0275fac=function(e){return new(e||n)};static \u0275cmp=A({type:n,selectors:[["app-footer"]],decls:58,vars:1,consts:[[1,"bg-gradient-to-r","from-blue-600","to-blue-700","dark:from-gray-800","dark:to-gray-800","text-white","mt-auto","transition-colors","duration-300"],[1,"border-blue-400","dark:border-gray-600","mb-4"],[1,"container","mx-auto","px-4","py-6"],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-3","gap-6","mb-6"],[1,"text-lg","font-semibold","mb-3","text-blue-100","dark:text-gray-200"],[1,"space-y-2"],["href","http://ur837-intranet/prod/home/HOM_Homepage.php",1,"hover:text-blue-200","dark:hover:text-gray-300","transition-colors","text-blue-50","dark:text-gray-300"],["href","http://ur837-intranet/prod/gabarits/GAB_Gabarit-erh.php",1,"hover:text-blue-200","dark:hover:text-gray-300","transition-colors","text-blue-50","dark:text-gray-300"],["href","http://ur837-intranet/prod/gabarits/GAB_Gabarit-article-liste.php",1,"hover:text-blue-200","dark:hover:text-gray-300","transition-colors","text-blue-50","dark:text-gray-300"],["href","http://ur837-intranet/prod/gabarits/GAB_Gabarit-page-irp.php",1,"hover:text-blue-200","dark:hover:text-gray-300","transition-colors","text-blue-50","dark:text-gray-300"],["href","http://ur837-intranet/prod/gabarits/GAB_Gabarit-page-applications.php",1,"hover:text-blue-200","dark:hover:text-gray-300","transition-colors","text-blue-50","dark:text-gray-300"],["href","http://ur837-intranet/prod/gabarits/GAB_Gabarit-page-annuaire.php",1,"hover:text-blue-200","dark:hover:text-gray-300","transition-colors","text-blue-50","dark:text-gray-300"],["href","https://helpy.urssaf.recouv/helpy/libraries/views/connexion.php",1,"hover:text-blue-200","dark:hover:text-gray-300","transition-colors","text-blue-50","dark:text-gray-300"],["href","http://ur837-intranet/prod/gabarits/GAB_Gabarit-page-gouvernance.php",1,"hover:text-blue-200","dark:hover:text-gray-300","transition-colors","text-blue-50","dark:text-gray-300"],["href","mailto:security-base@urssaf.fr",1,"hover:text-blue-200","dark:hover:text-gray-300","transition-colors","text-blue-50","dark:text-gray-300"],["href","http://ur837-intranet/prod/gabarits/GAB_Gabarit-page-archives.php",1,"hover:text-blue-200","dark:hover:text-gray-300","transition-colors","text-blue-50","dark:text-gray-300"],[1,"flex","flex-col","md:flex-row","justify-between","items-center","text-sm","text-blue-100","dark:text-gray-400"],[1,"mb-2","md:mb-0"],[1,"flex","items-center","space-x-4"],["href","/",1,"hover:text-blue-200","dark:hover:text-gray-300","transition-colors"],["href","http://ur837-intranet/prod/home/HOM_Homepage.php",1,"hover:text-blue-200","dark:hover:text-gray-300","transition-colors"]],template:function(e,i){e&1&&(r(0,"footer",0),g(1,"hr",1),r(2,"div",2)(3,"div",3)(4,"div")(5,"h3",4),l(6,"Navigation"),o(),r(7,"ul",5)(8,"li")(9,"a",6),l(10,"Accueil"),o()(),r(11,"li")(12,"a",7),l(13,"Ressources humaines"),o()(),r(14,"li")(15,"a",8),l(16,"Articles"),o()(),r(17,"li")(18,"a",9),l(19,"Instances repr\xE9sentatives"),o()()()(),r(20,"div")(21,"h3",4),l(22,"Applications & Services"),o(),r(23,"ul",5)(24,"li")(25,"a",10),l(26,"Applications"),o()(),r(27,"li")(28,"a",11),l(29,"Annuaire"),o()(),r(30,"li")(31,"a",12),l(32,"Helpy"),o()(),r(33,"li")(34,"a",13),l(35,"La gouvernance"),o()()()(),r(36,"div")(37,"h3",4),l(38,"Support & Informations"),o(),r(39,"ul",5)(40,"li")(41,"a",14),l(42,"Assistance informatique"),o()(),r(43,"li")(44,"a",15),l(45,"Archives"),o()()()()(),g(46,"hr",1),r(47,"div",16)(48,"div",17)(49,"p"),l(50),o()(),r(51,"div",18)(52,"a",19),l(53,"Security Base"),o(),r(54,"span"),l(55,"|"),o(),r(56,"a",20),l(57,"Intranet Urssaf"),o()()()()()),e&2&&(s(50),_("\xA9 ",i.currentYear," Urssaf Auvergne - Tous droits r\xE9serv\xE9s"))},styles:["footer[_ngcontent-%COMP%]{margin-top:auto}[_nghost-%COMP%]{display:block;margin-top:auto}@media (max-width: 768px){.grid[_ngcontent-%COMP%]{grid-template-columns:1fr}.flex[_ngcontent-%COMP%]{flex-direction:column;text-align:center}}"]})};var rl=(n,t)=>t.id;function ol(n,t){if(n&1&&(r(0,"p",7),l(1),o()),n&2){let e=c().$implicit,i=c();C("ngClass",i.getMessageClasses(e.type)),s(),_(" ",e.message," ")}}function al(n,t){if(n&1){let e=S();r(0,"div",1)(1,"div",2)(2,"div",3),g(3,"span",4),o()(),r(4,"div",5)(5,"h4",6),l(6),o(),u(7,ol,2,2,"p",7),o(),r(8,"button",8),f("click",function(){let a=h(e).$implicit,d=c();return b(d.removeNotification(a.id))}),w(),r(9,"svg",9),g(10,"path",10),o()()()}if(n&2){let e=t.$implicit,i=c();C("ngClass",i.getNotificationClasses(e.type)),s(3),C("innerHTML",i.getNotificationIcon(e.type),pe),s(2),C("ngClass",i.getTitleClasses(e.type)),s(),_(" ",e.title," "),s(),p(e.message?7:-1),s(),C("title","Fermer")}}var Jt=class n{constructor(t,e){this.notificationService=t;this.sanitizer=e}notifications=[];subscription=new at;ngOnInit(){this.subscription=this.notificationService.notifications$.subscribe(t=>this.notifications=t)}ngOnDestroy(){this.subscription?.unsubscribe()}removeNotification(t){this.notificationService.removeNotification(t)}getNotificationClasses(t){let e="border-l-4";switch(t){case"success":return`${e} bg-green-50 border-green-400 dark:bg-green-900 dark:border-green-500`;case"error":return`${e} bg-red-50 border-red-400 dark:bg-red-900 dark:border-red-500`;case"warning":return`${e} bg-yellow-50 border-yellow-400 dark:bg-yellow-900 dark:border-yellow-500`;case"info":return`${e} bg-blue-50 border-blue-400 dark:bg-blue-900 dark:border-blue-500`;default:return`${e} bg-gray-50 border-gray-400 dark:bg-gray-800 dark:border-gray-600`}}getTitleClasses(t){switch(t){case"success":return"text-green-800 dark:text-green-200";case"error":return"text-red-800 dark:text-red-200";case"warning":return"text-yellow-800 dark:text-yellow-200";case"info":return"text-blue-800 dark:text-blue-200";default:return"text-gray-800 dark:text-gray-200"}}getMessageClasses(t){switch(t){case"success":return"text-green-700 dark:text-green-300";case"error":return"text-red-700 dark:text-red-300";case"warning":return"text-yellow-700 dark:text-yellow-300";case"info":return"text-blue-700 dark:text-blue-300";default:return"text-gray-700 dark:text-gray-300"}}getNotificationIcon(t){let e;switch(t){case"success":e='<svg class="w-5 h-5 text-green-400" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>';break;case"error":e='<svg class="w-5 h-5 text-red-400" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path></svg>';break;case"warning":e='<svg class="w-5 h-5 text-yellow-400" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path></svg>';break;case"info":e='<svg class="w-5 h-5 text-blue-400" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path></svg>';break;default:e='<svg class="w-5 h-5 text-gray-400" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path></svg>';break}return this.sanitizer.bypassSecurityTrustHtml(e)}static \u0275fac=function(e){return new(e||n)(y(z),y(Re))};static \u0275cmp=A({type:n,selectors:[["app-notification"]],decls:3,vars:0,consts:[[1,"fixed","top-4","right-4","z-50","space-y-3","max-w-sm","w-full"],[1,"notification-toast","flex","items-start","p-4","rounded-lg","shadow-lg","border","transition-all","duration-300","ease-in-out","transform",3,"ngClass"],[1,"flex-shrink-0","mr-3"],[1,"w-5","h-5","flex","items-center","justify-center"],[3,"innerHTML"],[1,"flex-1","min-w-0"],[1,"text-sm","font-semibold",3,"ngClass"],[1,"mt-1","text-xs",3,"ngClass"],[1,"flex-shrink-0","ml-2","p-1","rounded-full","hover:bg-black","hover:bg-opacity-10","transition-colors",3,"click","title"],["fill","currentColor","viewBox","0 0 20 20",1,"w-4","h-4"],["fill-rule","evenodd","d","M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z","clip-rule","evenodd"]],template:function(e,i){e&1&&(r(0,"div",0),M(1,al,11,6,"div",1,rl),o()),e&2&&(s(),T(i.notifications))},dependencies:[q,qe],styles:['@charset "UTF-8";.notifications-container[_ngcontent-%COMP%]{position:fixed;top:1rem;right:1rem;z-index:50;max-width:24rem;width:100%;pointer-events:none}.notification-toast[_ngcontent-%COMP%]{display:flex;align-items:flex-start;padding:1rem;margin-bottom:.75rem;border-radius:.5rem;box-shadow:0 10px 15px -3px #0000001a,0 4px 6px -2px #0000000d;border-left-width:4px;pointer-events:auto;animation:_ngcontent-%COMP%_slideInRight .3s ease-out;transition:all .2s ease-in-out}.notification-toast[_ngcontent-%COMP%]:hover{transform:translate(-4px);box-shadow:0 20px 25px -5px #0000001a,0 10px 10px -5px #0000000a}.notification-icon[_ngcontent-%COMP%]{flex-shrink:0;margin-right:.75rem;width:1.25rem;height:1.25rem;display:flex;align-items:center;justify-content:center}.notification-content[_ngcontent-%COMP%]{flex:1;min-width:0}.notification-title[_ngcontent-%COMP%]{font-size:.875rem;font-weight:600;margin:0;line-height:1.25}.notification-message[_ngcontent-%COMP%]{margin:.25rem 0 0;font-size:.75rem;line-height:1.4}.notification-close[_ngcontent-%COMP%]{flex-shrink:0;margin-left:.5rem;padding:.25rem;border-radius:50%;background:transparent;border:none;cursor:pointer;transition:background-color .2s ease}.notification-close[_ngcontent-%COMP%]:hover{background-color:#0000001a}.notification-success[_ngcontent-%COMP%]{background-color:#f0fdf4;border-left-color:#22c55e}.dark[_ngcontent-%COMP%]   .notification-success[_ngcontent-%COMP%]{background-color:#14532d;border-left-color:#22c55e}.title-success[_ngcontent-%COMP%]{color:#166534}.dark[_ngcontent-%COMP%]   .title-success[_ngcontent-%COMP%]{color:#dcfce7}.message-success[_ngcontent-%COMP%]{color:#15803d}.dark[_ngcontent-%COMP%]   .message-success[_ngcontent-%COMP%]{color:#bbf7d0}.notification-error[_ngcontent-%COMP%]{background-color:#fef2f2;border-left-color:#ef4444}.dark[_ngcontent-%COMP%]   .notification-error[_ngcontent-%COMP%]{background-color:#7f1d1d;border-left-color:#ef4444}.title-error[_ngcontent-%COMP%]{color:#991b1b}.dark[_ngcontent-%COMP%]   .title-error[_ngcontent-%COMP%]{color:#fee2e2}.message-error[_ngcontent-%COMP%]{color:#b91c1c}.dark[_ngcontent-%COMP%]   .message-error[_ngcontent-%COMP%]{color:#fca5a5}.notification-warning[_ngcontent-%COMP%]{background-color:#fffbeb;border-left-color:#f59e0b}.dark[_ngcontent-%COMP%]   .notification-warning[_ngcontent-%COMP%]{background-color:#78350f;border-left-color:#f59e0b}.title-warning[_ngcontent-%COMP%]{color:#92400e}.dark[_ngcontent-%COMP%]   .title-warning[_ngcontent-%COMP%]{color:#fef3c7}.message-warning[_ngcontent-%COMP%]{color:#b45309}.dark[_ngcontent-%COMP%]   .message-warning[_ngcontent-%COMP%]{color:#fde68a}.notification-info[_ngcontent-%COMP%]{background-color:#eff6ff;border-left-color:#3b82f6}.dark[_ngcontent-%COMP%]   .notification-info[_ngcontent-%COMP%]{background-color:#1e3a8a;border-left-color:#3b82f6}.title-info[_ngcontent-%COMP%]{color:#1e40af}.dark[_ngcontent-%COMP%]   .title-info[_ngcontent-%COMP%]{color:#dbeafe}.message-info[_ngcontent-%COMP%]{color:#2563eb}.dark[_ngcontent-%COMP%]   .message-info[_ngcontent-%COMP%]{color:#bfdbfe}.notification-toast[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_slideInRight .3s ease-out}@keyframes _ngcontent-%COMP%_slideInRight{0%{transform:translate(100%);opacity:0}to{transform:translate(0);opacity:1}}']})};function ll(n,t){n&1&&g(0,"app-header")}function sl(n,t){n&1&&(r(0,"div",1)(1,"div",2),g(2,"div",3),r(3,"p",4),l(4,"V\xE9rification de la session..."),o()()())}function dl(n,t){n&1&&g(0,"app-footer")}function cl(n,t){if(n&1&&(r(0,"main"),g(1,"router-outlet"),o(),u(2,dl,1,0,"app-footer"),ve(3,"async")),n&2){let e=c();s(2),p(Ye(3,1,e.authService.isAuthenticated$)?2:-1)}}var Yt=class n{constructor(t,e,i){this.route=t;this.router=e;this.authService=i}isCheckingSession=!0;ngOnInit(){this.route.queryParams.subscribe(t=>{let e=t.token;e&&(this.authService.setToken(e),this.router.navigate([],{queryParams:{token:null},queryParamsHandling:"merge",replaceUrl:!0}))}),this.authService.validateSession().subscribe({next:()=>{this.isCheckingSession=!1},error:()=>{this.isCheckingSession=!1}})}static \u0275fac=function(e){return new(e||n)(y(je),y(U),y(W))};static \u0275cmp=A({type:n,selectors:[["app-root"]],decls:6,vars:4,consts:[[1,"min-h-screen","bg-gray-50","dark:bg-gray-900"],[1,"flex","items-center","justify-center","h-screen"],[1,"text-center"],[1,"animate-spin","rounded-full","h-12","w-12","border-b-2","border-blue-600","mx-auto"],[1,"mt-4","text-gray-600","dark:text-gray-400"]],template:function(e,i){e&1&&(r(0,"div",0),u(1,ll,1,0,"app-header"),ve(2,"async"),u(3,sl,5,0,"div",1)(4,cl,4,3),g(5,"app-notification"),o()),e&2&&(s(),p(Ye(2,2,i.authService.isAuthenticated$)?1:-1),s(2),p(i.isCheckingSession?3:4))},dependencies:[q,pt,Ni,Qt,Wt,Jt],encapsulation:2})};Ri(Yt,mn).catch(n=>console.error(n));
