import{A as u,Aa as k,B as m,C as b,D as M,Db as Z,Eb as Q,Fb as K,G as Y,Ga as he,Ha as Fe,Kb as ee,L as Ie,Mb as te,N as Te,Nb as Oe,O as s,Oa as re,Q as I,R as z,Ra as R,V as B,X as De,Y as U,Z as _,_ as g,_a as Me,aa as j,ba as S,bb as Ve,c as H,ca as y,cb as N,d as O,da as h,db as ie,ea as r,eb as be,fa as a,fb as Le,ga as f,gb as Pe,ha as v,hb as ae,ia as p,ib as le,ja as c,jb as se,k as ve,kb as de,nb as X,qa as ke,qb as q,ra as P,s as L,sa as Ce,ta as oe,ua as l,ub as J,v as $,va as w,wa as C,xa as A,xb as Ae,y as Ee,ya as T,za as D}from"./chunk-GDOXGUHT.js";import{a as E,b as V}from"./chunk-PHUH23IY.js";var ne=(o,t)=>t.value;function Re(o,t){if(o&1){let e=v();r(0,"button",36),p("click",function(){u(e);let i=c(2);return m(i.resetSort())}),l(1," Reset "),a()}}function Ne(o,t){if(o&1){let e=v();r(0,"div",23)(1,"div",37)(2,"button",38),p("click",function(){u(e);let i=c(2);return m(i.addNewRule("metier"))}),l(3," \u{1F3E2} Liste m\xE9tier "),r(4,"span",39),l(5,"Avec gravit\xE9, domaines, sites"),a()(),r(6,"button",38),p("click",function(){u(e);let i=c(2);return m(i.addNewRule("personnelle"))}),l(7," \u{1F464} Liste personnalis\xE9e "),r(8,"span",39),l(9,"Libre, uniquement emails"),a()()()()}}function Be(o,t){o&1&&(r(0,"div",27)(1,"div",40),f(2,"div",41),r(3,"p",42),l(4,"Chargement..."),a()()())}function We(o,t){if(o&1){let e=v();r(0,"div",56)(1,"span",57),l(2),a(),r(3,"button",58),p("click",function(){let i=u(e).$index,d=c(5);return m(d.removeEmailFromValidatorList(i))}),b(),r(4,"svg",59),f(5,"path",26),a()()()}if(o&2){let e=t.$implicit;s(2),w(e)}}function Ge(o,t){if(o&1&&(r(0,"div",54),S(1,We,6,1,"div",56,U().trackByEmail,!0),a()),o&2){let e=c(4);s(),y(e.validatorList.emails)}}function He(o,t){if(o&1){let e=v();r(0,"div",44)(1,"div",47)(2,"div",48)(3,"h3",49),l(4,"\u{1F512} Liste des Validateurs "),a(),r(5,"h5",50),l(6,"(Utilisez des adresses @urssaf uniquement)"),a(),r(7,"p",51),l(8," Cette liste est utilis\xE9e pour notifier les responsables lors de la cr\xE9ation d'incidents graves ou tr\xE8s graves. Elle est toujours active et ne peut pas \xEAtre supprim\xE9e. "),a()(),r(9,"div",52)(10,"label",53),l(11),a(),_(12,Ge,3,0,"div",54),r(13,"input",55),p("keydown",function(i){u(e);let d=c(3);return m(d.addEmailToValidatorList(i))}),a()()()()}if(o&2){let e=c(3);s(11),C(" Emails des validateurs (",e.validatorList.emails.length||0,") "),s(),g(e.validatorList.emails&&e.validatorList.emails.length>0?12:-1)}}function Ye(o,t){if(o&1){let e=v();r(0,"div",30)(1,"div",33)(2,"span",62),l(3,"\u{1F5D1}\uFE0F"),a(),r(4,"div")(5,"p",63),l(6),a(),r(7,"p",32),l(8,"Sera supprim\xE9e"),a()()(),r(9,"button",64),p("click",function(){u(e);let i=c().$implicit,d=c(3);return m(d.undoDeleteRule(i))}),l(10," Restaurer "),a()()}if(o&2){let e=c().$implicit;s(6),w(e.name)}}function Ue(o,t){if(o&1&&(r(0,"option",80),l(1),a()),o&2){let e=t.$implicit;h("value",e.value),s(),w(e.label)}}function Xe(o,t){if(o&1){let e=v();r(0,"label",53),l(1,"Gravit\xE9"),a(),r(2,"div",78)(3,"select",79),k("ngModelChange",function(i){u(e);let d=c(2).$implicit;return D(d.gravite,i)||(d.gravite=i),m(i)}),p("ngModelChange",function(i){u(e);let d=c(2).$implicit,x=c(3);return m(x.updateRuleGravity(d,i))}),S(4,Ue,2,2,"option",80,ne),a(),r(6,"span",81),l(7),a()()}if(o&2){let e=c(2).$implicit,n=c(3);s(3),T("ngModel",e.gravite),s(),y(n.gravityOptions),s(2),oe(e.gravite&&n.gravityConfig[e.gravite]?n.gravityConfig[e.gravite].colorClass:"bg-gray-100 text-gray-800"),s(),C(" ",e.gravite&&n.gravityConfig[e.gravite]?n.gravityConfig[e.gravite].label:"Non d\xE9fini"," ")}}function qe(o,t){if(o&1){let e=v();r(0,"label",71)(1,"input",83),p("change",function(i){let d=u(e).$implicit,x=c(3).$implicit,F=c(3);return m(F.onDomainChange(x,d.value,i))}),a(),r(2,"span",84),l(3),a()()}if(o&2){let e=t.$implicit,n=c(3).$implicit;s(),h("checked",n.domains==null?null:n.domains.includes(e.value)),s(),P("font-medium",n.domains==null?null:n.domains.includes(e.value))("text-blue-700",n.domains==null?null:n.domains.includes(e.value)),s(),C(" ",e.label," ")}}function Je(o,t){if(o&1&&(r(0,"div",70)(1,"label",82),l(2,"Domaines concern\xE9s"),a(),r(3,"div",61),S(4,qe,4,6,"label",71,ne),a()()),o&2){let e=c(5);s(4),y(e.domainOptions)}}function Ze(o,t){if(o&1){let e=v();r(0,"label",71)(1,"input",72),p("change",function(i){u(e);let d=c(2).$implicit,x=c(3);return m(x.updateRuleAutoInclude(d,i.target.checked))}),a(),r(2,"span"),l(3,"Ajouter liste m\xE9tier"),a()()}if(o&2){let e=c(2).$implicit;s(),h("checked",e.auto_include_service_users)}}function Qe(o,t){if(o&1){let e=v();r(0,"div",85)(1,"span",57),l(2),a(),r(3,"button",58),p("click",function(){let i=u(e).$index,d=c(3).$implicit,x=c(3);return m(x.removeEmailFromRule(d,i))}),b(),r(4,"svg",59),f(5,"path",26),a()()()}if(o&2){let e=t.$implicit;s(2),w(e)}}function Ke(o,t){if(o&1&&(r(0,"div",75),S(1,Qe,6,1,"div",85,U().trackByEmail,!0),a()),o&2){let e=c(2).$implicit;s(),y(e.emails)}}function et(o,t){if(o&1){let e=v();r(0,"label",89)(1,"input",90),p("change",function(i){let d=u(e).$implicit,x=c(3).$implicit,F=c(3);return m(F.onSiteChange(x,d.value,i))}),a(),r(2,"span",91),l(3),a()()}if(o&2){let e=t.$implicit,n=c(3).$implicit;s(),h("checked",n.sites==null?null:n.sites.includes(e.value)),s(),P("font-medium",n.sites==null?null:n.sites.includes(e.value)),s(),C(" ",e.label," ")}}function tt(o,t){if(o&1){let e=v();r(0,"label",89)(1,"input",90),p("change",function(i){let d=u(e).$implicit,x=c(3).$implicit,F=c(3);return m(F.onSiteChange(x,d.value,i))}),a(),r(2,"span",91),l(3),a()()}if(o&2){let e=t.$implicit,n=c(3).$implicit;s(),h("checked",n.sites==null?null:n.sites.includes(e.value)),s(),P("font-medium",n.sites==null?null:n.sites.includes(e.value)),s(),C(" ",e.label," ")}}function it(o,t){if(o&1){let e=v();r(0,"label",89)(1,"input",90),p("change",function(i){let d=u(e).$implicit,x=c(3).$implicit,F=c(3);return m(F.onSiteChange(x,d.value,i))}),a(),r(2,"span",91),l(3),a()()}if(o&2){let e=t.$implicit,n=c(3).$implicit;s(),h("checked",n.sites==null?null:n.sites.includes(e.value)),s(),P("font-medium",n.sites==null?null:n.sites.includes(e.value)),s(),C(" ",e.label," ")}}function nt(o,t){if(o&1&&(r(0,"div",77)(1,"div")(2,"label",86),l(3," \u{1F3DB}\uFE0F Sites "),a(),r(4,"div",87)(5,"div",88)(6,"div",66),S(7,et,4,4,"label",89,ne),a(),r(9,"div",66),S(10,tt,4,4,"label",89,ne),a(),r(12,"div",66),S(13,it,4,4,"label",89,ne),a()()()()()),o&2){let e=c(5);s(7),y(e.column1Sites),s(3),y(e.column2Sites),s(3),y(e.column3Sites)}}function ot(o,t){if(o&1){let e=v();r(0,"div",61)(1,"div",65)(2,"div",66)(3,"div")(4,"label",53),l(5,"Nom de la liste"),a(),r(6,"input",67),p("input",function(i){u(e);let d=c().$implicit,x=c(3);return m(x.updateRuleName(d,i.target.value))}),a()(),r(7,"div")(8,"div",30)(9,"label",68),l(10,"Type de liste"),a(),r(11,"span",69),l(12),a()()(),r(13,"div"),_(14,Xe,8,4),a()(),_(15,Je,6,0,"div",70),r(16,"div",66)(17,"div",30)(18,"div",33)(19,"label",71)(20,"input",72),p("change",function(i){u(e);let d=c().$implicit,x=c(3);return m(x.updateRuleActif(d,i.target.checked))}),a(),r(21,"span"),l(22,"Actif"),a()(),_(23,Ze,4,1,"label",71),a(),r(24,"button",73),p("click",function(){u(e);let i=c().$implicit,d=c(3);return m(d.deleteRule(i))}),b(),r(25,"svg",21),f(26,"path",74),a()()(),M(),r(27,"div")(28,"label",53),l(29),a(),_(30,Ke,3,0,"div",75),r(31,"input",76),p("keydown",function(i){u(e);let d=c().$implicit,x=c(3);return m(x.addEmailToRule(d,i))}),a()()()(),_(32,nt,15,0,"div",77),a()}if(o&2){let e=c().$implicit;s(2),oe(e.type==="personnelle"?"col-span-8":"col-span-5"),s(4),h("value",e.name),s(5),P("bg-blue-100",e.type==="metier")("text-blue-800",e.type==="metier")("bg-purple-100",e.type==="personnelle")("text-purple-800",e.type==="personnelle"),s(),C(" ",e.type==="metier"?"\u{1F3E2} M\xE9tier":"\u{1F464} Personnalis\xE9e"," "),s(2),g(e.type==="metier"?14:-1),s(),g(e.type==="metier"?15:-1),s(),oe((e.type==="personnelle","col-span-4")),s(4),h("checked",e.actif),s(3),g(e.type==="metier"?23:-1),s(6),C(" Emails (",e.emails.length||0,") "),s(),g(e.emails&&e.emails.length>0?30:-1),s(2),g((e.type||"metier")==="metier"?32:-1)}}function rt(o,t){if(o&1&&(r(0,"div",60),_(1,Ye,11,1,"div",30)(2,ot,33,21,"div",61),a()),o&2){let e=t.$implicit;P("border-blue-300",e.isNew)("bg-blue-50",e.isNew)("border-red-300",e.isDeleted)("bg-red-50",e.isDeleted)("opacity-60",e.isDeleted),s(),g(e.isDeleted?1:2)}}function at(o,t){if(o&1&&l(0),o&2){let e=c(5);A(" Aucune liste ",e.typeFilter==="metier"?"m\xE9tier":"personnalis\xE9e",' ne correspond \xE0 "',e.searchTerm,'" ')}}function lt(o,t){if(o&1&&l(0),o&2){let e=c(5);C(' Aucune liste ne correspond \xE0 "',e.searchTerm,'" ')}}function st(o,t){if(o&1&&l(0),o&2){let e=c(5);C(" Aucune liste ",e.typeFilter==="metier"?"m\xE9tier":"personnalis\xE9e"," visible ")}}function dt(o,t){if(o&1){let e=v();r(0,"div")(1,"h3",95),l(2,"Aucune liste trouv\xE9e"),a(),r(3,"p",96),_(4,at,1,2)(5,lt,1,1)(6,st,1,1),a(),r(7,"button",97),p("click",function(){u(e);let i=c(4);return m(i.clearFilters())}),l(8," Voir toutes les listes "),a()()}if(o&2){let e=c(4);s(4),g(e.searchTerm&&e.typeFilter!=="all"?4:e.searchTerm?5:6)}}function ct(o,t){if(o&1){let e=v();r(0,"div")(1,"h3",98),l(2,"Aucune liste visible"),a(),r(3,"p",99),l(4,"Vous pouvez cr\xE9er votre premi\xE8re liste personnelle"),a(),r(5,"button",100),p("click",function(){u(e);let i=c(4);return m(i.addNewRule("personnelle"))}),l(6," \u{1F464} Cr\xE9er une liste personnalis\xE9e "),a()()}}function ut(o,t){if(o&1&&(r(0,"div",46)(1,"div",92),b(),r(2,"svg",93),f(3,"path",94),a()(),_(4,dt,9,1,"div")(5,ct,7,0,"div"),a()),o&2){let e=c(3);s(4),g(e.searchTerm||e.typeFilter!=="all"?4:5)}}function mt(o,t){if(o&1&&(r(0,"div",28)(1,"div",43),_(2,He,14,2,"div",44),S(3,rt,3,11,"div",45,U().trackByRuleId,!0),_(5,ut,6,1,"div",46),a()()),o&2){let e=c(2);s(2),g(e.validatorList?2:-1),s(),y(e.filteredRules),s(2),g(e.filteredRules.length===0&&!e.isLoading?5:-1)}}function pt(o,t){o&1&&(r(0,"div",31),f(1,"div",101),r(2,"span",102),l(3,"Modifications non sauvegard\xE9es"),a()())}function _t(o,t){o&1&&(r(0,"span",32),l(1,"Tout est sauvegard\xE9"),a())}function gt(o,t){o&1&&(f(0,"div",103),l(1," Sauvegarde... "))}function xt(o,t){o&1&&l(0," Sauvegarder ")}function ft(o,t){if(o&1){let e=v();r(0,"div",0)(1,"div",1)(2,"div",2),p("click",function(i){return u(e),m(i.stopPropagation())}),r(3,"div",3)(4,"div",4)(5,"div",5)(6,"h2",6),l(7,"Listes de Diffusion"),a()(),r(8,"div",7)(9,"input",8),k("ngModelChange",function(i){u(e);let d=c();return D(d.searchTerm,i)||(d.searchTerm=i),m(i)}),p("ngModelChange",function(i){u(e);let d=c();return m(d.onSearchChange(i))}),a(),r(10,"select",9),k("ngModelChange",function(i){u(e);let d=c();return D(d.typeFilter,i)||(d.typeFilter=i),m(i)}),p("ngModelChange",function(i){u(e);let d=c();return m(d.onTypeFilterChange(i))}),r(11,"option",10),l(12,"\u{1F4CB} Toutes les listes"),a(),r(13,"option",11),l(14,"\u{1F3E2} Listes m\xE9tier"),a(),r(15,"option",12),l(16,"\u{1F464} Listes personnalis\xE9e"),a()()(),r(17,"div",13)(18,"span",14),l(19,"Trier :"),a(),r(20,"button",15),p("click",function(){u(e);let i=c();return m(i.sortByName())}),r(21,"strong"),l(22,"\u{1F4DD} NOM"),a(),l(23),a(),r(24,"button",15),p("click",function(){u(e);let i=c();return m(i.sortByCreationDate())}),r(25,"strong"),l(26,"\u{1F4C5} DATE : "),a(),l(27),a(),r(28,"button",15),p("click",function(){u(e);let i=c();return m(i.sortByGravity())}),r(29,"strong"),l(30,"\u26A0\uFE0F GRAVIT\xC9 : "),a(),l(31),a(),r(32,"div",16),_(33,Re,2,0,"button",17),a()(),r(34,"div",18)(35,"span",14)(36,"strong"),l(37,"\u{1F4C4} Liste(s) :"),a(),l(38),a(),r(39,"div",19)(40,"button",20),p("click",function(){u(e);let i=c();return m(i.toggleAddMenu())}),l(41," + Nouvelle Liste "),b(),r(42,"svg",21),f(43,"path",22),a()(),_(44,Ne,10,0,"div",23),a(),M(),r(45,"button",24),p("click",function(){u(e);let i=c();return m(i.closeModal())}),b(),r(46,"svg",25),f(47,"path",26),a()()()()(),_(48,Be,5,0,"div",27)(49,mt,6,2,"div",28),M(),r(50,"div",29)(51,"div",30)(52,"div"),_(53,pt,4,0,"div",31)(54,_t,2,0,"span",32),a(),r(55,"div",33)(56,"button",34),p("click",function(){u(e);let i=c();return m(i.closeModal())}),l(57," Fermer "),a(),r(58,"button",35),p("click",function(){u(e);let i=c();return m(i.saveChanges())}),_(59,gt,2,0)(60,xt,1,0),a()()()()()()()}if(o&2){let e=c();s(9),T("ngModel",e.searchTerm),s(),T("ngModel",e.typeFilter),s(10),P("bg-blue-100",e.sortState.currentSort==="name")("border-blue-300",e.sortState.currentSort==="name")("text-blue-700",e.sortState.currentSort==="name")("bg-gray-50",e.sortState.currentSort!=="name")("border-gray-300",e.sortState.currentSort!=="name")("text-gray-600",e.sortState.currentSort!=="name")("hover:bg-gray-100",e.sortState.currentSort!=="name"),s(3),C(" ",e.sortState.nameDirection==="desc"?"Z-A":"A-Z"," "),s(),P("bg-blue-100",e.sortState.currentSort==="date")("border-blue-300",e.sortState.currentSort==="date")("text-blue-700",e.sortState.currentSort==="date")("bg-gray-50",e.sortState.currentSort!=="date")("border-gray-300",e.sortState.currentSort!=="date")("text-gray-600",e.sortState.currentSort!=="date")("hover:bg-gray-100",e.sortState.currentSort!=="date"),s(3),C("",e.sortState.dateDirection==="desc"?"R\xE9cent":"Ancien"," "),s(),P("bg-blue-100",e.sortState.currentSort==="gravity")("border-blue-300",e.sortState.currentSort==="gravity")("text-blue-700",e.sortState.currentSort==="gravity")("bg-gray-50",e.sortState.currentSort!=="gravity")("border-gray-300",e.sortState.currentSort!=="gravity")("text-gray-600",e.sortState.currentSort!=="gravity")("hover:bg-gray-100",e.sortState.currentSort!=="gravity"),s(3),C("",e.sortState.gravityDirection==="desc"?"Grave":"Faible"," "),s(2),g(e.sortState.currentSort!=="default"?33:-1),s(5),A(" ",e.filteredRules.length,"/",e.currentRules.length," "),s(2),h("disabled",e.isLoading),s(4),g(e.showAddMenu?44:-1),s(4),g(e.isLoading?48:49),s(5),g(e.hasChanges?53:54),s(3),h("disabled",e.isLoading),s(2),h("disabled",!e.hasChanges||e.isLoading),s(),g(e.isLoading?59:60)}}var ce=class o{constructor(t,e,n){this.notificationService=t;this.diffusionListService=e;this.appConfigService=n}isVisible=!1;close=new B;validatorList=null;originalValidatorList=null;currentRules=[];filteredRules=[];isLoading=!1;hasChanges=!1;searchTerm="";sortState={currentSort:"default",nameDirection:"asc",dateDirection:"desc",gravityDirection:"desc"};newListsBeingEdited=new Set;showAddMenu=!1;typeFilter="all";gravityConfig=ie;destroy$=new H;get gravityOptions(){return this.appConfigService.getGravityLevels()}get domainOptions(){return this.appConfigService.getDomains()}get siteOptions(){return this.appConfigService.getSites()}get column1Sites(){let t=this.siteOptions;return[t.find(e=>e.label.includes("PAJEMPLOI")),t.find(e=>e.label.includes("CNV"))].filter(e=>!!e)}get column2Sites(){let t=this.siteOptions;return[t.find(e=>e.label.includes("Clermont")),t.find(e=>e.label.includes("Moulins"))].filter(e=>!!e)}get column3Sites(){let t=this.siteOptions;return[t.find(e=>e.label.includes("Aurillac")),t.find(e=>e.label.includes("Puy"))].filter(e=>!!e)}ngOnInit(){this.diffusionListService.state$.pipe(L(this.destroy$)).subscribe(t=>{this.currentRules=t.lists,this.filteredRules=t.filteredLists,this.isLoading=t.isLoading,this.hasChanges=t.hasChanges,this.searchTerm=t.searchTerm,this.sortState=t.sortState,this.newListsBeingEdited=t.newListsBeingEdited,this.typeFilter=t.typeFilter||"all"})}ngOnChanges(t){t.isVisible&&t.isVisible.currentValue===!0&&this.loadCurrentRules()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}onDocumentClick(t){t.target.closest(".relative")||(this.showAddMenu=!1)}onSearchChange(t){this.diffusionListService.updateSearchTerm(t)}onTypeFilterChange(t){this.typeFilter=t,this.diffusionListService.updateTypeFilter(this.typeFilter)}clearFilters(){this.typeFilter="all",this.searchTerm="",this.diffusionListService.clearAllFilters()}sortByName(){this.diffusionListService.sortByName()}sortByCreationDate(){this.diffusionListService.sortByCreationDate()}sortByGravity(){this.diffusionListService.sortByGravity()}resetSort(){this.diffusionListService.resetSort()}getAuvergneSites(){return this.appConfigService.getSitesByRegion("auvergne")}getNationalSites(){return this.appConfigService.getSitesByRegion("national")}onSiteChange(t,e,n){let i=n.target.checked;this.diffusionListService.updateSites(t.id,e,i)}addNewRule(t="metier"){this.showAddMenu=!1,this.diffusionListService.addNewList(t)}deleteRule(t){this.diffusionListService.markForDeletion(t.id)}undoDeleteRule(t){this.diffusionListService.undoDeleteList(t.id)}toggleAddMenu(){this.showAddMenu=!this.showAddMenu}updateRuleName(t,e){this.diffusionListService.updateListData(t.id,{name:e})}updateRuleGravity(t,e){this.diffusionListService.updateListData(t.id,{gravite:e})}updateRuleActif(t,e){this.diffusionListService.updateListData(t.id,{actif:e})}updateRuleAutoInclude(t,e){this.diffusionListService.updateListData(t.id,{auto_include_service_users:e})}onDomainChange(t,e,n){let i=n.target.checked;this.diffusionListService.updateDomains(t.id,e,i)}addEmailToRule(t,e){if(e.key==="Enter"){e.preventDefault();let n=e.target,i=n.value.trim();if(i){let d=this.diffusionListService.addEmailToList(t.id,i);d.success?n.value="":this.notificationService.error("Erreur",d.message)}}}removeEmailFromRule(t,e){this.diffusionListService.removeEmailFromList(t.id,e)||this.notificationService.error("Erreur","Impossible de supprimer cet email")}addEmailToValidatorList(t){if(t.key==="Enter"&&this.validatorList){t.preventDefault();let e=t.target,n=e.value.trim();if(n){if(this.validatorList.emails.includes(n)){this.notificationService.error("Erreur","Cet email est d\xE9j\xE0 dans la liste des validateurs.");return}this.validatorList.emails=[...this.validatorList.emails,n],e.value="",this.hasChanges=!0}}}removeEmailFromValidatorList(t){if(this.validatorList&&t>=0){let e=[...this.validatorList.emails];e.splice(t,1),this.validatorList.emails=e,this.hasChanges=!0}}validatorListHasChanged(){return!this.validatorList||!this.originalValidatorList?!1:JSON.stringify(this.validatorList.emails.sort())!==JSON.stringify(this.originalValidatorList.emails.sort())}saveChanges(){if(this.isLoading)return;this.isLoading=!0;let t=[],e=this.diffusionListService.saveAllChanges();t.push(e),this.validatorListHasChanged()&&t.push(this.diffusionListService.updateValidatorList(this.validatorList.emails)),ve(t).pipe(L(this.destroy$)).subscribe({next:n=>{this.isLoading=!1;let i=n[0];i.success?(this.notificationService.success("Sauvegarde r\xE9ussie","Toutes les modifications ont \xE9t\xE9 enregistr\xE9es."),this.loadCurrentRules()):this.notificationService.error("Erreurs de validation",i.errors.join(`
`))},error:n=>{this.isLoading=!1,console.error("Erreur lors de la sauvegarde globale:",n),this.notificationService.error("Erreur de sauvegarde","Une erreur est survenue lors de la sauvegarde.")}})}closeModal(){this.hasChanges&&!confirm("Vous avez des modifications non sauvegard\xE9es. Voulez-vous vraiment fermer ?")||this.close.emit()}trackByRuleId(t,e){return e.id||`temp-${t}`}trackByEmail(t,e){return`${e}-${t}`}loadCurrentRules(){let t=this.diffusionListService.loadLists(),e=this.diffusionListService.getValidatorList();ve([t,e]).pipe(L(this.destroy$)).subscribe({next:([n,i])=>{this.validatorList=i,this.originalValidatorList=JSON.parse(JSON.stringify(i))},error:n=>{console.error("Erreur de chargement:",n),this.notificationService.error("Erreur de chargement","Impossible de r\xE9cup\xE9rer les listes depuis le serveur.")}})}static \u0275fac=function(e){return new(e||o)(I(N),I(Oe),I(te))};static \u0275cmp=z({type:o,selectors:[["app-diffusion-list"]],hostBindings:function(e,n){e&1&&p("click",function(d){return n.onDocumentClick(d)},Te)},inputs:{isVisible:"isVisible"},outputs:{close:"close"},features:[Y],decls:1,vars:1,consts:[[1,"fixed","inset-0","bg-black","bg-opacity-50","z-50","overflow-y-auto"],[1,"min-h-full","flex","items-start","justify-center","p-4","pt-8"],[1,"bg-white","rounded-lg","shadow-xl","w-full","max-w-6xl","min-h-[80vh]","max-h-[90vh]","flex","flex-col","relative",3,"click"],[1,"px-4","py-4","border-b","border-gray-200","bg-gray-50","flex-shrink-0"],[1,"grid","grid-cols-12","items-center","gap-3"],[1,"col-span-2"],[1,"text-xl","font-semibold","text-gray-900","whitespace-nowrap"],[1,"col-span-2","space-y-1"],["type","text","placeholder","\u{1F50E} Rechercher...",1,"w-full","border","border-gray-300","rounded-md","px-2","py-1","text-xs","focus:ring-2","focus:ring-blue-500","focus:border-blue-500",3,"ngModelChange","ngModel"],[1,"w-full","border","border-gray-300","rounded-md","px-2","py-1","text-xs","focus:ring-2","focus:ring-blue-500",3,"ngModelChange","ngModel"],["value","all"],["value","metier"],["value","personnelle"],[1,"col-span-5","flex","items-center","justify-start","gap-2"],[1,"text-sm","text-gray-600","whitespace-nowrap"],["type","button",1,"px-2","py-1","text-xs","border","rounded","transition-colors","whitespace-nowrap",3,"click"],[1,"w-12"],["type","button","title","Remettre l'ordre par d\xE9faut",1,"px-2","py-1","text-xs","text-gray-500","hover:text-gray-700","border","border-gray-300","rounded","hover:bg-gray-100","transition-colors"],[1,"col-span-3","flex","items-center","justify-end","gap-3"],[1,"relative"],["type","button",1,"px-3","py-1.5","text-sm","font-medium","text-white","bg-green-600","rounded","hover:bg-green-700","focus:ring-2","focus:ring-green-500","disabled:opacity-50","transition-colors","whitespace-nowrap","flex","items-center","gap-1",3,"click","disabled"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M19 9l-7 7-7-7"],[1,"absolute","right-0","mt-1","w-48","bg-white","rounded-md","shadow-lg","z-10","border"],[1,"text-gray-400","hover:text-gray-600","transition-colors","p-1","rounded","hover:bg-gray-100",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12"],[1,"flex-grow","flex","items-center","justify-center"],[1,"flex-grow","overflow-y-auto","p-4"],[1,"px-6","py-3","bg-gray-50","border-t","border-gray-200","flex-shrink-0"],[1,"flex","items-center","justify-between"],[1,"flex","items-center","gap-2","text-amber-600"],[1,"text-sm","text-gray-500"],[1,"flex","items-center","gap-3"],["type","button",1,"px-4","py-2","text-sm","text-gray-700","bg-white","border","border-gray-300","rounded","hover:bg-gray-50","disabled:opacity-50",3,"click","disabled"],["type","button",1,"px-6","py-2","text-sm","text-white","bg-blue-600","rounded","hover:bg-blue-700","disabled:opacity-50",3,"click","disabled"],["type","button","title","Remettre l'ordre par d\xE9faut",1,"px-2","py-1","text-xs","text-gray-500","hover:text-gray-700","border","border-gray-300","rounded","hover:bg-gray-100","transition-colors",3,"click"],[1,"py-1"],[1,"block","w-full","text-left","px-4","py-2","text-sm","text-gray-700","hover:bg-gray-100",3,"click"],[1,"block","text-xs","text-gray-500"],[1,"text-center"],[1,"inline-block","animate-spin","rounded-full","h-8","w-8","border-b-2","border-blue-600"],[1,"text-gray-500","mt-2"],[1,"space-y-3"],[1,"border-2","border-yellow-400","bg-yellow-50","rounded-lg","p-4"],[1,"border","border-gray-200","rounded-lg","p-4","transition-all","duration-200",3,"border-blue-300","bg-blue-50","border-red-300","bg-red-50","opacity-60"],[1,"text-center","py-12"],[1,"grid","grid-cols-12","gap-4"],[1,"col-span-5","space-y-2"],[1,"text-lg","font-bold","text-gray-900"],[1,"font-bold","text-gray-700"],[1,"text-sm","text-gray-600"],[1,"col-span-7"],[1,"block","text-xs","font-medium","text-gray-700","mb-1"],[1,"mb-1","space-y-1","max-h-32","overflow-y-auto"],["type","email","placeholder","nouveau.validateur@urssaf.fr (Entr\xE9e)",1,"w-full","border","border-gray-300","rounded","px-2","py-1","text-xs","focus:ring-1","focus:ring-blue-500",3,"keydown"],[1,"flex","items-center","justify-between","bg-white","px-2","py-0.5","rounded","text-xs","border","border-gray-200"],[1,"text-gray-800","truncate"],["type","button",1,"text-gray-400","hover:text-red-500","ml-1","flex-shrink-0",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-3","h-3"],[1,"border","border-gray-200","rounded-lg","p-4","transition-all","duration-200"],[1,"space-y-4"],[1,"text-red-600","text-lg"],[1,"font-medium","text-gray-900"],[1,"px-3","py-1","text-sm","text-blue-600","border","border-blue-300","rounded","hover:bg-blue-50",3,"click"],[1,"grid","grid-cols-12","gap-4","items-start"],[1,"space-y-2"],["type","text","placeholder","Nom de la liste...",1,"w-full","border","border-gray-300","rounded","px-2","py-1.5","text-sm","focus:ring-1","focus:ring-blue-500",3,"input","value"],[1,"block","text-xs","font-medium","text-gray-700"],[1,"px-2","py-1","text-xs","font-medium","rounded-full"],[1,"col-span-3"],[1,"flex","items-center","gap-1","text-xs","cursor-pointer"],["type","checkbox",1,"h-3","w-3","text-blue-600","border-gray-300","rounded",3,"change","checked"],["type","button","title","Supprimer",1,"p-1","text-red-500","hover:text-red-700","hover:bg-red-50","rounded",3,"click"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"],[1,"mb-1","space-y-1","max-h-20","overflow-y-auto"],["type","email","placeholder","email@urssaf.fr (Entr\xE9e)",1,"w-full","border","border-gray-300","rounded","px-2","py-1","text-xs","focus:ring-1","focus:ring-blue-500",3,"keydown"],[1,"border-t","border-gray-200","pt-3"],[1,"flex","items-center","gap-2"],[1,"flex-1","border","border-gray-300","rounded","px-2","py-1.5","text-sm","focus:ring-1","focus:ring-blue-500",3,"ngModelChange","ngModel"],[3,"value"],[1,"px-2","py-1","text-xs","font-medium","rounded-full","whitespace-nowrap"],[1,"block","text-xs","font-medium","text-gray-700","mb-2"],["type","checkbox",1,"h-3","w-3","text-blue-600","border-gray-300","rounded","focus:ring-blue-500",3,"change","checked"],[1,"select-none"],[1,"flex","items-center","justify-between","bg-gray-50","px-2","py-0.5","rounded","text-xs"],[1,"block","text-xs","font-medium","text-gray-700","mb-2","flex","items-center","gap-1"],[1,"border","border-gray-200","rounded-md","p-3","bg-gray-50/30"],[1,"grid","grid-cols-3","gap-x-6"],[1,"flex","items-center","gap-1.5","text-xs","cursor-pointer"],["type","checkbox",1,"h-3.5","w-3.5","text-blue-600","border-gray-300","rounded","focus:ring-blue-500",3,"change","checked"],[1,"select-none","truncate"],[1,"w-12","h-12","mx-auto","bg-gray-100","rounded-full","flex","items-center","justify-center","mb-3"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-6","h-6","text-gray-400"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"],[1,"text-lg","font-medium","text-gray-900"],[1,"text-gray-500"],["type","button",1,"mt-2","px-3","py-1","text-sm","text-blue-600","border","border-blue-300","rounded","hover:bg-blue-50",3,"click"],[1,"text-lg","font-medium","text-gray-900","mb-2"],[1,"text-gray-500","mb-4"],["type","button",1,"px-4","py-2","text-sm","font-medium","text-white","bg-purple-600","rounded","hover:bg-purple-700",3,"click"],[1,"w-2","h-2","bg-amber-500","rounded-full","animate-pulse"],[1,"text-sm"],[1,"animate-spin","rounded-full","h-4","w-4","border-b-2","border-white","mr-2","inline-block"]],template:function(e,n){e&1&&_(0,ft,61,57,"div",0),e&2&&g(n.isVisible?0:-1)},dependencies:[R,ee,Q,K,X,Z,q,J],encapsulation:2})};var Ct=(o,t)=>t.value;function ht(o,t){if(o&1&&(r(0,"span",16),l(1),a()),o&2){let e=c(2);s(),C(" ",e.filteredIncidents.length," incident(s) apr\xE8s filtrage ")}}function bt(o,t){if(o&1&&(r(0,"option",41),l(1),a()),o&2){let e=t.$implicit,n=c(3);h("value",e),s(),A(" ",e," (",n.getIncidentsByYear(e).length," incident(s)) ")}}function St(o,t){if(o&1){let e=v();r(0,"div",26)(1,"select",40),k("ngModelChange",function(i){u(e);let d=c(2);return D(d.exportOptions.selectedYear,i)||(d.exportOptions.selectedYear=i),m(i)}),p("ngModelChange",function(i){u(e);let d=c(2);return m(d.onYearChange(i))}),S(2,bt,2,3,"option",41,j),a()()}if(o&2){let e=c(2);s(),T("ngModel",e.exportOptions.selectedYear),s(),y(e.availableYears)}}function yt(o,t){if(o&1){let e=v();r(0,"button",45),p("click",function(){let i=u(e).$implicit,d=c(3);return m(d.exportOptions.selectedMonths=i.value)}),l(1),a()}if(o&2){let e=t.$implicit,n=c(3);P("bg-blue-600",n.exportOptions.selectedMonths===e.value)("text-white",n.exportOptions.selectedMonths===e.value)("bg-gray-100",n.exportOptions.selectedMonths!==e.value)("text-gray-700",n.exportOptions.selectedMonths!==e.value),s(),C(" ",e.label," ")}}function wt(o,t){if(o&1&&(r(0,"div",28)(1,"div",42),S(2,yt,2,9,"button",43,Ct),a(),r(4,"p",44),l(5),a()()),o&2){let e=c(2);s(2),y(e.monthOptions),s(3),A(" ",e.getIncidentsByMonths(e.exportOptions.selectedMonths||3).length," incident(s) dans les ",e.exportOptions.selectedMonths||3," dernier(s) mois ")}}function Et(o,t){if(o&1&&(r(0,"p",49),l(1),a()),o&2){let e=c(3);s(),C(" ",e.getIncidentsByDateRange(e.exportOptions.customStartDate,e.exportOptions.customEndDate).length," incident(s) dans cette p\xE9riode ")}}function It(o,t){if(o&1){let e=v();r(0,"div",30)(1,"div",46)(2,"div")(3,"label",47),l(4,"Date de d\xE9but"),a(),r(5,"input",48),k("ngModelChange",function(i){u(e);let d=c(2);return D(d.exportOptions.customStartDate,i)||(d.exportOptions.customStartDate=i),m(i)}),a()(),r(6,"div")(7,"label",47),l(8,"Date de fin"),a(),r(9,"input",48),k("ngModelChange",function(i){u(e);let d=c(2);return D(d.exportOptions.customEndDate,i)||(d.exportOptions.customEndDate=i),m(i)}),a()()(),_(10,Et,2,1,"p",49),a()}if(o&2){let e=c(2);s(5),T("ngModel",e.exportOptions.customStartDate),s(4),T("ngModel",e.exportOptions.customEndDate),s(),g(e.exportOptions.customStartDate&&e.exportOptions.customEndDate?10:-1)}}function Tt(o,t){if(o&1){let e=v();r(0,"div",1),p("click",function(){u(e);let i=c();return m(i.closeModal())}),r(1,"div",2),p("click",function(i){return u(e),m(i.stopPropagation())}),r(2,"div",3)(3,"div",4)(4,"h3",5),l(5),a(),r(6,"button",6),p("click",function(){u(e);let i=c();return m(i.closeModal())}),b(),r(7,"svg",7),f(8,"path",8),a()()()(),M(),r(9,"div",9)(10,"div",10)(11,"div",11),b(),r(12,"svg",12),f(13,"path",13),a(),M(),r(14,"div")(15,"h4",14),l(16,"\xC9tat actuel"),a(),r(17,"p",15),l(18),_(19,ht,2,1,"span",16),a()()()(),r(20,"div")(21,"label",17),l(22,"P\xE9riode d'export"),a(),r(23,"div",18)(24,"label",19)(25,"input",20),k("ngModelChange",function(i){u(e);let d=c();return D(d.exportOptions.period,i)||(d.exportOptions.period=i),m(i)}),a(),r(26,"span",21)(27,"strong"),l(28,"Tous les incidents"),a(),r(29,"span",22),l(30),a()()(),r(31,"label",19)(32,"input",23),k("ngModelChange",function(i){u(e);let d=c();return D(d.exportOptions.period,i)||(d.exportOptions.period=i),m(i)}),a(),r(33,"span",21)(34,"strong"),l(35,"Incidents actuellement affich\xE9s"),a(),r(36,"span",22),l(37),a()()(),r(38,"label",19)(39,"input",24),k("ngModelChange",function(i){u(e);let d=c();return D(d.exportOptions.period,i)||(d.exportOptions.period=i),m(i)}),a(),r(40,"span",21)(41,"strong"),l(42),a(),r(43,"span",22),l(44),a()()(),r(45,"label",19)(46,"input",25),k("ngModelChange",function(i){u(e);let d=c();return D(d.exportOptions.period,i)||(d.exportOptions.period=i),m(i)}),a(),r(47,"span",21)(48,"strong"),l(49,"Ann\xE9e sp\xE9cifique"),a()()(),_(50,St,4,1,"div",26),r(51,"label",19)(52,"input",27),k("ngModelChange",function(i){u(e);let d=c();return D(d.exportOptions.period,i)||(d.exportOptions.period=i),m(i)}),a(),r(53,"span",21)(54,"strong"),l(55,"Derniers mois"),a()()(),_(56,wt,6,2,"div",28),r(57,"label",19)(58,"input",29),k("ngModelChange",function(i){u(e);let d=c();return D(d.exportOptions.period,i)||(d.exportOptions.period=i),m(i)}),a(),r(59,"span",21)(60,"strong"),l(61,"P\xE9riode personnalis\xE9e"),a()()(),_(62,It,11,3,"div",30),a()(),r(63,"div",31)(64,"h4",32),l(65,"R\xE9sum\xE9 de l'export"),a(),r(66,"div",33)(67,"div",34)(68,"span"),l(69,"Format :"),a(),r(70,"span",35),l(71),a()(),r(72,"div",34)(73,"span"),l(74,"Nombre d'incidents :"),a(),r(75,"span",36),l(76),a()(),r(77,"div",34)(78,"span"),l(79,"P\xE9riode :"),a(),r(80,"span",35),l(81),a()()()()(),r(82,"div",37)(83,"div",4)(84,"button",38),p("click",function(){u(e);let i=c();return m(i.closeModal())}),l(85," Annuler "),a(),r(86,"button",39),p("click",function(){u(e);let i=c();return m(i.executeExport())}),l(87),a()()()()()}if(o&2){let e=c();s(5),C(" ",e.exportOptions.type==="xlsx"?"\u{1F4CA} Export Excel":"\u{1F4C4} Export PDF"," "),s(13),C(" ",e.totalIncidents," incident(s) total dans la base "),s(),g(e.hasActiveFilters?19:-1),s(6),T("ngModel",e.exportOptions.period),s(5),C("",e.totalIncidents," incident(s) depuis le d\xE9but"),s(2),T("ngModel",e.exportOptions.period),s(5),C(" ",e.paginatedIncidents.length," incident(s) sur cette page "),s(2),T("ngModel",e.exportOptions.period),s(3),C("Ann\xE9e en cours (",e.exportOptions.selectedYear,")"),s(2),C("",e.getIncidentsByYear(e.currentYear).length," incident(s)"),s(2),T("ngModel",e.exportOptions.period),s(4),g(e.exportOptions.period==="custom-year"?50:-1),s(2),T("ngModel",e.exportOptions.period),s(4),g(e.exportOptions.period==="months"?56:-1),s(2),T("ngModel",e.exportOptions.period),s(4),g(e.exportOptions.period==="custom-range"?62:-1),s(9),w(e.exportOptions.type.toUpperCase()),s(5),w(e.getExportCount()),s(5),w(e.getExportPeriodLabel()),s(5),h("disabled",e.getExportCount()===0),s(),A(" ",e.exportOptions.type==="xlsx"?"\u{1F4CA} Exporter Excel":"\u{1F4C4} Exporter PDF"," (",e.getExportCount(),") ")}}var ue=class o{constructor(t,e){this.exportService=t;this.notificationService=e}isVisible=!1;incidents=[];filteredIncidents=[];hasActiveFilters=!1;paginatedIncidents=[];exportType="xlsx";close=new B;export=new B;exportOptions={type:"xlsx",period:"current",selectedYear:new Date().getFullYear(),selectedMonths:3,customStartDate:"",customEndDate:""};ngOnInit(){this.exportOptions.type=this.exportType}ngOnChanges(){this.exportOptions&&(this.exportOptions.type=this.exportType)}get totalIncidents(){return this.incidents.length}get currentYear(){return this.exportService.currentYear}get monthOptions(){return this.exportService.monthOptions}get availableYears(){return this.exportService.getAvailableYears(this.incidents)}getExportCount(){return this.exportService.getExportCount(this.incidents,this.filteredIncidents,this.exportOptions)}getExportPeriodLabel(){return this.exportService.getExportPeriodLabel(this.exportOptions)}getIncidentsByYear(t){return this.exportService.getIncidentsByYear(this.incidents,t)}getIncidentsByMonths(t){return this.exportService.getIncidentsByMonths(this.incidents,t)}getIncidentsByDateRange(t,e){return this.exportService.getIncidentsByDateRange(this.incidents,t,e)}onYearChange(t){this.exportOptions.selectedYear=typeof t=="string"?parseInt(t,10):t}executeExport(){if(this.exportOptions.type=this.exportType,this.getExportCount()===0){this.notificationService.warning("Aucune donn\xE9e","Aucun incident ne correspond aux crit\xE8res s\xE9lectionn\xE9s");return}this.export.emit(this.exportOptions),this.closeModal()}closeModal(){this.close.emit()}static \u0275fac=function(e){return new(e||o)(I(se),I(N))};static \u0275cmp=z({type:o,selectors:[["app-export-modal"]],inputs:{isVisible:"isVisible",incidents:"incidents",filteredIncidents:"filteredIncidents",hasActiveFilters:"hasActiveFilters",paginatedIncidents:"paginatedIncidents",exportType:"exportType"},outputs:{close:"close",export:"export"},features:[Y],decls:1,vars:1,consts:[[1,"fixed","inset-0","bg-black","bg-opacity-50","flex","items-center","justify-center","z-50"],[1,"fixed","inset-0","bg-black","bg-opacity-50","flex","items-center","justify-center","z-50",3,"click"],[1,"bg-white","rounded-lg","shadow-xl","max-w-md","w-full","mx-4",3,"click"],[1,"px-6","py-4","border-b","border-gray-200"],[1,"flex","items-center","justify-between"],[1,"text-lg","font-semibold","text-gray-900"],[1,"text-gray-400","hover:text-gray-600","transition-colors",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-6","h-6"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12"],[1,"px-6","py-4","space-y-4"],[1,"bg-blue-50","border","border-blue-200","rounded-lg","p-3"],[1,"flex","items-start","space-x-2"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","text-blue-500","mt-0.5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"],[1,"text-sm","font-medium","text-blue-800"],[1,"text-sm","text-blue-700","mt-1"],[1,"block"],[1,"block","text-sm","font-medium","text-gray-700","mb-3"],[1,"space-y-2"],[1,"flex","items-center","cursor-pointer","hover:bg-gray-50","p-2","rounded-md","transition-colors"],["type","radio","value","all","name","exportPeriod",1,"h-4","w-4","text-blue-600","border-gray-300","focus:ring-blue-500",3,"ngModelChange","ngModel"],[1,"ml-3","text-sm","text-gray-900"],[1,"text-gray-500","block"],["type","radio","value","current","name","exportPeriod",1,"h-4","w-4","text-blue-600","border-gray-300","focus:ring-blue-500",3,"ngModelChange","ngModel"],["type","radio","value","year","name","exportPeriod",1,"h-4","w-4","text-blue-600","border-gray-300","focus:ring-blue-500",3,"ngModelChange","ngModel"],["type","radio","value","custom-year","name","exportPeriod",1,"h-4","w-4","text-blue-600","border-gray-300","focus:ring-blue-500",3,"ngModelChange","ngModel"],[1,"ml-7","mt-2"],["type","radio","value","months","name","exportPeriod",1,"h-4","w-4","text-blue-600","border-gray-300","focus:ring-blue-500",3,"ngModelChange","ngModel"],[1,"ml-7","mt-2","space-y-2"],["type","radio","value","custom-range","name","exportPeriod",1,"h-4","w-4","text-blue-600","border-gray-300","focus:ring-blue-500",3,"ngModelChange","ngModel"],[1,"ml-7","mt-2","space-y-3"],[1,"bg-gray-50","border","border-gray-200","rounded-lg","p-3"],[1,"text-sm","font-medium","text-gray-800","mb-2"],[1,"text-sm","text-gray-600","space-y-1"],[1,"flex","justify-between"],[1,"font-medium"],[1,"font-medium","text-blue-600"],[1,"px-6","py-4","border-t","border-gray-200","bg-gray-50","rounded-b-lg"],[1,"px-4","py-2","text-sm","font-medium","text-gray-700","bg-white","border","border-gray-300","rounded-md","hover:bg-gray-50","transition-colors",3,"click"],[1,"px-6","py-2","text-sm","font-medium","text-white","bg-blue-600","border","border-transparent","rounded-md","hover:bg-blue-700","disabled:opacity-50","disabled:cursor-not-allowed","transition-colors",3,"click","disabled"],[1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","focus:ring-2","focus:ring-blue-500","text-sm",3,"ngModelChange","ngModel"],[3,"value"],[1,"grid","grid-cols-3","gap-2"],["type","button",1,"px-3","py-2","text-sm","rounded-md","border","transition-colors","hover:bg-blue-50",3,"bg-blue-600","text-white","bg-gray-100","text-gray-700"],[1,"text-xs","text-gray-500","mt-2"],["type","button",1,"px-3","py-2","text-sm","rounded-md","border","transition-colors","hover:bg-blue-50",3,"click"],[1,"grid","grid-cols-2","gap-3"],[1,"block","text-xs","text-gray-600","mb-1"],["type","date",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","focus:ring-2","focus:ring-blue-500","text-sm",3,"ngModelChange","ngModel"],[1,"text-xs","text-gray-500"]],template:function(e,n){e&1&&_(0,Tt,88,22,"div",0),e&2&&g(n.isVisible?0:-1)},dependencies:[R,ee,Q,K,X,Z,Ae,q,J],encapsulation:2})};function Vt(o,t){o&1&&(r(0,"div",15)(1,"div",21),f(2,"div",22),r(3,"p",23),l(4,"Chargement de la corbeille..."),a()()())}function Lt(o,t){o&1&&(r(0,"div",24)(1,"div",26)(2,"div",27),b(),r(3,"svg",28),f(4,"path",8),a()(),M(),r(5,"h3",29),l(6,"Corbeille vide"),a(),r(7,"p",19),l(8,"Aucun incident supprim\xE9 pour le moment."),a()()())}function Pt(o,t){if(o&1&&(r(0,"span",39),l(1),a()),o&2){let e=c().$implicit;h("ngClass",e.gravity==="tres_grave"?"bg-red-100 text-red-800":e.gravity==="grave"?"bg-orange-100 text-orange-800":e.gravity==="moyen"?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"),s(),C(" ",e.gravity==="tres_grave"?"Tr\xE8s Grave":e.gravity==="grave"?"Grave":e.gravity==="moyen"?"Moyen":"Faible"," ")}}function At(o,t){if(o&1&&(r(0,"span",40),l(1),a()),o&2){let e=c().$implicit,n=c(4);s(),C(" ",(n.statusConfig[e.status]==null?null:n.statusConfig[e.status].label)||e.status," ")}}function Ot(o,t){if(o&1&&(r(0,"span",41),l(1),a()),o&2){let e=c().$implicit;s(),A(" ",e.domains.length," domaine",e.domains.length>1?"s":""," ")}}function jt(o,t){if(o&1&&(r(0,"span",41),l(1),a()),o&2){let e=c().$implicit;s(),A(" ",e.sitesImpactes.length," site",e.sitesImpactes.length>1?"s":""," ")}}function $t(o,t){if(o&1&&(r(0,"div",42)(1,"div",60)(2,"span",61),l(3,"Description :"),a(),f(4,"div",62),a()()),o&2){let e=c().$implicit;s(4),h("innerHTML",e.description,Ie)}}function zt(o,t){if(o&1){let e=v();r(0,"button",63),p("click",function(){u(e);let i=c().$implicit,d=c(4);return m(d.restoreIncident(i))}),b(),r(1,"svg",64),f(2,"path",65),a(),l(3," Restaurer "),a()}}function Rt(o,t){if(o&1){let e=v();r(0,"button",66),p("click",function(){u(e);let i=c().$implicit,d=c(4);return m(d.forceDeleteIncident(i))}),b(),r(1,"svg",64),f(2,"path",8),a(),l(3," Supprimer "),a()}}function Nt(o,t){if(o&1&&(r(0,"div",54)(1,"span",67),l(2,"Supprim\xE9 le :"),a(),r(3,"span",68),l(4),a()()),o&2){let e=c().$implicit,n=c(4);s(4),A("",n.incidentDisplayService.formatDateShort(e.deleted_at)," \xE0 ",n.incidentDisplayService.formatTimeShort(e.deleted_at))}}function Bt(o,t){if(o&1&&(r(0,"div",55)(1,"span",69),l(2,"Cl\xF4tur\xE9 le :"),a(),r(3,"span",70),l(4),a()()),o&2){let e=c().$implicit,n=c(4);s(4),A("",n.incidentDisplayService.formatDateShort(e.dateCloture)," \xE0 ",n.incidentDisplayService.formatTimeShort(e.dateCloture))}}function Wt(o,t){if(o&1&&(r(0,"div",56)(1,"span",57),l(2,"Ticket :"),a(),r(3,"span",58),l(4),a()()),o&2){let e=c().$implicit;s(4),w(e.ticketNumber)}}function Gt(o,t){o&1&&(r(0,"div",59)(1,"div",71)(2,"div",72),b(),r(3,"svg",73),f(4,"path",74),a(),M(),r(5,"span",75),l(6,"Actions en attente"),a()(),r(7,"span",76),l(8," 1 action(s) en attente "),a()()())}function Ht(o,t){if(o&1&&(r(0,"div",30)(1,"div",31)(2,"div",32)(3,"div",33)(4,"div",34)(5,"span",35),l(6),a()()(),r(7,"div",36)(8,"h3",37),l(9),a(),r(10,"div",38),_(11,Pt,2,2,"span",39),_(12,At,2,1,"span",40),_(13,Ot,2,2,"span",41),_(14,jt,2,2,"span",41),a(),_(15,$t,5,1,"div",42),a()(),r(16,"div",43),_(17,zt,4,0,"button",44),_(18,Rt,4,0,"button",45),a()(),r(19,"div",46)(20,"div",47)(21,"div",48)(22,"h4",49),l(23,"Informations temporelles"),a(),r(24,"div",50)(25,"div",51)(26,"span",52),l(27,"Cr\xE9\xE9 le :"),a(),r(28,"span",53),l(29),a()(),_(30,Nt,5,2,"div",54),_(31,Bt,5,2,"div",55),a()(),r(32,"div",48)(33,"h4",49),l(34,"D\xE9tails de l'incident"),a(),r(35,"div",50)(36,"div",56)(37,"span",57),l(38,"Cr\xE9ateur :"),a(),r(39,"span",58),l(40),a()(),r(41,"div",56)(42,"span",57),l(43,"Modifi\xE9 par :"),a(),r(44,"span",58),l(45),a()(),_(46,Wt,5,1,"div",56),a()()(),_(47,Gt,9,0,"div",59),a()()),o&2){let e=t.$implicit,n=c(4);s(6),C("#",e.id),s(3),w(e.object),s(2),g(e.gravity?11:-1),s(),g(e.status?12:-1),s(),g(e.domains&&e.domains.length>0?13:-1),s(),g(e.sitesImpactes&&e.sitesImpactes.length>0?14:-1),s(),g(e.description&&e.description.length>0?15:-1),s(2),g(n.PermissionService.canRestoreFromTrash()?17:-1),s(),g(n.PermissionService.canForceDeleteIncident()?18:-1),s(11),A("",n.incidentDisplayService.formatDateShort(e.dateOuverture)," \xE0 ",n.incidentDisplayService.formatTimeShort(e.dateOuverture)),s(),g(e.deleted_at?30:-1),s(),g(e.dateCloture?31:-1),s(9),w(e.creator==null?null:e.creator.full_name),s(5),w(e.assignee==null?null:e.assignee.full_name),s(),g(e.ticketNumber?46:-1),s(),g(e.actionsAMener&&e.actionsAMener.length>0?47:-1)}}function Yt(o,t){if(o&1&&(r(0,"div",25),S(1,Ht,48,17,"div",30,U().trackByIncidentId,!0),a()),o&2){let e=c(3);s(),y(e.trashedIncidents)}}function Ut(o,t){if(o&1&&(r(0,"div",16),_(1,Lt,9,0,"div",24)(2,Yt,3,0,"div",25),a()),o&2){let e=c(2);s(),g(e.trashedIncidents.length===0?1:2)}}function Xt(o,t){o&1&&(r(0,"div",18),b(),r(1,"svg",77),f(2,"path",74),a(),M(),r(3,"span"),l(4,"Les incidents peuvent \xEAtre restaur\xE9s ou supprim\xE9s d\xE9finitivement"),a()())}function qt(o,t){o&1&&(r(0,"span",19),l(1,"La corbeille est vide"),a())}function Jt(o,t){if(o&1){let e=v();r(0,"div",0)(1,"div",1)(2,"div",2),p("click",function(i){return u(e),m(i.stopPropagation())}),r(3,"div",3)(4,"div",4)(5,"div",5)(6,"div",6),b(),r(7,"svg",7),f(8,"path",8),a()(),M(),r(9,"div")(10,"h2",9),l(11,"Corbeille des Incidents"),a(),r(12,"p",10),l(13,"Incidents supprim\xE9s pouvant \xEAtre restaur\xE9s"),a()()(),r(14,"div",11)(15,"span",10)(16,"strong"),l(17,"Incidents :"),a(),l(18),a(),r(19,"button",12),p("click",function(){u(e);let i=c();return m(i.closeModal())}),b(),r(20,"svg",13),f(21,"path",14),a()()()()(),_(22,Vt,5,0,"div",15)(23,Ut,3,1,"div",16),M(),r(24,"div",17)(25,"div",4)(26,"div",10),_(27,Xt,5,0,"div",18)(28,qt,2,0,"span",19),a(),r(29,"div",5)(30,"button",20),p("click",function(){u(e);let i=c();return m(i.closeModal())}),l(31," Fermer "),a()()()()()()()}if(o&2){let e=c();s(18),C(" ",e.trashedIncidents.length," "),s(4),g(e.isLoading?22:23),s(5),g(e.trashedIncidents.length>0?27:28),s(3),h("disabled",e.isLoading)}}var me=class o{constructor(t,e,n,i){this.incidentDataService=t;this.notificationService=e;this.incidentDisplayService=n;this.PermissionService=i;this.statusConfig=this.incidentDisplayService.statusConfig}isVisible=!1;close=new B;trashedIncidents=[];isLoading=!1;statusConfig;destroy$=new H;ngOnInit(){}ngOnChanges(t){t.isVisible&&t.isVisible.currentValue===!0&&t.isVisible.previousValue===!1&&this.loadTrashedIncidents()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}restoreIncident(t){this.incidentDataService.restoreTrashedIncident(t.id).pipe(L(this.destroy$)).subscribe({next:()=>{this.trashedIncidents=this.trashedIncidents.filter(e=>e.id!==t.id),this.notificationService.success("Incident restaur\xE9",`L'incident #${t.id} "${t.object}" a \xE9t\xE9 restaur\xE9 avec succ\xE8s.`)},error:e=>{console.error("Erreur lors de la restauration:",e),this.notificationService.error("Erreur de restauration",`L'incident #${t.id} n'a pas pu \xEAtre restaur\xE9. ${e.message||e}`)}})}forceDeleteIncident(t){let e=`\xCAtes-vous s\xFBr de vouloir supprimer D\xC9FINITIVEMENT l'incident #${t.id} ?

Objet: ${t.object}

Cette action est IRR\xC9VERSIBLE.`;confirm(e)&&this.incidentDataService.deleteTrashedIncident(t.id).pipe(L(this.destroy$)).subscribe({next:()=>{this.trashedIncidents=this.trashedIncidents.filter(n=>n.id!==t.id),this.notificationService.success("Suppression d\xE9finitive",`L'incident #${t.id} "${t.object}" a \xE9t\xE9 supprim\xE9 d\xE9finitivement.`)},error:n=>{console.error("Erreur lors de la suppression d\xE9finitive:",n),this.notificationService.error("Erreur de suppression",`L'incident #${t.id} n'a pas pu \xEAtre supprim\xE9 d\xE9finitivement. ${n.message||n}`)}})}closeModal(){this.close.emit()}trackByIncidentId(t,e){return e.id}loadTrashedIncidents(){this.isLoading=!0,this.incidentDataService.getTrashedIncidents().pipe(L(this.destroy$)).subscribe({next:t=>{this.trashedIncidents=t,this.isLoading=!1},error:t=>{console.error("Erreur lors du chargement de la corbeille:",t),this.notificationService.error("Erreur de chargement","Impossible de charger les incidents de la corbeille."),this.isLoading=!1}})}static \u0275fac=function(e){return new(e||o)(I(le),I(N),I(ae),I(de))};static \u0275cmp=z({type:o,selectors:[["app-trash-modal"]],inputs:{isVisible:"isVisible"},outputs:{close:"close"},features:[Y],decls:1,vars:1,consts:[[1,"fixed","inset-0","bg-black","bg-opacity-50","z-50","overflow-y-auto"],[1,"min-h-full","flex","items-start","justify-center","p-4","pt-8"],[1,"bg-white","rounded-lg","shadow-xl","w-full","max-w-6xl","min-h-[80vh]","max-h-[90vh]","flex","flex-col","relative",3,"click"],[1,"px-6","py-4","border-b","border-gray-200","bg-gray-50","flex-shrink-0"],[1,"flex","items-center","justify-between"],[1,"flex","items-center","gap-3"],[1,"w-10","h-10","bg-red-100","rounded-full","flex","items-center","justify-center"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","text-red-600"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"],[1,"text-xl","font-semibold","text-gray-900"],[1,"text-sm","text-gray-600"],[1,"flex","items-center","gap-4"],[1,"text-gray-400","hover:text-gray-600","transition-colors","p-1","rounded","hover:bg-gray-100",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12"],[1,"flex-grow","flex","items-center","justify-center"],[1,"flex-grow","overflow-y-auto"],[1,"px-6","py-4","bg-gray-50","border-t","border-gray-200","flex-shrink-0"],[1,"flex","items-center","gap-2","text-amber-600"],[1,"text-gray-500"],["type","button",1,"px-6","py-2","text-sm","text-gray-700","bg-white","border","border-gray-300","rounded-md","hover:bg-gray-50","disabled:opacity-50","transition-colors",3,"click","disabled"],[1,"text-center"],[1,"inline-block","animate-spin","rounded-full","h-8","w-8","border-b-2","border-red-600"],[1,"text-gray-500","mt-2"],[1,"flex","items-center","justify-center","h-full"],[1,"p-6","space-y-4"],[1,"text-center","py-12"],[1,"w-16","h-16","mx-auto","bg-gray-100","rounded-full","flex","items-center","justify-center","mb-4"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-8","h-8","text-gray-400"],[1,"text-lg","font-medium","text-gray-900","mb-2"],[1,"border","border-gray-200","rounded-lg","p-5","bg-white","hover:bg-gray-50","transition-colors","shadow-sm"],[1,"flex","items-start","justify-between","mb-4"],[1,"flex","items-start","gap-4","flex-1"],[1,"flex-shrink-0"],[1,"w-12","h-12","bg-red-100","rounded-lg","flex","items-center","justify-center"],[1,"text-red-700","text-sm","font-bold"],[1,"flex-1","min-w-0"],[1,"text-lg","font-semibold","text-gray-900","mb-2","leading-tight"],[1,"flex","items-center","gap-2","mb-3"],[1,"inline-flex","items-center","px-3","py-1","rounded-full","text-sm","font-medium",3,"ngClass"],[1,"inline-flex","items-center","px-3","py-1","rounded-full","text-sm","font-medium","bg-gray-100","text-gray-700"],[1,"inline-flex","items-center","px-3","py-1","rounded-full","text-sm","font-medium","bg-blue-100","text-blue-700"],[1,"text-sm","text-gray-600","mb-3"],[1,"flex","items-center","gap-2","flex-shrink-0","ml-4"],[1,"inline-flex","items-center","px-4","py-2","text-sm","font-medium","text-green-700","bg-green-100","border","border-green-300","rounded-md","hover:bg-green-200","focus:ring-2","focus:ring-green-500","transition-colors"],[1,"inline-flex","items-center","px-4","py-2","text-sm","font-medium","text-red-700","bg-red-100","border","border-red-300","rounded-md","hover:bg-red-200","focus:ring-2","focus:ring-red-500","transition-colors"],[1,"pt-4","border-t","border-gray-100","space-y-4"],[1,"grid","grid-cols-2","gap-6"],[1,"space-y-3"],[1,"font-semibold","text-gray-800","text-sm","uppercase","tracking-wide"],[1,"space-y-2","text-sm"],[1,"flex","items-center","justify-between","p-2","bg-blue-50","rounded","border-l-4","border-blue-400"],[1,"font-medium","text-blue-800"],[1,"font-bold","text-blue-900"],[1,"flex","items-center","justify-between","p-2","bg-red-50","rounded","border-l-4","border-red-400"],[1,"flex","items-center","justify-between","p-2","bg-green-50","rounded","border-l-4","border-green-400"],[1,"flex","items-center","justify-between","p-2","bg-gray-50","rounded"],[1,"text-gray-600"],[1,"font-medium","text-gray-900"],[1,"mt-4"],[1,"p-3","rounded","border","border-gray-300"],[1,"font-medium","text-gray-700"],[1,"mt-1",3,"innerHTML"],[1,"inline-flex","items-center","px-4","py-2","text-sm","font-medium","text-green-700","bg-green-100","border","border-green-300","rounded-md","hover:bg-green-200","focus:ring-2","focus:ring-green-500","transition-colors",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4","mr-2"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"],[1,"inline-flex","items-center","px-4","py-2","text-sm","font-medium","text-red-700","bg-red-100","border","border-red-300","rounded-md","hover:bg-red-200","focus:ring-2","focus:ring-red-500","transition-colors",3,"click"],[1,"font-medium","text-red-800"],[1,"font-bold","text-red-900"],[1,"font-medium","text-green-800"],[1,"font-bold","text-green-900"],[1,"flex","items-center","justify-between","p-3","bg-amber-50","rounded-lg","border","border-amber-200"],[1,"flex","items-center","gap-2"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","text-amber-600"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.664-.833-2.464 0L4.35 16.5c-.77.833.192 2.5 1.732 2.5z"],[1,"font-medium","text-amber-800"],[1,"px-3","py-1","bg-amber-100","text-amber-800","rounded-full","text-sm","font-medium"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4"]],template:function(e,n){e&1&&_(0,Jt,32,4,"div",0),e&2&&g(n.isVisible?0:-1)},dependencies:[R,re],encapsulation:2})};var pe=class o{defaultColumns=[{key:"id",label:"ID",visible:!0,width:70,minWidth:60,sortable:!0,order:0},{key:"object",label:"OBJET",visible:!0,width:200,minWidth:150,sortable:!0,order:1},{key:"domains",label:"DOMAINE",visible:!0,width:120,minWidth:100,sortable:!0,order:2},{key:"gravity",label:"GRAVIT\xC9",visible:!0,width:100,minWidth:80,sortable:!0,order:3},{key:"status",label:"STATUT",visible:!0,width:90,minWidth:80,sortable:!0,order:4},{key:"dateOuverture",label:"DATE OUVERTURE",visible:!0,width:100,minWidth:100,sortable:!0,order:5},{key:"dateCloture",label:"DATE CL\xD4TURE",visible:!0,width:100,minWidth:100,sortable:!0,order:6},{key:"has_pending_actions",label:"\xC0 FAIRE",visible:!0,width:70,minWidth:70,sortable:!0,order:7},{key:"sitesImpactes",label:"SITE IMPACT\xC9",visible:!0,width:160,minWidth:150,sortable:!0,order:8},{key:"isNational",label:"NATIONAL",visible:!0,width:70,minWidth:70,sortable:!0,order:9},{key:"ticketNumber",label:"N\xB0 TICKET",visible:!1,width:130,minWidth:100,sortable:!0,order:10},{key:"redacteur_id",label:"R\xC9DACTEUR",visible:!0,width:150,minWidth:120,sortable:!0,order:11},{key:"intervenant_id",label:"INTERVENANT",visible:!1,width:150,minWidth:120,sortable:!0,order:12}];columnsSubject=new O([...this.defaultColumns]);dragStateSubject=new O({draggingColumn:null,dragOverColumn:null});resizeStateSubject=new O({resizingColumn:null,resizeStartX:0,resizeStartWidth:0});menuStateSubject=new O({show:!1,position:{x:0,y:0}});columns$=this.columnsSubject.asObservable();dragState$=this.dragStateSubject.asObservable();resizeState$=this.resizeStateSubject.asObservable();menuState$=this.menuStateSubject.asObservable();constructor(){this.loadColumnPreferences()}getVisibleColumns(){return this.columnsSubject.value.filter(t=>t.visible).sort((t,e)=>t.order-e.order)}getHiddenColumns(){return this.columnsSubject.value.filter(t=>!t.visible)}getColumnConfig(t){return this.columnsSubject.value.find(e=>e.key===t)}toggleColumnVisibility(t,e=!1){let n=this.columnsSubject.value,i=n.find(d=>d.key===t);i&&(i.visible=!i.visible,this.columnsSubject.next([...n]),this.saveColumnPreferences(),e||setTimeout(()=>{this.hideColumnsMenu()},100))}resetColumnsToDefault(){try{localStorage.removeItem("incidents_column_preferences")}catch(e){console.error("Impossible de nettoyer le localStorage:",e)}let t=this.defaultColumns.map(e=>V(E({},e),{width:this.getDefaultWidth(e.key),order:e.order}));this.columnsSubject.next(t),setTimeout(()=>{this.columnsSubject.next([...t])},0)}getColumnStyle(t){let e=this.getColumnConfig(t);return e?{width:`${e.width}px`,"min-width":`${e.minWidth}px`,"max-width":`${e.width}px`}:{}}startResize(t,e){t.stopPropagation(),t.preventDefault();let n=this.getColumnConfig(e);if(!n)return;let i={resizingColumn:e,resizeStartX:t.clientX,resizeStartWidth:n.width};this.resizeStateSubject.next(i),document.addEventListener("mousemove",this.onResizeMove.bind(this)),document.addEventListener("mouseup",this.onResizeEnd.bind(this)),document.body.style.cursor="col-resize"}onResizeMove(t){let e=this.resizeStateSubject.value;if(!e.resizingColumn)return;let n=this.getColumnConfig(e.resizingColumn);if(!n)return;let i=t.clientX-e.resizeStartX,d=Math.max(n.minWidth,e.resizeStartWidth+i);n.width=d,this.columnsSubject.next([...this.columnsSubject.value])}onResizeEnd(){this.resizeStateSubject.value.resizingColumn&&this.saveColumnPreferences(),this.resizeStateSubject.next({resizingColumn:null,resizeStartX:0,resizeStartWidth:0}),document.body.style.cursor="default",document.removeEventListener("mousemove",this.onResizeMove.bind(this)),document.removeEventListener("mouseup",this.onResizeEnd.bind(this))}isResizing(t){return this.resizeStateSubject.value.resizingColumn===t}startColumnDrag(t,e){t.stopPropagation();let n={draggingColumn:e,dragOverColumn:null};this.dragStateSubject.next(n),t.dataTransfer&&(t.dataTransfer.effectAllowed="move",t.dataTransfer.setData("text/plain",e))}onColumnDragOver(t,e){t.preventDefault(),t.stopPropagation();let n=this.dragStateSubject.value;n.draggingColumn&&n.draggingColumn!==e&&(this.dragStateSubject.next(V(E({},n),{dragOverColumn:e})),t.dataTransfer&&(t.dataTransfer.dropEffect="move"))}onColumnDrop(t,e){t.preventDefault(),t.stopPropagation();let n=this.dragStateSubject.value;if(!n.draggingColumn||n.draggingColumn===e){this.resetDragState();return}this.reorderColumns(n.draggingColumn,e),this.resetDragState()}reorderColumns(t,e){let n=this.columnsSubject.value,i=n.find(G=>G.key===t),d=n.find(G=>G.key===e);if(!i||!d)return;let x=i.order,F=d.order;i.order=F,d.order=x,this.columnsSubject.next([...n]),this.saveColumnPreferences()}resetDragState(){this.dragStateSubject.next({draggingColumn:null,dragOverColumn:null})}isDragging(t){return this.dragStateSubject.value.draggingColumn===t}isDragOver(t){return this.dragStateSubject.value.dragOverColumn===t}showColumnsMenu(t){t.preventDefault(),t.stopPropagation();let e={show:!0,position:{x:t.clientX,y:t.clientY}};this.menuStateSubject.next(e),setTimeout(()=>{document.addEventListener("click",this.hideColumnsMenu.bind(this),{once:!0})},0)}hideColumnsMenu(){let t=this.menuStateSubject.value;this.menuStateSubject.next(V(E({},t),{show:!1}))}saveColumnPreferences(){try{let t={columns:this.columnsSubject.value.map(e=>({key:e.key,visible:e.visible,width:e.width,order:e.order})),timestamp:Date.now()};localStorage.setItem("incidents_column_preferences",JSON.stringify(t))}catch(t){console.error("Impossible de sauvegarder les pr\xE9f\xE9rences des colonnes:",t)}}loadColumnPreferences(){try{let t=localStorage.getItem("incidents_column_preferences");if(!t)return;let e=JSON.parse(t);if(!e.columns)return;let n=this.columnsSubject.value;e.columns.forEach(i=>{let d=n.find(x=>x.key===i.key);d&&(d.visible=i.visible,d.width=Math.max(d.minWidth,i.width),d.order=i.order)}),this.columnsSubject.next([...n])}catch(t){console.error("Impossible de charger les pr\xE9f\xE9rences des colonnes:",t)}}getDefaultWidth(t){return{id:80,object:250,domains:160,gravity:100,status:100,dateOuverture:140,dateCloture:140,siteImpacte:130,isNational:80,ticketNumber:130,redacteur_id:160}[t]||120}static \u0275fac=function(e){return new(e||o)};static \u0275prov=$({token:o,factory:o.\u0275fac,providedIn:"root"})};var _e=class o{constructor(t){this.appConfigService=t}initialFilterState={searchTerm:"",advancedFilters:{id:"",object:"",domain:"",gravity:"",status:"",siteImpacte:"",redacteur_id:null,intervenant_id:null,dateFrom:"",dateTo:""},showAdvancedFilters:!1};filterStateSubject=new O(E({},this.initialFilterState));filterState$=this.filterStateSubject.asObservable();get currentState(){return this.filterStateSubject.value}get searchTerm(){return this.currentState.searchTerm}get advancedFilters(){return this.currentState.advancedFilters}get showAdvancedFilters(){return this.currentState.showAdvancedFilters}setFilterState(t){let e=this.currentState;this.filterStateSubject.next(E(E({},e),t))}setSearchTerm(t){let e=this.currentState;this.filterStateSubject.next(V(E({},e),{searchTerm:t}))}clearSearch(){this.setSearchTerm("")}setAdvancedFilter(t,e){let n=this.currentState,i=V(E({},n.advancedFilters),{[t]:e});this.filterStateSubject.next(V(E({},n),{advancedFilters:i,searchTerm:""}))}setAdvancedFilters(t){let e=this.currentState,n=E(E({},e.advancedFilters),t);this.filterStateSubject.next(V(E({},e),{advancedFilters:n,searchTerm:""}))}resetAdvancedFilters(){let t=this.currentState;this.filterStateSubject.next(V(E({},t),{advancedFilters:E({},this.initialFilterState.advancedFilters),searchTerm:""}))}toggleAdvancedFilters(){let t=this.currentState;this.filterStateSubject.next(V(E({},t),{showAdvancedFilters:!t.showAdvancedFilters}))}clearAllFilters(){this.filterStateSubject.next(E({},this.initialFilterState))}hasActiveFilters(){let t=this.currentState;if(t.searchTerm.trim())return!0;for(let e in t.advancedFilters)if(Object.prototype.hasOwnProperty.call(t.advancedFilters,e)){let n=t.advancedFilters[e];if(typeof n=="string"&&n.trim()!==""||typeof n=="number"&&n!=null)return!0}return!1}getActiveFilters(){let t=[],e=this.currentState;if(e.searchTerm.trim()&&t.push({label:"Recherche",value:e.searchTerm,type:"search"}),e.advancedFilters.id.trim()&&t.push({label:"ID",value:e.advancedFilters.id,type:"filter",key:"id"}),e.advancedFilters.object.trim()&&t.push({label:"Objet",value:e.advancedFilters.object,type:"filter",key:"object"}),e.advancedFilters.domain){let i=this.appConfigService.findDomain(e.advancedFilters.domain)?.label||e.advancedFilters.domain;t.push({label:"Domaine",value:i,type:"filter",key:"domain"})}if(e.advancedFilters.gravity){let i=this.appConfigService.findGravity(e.advancedFilters.gravity)?.label||e.advancedFilters.gravity;t.push({label:"Gravit\xE9",value:i,type:"filter",key:"gravity"})}if(e.advancedFilters.status){let i=this.appConfigService.findStatus(e.advancedFilters.status)?.label||e.advancedFilters.status;t.push({label:"Statut",value:i,type:"filter",key:"status"})}if(e.advancedFilters.siteImpacte.trim()){let i=this.appConfigService.findSite(e.advancedFilters.siteImpacte)?.shortLabel||e.advancedFilters.siteImpacte;t.push({label:"Site Impact\xE9",value:i,type:"filter",key:"siteImpacte"})}if(e.advancedFilters.redacteur_id!==null&&e.advancedFilters.redacteur_id!==void 0&&t.push({label:"R\xE9dacteur",value:e.advancedFilters.redacteur_id.toString(),type:"filter",key:"redacteur_id"}),e.advancedFilters.intervenant_id!=null&&t.push({label:"Intervenant",value:e.advancedFilters.intervenant_id.toString(),type:"filter",key:"intervenant_id"}),e.advancedFilters.dateFrom){let n=this.formatDateForDisplay(e.advancedFilters.dateFrom);t.push({label:"Du",value:n,type:"filter",key:"dateFrom"})}if(e.advancedFilters.dateTo){let n=this.formatDateForDisplay(e.advancedFilters.dateTo);t.push({label:"Au",value:n,type:"filter",key:"dateTo"})}return t}removeFilter(t,e){if(e==="search")this.clearSearch();else switch(t){case"dateFrom":case"dateTo":this.setAdvancedFilter(t,"");break;case"redacteur_id":case"intervenant_id":this.setAdvancedFilter(t,null);break;default:this.setAdvancedFilter(t,"");break}}applyFilters(t){let e=this.currentState,n=[...t];return e.searchTerm.trim()&&(n=this.applyLocalSearch(n,e.searchTerm)),n=this.applyLocalFilters(n,e.advancedFilters),n}applyLocalSearch(t,e){if(!e.trim())return t;let n=e.toLowerCase().trim();return t.filter(i=>{if(i.id.toString().includes(n)||i.object.toLowerCase().includes(n)||i.redacteur_id?.toString().includes(n)||i.creator?.full_name?.toLowerCase().includes(n)||i.intervenant_id&&i.intervenant_id.toString().includes(n)||i.assignee?.full_name?.toLowerCase().includes(n)||i.ticketNumber&&i.ticketNumber.toLowerCase().includes(n)||i.domains&&i.domains.some(F=>F.toLowerCase().includes(n))||i.sitesImpactes&&i.sitesImpactes.some(F=>F.toLowerCase().includes(n)))return!0;let d=this.appConfigService.findGravity(i.gravity)?.label;if(d&&d.toLowerCase().includes(n))return!0;let x=this.appConfigService.findStatus(i.status)?.label;return!!(x&&x.toLowerCase().includes(n)||i.dateOuverture&&new Date(i.dateOuverture).toLocaleDateString("fr-FR").includes(n)||i.dateCloture&&new Date(i.dateCloture).toLocaleDateString("fr-FR").includes(n)||i.isNational&&("oui".includes(n)||"national".includes(n))||i.has_pending_actions&&"oui".includes(n)||!i.has_pending_actions&&"non".includes(n))})}applyLocalFilters(t,e){let n=[...t];if(e.id.trim()&&(n=n.filter(i=>i.id.toString().includes(e.id.trim()))),e.object.trim()&&(n=n.filter(i=>i.object.toLowerCase().includes(e.object.toLowerCase().trim()))),e.domain&&(n=n.filter(i=>i.domains.includes(e.domain))),e.gravity&&(n=n.filter(i=>i.gravity===e.gravity)),e.status&&e.status!=="archive"&&(n=n.filter(i=>i.status===e.status)),e.siteImpacte.trim()){let i=e.siteImpacte.toLowerCase().trim();n=n.filter(d=>d.sitesImpactes&&d.sitesImpactes.length>0?d.sitesImpactes.some(x=>{if(x.toLowerCase().includes(i))return!0;let F=this.appConfigService.findSite(x);return(F?.label?.toLowerCase().includes(i)??!1)||(F?.shortLabel?.toLowerCase().includes(i)??!1)}):!1)}return(e.dateFrom||e.dateTo)&&(n=n.filter(i=>{let d=i.dateOuverture;if(!d)return!1;let x=new Date(d).toISOString().split("T")[0],F=!e.dateFrom||x>=e.dateFrom,G=!e.dateTo||x<=e.dateTo;return F&&G})),e.redacteur_id!==null&&e.redacteur_id!==void 0&&(n=n.filter(i=>{if(typeof e.redacteur_id=="number")return i.redacteur_id===e.redacteur_id;if(typeof e.redacteur_id=="string"){let d=e.redacteur_id.toLowerCase().trim();return i.creator?.full_name?.toLowerCase().includes(d)}return!1})),e.intervenant_id!=null&&(n=n.filter(i=>{if(typeof e.intervenant_id=="number")return i.intervenant_id===e.intervenant_id;if(typeof e.intervenant_id=="string"){let d=e.intervenant_id.toLowerCase().trim();return i.assignee?.full_name?.toLowerCase().includes(d)}return!1})),n}getFilterDisplayValue(t,e){switch(t){case"domain":return this.appConfigService.findDomain(e)?.shortLabel??e;case"gravity":return this.appConfigService.findGravity(e)?.label??e;case"status":return this.appConfigService.findStatus(e)?.label??e;case"siteImpacte":return this.appConfigService.findSite(e)?.shortLabel??e;default:return e}}countByStatus(t,e){return t.filter(n=>n.status===e).length}formatDateForDisplay(t){if(!t)return"";try{return new Date(t).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"})}catch{return t}}static \u0275fac=function(e){return new(e||o)(Ee(te))};static \u0275prov=$({token:o,factory:o.\u0275fac,providedIn:"root"})};var ge=class o{defaultSortConfig={defaultColumn:"dateOuverture",defaultDirection:"desc",sortableColumns:[{key:"id",sortable:!0},{key:"object",sortable:!0},{key:"domains",sortable:!0},{key:"gravity",sortable:!0},{key:"status",sortable:!0},{key:"dateOuverture",sortable:!0},{key:"dateCloture",sortable:!0},{key:"sitesImpactes",sortable:!0},{key:"isNational",sortable:!0},{key:"ticketNumber",sortable:!0},{key:"redacteur_id",sortable:!0},{key:"intervenant_id",sortable:!0},{key:"has_pending_actions",sortable:!0}]};sortStateSubject=new O({column:this.defaultSortConfig.defaultColumn,direction:this.defaultSortConfig.defaultDirection});sortState$=this.sortStateSubject.asObservable();sortIcons=Le;constructor(){}get currentSortState(){return this.sortStateSubject.value}get sortColumn(){return this.currentSortState.column}get sortDirection(){return this.currentSortState.direction}sortBy(t){let e=this.currentSortState;if(e.column===t){let n=e.direction==="asc"?"desc":"asc";this.setSortState(t,n)}else this.setSortState(t,"asc")}setSortState(t,e){let n={column:t,direction:e};this.sortStateSubject.next(n)}resetToDefault(){let t={column:this.defaultSortConfig.defaultColumn,direction:this.defaultSortConfig.defaultDirection};this.sortStateSubject.next(t)}isSorted(t){return this.sortColumn===t}getSortIcon(t){return this.isSorted(t)?this.sortDirection==="asc"?this.sortIcons.ascending:this.sortIcons.descending:this.sortIcons.neutral}isSortable(t){return this.defaultSortConfig.sortableColumns.some(e=>e.key===t&&e.sortable)}applySorting(t){let e=this.currentSortState;return e.column?[...t].sort((n,i)=>{if(e.column==="dateCloture"){let x=!!n.dateCloture,F=!!i.dateCloture;if(x&&!F)return-1;if(!x&&F)return 1}let d=this.compareItems(n,i,e.column);return e.direction==="asc"?d:-d}):t}compareItems(t,e,n){let i,d;switch(n){case"id":i=t.id,d=e.id;break;case"object":i=t.object.toLowerCase(),d=e.object.toLowerCase();break;case"domains":i=t.domains[0]?.toLowerCase()||"",d=e.domains[0]?.toLowerCase()||"";break;case"gravity":i=ie[t.gravity].priority,d=ie[e.gravity].priority;break;case"status":i=be[t.status]?.priority||99,d=be[e.status]?.priority||99;break;case"dateOuverture":i=this.parseDateString(t.dateOuverture)?.getTime()||0,d=this.parseDateString(e.dateOuverture)?.getTime()||0;break;case"dateCloture":i=this.parseDateString(t.dateCloture)?.getTime()||0,d=this.parseDateString(e.dateCloture)?.getTime()||0;break;case"sitesImpactes":i=(t.sitesImpactes||[]).join(", ").toLowerCase(),d=(e.sitesImpactes||[]).join(", ").toLowerCase();break;case"isNational":i=t.isNational?1:0,d=e.isNational?1:0;break;case"ticketNumber":i=(t.ticketNumber||"").toLowerCase(),d=(e.ticketNumber||"").toLowerCase();break;case"redacteur_id":i=t.creator?.full_name?.toLowerCase()||"",d=e.creator?.full_name?.toLowerCase()||"";break;case"intervenant_id":i=t.assignee?.full_name?.toLowerCase()||"",d=e.assignee?.full_name?.toLowerCase()||"";break;case"has_pending_actions":i=t.has_pending_actions?1:0,d=e.has_pending_actions?1:0;break;default:return 0}return i<d?-1:i>d?1:0}parseDateString(t){if(!t)return null;if(t instanceof Date)return t;if(typeof t=="string"){let e=t.match(/(\d{2})\/(\d{2})\/(\d{4}) (\d{2}):(\d{2})/);if(e)return new Date(+e[3],+e[2]-1,+e[1],+e[4],+e[5]);try{let n=new Date(t);return isNaN(n.getTime())?null:n}catch{return null}}return null}static \u0275fac=function(e){return new(e||o)};static \u0275prov=$({token:o,factory:o.\u0275fac,providedIn:"root"})};var xe=class o{config=Pe;paginationStateSubject=new O({currentPage:1,pageSize:this.config.defaultPageSize,showAllResults:!1,totalItems:0});paginationState$=this.paginationStateSubject.asObservable();constructor(){}get currentState(){return this.paginationStateSubject.value}get currentPage(){return this.currentState.currentPage}get pageSize(){return this.currentState.pageSize}get showAllResults(){return this.currentState.showAllResults}get totalItems(){return this.currentState.totalItems}get availablePageSizes(){return this.config.availablePageSizes}setTotalItems(t){let e=this.currentState,n=V(E({},e),{totalItems:t}),i=this.calculateTotalPages(t,e.pageSize,e.showAllResults);e.currentPage>i&&i>0&&(n.currentPage=i),this.paginationStateSubject.next(n)}setPageSize(t){let e=this.currentState;if(t==="all"){let n=V(E({},e),{showAllResults:!0,currentPage:1});this.paginationStateSubject.next(n)}else{let n=V(E({},e),{pageSize:t,showAllResults:!1,currentPage:1});this.paginationStateSubject.next(n)}}getCurrentPageSize(){return this.currentState.pageSize}setCurrentPage(t){let e=this.currentState,n=this.getTotalPages();if(t>=1&&t<=n){let i=V(E({},e),{currentPage:t});this.paginationStateSubject.next(i)}}previousPage(){let t=this.currentPage;t>1&&this.setCurrentPage(t-1)}nextPage(){let t=this.currentPage,e=this.getTotalPages();t<e&&this.setCurrentPage(t+1)}resetToFirstPage(){this.setCurrentPage(1)}getTotalPages(){let t=this.currentState;return this.calculateTotalPages(t.totalItems,t.pageSize,t.showAllResults)}calculateTotalPages(t,e,n){return n||t===0?1:Math.ceil(t/e)}getVisiblePages(){let t=this.getTotalPages(),e=this.currentPage,n=this.config.maxVisiblePages,i=this.config.ellipsisThreshold,d=[];if(t<=n)for(let x=1;x<=t;x++)d.push(x);else if(e<=4){for(let x=1;x<=5;x++)d.push(x);t>i&&(d.push(-1),d.push(t))}else if(e>=t-3){d.push(1),t>i&&d.push(-1);for(let x=t-4;x<=t;x++)d.push(x)}else{d.push(1),d.push(-1);for(let x=e-1;x<=e+1;x++)d.push(x);d.push(-1),d.push(t)}return d}getPaginationInfo(){let t=this.currentState;if(t.showAllResults)return{startIndex:1,endIndex:t.totalItems,totalItems:t.totalItems,currentPage:1,totalPages:1,displayText:`Affichage de tous les ${t.totalItems} \xE9l\xE9ment(s)`};let e=(t.currentPage-1)*t.pageSize+1,n=Math.min(t.currentPage*t.pageSize,t.totalItems),i=this.getTotalPages();return{startIndex:e,endIndex:n,totalItems:t.totalItems,currentPage:t.currentPage,totalPages:i,displayText:`Affichage de ${e}-${n} sur ${t.totalItems} \xE9l\xE9ment(s)`}}paginateData(t){t.length!==this.totalItems&&this.setTotalItems(t.length);let e=this.currentState;if(e.showAllResults)return{items:t,pagination:this.getPaginationInfo()};let n=(e.currentPage-1)*e.pageSize,i=n+e.pageSize;return{items:t.slice(n,i),pagination:this.getPaginationInfo()}}canGoPrevious(){return this.currentPage>1}canGoNext(){return this.currentPage<this.getTotalPages()}isPaginationNeeded(){let t=this.currentState;return!t.showAllResults&&t.totalItems>t.pageSize}static \u0275fac=function(e){return new(e||o)};static \u0275prov=$({token:o,factory:o.\u0275fac,providedIn:"root"})};var ti=(o,t)=>({"bg-cyan-500 hover:bg-cyan-600":o,"bg-amber-500 hover:bg-amber-600":t}),ii=(o,t)=>({"bg-orange-500 hover:bg-orange-600":o,"bg-gray-500 hover:bg-gray-600":t}),ni=(o,t,e,n,i)=>({"bg-blue-50 text-blue-700":o,"bg-yellow-100":t,"bg-green-100":e,"border-r-2 border-blue-500":n,"header-multiline":i}),we=(o,t)=>t.key,fe=(o,t)=>t.value,oi=(o,t)=>t.label,ri=(o,t)=>t.id;function ai(o,t){o&1&&(r(0,"span"),l(1,"total"),a())}function li(o,t){o&1&&(r(0,"span"),l(1,"archiv\xE9s"),a())}function si(o,t){if(o&1&&(r(0,"span",12),l(1),a()),o&2){let e=c(2);s(),C(" ",e.getIncidentsByStatus("en_attente").length," En attente ")}}function di(o,t){if(o&1){let e=v();r(0,"button",42),p("click",function(){u(e);let i=c(2);return m(i.openExportXLSX())}),r(1,"span",23),l(2,"\u{1F4CA}"),a(),r(3,"span",24),l(4,"Export"),f(5,"br"),l(6,"Excel"),a()()}}function ci(o,t){if(o&1){let e=v();r(0,"button",43),p("click",function(){u(e);let i=c(2);return m(i.openExportPDF())}),r(1,"span",23),l(2,"\u{1F4C4}"),a(),r(3,"span",24),l(4,"Export"),f(5,"br"),l(6,"PDF"),a()()}}function ui(o,t){if(o&1){let e=v();r(0,"button",44),p("click",function(){u(e);let i=c(2);return m(i.toggleArchivedView())}),r(1,"span",23),l(2),a(),r(3,"span",24),l(4),f(5,"br"),l(6,"archives"),a()()}if(o&2){let e=c(2);h("ngClass",he(3,ti,e.filterState.advancedFilters.status!=="archive",e.filterState.advancedFilters.status==="archive")),s(2),w(e.filterState.advancedFilters.status==="archive"?"\u{1F4CB}":"\u{1F5C4}\uFE0F"),s(2),w((e.filterState.advancedFilters.status==="archive","Voir"))}}function mi(o,t){if(o&1){let e=v();r(0,"button",45),p("click",function(){u(e);let i=c(2);return m(i.openTrashModal())}),r(1,"span",23),l(2,"\u{1F5D1}\uFE0F"),a(),r(3,"span",24),l(4,"Voir"),f(5,"br"),l(6,"corbeille"),a()()}}function pi(o,t){if(o&1){let e=v();r(0,"button",46),p("click",function(){u(e);let i=c(2);return m(i.navigateToCreate())}),r(1,"span",23),l(2,"\u26A0\uFE0F"),a(),r(3,"span",24),l(4,"Ajouter"),f(5,"br"),l(6,"incident"),a()()}}function _i(o,t){if(o&1){let e=v();r(0,"button",47),p("click",function(){u(e);let i=c(2);return m(i.openDiffusionModal())}),r(1,"span",23),l(2,"\u{1F4E7}"),a(),r(3,"span",24),l(4,"Liste"),f(5,"br"),l(6,"diffusion"),a()()}}function gi(o,t){if(o&1){let e=v();r(0,"button",48),p("click",function(){u(e);let i=c(2);return m(i.goToDashboard())}),r(1,"span",23),l(2,"\u{1F4CA}"),a(),r(3,"span",24),l(4,"Tableau"),f(5,"br"),l(6,"de bord"),a()()}}function xi(o,t){if(o&1){let e=v();r(0,"button",44),p("click",function(){u(e);let i=c(2);return m(i.toggleAdminMode())}),r(1,"span",23),l(2),a(),r(3,"span",24),l(4),f(5,"br"),l(6,"gestion"),a()()}if(o&2){let e=c(2);h("ngClass",he(3,ii,!e.isAdminModeActive,e.isAdminModeActive)),s(2),w(e.isAdminModeActive?"\u{1F4CB}":"\u2699\uFE0F"),s(2),w(e.isAdminModeActive?"Quitter":"Mode")}}function fi(o,t){if(o&1){let e=v();r(0,"div",35)(1,"div",49)(2,"div",50),b(),r(3,"svg",51),f(4,"path",34),a()(),M(),r(5,"div",52)(6,"h4",53),l(7,"\u{1F4A1} Fonctionnalit\xE9s interactives"),a(),r(8,"ul",54)(9,"li",55),f(10,"span",56),r(11,"span")(12,"strong"),l(13,"R\xE9organiser :"),a(),l(14," Glissez-d\xE9posez les en-t\xEAtes"),a()(),r(15,"li",55),f(16,"span",56),r(17,"span")(18,"strong"),l(19,"Redimensionner :"),a(),l(20," Bordures droites des en-t\xEAtes"),a()(),r(21,"li",55),f(22,"span",56),r(23,"span")(24,"strong"),l(25,"Masquer/Afficher :"),a(),l(26,' \u2715 au survol ou "G\xE9rer colonnes"'),a()(),r(27,"li",55),f(28,"span",56),r(29,"span")(30,"strong"),l(31,"Trier :"),a(),l(32," Cliquez sur les en-t\xEAtes"),a()(),r(33,"li",55),f(34,"span",56),r(35,"span")(36,"strong"),l(37,"Exporter :"),a(),l(38," Excel / PDF avec filtres temporels"),a()(),r(39,"li",55),f(40,"span",57),r(41,"span")(42,"strong"),l(43,"Attention :"),a(),l(44," N\xB0TICKET & INTERVENANT sont masqu\xE9es par d\xE9faut"),a()(),r(45,"li",55),f(46,"span",58),r(47,"span")(48,"strong"),l(49,"Statut en attente :"),a(),l(50," Validation possible dans la colonne actions"),a()()(),r(51,"button",59),p("click",function(){u(e);let i=c(2);return m(i.showHelp=!1)}),l(52," Fermer "),a()()()()}}function vi(o,t){if(o&1){let e=v();r(0,"span",64)(1,"strong"),l(2),a(),l(3),r(4,"button",66),p("click",function(){let i=u(e).$implicit,d=c(3);return m(d.removeFilter(i.key||"",i.type))}),l(5," \xD7 "),a()()}if(o&2){let e=t.$implicit;s(2),C("",e.label,":"),s(),C("\xA0",e.value," ")}}function Ci(o,t){if(o&1){let e=v();r(0,"div",36)(1,"div",60)(2,"div",61)(3,"span",62),l(4,"Filtres actifs :"),a(),r(5,"div",63),S(6,vi,6,2,"span",64,we),a()(),r(8,"button",65),p("click",function(){u(e);let i=c(2);return m(i.clearAllFilters())}),l(9," \u{1F5D1}\uFE0F Effacer tous les filtres "),a()()()}if(o&2){let e=c(2);s(6),y(e.getActiveFilters())}}function hi(o,t){if(o&1){let e=v();r(0,"div",73)(1,"span",77),l(2),a(),r(3,"button",78),p("click",function(i){let d=u(e).$implicit,x=c(3);return i.stopPropagation(),m(x.toggleColumnVisibilityKeepOpen(d.key))}),l(4," Masquer "),a()()}if(o&2){let e=t.$implicit;s(2),w(e.label)}}function bi(o,t){if(o&1){let e=v();r(0,"div",73)(1,"span",79),l(2),a(),r(3,"button",80),p("click",function(i){let d=u(e).$implicit,x=c(4);return i.stopPropagation(),m(x.toggleColumnVisibilityKeepOpen(d.key))}),l(4," Afficher "),a()()}if(o&2){let e=t.$implicit;s(2),w(e.label)}}function Si(o,t){if(o&1&&(r(0,"div",74)(1,"h4",71),l(2,"Colonnes masqu\xE9es"),a(),r(3,"div",72),S(4,bi,5,1,"div",73,j),a()()),o&2){let e=c(3);s(4),y(e.hiddenColumns)}}function yi(o,t){if(o&1){let e=v();r(0,"div",67)(1,"div",68)(2,"h3",69),l(3,"Gestion des colonnes"),a()(),r(4,"div",70)(5,"h4",71),l(6,"Colonnes affich\xE9es"),a(),r(7,"div",72),S(8,hi,5,1,"div",73,j),a()(),_(10,Si,6,0,"div",74),r(11,"div",75)(12,"button",76),p("click",function(){u(e);let i=c(2);return m(i.resetColumnsAndCloseMenu())}),l(13," R\xE9initialiser par d\xE9faut "),a()()()}if(o&2){let e=c(2);ke("left",e.columnMenuPosition.x,"px")("top",e.columnMenuPosition.y,"px"),s(8),y(e.visibleColumns),s(2),g(e.hiddenColumns.length>0?10:-1)}}function wi(o,t){if(o&1&&(r(0,"option",88),l(1),a()),o&2){let e=t.$implicit;h("value",e.value),s(),C(" ",e.label," ")}}function Ei(o,t){if(o&1&&(r(0,"option",88),l(1),a()),o&2){let e=t.$implicit;h("value",e.value),s(),C(" ",e.label," ")}}function Ii(o,t){if(o&1&&(r(0,"option",88),l(1),a()),o&2){let e=t.$implicit;h("value",e.value),s(),C(" ",e.label," ")}}function Ti(o,t){if(o&1&&(r(0,"option",88),l(1),a()),o&2){let e=t.$implicit;h("value",e.value),s(),C(" ",e.label," ")}}function Di(o,t){if(o&1&&(r(0,"optgroup",89),S(1,Ti,2,2,"option",88,fe),a()),o&2){let e=t.$implicit;h("label",e.label),s(),y(e.options)}}function ki(o,t){if(o&1){let e=v();r(0,"div",38)(1,"h3",81),l(2,"Recherche avanc\xE9e"),a(),r(3,"div",82)(4,"div")(5,"label",83),l(6,"ID"),a(),r(7,"input",84),k("ngModelChange",function(i){u(e);let d=c(2);return D(d.advancedFilters.id,i)||(d.advancedFilters.id=i),m(i)}),p("input",function(i){u(e);let d=c(2);return m(d.setAdvancedFilter("id",i.target.value))}),a()(),r(8,"div")(9,"label",83),l(10,"Objet"),a(),r(11,"input",85),k("ngModelChange",function(i){u(e);let d=c(2);return D(d.advancedFilters.object,i)||(d.advancedFilters.object=i),m(i)}),p("input",function(i){u(e);let d=c(2);return m(d.setAdvancedFilter("object",i.target.value))}),a()(),r(12,"div")(13,"label",83),l(14,"Domaine"),a(),r(15,"select",86),k("ngModelChange",function(i){u(e);let d=c(2);return D(d.advancedFilters.domain,i)||(d.advancedFilters.domain=i),m(i)}),p("change",function(i){u(e);let d=c(2);return m(d.setAdvancedFilter("domain",i.target.value))}),r(16,"option",87),l(17,"Tous"),a(),S(18,wi,2,2,"option",88,fe),a()(),r(20,"div")(21,"label",83),l(22,"Gravit\xE9"),a(),r(23,"select",86),k("ngModelChange",function(i){u(e);let d=c(2);return D(d.advancedFilters.gravity,i)||(d.advancedFilters.gravity=i),m(i)}),p("change",function(i){u(e);let d=c(2);return m(d.setAdvancedFilter("gravity",i.target.value))}),r(24,"option",87),l(25,"Tous"),a(),S(26,Ei,2,2,"option",88,fe),a()(),r(28,"div")(29,"label",83),l(30,"Statut"),a(),r(31,"select",86),k("ngModelChange",function(i){u(e);let d=c(2);return D(d.advancedFilters.status,i)||(d.advancedFilters.status=i),m(i)}),p("change",function(i){u(e);let d=c(2);return m(d.setAdvancedFilter("status",i.target.value))}),r(32,"option",87),l(33,"Tous (hors archives)"),a(),S(34,Ii,2,2,"option",88,fe),a()(),r(36,"div")(37,"label",83),l(38,"Sites impact\xE9s"),a(),r(39,"select",86),k("ngModelChange",function(i){u(e);let d=c(2);return D(d.advancedFilters.siteImpacte,i)||(d.advancedFilters.siteImpacte=i),m(i)}),p("change",function(i){u(e);let d=c(2);return m(d.setAdvancedFilter("siteImpacte",i.target.value))}),r(40,"option",87),l(41,"Tous les sites"),a(),S(42,Di,3,1,"optgroup",89,oi),a()(),r(44,"div")(45,"label",83),l(46,"R\xE9dacteur"),a(),r(47,"input",90),k("ngModelChange",function(i){u(e);let d=c(2);return D(d.advancedFilters.redacteur_id,i)||(d.advancedFilters.redacteur_id=i),m(i)}),p("input",function(i){u(e);let d=c(2);return m(d.setAdvancedFilter("redacteur_id",i.target.value))}),a()(),r(48,"div")(49,"label",83),l(50,"Intervenant (\xE0 afficher dans \u{1F527} Colonnes)"),a(),r(51,"input",91),k("ngModelChange",function(i){u(e);let d=c(2);return D(d.advancedFilters.intervenant_id,i)||(d.advancedFilters.intervenant_id=i),m(i)}),p("input",function(i){u(e);let d=c(2);return m(d.setAdvancedFilter("intervenant_id",i.target.value))}),a()(),r(52,"div")(53,"label",92),l(54,"De la date du (sur date d'ouverture)"),a(),r(55,"input",93),p("change",function(i){u(e);let d=c(2);return m(d.setAdvancedFilter("dateFrom",i.target.value))}),a()(),r(56,"div")(57,"label",94),l(58,"A la date au (sur date d'ouverture)"),a(),r(59,"input",95),p("change",function(i){u(e);let d=c(2);return m(d.setAdvancedFilter("dateTo",i.target.value))}),a()(),r(60,"div",96)(61,"button",97),p("click",function(){u(e);let i=c(2);return m(i.resetAdvancedFilters())}),l(62," R\xE9initialiser "),a()()()()}if(o&2){let e=c(2);s(7),T("ngModel",e.advancedFilters.id),s(4),T("ngModel",e.advancedFilters.object),s(4),T("ngModel",e.advancedFilters.domain),s(3),y(e.getDomainFilterOptions()),s(5),T("ngModel",e.advancedFilters.gravity),s(3),y(e.getGravityFilterOptions()),s(5),T("ngModel",e.advancedFilters.status),s(3),y(e.getStatusFilterOptions()),s(5),T("ngModel",e.advancedFilters.siteImpacte),s(3),y(e.getGroupedSiteOptions()),s(5),T("ngModel",e.advancedFilters.redacteur_id),s(4),T("ngModel",e.advancedFilters.intervenant_id),s(4),h("value",e.advancedFilters.dateFrom),s(4),h("value",e.advancedFilters.dateTo)}}function Fi(o,t){o&1&&(r(0,"div",40),f(1,"div",98),r(2,"p",99),l(3,"Chargement des incidents..."),a()())}function Mi(o,t){if(o&1&&(r(0,"span",120),l(1),a()),o&2){let e=c().$implicit,n=c(3);s(),w(n.getSortIcon(e.key))}}function Vi(o,t){o&1&&f(0,"div",121)}function Li(o,t){if(o&1){let e=v();r(0,"th",118),p("click",function(){let i=u(e).$implicit,d=c(3);return m(i.sortable&&d.sortBy(i.key))})("dragstart",function(i){let d=u(e).$implicit,x=c(3);return m(x.startColumnDrag(i,d.key))})("dragover",function(i){let d=u(e).$implicit,x=c(3);return m(x.onColumnDragOver(i,d.key))})("drop",function(i){let d=u(e).$implicit,x=c(3);return m(x.onColumnDrop(i,d.key))})("dragend",function(){u(e);let i=c(3);return m(i.resetDragState())}),r(1,"div",119)(2,"span"),l(3),a(),_(4,Mi,2,1,"span",120),a(),_(5,Vi,1,0,"div",121),r(6,"div",122),p("mousedown",function(i){let d=u(e).$implicit,x=c(3);return m(x.startResize(i,d.key))}),a(),r(7,"div",123)(8,"button",124),p("click",function(i){let d=u(e).$implicit,x=c(3);return i.stopPropagation(),m(x.toggleColumnVisibility(d.key))}),l(9," \u2715 "),a()()()}if(o&2){let e=t.$implicit,n=c(3);Ce(n.getColumnStyle(e.key)),h("ngClass",Fe(6,ni,n.isSorted(e.key),n.isDragging(e.key),n.isDragOver(e.key),n.isResizing(e.key),e.key==="dateOuverture"||e.key==="dateCloture")),s(3),w(e.label),s(),g(e.sortable?4:-1),s(),g(n.isDragging(e.key)?5:-1)}}function Pi(o,t){o&1&&(r(0,"th",104),l(1," Actions "),a())}function Ai(o,t){o&1&&(r(0,"p",131),l(1," Aucun incident ne correspond \xE0 vos crit\xE8res de recherche. "),f(2,"br"),l(3,"Essayez de modifier ou supprimer certains filtres. "),a())}function Oi(o,t){o&1&&(r(0,"p",131),l(1," Il n'y a actuellement aucun incident de s\xE9curit\xE9 enregistr\xE9. "),a())}function ji(o,t){if(o&1){let e=v();r(0,"div",132)(1,"button",133),p("click",function(){u(e);let i=c(4);return m(i.clearAllFilters())}),l(2," \u{1F5D1}\uFE0F Effacer tous les filtres "),a(),r(3,"button",134),p("click",function(){u(e);let i=c(4);return m(i.toggleAdvancedSearch())}),l(4," \u{1F50D} Modifier la recherche "),a()()}}function $i(o,t){if(o&1){let e=v();r(0,"div")(1,"button",133),p("click",function(){u(e);let i=c(4);return m(i.navigateToCreate())}),l(2," \u26A0\uFE0F Ajouter le premier incident "),a()()}}function zi(o,t){if(o&1&&(r(0,"tr")(1,"td",125)(2,"div",126),b(),r(3,"svg",127),f(4,"path",128),a(),M(),r(5,"div",129)(6,"h3",130),l(7),a(),_(8,Ai,4,0,"p",131),_(9,Oi,2,0,"p",131),_(10,ji,5,0,"div",132),_(11,$i,3,0,"div"),a()()()()),o&2){let e=c(3);s(),De("colspan",e.visibleColumns.length+(e.isAdminModeActive?1:0)),s(6),C(" ",e.hasActiveFilters()?"Aucun incident trouv\xE9":"Aucun incident enregistr\xE9"," "),s(),g(e.hasActiveFilters()?8:-1),s(),g(e.hasActiveFilters()?-1:9),s(),g(e.hasActiveFilters()?10:-1),s(),g(!e.hasActiveFilters()&&e.permissionService.canCreateIncident()?11:-1)}}function Ri(o,t){if(o&1&&(r(0,"span",139),l(1),a()),o&2){let e=c(2).$implicit;s(),C(" #",e.id," ")}}function Ni(o,t){if(o&1&&(r(0,"div",140)(1,"div",147),l(2),a()()),o&2){let e=c(2).$implicit;s(),h("title",e.object),s(),C(" ",e.object," ")}}function Bi(o,t){if(o&1&&(r(0,"span",148),l(1),a()),o&2){let e=t.$implicit,n=c(6);s(),C(" ",n.getShortDomain(e)," ")}}function Wi(o,t){if(o&1&&(r(0,"div",141),S(1,Bi,2,1,"span",148,j),a()),o&2){let e=c(2).$implicit;s(),y(e.domains)}}function Gi(o,t){if(o&1&&l(0),o&2){let e=c(3).$implicit,n=c(3);C(" ",n.gravityConfig[e.gravity].label," ")}}function Hi(o,t){if(o&1&&(r(0,"span",142),_(1,Gi,1,1),a()),o&2){let e=c(2).$implicit,n=c(3);h("ngClass",e.gravity?n.gravityConfig[e.gravity].colorClass:""),s(),g(e.gravity?1:-1)}}function Yi(o,t){if(o&1&&(r(0,"span",149),l(1," En attente"),f(2,"br"),l(3,"de validation "),a()),o&2){let e=c(3).$implicit,n=c(3);h("ngClass",n.getStatusTextClass(e.status))}}function Ui(o,t){if(o&1&&(r(0,"span",150),l(1),a()),o&2){let e=c(3).$implicit,n=c(3);h("ngClass",n.getStatusTextClass(e.status)),s(),C(" ",n.statusConfig[e.status].label," ")}}function Xi(o,t){if(o&1&&_(0,Yi,4,1,"span",149)(1,Ui,2,2,"span",150),o&2){let e=c(2).$implicit;g(e.status==="en_attente"?0:1)}}function qi(o,t){if(o&1&&(r(0,"div",143)(1,"div",151),l(2),a(),r(3,"div",152),l(4),a()()),o&2){let e=c(2).$implicit,n=c(3);s(2),w(n.incidentDisplayService.formatDateShort(e.dateOuverture)),s(2),w(n.incidentDisplayService.formatTimeShort(e.dateOuverture))}}function Ji(o,t){if(o&1&&(r(0,"div",151),l(1),a(),r(2,"div",152),l(3),a()),o&2){let e=c(3).$implicit,n=c(3);s(),w(n.incidentDisplayService.formatDateShort(e.dateCloture)),s(2),C("",n.incidentDisplayService.formatTimeShort(e.dateCloture)," ")}}function Zi(o,t){o&1&&(r(0,"div",153),l(1,"-"),a())}function Qi(o,t){if(o&1&&(r(0,"div",143),_(1,Ji,4,2)(2,Zi,2,0,"div",153),a()),o&2){let e=c(2).$implicit;s(),g(e.dateCloture?1:2)}}function Ki(o,t){if(o&1&&(r(0,"span",154),l(1),a()),o&2){let e=t.$implicit,n=c(7);h("title",e),s(),C(" ",n.getShortSiteImpacte(e)," ")}}function en(o,t){if(o&1&&(r(0,"div",141),S(1,Ki,2,2,"span",154,j),a()),o&2){let e=c(3).$implicit;s(),y(e.sitesImpactes)}}function tn(o,t){o&1&&(r(0,"div",153),l(1," - "),a())}function nn(o,t){if(o&1&&(r(0,"div",72),_(1,en,3,0,"div",141)(2,tn,2,0,"div",153),a()),o&2){let e=c(2).$implicit;s(),g(e.sitesImpactes&&e.sitesImpactes.length>0?1:2)}}function on(o,t){o&1&&(r(0,"span",155),l(1," Oui "),a())}function rn(o,t){o&1&&(r(0,"div",153),l(1,"-"),a())}function an(o,t){if(o&1&&_(0,on,2,0,"span",155)(1,rn,2,0,"div",153),o&2){let e=c(2).$implicit;g(e.isNational?0:1)}}function ln(o,t){if(o&1&&(r(0,"div",144),l(1),a()),o&2){let e=c(2).$implicit;h("title",e.ticketNumber),s(),C(" ",e.ticketNumber||"-"," ")}}function sn(o,t){if(o&1&&(r(0,"div",145),l(1),a()),o&2){let e=c(2).$implicit;h("title",e.creator==null?null:e.creator.full_name),s(),C(" ",(e.creator==null?null:e.creator.full_name)||"-"," ")}}function dn(o,t){if(o&1&&(r(0,"div",145),l(1),a()),o&2){let e=c(2).$implicit;h("title",e.assignee==null?null:e.assignee.full_name),s(),C(" ",(e.assignee==null?null:e.assignee.full_name)||"-"," ")}}function cn(o,t){if(o&1&&(r(0,"span",146),l(1),a()),o&2){let e=c(2).$implicit;h("ngClass",e.has_pending_actions?"text-red-600":"text-green-600"),s(),C(" ",e.has_pending_actions?"Oui":"Non"," ")}}function un(o,t){if(o&1&&(r(0,"td",138),_(1,Ri,2,1,"span",139)(2,Ni,3,2,"div",140)(3,Wi,3,0,"div",141)(4,Hi,2,2,"span",142)(5,Xi,2,1)(6,qi,5,2,"div",143)(7,Qi,3,1,"div",143)(8,nn,3,1,"div",72)(9,an,2,1)(10,ln,2,2,"div",144)(11,sn,2,2,"div",145)(12,dn,2,2,"div",145)(13,cn,2,2,"span",146),a()),o&2){let e,n=t.$implicit,i=c(4);Ce(i.getColumnStyle(n.key)),s(),g((e=n.key)==="id"?1:e==="object"?2:e==="domains"?3:e==="gravity"?4:e==="status"?5:e==="dateOuverture"?6:e==="dateCloture"?7:e==="sitesImpactes"?8:e==="isNational"?9:e==="ticketNumber"?10:e==="redacteur_id"?11:e==="intervenant_id"?12:e==="has_pending_actions"?13:-1)}}function mn(o,t){o&1&&(b(),r(0,"svg",164),f(1,"path",166),a())}function pn(o,t){o&1&&(b(),r(0,"svg",165),f(1,"path",167),a())}function _n(o,t){if(o&1){let e=v();r(0,"button",163),p("click",function(){u(e);let i=c(2).$implicit,d=c(3);return m(d.validateIncident(i))}),_(1,mn,2,0,":svg:svg",164)(2,pn,2,0,":svg:svg",165),a()}if(o&2){let e=c(2).$implicit,n=c(3);h("disabled",n.validating===e.id),s(),g(n.validating===e.id?1:2)}}function gn(o,t){if(o&1){let e=v();r(0,"button",168),p("click",function(){u(e);let i=c(2).$implicit,d=c(3);return m(d.navigateToUpdate(i))}),b(),r(1,"svg",165),f(2,"path",169),a()()}}function xn(o,t){if(o&1){let e=v();r(0,"button",170),p("click",function(){u(e);let i=c(2).$implicit,d=c(3);return m(d.archiveIncident(i))}),b(),r(1,"svg",165),f(2,"path",171),a()()}}function fn(o,t){if(o&1){let e=v();r(0,"button",172),p("click",function(){u(e);let i=c(2).$implicit,d=c(3);return m(d.restoreIncident(i))}),b(),r(1,"svg",165),f(2,"path",173)(3,"path",174),a()()}}function vn(o,t){if(o&1){let e=v();r(0,"button",175),p("click",function(){u(e);let i=c(2).$implicit,d=c(3);return m(d.deleteIncident(i))}),b(),r(1,"svg",165),f(2,"path",176),a()()}}function Cn(o,t){if(o&1){let e=v();r(0,"td",156),p("click",function(i){return u(e),m(i.stopPropagation())}),r(1,"div",157),_(2,_n,3,2,"button",158),_(3,gn,3,0,"button",159),_(4,xn,3,0,"button",160),_(5,fn,4,0,"button",161),_(6,vn,3,0,"button",162),a()()}if(o&2){let e=c().$implicit,n=c(3);s(2),g(n.permissionService.canValidateIncidents()&&n.needsValidation(e)?2:-1),s(),g(n.permissionService.canModifyIncident()?3:-1),s(),g(n.permissionService.canArchiveIncidents()&&e.status==="cloture"&&n.filterState.advancedFilters.status!=="archive"?4:-1),s(),g(n.permissionService.canUnarchiveIncidents()&&n.filterState.advancedFilters.status==="archive"?5:-1),s(),g(n.permissionService.canSoftDeleteIncident()?6:-1)}}function hn(o,t){if(o&1){let e=v();r(0,"tr",135),p("click",function(){let i=u(e).$implicit,d=c(3);return m(d.viewIncidentDetail(i))}),S(1,un,14,3,"td",136,we),_(3,Cn,7,5,"td",137),a()}if(o&2){let e=c(3);s(),y(e.visibleColumns),s(2),g(e.isAdminModeActive?3:-1)}}function bn(o,t){if(o&1&&(r(0,"option",113),l(1),a()),o&2){let e=t.$implicit,n=c(3);h("value",e)("selected",e===n.pageSize),s(),w(e)}}function Sn(o,t){if(o&1){let e=v();r(0,"button",180),p("click",function(){let i=u(e).$implicit,d=c(4);return m(i>0?d.goToPage(i):null)}),l(1),a()}if(o&2){let e=t.$implicit,n=c(4);P("bg-blue-600",e===n.currentPage)("text-white",e===n.currentPage)("border-blue-600",e===n.currentPage)("bg-white",e!==n.currentPage&&e>0)("text-gray-700",e!==n.currentPage&&e>0)("border-gray-300",e!==n.currentPage&&e>0)("hover:bg-gray-50",e!==n.currentPage&&e>0)("text-gray-400",e===-1)("cursor-default",e===-1),h("disabled",e===-1),s(),C(" ",e===-1?"...":e," ")}}function yn(o,t){if(o&1){let e=v();r(0,"div",116)(1,"button",177),p("click",function(){u(e);let i=c(3);return m(i.previousPage())}),l(2," \u2190 Pr\xE9c\xE9dent "),a(),r(3,"div",178),S(4,Sn,2,20,"button",179,j),a(),r(6,"button",177),p("click",function(){u(e);let i=c(3);return m(i.nextPage())}),l(7," Suivant \u2192 "),a()()}if(o&2){let e=c(3);s(),P("opacity-50",e.currentPage===1)("cursor-not-allowed",e.currentPage===1),h("disabled",e.currentPage===1),s(3),y(e.visiblePages),s(2),P("opacity-50",e.currentPage===e.totalPages)("cursor-not-allowed",e.currentPage===e.totalPages),h("disabled",e.currentPage===e.totalPages)}}function wn(o,t){o&1&&(r(0,"div",117),l(1," Tous les incidents sont affich\xE9s "),a())}function En(o,t){if(o&1){let e=v();r(0,"div",41)(1,"div",100)(2,"table",101)(3,"thead",102)(4,"tr"),S(5,Li,10,12,"th",103,we),_(7,Pi,2,0,"th",104),a()(),r(8,"tbody",105),_(9,zi,12,6,"tr"),S(10,hn,4,1,"tr",106,ri),a()()(),r(12,"div",107)(13,"div",108)(14,"div",109)(15,"div",110),l(16),a(),r(17,"div",111)(18,"select",112),p("change",function(i){u(e);let d=c(2);return m(d.onPageSizeChange(i))}),S(19,bn,2,3,"option",113,j),r(21,"option",114),l(22,"Tout"),a()(),r(23,"span",115),l(24,"par page"),a()()(),_(25,yn,8,10,"div",116),_(26,wn,2,0,"div",117),a()()()}if(o&2){let e=c(2);s(5),y(e.visibleColumns),s(2),g(e.isAdminModeActive?7:-1),s(2),g(e.paginatedIncidents.length===0?9:-1),s(),y(e.paginatedIncidents),s(6),C(" ",e.getPaginationInfo()," "),s(2),h("value",e.pageSize),s(),y(e.availablePageSizes),s(2),h("selected",e.showAllResults),s(4),g(!e.showAllResults&&e.totalPages>1?25:-1),s(),g(e.showAllResults?26:-1)}}function In(o,t){if(o&1){let e=v();r(0,"div",5)(1,"h1",6),l(2,"Base d'Incidents S\xE9curit\xE9"),a(),r(3,"div",7)(4,"span",8)(5,"strong"),l(6,"Gestion des incidents de s\xE9curit\xE9 URSSAF :"),a(),l(7),_(8,ai,2,0,"span")(9,li,2,0,"span"),a(),r(10,"div",9)(11,"span",10),l(12),a(),r(13,"span",11),l(14),a(),_(15,si,2,1,"span",12),a()()(),r(16,"div",13)(17,"div",14),_(18,di,7,0,"button",15),_(19,ci,7,0,"button",16),_(20,ui,7,6,"button",17),_(21,mi,7,0,"button",18),_(22,pi,7,0,"button",19),_(23,_i,7,0,"button",20),_(24,gi,7,0,"button",21),_(25,xi,7,6,"button",17),r(26,"button",22),p("click",function(i){u(e);let d=c();return m(d.showColumnsMenu(i))}),r(27,"span",23),l(28,"\u{1F527}"),a(),r(29,"span",24),l(30,"G\xE9rer"),f(31,"br"),l(32,"colonnes"),a()(),r(33,"button",25),p("click",function(){u(e);let i=c();return m(i.toggleAdvancedSearch())}),r(34,"span",23),l(35,"\u{1F50D}"),a(),r(36,"span",24),l(37,"Recherche"),f(38,"br"),l(39,"avanc\xE9e"),a()()(),r(40,"div",26)(41,"div",27)(42,"input",28),k("ngModelChange",function(i){u(e);let d=c();return D(d.searchTerm,i)||(d.searchTerm=i),m(i)}),p("input",function(){u(e);let i=c();return m(i.onSearch())}),a(),r(43,"div",29),b(),r(44,"svg",30),f(45,"path",31),a()()(),M(),r(46,"div",27)(47,"button",32),p("click",function(){u(e);let i=c();return m(i.toggleHelp())})("mouseenter",function(){u(e);let i=c();return m(i.showTooltip=!0)})("mouseleave",function(){u(e);let i=c();return m(i.showTooltip=!1)}),b(),r(48,"svg",33),f(49,"path",34),a()(),_(50,fi,53,0,"div",35),a()()(),_(51,Ci,10,0,"div",36),_(52,yi,14,5,"div",37),_(53,ki,63,10,"div",38),M(),f(54,"div",39),_(55,Fi,4,0,"div",40),_(56,En,27,7,"div",41)}if(o&2){let e=c();s(7),C(" ",e.incidents.length," incidents "),s(),g(e.filterState.advancedFilters.status!=="archive"?8:9),s(2),P("invisible",e.filterState.advancedFilters.status==="archive"),s(2),C(" ",e.getIncidentsByStatus("en_cours").length," En cours "),s(2),C(" ",e.getIncidentsByStatus("cloture").length," Clotur\xE9s "),s(),g(e.incidentsEnAttente.length>0?15:-1),s(3),g(e.permissionService.canExportData()?18:-1),s(),g(e.permissionService.canExportData()?19:-1),s(),g(e.permissionService.canViewArchives()?20:-1),s(),g(e.permissionService.canViewTrash()?21:-1),s(),g(e.permissionService.canCreateIncident()?22:-1),s(),g(e.permissionService.canManageEmails()?23:-1),s(),g(e.permissionService.canViewDashboard()?24:-1),s(),g(e.permissionService.canModifyIncident()||e.permissionService.canForceDeleteIncident()||e.permissionService.canArchiveIncidents()||e.permissionService.canValidateIncidents()?25:-1),s(17),T("ngModel",e.searchTerm),s(8),g(e.showTooltip||e.showHelp?50:-1),s(),g(e.hasActiveFilters()?51:-1),s(),g(e.showColumnMenu?52:-1),s(),g(e.showAdvancedFilters?53:-1),s(2),g(e.isLoadingTable?55:-1),s(),g(e.isLoadingTable?-1:56)}}function Tn(o,t){if(o&1){let e=v();r(0,"div",2)(1,"div",181)(2,"div",182)(3,"div",183),b(),r(4,"svg",184),f(5,"path",185),a()()(),M(),r(6,"h2",186),l(7," Acc\xE8s non autoris\xE9 "),a(),r(8,"p",187),l(9," Vous n'avez pas les permissions n\xE9cessaires pour acc\xE9der \xE0 la base d'incidents de s\xE9curit\xE9. "),a(),r(10,"div",188)(11,"p",189)(12,"strong"),l(13,"Raison possible :"),a()(),r(14,"ul",190)(15,"li"),l(16,"Votre r\xF4le n'autorise pas la consultation des incidents"),a(),r(17,"li"),l(18,"Votre session a peut-\xEAtre expir\xE9"),a(),r(19,"li"),l(20,"Vos droits ont \xE9t\xE9 modifi\xE9s r\xE9cemment"),a()()(),r(21,"div",52)(22,"button",191),p("click",function(){u(e);let i=c();return m(i.authService.reconnect())}),b(),r(23,"svg",33),f(24,"path",192),a(),l(25," Se reconnecter "),a()(),M(),r(26,"p",193),l(27," Si vous pensez qu'il s'agit d'une erreur, contactez votre administrateur syst\xE8me. "),a()()()}}var ze=class o{constructor(t,e,n,i,d,x,F,G,Dn,kn,Fn,Mn){this.router=t;this.columnService=e;this.filterService=n;this.sortingService=i;this.paginationService=d;this.incidentDataService=x;this.notificationService=F;this.appConfigService=G;this.exportService=Dn;this.permissionService=kn;this.incidentDisplayService=Fn;this.authService=Mn}destroy$=new H;goToDashboard(){this.router.navigate(["/dashboard"])}incidents=[];incidentsEnCours=[];incidentsClotures=[];incidentsEnAttente=[];filteredIncidents=[];paginatedResult={items:[],pagination:{startIndex:0,endIndex:0,totalItems:0,currentPage:1,totalPages:1,displayText:""}};get gravityConfig(){return this.incidentDisplayService.gravityConfig}get statusConfig(){return this.incidentDisplayService.statusConfig}isAdminModeActive=!1;isLoadingTable=!1;showHelp=!1;showTooltip=!1;validating=null;showDiffusionModal=!1;showTrashModal=!1;showExportModal=!1;exportModalType="xlsx";visibleColumns=[];hiddenColumns=[];dragState={draggingColumn:null,dragOverColumn:null};resizeState={resizingColumn:null,resizeStartX:0,resizeStartWidth:0};menuState={show:!1,position:{x:0,y:0}};filterState={searchTerm:"",advancedFilters:{id:"",object:"",domain:"",gravity:"",status:"",siteImpacte:"",redacteur_id:null,intervenant_id:null,dateFrom:"",dateTo:""},showAdvancedFilters:!1};sortState={column:"dateOuverture",direction:"desc"};paginationState={currentPage:1,pageSize:10,showAllResults:!1,totalItems:0};ngOnInit(){this.subscribeToServices(),this.loadIncidents()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}loadIncidents(t=!1){this.isLoadingTable=!0;let e=this.filterService.currentState,n={search:e.searchTerm||"",status:e.advancedFilters.status||"",gravite:e.advancedFilters.gravity||"",siteImpacte:e.advancedFilters.siteImpacte||"",dateFrom:e.advancedFilters.dateFrom||"",dateTo:e.advancedFilters.dateTo||"",showArchived:e.advancedFilters.status==="archive"};this.incidentDataService.loadIncidents(n,t).pipe(L(this.destroy$)).subscribe({next:i=>{this.incidents=i,this.paginationService.setTotalItems(i.length),this.incidentsEnCours=this.incidents.filter(d=>d.status==="en_cours"),this.incidentsClotures=this.incidents.filter(d=>d.status==="cloture"),this.incidentsEnAttente=this.incidents.filter(d=>d.status==="en_attente"),this.applyFiltersAndSort(),this.isLoadingTable=!1},error:i=>{console.error("Error loading incidents:",i),this.notificationService.error("Erreur de chargement","Impossible de charger les incidents."),this.isLoadingTable=!1}})}subscribeToServices(){this.incidentDataService.incidents.pipe(L(this.destroy$)).subscribe(e=>{this.incidents=e,this.paginationService.setTotalItems(e.length),this.applyFiltersAndSort()}),this.columnService.columns$.pipe(L(this.destroy$)).subscribe(()=>{this.visibleColumns=this.columnService.getVisibleColumns(),this.hiddenColumns=this.columnService.getHiddenColumns()}),this.columnService.dragState$.pipe(L(this.destroy$)).subscribe(e=>this.dragState=e),this.columnService.resizeState$.pipe(L(this.destroy$)).subscribe(e=>this.resizeState=e),this.columnService.menuState$.pipe(L(this.destroy$)).subscribe(e=>this.menuState=e);let t=this.filterState.advancedFilters.status;this.filterService.filterState$.pipe(L(this.destroy$)).subscribe(e=>{let n=e.advancedFilters.status;this.filterState=e,t!==n?(t=n,this.loadIncidents(!0)):this.applyFiltersAndSort()}),this.sortingService.sortState$.pipe(L(this.destroy$)).subscribe(e=>{this.sortState=e,this.applyFiltersAndSort()}),this.paginationService.paginationState$.pipe(L(this.destroy$)).subscribe(e=>{this.paginationState=e,this.applyPagination()})}openExportXLSX(){this.exportModalType="xlsx",this.showExportModal=!0}openExportPDF(){this.exportModalType="pdf",this.showExportModal=!0}closeExportModal(){this.showExportModal=!1}onExportExecute(t){t.type==="xlsx"?this.exportService.exportToXLSX(this.incidents,this.filteredIncidents,t):this.exportService.exportToPDF(this.incidents,this.filteredIncidents,t)}openDiffusionModal(){this.showDiffusionModal=!0}closeDiffusionModal(){this.showDiffusionModal=!1}openTrashModal(){this.showTrashModal=!0}closeTrashModal(){this.showTrashModal=!1,this.loadIncidents(!0)}navigateToCreate(){this.router.navigate(["/incident/create"])}navigateToUpdate(t){this.router.navigate(["/incident",t.id,"update"])}deleteIncident(t){let e=`\xCAtes-vous s\xFBr de vouloir d\xE9placer l'incident #${t.id} vers la corbeille ?

Objet: ${t.object}

Cette action d\xE9placera l'incident vers la corbeille, d'o\xF9 il pourra \xEAtre restaur\xE9 ou supprim\xE9 d\xE9finitivement.`;confirm(e)&&this.incidentDataService.softDeleteIncident(t.id).subscribe({error:n=>{this.notificationService.error("Erreur de mise \xE0 la corbeille",`L'incident n'a pas pu \xEAtre d\xE9plac\xE9. D\xE9tails: ${n.message||n}`)}})}archiveIncident(t){this.incidentDataService.archiveIncident(t.id).subscribe({next:()=>{this.notificationService.success("Incident archiv\xE9",`L'incident #${t.id} "${t.object}" a \xE9t\xE9 archiv\xE9.`)},error:e=>{this.notificationService.error(`Erreur d'archivage. D\xE9tails: ${e.message||e}`)}})}restoreIncident(t){this.incidentDataService.unarchiveIncident(t.id).subscribe({next:()=>{this.notificationService.success("Incident restaur\xE9",`L'incident #${t.id} "${t.object}" a \xE9t\xE9 restaur\xE9.`)},error:e=>{this.notificationService.error(`Erreur de restauration. D\xE9tails: ${e.message||e}`)}})}viewIncidentDetail(t){this.router.navigate(["/incident",t.id])}toggleArchivedView(){let e=this.filterState.advancedFilters.status==="archive"?"":"archive";this.setAdvancedFilter("status",e)}needsValidation(t){return["grave","tres_grave"].includes(t.gravity)&&t.status==="en_attente"&&!t.validated}validateIncident(t){let e=`Valider l'incident "${t.object}" ?

Cela changera son statut vers "En cours".`;confirm(e)&&(this.validating=t.id,this.incidentDataService.validateIncident(t.id).subscribe({next:()=>{this.notificationService.success("Validation r\xE9ussie",`Incident #${t.id} valid\xE9. Statut chang\xE9 vers "En cours".`),this.validating=null},error:n=>{console.error("Erreur validation:",n),this.notificationService.error("Erreur de validation",`Impossible de valider l'incident: ${n.message||n}`),this.validating=null}}))}toggleColumnVisibility(t){this.columnService.toggleColumnVisibility(t)}toggleColumnVisibilityKeepOpen(t){this.columnService.toggleColumnVisibility(t,!0)}resetColumnsToDefault(){this.columnService.resetColumnsToDefault()}getColumnStyle(t){return this.columnService.getColumnStyle(t)}startResize(t,e){this.columnService.startResize(t,e)}startColumnDrag(t,e){this.columnService.startColumnDrag(t,e)}onColumnDragOver(t,e){this.columnService.onColumnDragOver(t,e)}onColumnDrop(t,e){this.columnService.onColumnDrop(t,e)}resetDragState(){this.columnService.resetDragState()}showColumnsMenu(t){this.columnService.showColumnsMenu(t)}hideColumnsMenu(){this.columnService.hideColumnsMenu()}isResizing(t){return this.columnService.isResizing(t)}isDragging(t){return this.columnService.isDragging(t)}isDragOver(t){return this.columnService.isDragOver(t)}onSearch(){this.filterService.setSearchTerm(this.filterState.searchTerm),this.paginationService.resetToFirstPage()}toggleAdvancedSearch(){this.filterService.toggleAdvancedFilters()}setAdvancedFilter(t,e){this.filterService.setAdvancedFilter(t,e),this.paginationService.resetToFirstPage()}resetAdvancedFilters(){this.filterService.resetAdvancedFilters(),this.paginationService.resetToFirstPage()}clearAllFilters(){this.filterService.clearAllFilters(),this.paginationService.resetToFirstPage()}hasActiveFilters(){return this.filterService.hasActiveFilters()}getActiveFilters(){return this.filterService.getActiveFilters()}removeFilter(t,e){this.filterService.removeFilter(t,e),this.paginationService.resetToFirstPage()}sortBy(t){this.sortingService.isSortable(t)&&this.sortingService.sortBy(t)}getSortIcon(t){return this.sortingService.getSortIcon(t)}isSorted(t){return this.sortingService.isSorted(t)}changePageSize(t){this.paginationService.setPageSize(t)}onPageSizeChange(t){let e=t.target;if(e?.value){let n=e.value==="all"?"all":+e.value;this.changePageSize(n)}}goToPage(t){this.paginationService.setCurrentPage(t)}previousPage(){this.paginationService.previousPage()}nextPage(){this.paginationService.nextPage()}formatDateShort(t){return this.incidentDisplayService.formatDateShort(t)}formatTimeShort(t){return this.incidentDisplayService.formatTimeShort(t)}getShortDomain(t){return this.incidentDisplayService.getShortDomain(t)}getShortSiteImpacte(t){return this.incidentDisplayService.getShortSiteImpacte(t)}getStatusTextClass(t){return this.incidentDisplayService.getStatusTextClass(t)}getDomainFilterOptions(){return this.appConfigService.getSelectOptions("domains")}getGravityFilterOptions(){return this.appConfigService.getSelectOptions("gravity")}getStatusFilterOptions(){let t=this.appConfigService.getSelectOptions("status");return this.permissionService.canArchiveIncidents()?t:t.filter(e=>e.value!=="archive")}getSiteFilterOptions(){return this.appConfigService.getSelectOptions("sites")}getGroupedSiteOptions(){return this.appConfigService.getGroupedSiteOptions()}get showColumnMenu(){return this.menuState.show}get columnMenuPosition(){return this.menuState.position}get searchTerm(){return this.filterState.searchTerm}set searchTerm(t){this.filterState=V(E({},this.filterState),{searchTerm:t})}get advancedFilters(){return this.filterState.advancedFilters}get showAdvancedFilters(){return this.filterState.showAdvancedFilters}get sortColumn(){return this.sortState.column}get sortDirection(){return this.sortState.direction}get paginatedIncidents(){return this.paginatedResult.items}get currentPage(){return this.paginationState.currentPage}get pageSize(){return this.paginationState.pageSize}get showAllResults(){return this.paginationState.showAllResults}get availablePageSizes(){return this.paginationService.availablePageSizes}get totalPages(){return this.paginationService.getTotalPages()}get visiblePages(){return this.paginationService.getVisiblePages()}get paginationInfo(){return this.paginatedResult.pagination}applyFiltersAndSort(){this.filteredIncidents=this.filterService.applyFilters(this.incidents),this.filteredIncidents=this.sortingService.applySorting(this.filteredIncidents),this.applyPagination()}applyPagination(){this.paginatedResult=this.paginationService.paginateData(this.filteredIncidents)}getPaginationInfo(){return this.paginatedResult.pagination.displayText}toggleAdminMode(){this.isAdminModeActive=!this.isAdminModeActive}toggleHelp(){this.showHelp=!this.showHelp,this.showTooltip=!1}getIncidentsByStatus(t){return this.incidents.filter(e=>e.status===t)}resetColumnsAndCloseMenu(){this.columnService.resetColumnsToDefault(),setTimeout(()=>{this.hideColumnsMenu()},100)}static \u0275fac=function(e){return new(e||o)(I(Me),I(pe),I(_e),I(ge),I(xe),I(le),I(N),I(te),I(se),I(de),I(ae),I(Ve))};static \u0275cmp=z({type:o,selectors:[["app-incidents"]],decls:7,vars:9,consts:[[1,"bg-gray-50","py-4","px-2","sm:px-4"],[1,"mb-4","sm:mb-6"],[1,"bg-gray-50","flex","items-center","justify-center","py-20","px-4"],[3,"close","export","isVisible","incidents","filteredIncidents","paginatedIncidents","hasActiveFilters","exportType"],[3,"close","isVisible"],[1,"flex","flex-col","lg:flex-row","lg:items-center","lg:justify-between","mb-4","space-y-4","lg:space-y-0"],[1,"text-2xl","sm:text-3xl","font-bold","text-gray-900"],[1,"flex","flex-col","sm:flex-row","sm:items-center","space-y-2","sm:space-y-0","sm:space-x-6"],[1,"text-gray-600","text-sm","sm:text-lg"],[1,"flex","space-x-3","text-sm"],[1,"px-3","py-1","badge-orange","rounded-full","font-medium"],[1,"px-3","py-1","badge-green","rounded-full","font-medium"],[1,"px-3","py-1","badge-purple","rounded-full","font-medium"],[1,"flex","flex-wrap","items-center","justify-between","gap-3"],[1,"flex","flex-wrap","items-center","gap-3"],[1,"inline-flex","items-center","gap-2","px-4","py-2.5","bg-emerald-500","hover:bg-emerald-600","text-white","rounded-xl","shadow-lg","hover:shadow-xl","transition-all","duration-200","transform","hover:-translate-y-0.5","text-sm","font-medium"],[1,"inline-flex","items-center","gap-2","px-4","py-2.5","bg-rose-500","hover:bg-rose-600","text-white","rounded-xl","shadow-lg","hover:shadow-xl","transition-all","duration-200","transform","hover:-translate-y-0.5","text-sm","font-medium"],[1,"inline-flex","items-center","gap-2","px-4","py-2.5","text-white","rounded-xl","shadow-lg","hover:shadow-xl","transition-all","duration-200","transform","hover:-translate-y-0.5","text-sm","font-medium",3,"ngClass"],[1,"inline-flex","items-center","gap-2","px-4","py-2.5","bg-red-500","hover:bg-red-600","text-white","rounded-xl","shadow-lg","hover:shadow-xl","transition-all","duration-200","transform","hover:-translate-y-0.5","text-sm","font-medium"],[1,"inline-flex","items-center","gap-2","px-4","py-2.5","bg-blue-600","hover:bg-blue-700","text-white","rounded-xl","shadow-lg","hover:shadow-xl","transition-all","duration-200","transform","hover:-translate-y-0.5","text-sm","font-medium"],[1,"inline-flex","items-center","gap-2","px-4","py-2.5","bg-purple-500","hover:bg-purple-600","text-white","rounded-xl","shadow-lg","hover:shadow-xl","transition-all","duration-200","transform","hover:-translate-y-0.5","text-sm","font-medium"],[1,"inline-flex","items-center","gap-2","px-4","py-2.5","bg-blue-500","hover:bg-blue-600","text-white","rounded-xl","shadow-lg","hover:shadow-xl","transition-all","duration-200","transform","hover:-translate-y-0.5","text-sm","font-medium"],[1,"inline-flex","items-center","gap-2","px-4","py-2.5","bg-indigo-500","hover:bg-indigo-600","text-white","rounded-xl","shadow-lg","hover:shadow-xl","transition-all","duration-200","transform","hover:-translate-y-0.5","text-sm","font-medium",3,"click"],[1,"text-lg"],[1,"leading-tight"],[1,"inline-flex","items-center","gap-2","px-4","py-2.5","bg-slate-600","hover:bg-slate-700","text-white","rounded-xl","shadow-lg","hover:shadow-xl","transition-all","duration-200","transform","hover:-translate-y-0.5","text-sm","font-medium",3,"click"],[1,"flex","items-center","gap-3"],[1,"relative"],["type","text","placeholder","Rechercher...",1,"pl-10","pr-4","py-2.5","border-0","bg-white","rounded-xl","shadow-lg","focus:ring-2","focus:ring-blue-500","focus:shadow-xl","transition-all","duration-200","w-60","text-sm",3,"ngModelChange","input","ngModel"],[1,"absolute","inset-y-0","left-0","pl-3","flex","items-center","pointer-events-none"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"h-5","w-5","text-gray-400"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"],[1,"inline-flex","items-center","gap-2","px-4","py-2.5","text-blue-600","bg-blue-50","hover:bg-blue-100","rounded-xl","shadow-lg","hover:shadow-xl","transition-all","duration-200","transform","hover:-translate-y-0.5","text-sm","font-medium","border","border-blue-200",3,"click","mouseenter","mouseleave"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"],[1,"absolute","right-0","top-full","mt-3","w-80","bg-white","rounded-2xl","shadow-2xl","border","border-gray-100","p-4","z-50","text-sm"],[1,"mb-4","sm:mb-6","p-4","bg-blue-50","rounded-lg","border","border-blue-200"],[1,"fixed","z-50","bg-white","rounded-lg","shadow-lg","border","border-gray-200","py-2","min-w-[250px]",3,"left","top"],[1,"mb-4","sm:mb-6","p-4","mt-4","bg-white","rounded-lg","shadow-sm","border","border-gray-200"],[1,"mt-4"],[1,"text-center","py-16"],[1,"bg-white","rounded-lg","shadow-sm","border","border-gray-200","overflow-hidden"],[1,"inline-flex","items-center","gap-2","px-4","py-2.5","bg-emerald-500","hover:bg-emerald-600","text-white","rounded-xl","shadow-lg","hover:shadow-xl","transition-all","duration-200","transform","hover:-translate-y-0.5","text-sm","font-medium",3,"click"],[1,"inline-flex","items-center","gap-2","px-4","py-2.5","bg-rose-500","hover:bg-rose-600","text-white","rounded-xl","shadow-lg","hover:shadow-xl","transition-all","duration-200","transform","hover:-translate-y-0.5","text-sm","font-medium",3,"click"],[1,"inline-flex","items-center","gap-2","px-4","py-2.5","text-white","rounded-xl","shadow-lg","hover:shadow-xl","transition-all","duration-200","transform","hover:-translate-y-0.5","text-sm","font-medium",3,"click","ngClass"],[1,"inline-flex","items-center","gap-2","px-4","py-2.5","bg-red-500","hover:bg-red-600","text-white","rounded-xl","shadow-lg","hover:shadow-xl","transition-all","duration-200","transform","hover:-translate-y-0.5","text-sm","font-medium",3,"click"],[1,"inline-flex","items-center","gap-2","px-4","py-2.5","bg-blue-600","hover:bg-blue-700","text-white","rounded-xl","shadow-lg","hover:shadow-xl","transition-all","duration-200","transform","hover:-translate-y-0.5","text-sm","font-medium",3,"click"],[1,"inline-flex","items-center","gap-2","px-4","py-2.5","bg-purple-500","hover:bg-purple-600","text-white","rounded-xl","shadow-lg","hover:shadow-xl","transition-all","duration-200","transform","hover:-translate-y-0.5","text-sm","font-medium",3,"click"],[1,"inline-flex","items-center","gap-2","px-4","py-2.5","bg-blue-500","hover:bg-blue-600","text-white","rounded-xl","shadow-lg","hover:shadow-xl","transition-all","duration-200","transform","hover:-translate-y-0.5","text-sm","font-medium",3,"click"],[1,"flex","items-start","gap-3"],[1,"w-8","h-8","bg-blue-100","rounded-full","flex","items-center","justify-center","flex-shrink-0"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4","text-blue-600"],[1,"space-y-3"],[1,"font-semibold","text-gray-900","text-base"],[1,"space-y-2","text-xs","text-gray-600","leading-relaxed"],[1,"flex","items-start","gap-2"],[1,"w-1","h-1","bg-blue-400","rounded-full","mt-2","flex-shrink-0"],[1,"w-1","h-1","bg-amber-400","rounded-full","mt-2","flex-shrink-0"],[1,"w-1","h-1","bg-green-400","rounded-full","mt-2","flex-shrink-0"],[1,"px-3","py-1.5","text-xs","text-blue-600","hover:text-blue-800","font-medium","bg-blue-50","hover:bg-blue-100","rounded-lg","transition-colors",3,"click"],[1,"flex","flex-col","lg:flex-row","lg:items-center","lg:justify-between","space-y-3","lg:space-y-0"],[1,"flex","flex-col","sm:flex-row","sm:items-center","space-y-2","sm:space-y-0","sm:space-x-3"],[1,"text-sm","font-medium","text-blue-800"],[1,"flex","flex-wrap","gap-2"],[1,"inline-flex","items-center","px-3","py-1","rounded-full","text-sm","badge-blue"],[1,"inline-flex","items-center","px-3","py-2","text-sm","font-medium","text-red-600","hover:text-red-800","hover:bg-red-50","rounded-md","transition-colors",3,"click"],["title","Supprimer ce filtre",1,"ml-2","text-blue-600","hover:text-blue-800","font-bold",3,"click"],[1,"fixed","z-50","bg-white","rounded-lg","shadow-lg","border","border-gray-200","py-2","min-w-[250px]"],[1,"px-4","py-2","border-b","border-gray-200"],[1,"font-medium","text-gray-900"],[1,"px-4","py-2"],[1,"text-sm","font-medium","text-gray-700","mb-2"],[1,"space-y-1"],[1,"flex","items-center","justify-between","text-sm","py-1"],[1,"px-4","py-2","border-t","border-gray-100"],[1,"border-t","border-gray-200","px-4","py-2"],[1,"w-full","text-sm","text-blue-600","hover:text-blue-800","hover:bg-blue-50","py-1","rounded",3,"click"],[1,"text-gray-900"],[1,"text-red-600","hover:text-red-800","text-xs","px-2","py-1","hover:bg-red-50","rounded",3,"click"],[1,"text-gray-500"],[1,"text-green-600","hover:text-green-800","text-xs","px-2","py-1","hover:bg-green-50","rounded",3,"click"],[1,"text-lg","font-semibold","text-gray-800","mb-4"],[1,"grid","grid-cols-1","sm:grid-cols-2","lg:grid-cols-3","xl:grid-cols-4","gap-4"],[1,"block","text-sm","font-medium","text-gray-700","mb-1"],["type","text","placeholder","Ex: 20257",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","focus:ring-2","focus:ring-blue-500",3,"ngModelChange","input","ngModel"],["type","text","placeholder","Ex: Coupure",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","focus:ring-2","focus:ring-blue-500",3,"ngModelChange","input","ngModel"],[1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","focus:ring-2","focus:ring-blue-500",3,"ngModelChange","change","ngModel"],["value",""],[3,"value"],[3,"label"],["type","text","placeholder","Ex: Dupont",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","focus:ring-2","focus:ring-blue-500",3,"ngModelChange","input","ngModel"],["type","text","placeholder","Ex: Martin (\xE0 afficher dans \u{1F527} Colonnes)",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","focus:ring-2","focus:ring-blue-500",3,"ngModelChange","input","ngModel"],["for","date-from",1,"block","text-sm","font-medium","text-gray-700","mb-1"],["type","date","id","date-from","title","Date de d\xE9but de la p\xE9riode",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","focus:ring-2","focus:ring-blue-500",3,"change","value"],["for","date-to",1,"block","text-sm","font-medium","text-gray-700","mb-1"],["type","date","id","date-to","title","Date de fin de la p\xE9riode",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","focus:ring-2","focus:ring-blue-500",3,"change","value"],[1,"flex","items-end"],[1,"w-full","bg-gray-500","text-white","px-4","py-2","rounded-md","hover:bg-gray-600","transition-colors",3,"click"],[1,"spinner","mx-auto"],[1,"text-lg","text-gray-600","mt-4"],[1,"overflow-x-auto"],[1,"w-full","divide-y","divide-gray-200","min-w-full",2,"table-layout","auto"],[1,"bg-gray-50"],["draggable","true",1,"relative","group","px-2","sm:px-4","py-3","sm:py-4","text-center","text-xs","sm:text-sm","font-semibold","text-gray-600","uppercase","tracking-wider","cursor-pointer","hover:bg-gray-100","transition-colors","select-none",3,"style","ngClass"],[1,"px-2","sm:px-4","py-3","sm:py-4","text-center","text-xs","sm:text-sm","font-semibold","text-gray-600","uppercase","tracking-wider","w-20"],[1,"bg-white","divide-y","divide-gray-200"],[1,"hover:bg-gray-50","transition-colors","cursor-pointer"],[1,"px-4","sm:px-6","py-4","border-t","border-gray-200","bg-gray-50"],[1,"flex","flex-col","lg:flex-row","lg:items-center","lg:justify-between","space-y-4","lg:space-y-0"],[1,"flex","flex-col","sm:flex-row","sm:items-center","space-y-2","sm:space-y-0","sm:space-x-4"],[1,"text-sm","text-gray-700"],[1,"flex","items-center","space-x-2"],[1,"text-sm","border","border-gray-300","rounded","px-2","py-1","focus:ring-2","focus:ring-blue-500","bg-white","text-gray-900",3,"change","value"],[3,"value","selected"],["value","all",3,"selected"],[1,"text-sm","text-gray-600"],[1,"pagination","flex","items-center","space-x-1"],[1,"text-sm","text-gray-500"],["draggable","true",1,"relative","group","px-2","sm:px-4","py-3","sm:py-4","text-center","text-xs","sm:text-sm","font-semibold","text-gray-600","uppercase","tracking-wider","cursor-pointer","hover:bg-gray-100","transition-colors","select-none",3,"click","dragstart","dragover","drop","dragend","ngClass"],[1,"flex","items-center","justify-center","space-x-1"],[1,"text-xs"],[1,"absolute","inset-0","bg-yellow-200","opacity-50","pointer-events-none"],["title","Redimensionner la colonne",1,"absolute","top-0","right-0","w-2","h-full","cursor-col-resize","hover:bg-blue-300","opacity-0","group-hover:opacity-100","transition-opacity",3,"mousedown"],[1,"absolute","top-1","right-1","opacity-0","group-hover:opacity-100","transition-opacity"],["title","Masquer cette colonne",1,"text-xs","text-gray-400","hover:text-red-600","p-1",3,"click"],[1,"px-6","py-12","text-center"],[1,"flex","flex-col","items-center","space-y-4"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-16","h-16","text-gray-300"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","1","d","M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"],[1,"text-center"],[1,"text-lg","font-medium","text-gray-700","mb-2"],[1,"text-sm","text-gray-500","mb-4"],[1,"flex","flex-col","sm:flex-row","gap-3","justify-center"],[1,"inline-flex","items-center","px-4","py-2","text-sm","font-medium","text-blue-600","bg-blue-50","hover:bg-blue-100","rounded-md","transition-colors",3,"click"],[1,"inline-flex","items-center","px-4","py-2","text-sm","font-medium","text-gray-600","bg-gray-50","hover:bg-gray-100","rounded-md","transition-colors",3,"click"],[1,"hover:bg-gray-50","transition-colors","cursor-pointer",3,"click"],[1,"px-2","sm:px-4","py-3","sm:py-5","text-xs","sm:text-sm","text-center","overflow-hidden",3,"style"],[1,"px-2","sm:px-4","py-3","sm:py-5","whitespace-nowrap","text-sm","font-medium","text-center"],[1,"px-2","sm:px-4","py-3","sm:py-5","text-xs","sm:text-sm","text-center","overflow-hidden"],[1,"font-mono","text-gray-900"],[1,"text-gray-900","leading-relaxed","max-w-xs","mx-auto"],[1,"flex","flex-wrap","gap-1","justify-center"],[1,"inline-flex","items-center","px-2","sm:px-3","py-1","rounded-full","text-xs","font-medium",3,"ngClass"],[1,"font-mono","leading-relaxed"],[1,"font-mono","text-gray-900","truncate","text-xs","sm:text-sm",3,"title"],[1,"line-clamp-2","leading-relaxed","text-gray-900","text-xs","sm:text-sm",3,"title"],[1,"font-semibold",3,"ngClass"],[1,"whitespace-normal","break-words","text-xs","sm:text-sm",3,"title"],[1,"inline-block","px-2","py-1","text-xs","font-medium","badge-blue","rounded-sm"],[1,"font-semibold","text-xs","sm:text-sm","leading-tight",3,"ngClass"],[1,"font-semibold","text-xs","sm:text-sm",3,"ngClass"],[1,"text-gray-900","text-xs","sm:text-sm"],[1,"text-gray-500","text-xs"],[1,"text-gray-400"],[1,"inline-block","px-2","py-1","text-xs","bg-gray-100","text-gray-700","rounded","border",3,"title"],[1,"inline-flex","items-center","px-2","py-1","rounded-full","text-xs","font-medium","badge-purple"],[1,"px-2","sm:px-4","py-3","sm:py-5","whitespace-nowrap","text-sm","font-medium","text-center",3,"click"],[1,"flex","flex-col","space-y-2","items-center"],["title","Valider cet incident grave",1,"text-green-600","hover:text-green-900","transition-colors",3,"disabled"],["title","Modifier l'incident",1,"text-gray-600","hover:text-gray-900","transition-colors"],["title","Archiver l'incident",1,"text-blue-600","hover:text-blue-900","transition-colors"],["title","D\xE9sarchiver l'incident",1,"text-green-600","hover:text-green-900","transition-colors"],["title","Supprimer l'incident",1,"text-red-600","hover:text-red-900","transition-colors"],["title","Valider cet incident grave",1,"text-green-600","hover:text-green-900","transition-colors",3,"click","disabled"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4","animate-spin"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M5 13l4 4L19 7"],["title","Modifier l'incident",1,"text-gray-600","hover:text-gray-900","transition-colors",3,"click"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"],["title","Archiver l'incident",1,"text-blue-600","hover:text-blue-900","transition-colors",3,"click"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M8 4H6a2 2 0 00-2 2v12a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-2m-4-1v8m0 0l3-3m-3 3L9 8m-5 5h18"],["title","D\xE9sarchiver l'incident",1,"text-green-600","hover:text-green-900","transition-colors",3,"click"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M4 4v5h5M7 9l3 3-3 3"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M20 20v-5h-5M17 15l-3-3 3-3"],["title","Supprimer l'incident",1,"text-red-600","hover:text-red-900","transition-colors",3,"click"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"],[1,"px-2","sm:px-3","py-2","text-sm","border","rounded-md","transition-colors","bg-white","text-gray-700","border-gray-300","hover:bg-gray-50",3,"click","disabled"],[1,"flex","items-center","space-x-1"],[1,"px-2","sm:px-3","py-2","text-sm","border","rounded-md","transition-colors","min-w-[32px]","sm:min-w-[40px]","text-center",3,"disabled","bg-blue-600","text-white","border-blue-600","bg-white","text-gray-700","border-gray-300","hover:bg-gray-50","text-gray-400","cursor-default"],[1,"px-2","sm:px-3","py-2","text-sm","border","rounded-md","transition-colors","min-w-[32px]","sm:min-w-[40px]","text-center",3,"click","disabled"],[1,"max-w-md","w-full","bg-white","rounded-2xl","shadow-xl","p-8"],[1,"flex","justify-center","mb-6"],[1,"w-20","h-20","bg-red-100","rounded-full","flex","items-center","justify-center"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-12","h-12","text-red-600"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"],[1,"text-2xl","font-bold","text-gray-900","text-center","mb-4"],[1,"text-gray-600","text-center","mb-6","leading-relaxed"],[1,"bg-gray-50","rounded-lg","p-4","mb-6"],[1,"text-sm","text-gray-700","mb-2"],[1,"text-sm","text-gray-600","space-y-1","list-disc","list-inside"],[1,"w-full","bg-gray-100","hover:bg-gray-200","text-gray-700","font-medium","py-3","px-4","rounded-lg","transition-colors","duration-200","flex","items-center","justify-center","gap-2",3,"click"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"],[1,"text-xs","text-gray-500","text-center","mt-6"]],template:function(e,n){e&1&&(r(0,"div",0)(1,"div",1),_(2,In,57,22)(3,Tn,28,0,"div",2),a(),r(4,"app-export-modal",3),p("close",function(){return n.closeExportModal()})("export",function(d){return n.onExportExecute(d)}),a(),r(5,"app-diffusion-list",4),p("close",function(){return n.closeDiffusionModal()}),a(),r(6,"app-trash-modal",4),p("close",function(){return n.closeTrashModal()}),a()()),e&2&&(s(2),g(n.permissionService.canViewAllIncidents()?2:3),s(2),h("isVisible",n.showExportModal)("incidents",n.incidents)("filteredIncidents",n.filteredIncidents)("paginatedIncidents",n.paginatedResult.items)("hasActiveFilters",n.hasActiveFilters())("exportType",n.exportModalType),s(),h("isVisible",n.showDiffusionModal),s(),h("isVisible",n.showTrashModal))},dependencies:[R,re,ee,Q,K,X,Z,q,J,ce,ue,me],styles:['.column-header[_ngcontent-%COMP%]{position:relative}.column-header[_ngcontent-%COMP%]:hover{background-color:#f3f4f6;transition:background-color .2s ease}.column-header.sorted[_ngcontent-%COMP%]{background-color:#eff6ff;color:#1d4ed8}.column-header.sorted[_ngcontent-%COMP%]:hover{background-color:#dbeafe}.column-header.resizing[_ngcontent-%COMP%]{border-right:2px solid #3b82f6;-webkit-user-select:none;user-select:none}.column-header.dragging[_ngcontent-%COMP%]{background-color:#fef3c7;opacity:.8;z-index:1000;transform:rotate(2deg);box-shadow:0 4px 12px #00000026}.column-header.drag-over[_ngcontent-%COMP%]{background-color:#dcfce7;border:2px dashed #22c55e}.column-header.drag-over[_ngcontent-%COMP%]:before{content:"";position:absolute;top:0;left:-2px;width:4px;height:100%;background-color:#22c55e}.resize-handle[_ngcontent-%COMP%]{position:absolute;top:0;right:0;width:8px;height:100%;cursor:col-resize;background-color:transparent;z-index:10}.resize-handle[_ngcontent-%COMP%]:hover{background-color:#3b82f64d}.resize-handle.active[_ngcontent-%COMP%]{background-color:#3b82f680}.column-menu[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeInScale .2s ease-out}@keyframes _ngcontent-%COMP%_fadeInScale{0%{opacity:0;transform:scale(.95) translateY(-10px)}to{opacity:1;transform:scale(1) translateY(0)}}td[_ngcontent-%COMP%], th[_ngcontent-%COMP%]{height:60px;vertical-align:middle;box-sizing:border-box;white-space:nowrap;text-overflow:ellipsis}td[_ngcontent-%COMP%]   .badge[_ngcontent-%COMP%], th[_ngcontent-%COMP%]   .badge[_ngcontent-%COMP%]{display:inline-flex;align-items:center;font-weight:600;font-size:.75rem;padding:.25rem .75rem;border-radius:9999px;transition:background-color .2s ease,color .2s ease}td[_ngcontent-%COMP%]   .badge[_ngcontent-%COMP%]:hover, th[_ngcontent-%COMP%]   .badge[_ngcontent-%COMP%]:hover{filter:brightness(1.1)}th[_ngcontent-%COMP%]{position:sticky;top:0;z-index:10}.header-multiline[_ngcontent-%COMP%]{white-space:normal;line-height:1.2}tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{transition:background-color .2s ease,box-shadow .2s ease}tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:#f9fafb;box-shadow:inset 4px 0 #3b82f6}@media (max-width: 1024px){.column-menu[_ngcontent-%COMP%]{max-width:90vw;max-height:80vh;overflow-y:auto}}@media (max-width: 768px){.cards-container[_ngcontent-%COMP%]{display:block}}.cursor-col-resize[_ngcontent-%COMP%]{cursor:col-resize}.column-header[_ngcontent-%COMP%]:focus, .resize-handle[_ngcontent-%COMP%]:focus{outline:2px solid #3b82f6;outline-offset:2px}@media (prefers-reduced-motion: reduce){.column-menu[_ngcontent-%COMP%], .tooltip[_ngcontent-%COMP%]:after, .tooltip[_ngcontent-%COMP%]:before{transition:none;animation:none}}.line-clamp-2[_ngcontent-%COMP%]{display:-webkit-box;-webkit-line-clamp:2;line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}']})};export{ze as Incidents};
